window.__require=function t(e,i,a){function n(s,r){if(!i[s]){if(!e[s]){var l=s.split("/");if(l=l[l.length-1],!e[l]){var c="function"==typeof __require&&__require;if(!r&&c)return c(l,!0);if(o)return o(l,!0);throw new Error("Cannot find module '"+s+"'")}s=l}var h=i[s]={exports:{}};e[s][0].call(h.exports,function(t){return n(e[s][1][t]||t)},h,h.exports,t,e,i,a)}return i[s].exports}for(var o="function"==typeof __require&&__require,s=0;s<a.length;s++)n(a[s]);return n}({AudioMgr:[function(t,e,i){"use strict";cc._RF.push(e,"f417bXnQTJI8rwxu3MiBOjU","AudioMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Singleton"),s=a("ConfigMgr"),r=a("DataMgr"),l=a("ResMgr"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.musicEnable=!0,e.effectEnable=!0,e.vibrate=!0,e.music="",e}return __extends(e,t),e.prototype.playEffect=function(t){if(!this.effectEnable)return-1;var e=s.default.Instance().getTableValue("id",t,cfgTable.audioData).name;l.default.Instance().loadAndGetResSync("sounds",e,function(t,i){!t&&i?cc.audioEngine.playEffect(i,!1):console.error("\u52a0\u8f7d\u8d44\u6e90\u9519\u8bef:"+e+" err:",t)},cc.AudioClip)},e.prototype.stopEffect=function(t){cc.audioEngine.stopEffect(t)},e.prototype.playMusic=function(t){var e=this,i=s.default.Instance().getTableValue("id",t,cfgTable.audioData);this.music=i.name,this.musicEnable&&(cc.audioEngine.setMusicVolume(1),l.default.Instance().loadAndGetResSync("sounds",this.music,function(t,i){!t&&i?(cc.audioEngine.stopMusic(),cc.audioEngine.playMusic(i,!0)):console.error("\u52a0\u8f7d\u8d44\u6e90\u9519\u8bef:"+e.music+" err:",t)},cc.AudioClip))},e.prototype.stopMusic=function(){cc.audioEngine.stopMusic()},e.prototype.setMusicEnabled=function(t){this.musicEnable=t,r.default.Instance().Save_AudioData()},e.prototype.getMusicEnable=function(){return this.musicEnable},e.prototype.setEffectEnabled=function(t){this.effectEnable=t,r.default.Instance().Save_AudioData()},e.prototype.getEffectEnable=function(){return this.effectEnable},e.prototype.setVibrateEnabled=function(t){this.vibrate=t,r.default.Instance().Save_AudioData()},e.prototype.getVibrateEnabled=function(){return this.vibrate},e}(o.default);n.default=c,cc._RF.pop()},{}],BaitRoleBase:[function(t,e,i){"use strict";cc._RF.push(e,"edcd2RmHq9Ip4tX6PPgGlx2","BaitRoleBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.BaitRoleBase=void 0;var o=a("CompBase"),s=a("BattleFightMgr"),r=a("ConfigMgr"),l=a("EventMgr"),c=a("IVector2"),h=a("TweenMaterial"),d=a("UtilOne"),u=a("typeEnum"),p=a("DataMgr"),f=a("AudioMgr"),g=a("Global"),m=a("SkillMgr"),y=a("RoleBase"),v=a("BattleFightPanel"),b=a("DungeonFightMgr"),_=cc._decorator,T=_.ccclass,S=_.property,D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bady=null,e.icon=null,e.weapon=null,e.other=null,e.bullet="",e.bulletPos=cc.v2(0,0),e.bulletRotation=0,e.bulletScale=1,e.bulletEff="",e.health=null,e.levelUrl="",e.warriorsname="",e.attack=1,e.hp=1,e.curHp=0,e.defense=1,e.attackDis=2,e.moveSpeed=1,e.sputRange=1,e.sputAttack=1,e.attakInterval=1,e.attakIngInterval=.5,e.perpetualAttack=!1,e.playReverse=!1,e.attackAim=!1,e.killRewards=1,e.needFood=1,e.damageToOurBuild=1,e.damageToOtherBuild=1,e.bulletspeed=.2,e.id=0,e.isEnemy=!1,e.target=null,e.anim=null,e.roleDate=null,e.rigidbody=null,e.bodySpeed=cc.v2(0,0),e.physics=null,e.OtherPhysics=0,e.selfPhysics=0,e.roleBaseType=u.RoleBaseType.Birth,e.OnAttackAim=!1,e.playReverseing=!1,e.NowAttackType=u.AttackType.Default,e.Birthpoint={myBirthpoint:cc.v2(-375,-25),enemyBirthpoint:cc.v2(375,-25)},e.nowBirthpoint=null,e.moveToBulidUse=0,e.canMove=!0,e.skillList=[],e.moveSpeedScale=1,e.animTimeScale=1,e.attackTimeScale=1,e}return __extends(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.physics=this.getComponent(cc.PhysicsCircleCollider),this.health=this.findElement("health",cc.ProgressBar),this.moveToBulidUse=d.default.rand(40,135),this.addEvent()},e.prototype.addEvent=function(){var t=this;l.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this),l.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this)},e.prototype.getCurHp=function(){return this.curHp},e.prototype.getId=function(){return this.id},e.prototype.initRole=function(t,e,i,a){return __awaiter(this,void 0,void 0,function(){var n,o,l,c,h,d,f,m,y;return __generator(this,function(){return this.canMove=!0,this.fightplan=a,this.isEnemy=t,n=1,o=1,l=1,c=p.default.Instance().getPlayerData().getCardsTotalAddition(),this.roleDate=r.default.Instance().getTableValue("warriorsid",e,cfgTable.warriorsData),this.isEnemy?(h=cfgTable.commonData.aiidaktcorrect.find(function(t){return t[0]==e}),d=s.default.Instance().enemyLevels,o*=Number(d.aihpcorrect),n*=Number(d.aiaktcorrect),h&&(n*=Number(h[1]))):(f=c.find(function(t){return t.type==u.CardAddType.RoleAtk}),(m=c.find(function(t){return t.type==u.CardAddType.RoleHP}))&&(o+=m.addition),f&&(n+=f.addition)),(y=c.find(function(t){return t.type==u.CardAddType.coinAdd}))&&(l+=y.addition),this.id=i,this.attack=this.roleDate.attack*n,this.defense=this.roleDate.armor,this.hp=Number(this.roleDate.hp)*o,this.curHp=this.hp,this.warriorsname=g.Global.languageMgr.getText(Number(this.roleDate.nameid)),this.damageToOtherBuild=Number(this.roleDate.enemybasedamage),this.damageToOurBuild=this.roleDate.ourbasedamage,this.attackDis=this.roleDate.attackdistance,this.attakInterval=Number(this.roleDate.attackspeed),this.attakIngInterval=this.roleDate.attakIngInterval,this.perpetualAttack=!!this.roleDate.perpetualAttack,this.playReverse=!!this.roleDate.playReverse,this.moveSpeed=this.roleDate.movespeed,this.sputAttack=this.roleDate.splashdamage,this.sputRange=this.roleDate.splashrange,this.needFood=this.roleDate.Needfood,this.killRewards=Math.round(this.roleDate.Killrewards*l),this.bulletspeed=this.roleDate.bulletspeed?Number(this.roleDate.bulletspeed):.2,this.OtherPhysics=0,this.NowAttackType=u.AttackType.Default,this.OnAttackAim=!1,this.playReverseing=!1,this.roleBaseType=u.RoleBaseType.Birth,this.skillList=[],this.onShow(),[2]})})},e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2]})})},e.prototype.attackOver=function(){var t=this;this.isDeath()||this.NowAttackType==u.AttackType.Over||(this.NowAttackType=u.AttackType.Over,this.OnAttackAim=!1,this.roleBaseType=u.RoleBaseType.Interval,this.scheduleOnce(function(){t.roleBaseType=u.RoleBaseType.Move},this.attakInterval))},e.prototype.attackEnd=function(){this.isDeath()||this.NowAttackType==u.AttackType.End||(this.NowAttackType=u.AttackType.End,this.playReverseing||(this.perpetualAttack?this.playReverse?(this.anim.on(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.playReverseAttack(u.AttackType.AinmIng)):this.prepareAtk():this.playAttack(u.AttackType.AinmOver)))},e.prototype.playAtkAuio=function(){this.roleDate.audioId&&f.default.Instance().playEffect(Number(this.roleDate.audioId))},e.prototype.onplayReverse=function(){this.playReverseing=!1,this.anim.off(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.prepareAtk()},e.prototype.onGoAtk=function(){if(this.NowAttackType!=u.AttackType.OnGo&&(this.NowAttackType=u.AttackType.OnGo,!this.playReverseing)){this.playAtkAuio();for(var t=this.isEnemy?v.default.roleList:v.default.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"otherBase"==n.name||"selfBase"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}if(e.minDts<=this.attackDis);else if(!(i.minDts<=this.attackDis))return;this.roleDate.warriortype}},e.prototype.prepareAtk=function(){if(!this.isDeath()&&this.NowAttackType!=u.AttackType.Prepare){this.NowAttackType=u.AttackType.Prepare;for(var t=this.isEnemy?v.default.roleList:v.default.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"otherBase"==n.name||"selfBase"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}e.minDts<=this.attackDis?this.prepareAtkTo(e):i.minDts<=this.attackDis?this.prepareAtkTo(i):this.playAttack(u.AttackType.AinmOver)}},e.prototype.attackedFunc=function(t,e,i){var a=i;if(t&&(a=t[0]),!this.isDeath()){this.hp-=a,f.default.Instance().playEffect(4);var n=this.bady.getComponent(cc.Sprite),o=new h.TweenMaterial(n,"time",0);cc.tween(o).to(.1,{mainAny:1}).to(.1,{mainAny:0}).start(),this.health.node.active=!0,this.health.progress=this.hp/this.curHp;var r=this.health.node.getChildByName("white");if(r.active=!0,r.width=(this.hp+a)/this.curHp*52,cc.tween(r).to(.2,{width:this.hp/this.curHp*52}).call(function(){r.active=!1}).start(),this.hp<=0){if(this.roleBaseType=u.RoleBaseType.Dide,this.isEnemy){var c=this.killRewards,d=this.fightplan.gold.convertToWorldSpaceAR(cc.v3(0,0)),y=this.node.convertToWorldSpaceAR(cc.v3(0,0));s.default.Instance().coinChange=!0,l.default.Instance().emitCoinEffect(y,d,function(){f.default.Instance().playEffect(21),s.default.Instance().addCoinNum(c),s.default.Instance().coinChange=!1}),p.default.Instance().getPlayerData().addCurTaskCount(1,2)}var v=this.node.getContentSize().height;l.default.Instance().emitRoleDie(this.node.convertToWorldSpaceAR(cc.v2(0,v/2)),v/56.6);var b=g.Global.common.getRoleList(m.default.ins.panel,m.default.ins.panelType),_=b.indexOf(this);_>-1&&b.splice(_,1),this.node.destroy()}}},e.prototype.prepareAtkTo=function(t){!t.base||t.base.isDeath()?this.playAttack(u.AttackType.AinmOver):(this.target=t.base,this.startAtk())},e.prototype.onGoAtkTo=function(t){t.base&&!t.base.isDeath()?this.target=t.base:this.attackEnd()},e.prototype.startAtk=function(){var t=this;this.isDeath()||(this.attackAim&&(this.OnAttackAim=!0),this.scheduleOnce(function(){t.target&&!t.target.isDeath()?t.playAttack(u.AttackType.AinmIng):t.playAttack(u.AttackType.AinmOver)},this.attakIngInterval))},e.prototype.playAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(){return this.isDeath()?[2]:(e=this.anim.getClips(),this.anim.play(e[t].name).wrapMode=cc.WrapMode.Normal,[2])})})},e.prototype.playReverseAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(){return this.isDeath()?[2]:(e=this.anim.getClips(),this.anim.play(e[t].name).wrapMode=cc.WrapMode.Reverse,this.playReverseing=!0,[2])})})},e.prototype.detectionDis=function(){for(var t=g.Global.common.getEnemyList(m.default.ins.panel,m.default.ins.panelType),e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node,o=this.getDistance(this.node,n);"otherBase"==n.name||"selfBase"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}this.roleBaseType==u.RoleBaseType.Attack&&this.attackAim&&this.OnAttackAim&&(e.minDts<=this.attackDis?this.setAimTo(e):i.minDts<=this.attackDis&&this.setAimTo(i)),this.roleBaseType==u.RoleBaseType.Move&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.roleBaseType=u.RoleBaseType.Interval:i.minDts<=this.attackDis&&(this.roleBaseType=u.RoleBaseType.Interval)),2==this.roleDate.warriortype&&(this.roleBaseType==u.RoleBaseType.Attack?("enemy_3"!=this.node.group&&"my_3"!=this.node.group||(this.node.group=this.isEnemy?"enemy_2":"my_2"),this.bodySpeed=cc.v2(c.Vector2.ZERO)):("enemy_2"!=this.node.group&&"my_2"!=this.node.group||(this.node.group=this.isEnemy?"enemy_3":"my_3"),this.bodySpeed=this.bodySpeed)),this.OtherPhysics>0&&50!=this.physics.density?(this.physics.density=50,this.physics.apply()):10!=this.physics.density&&(this.physics.density=10,this.physics.apply()),this.roleBaseType==u.RoleBaseType.Interval&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.bodySpeed=cc.v2(c.Vector2.ZERO):i.minDts<=this.attackDis&&(this.bodySpeed=cc.v2(c.Vector2.ZERO))),b.default.Instance().isEnd||s.default.Instance().isEnd||(this.bodySpeed.x*=this.moveSpeedScale,this.bodySpeed.y*=this.moveSpeedScale,this.rigidbody.linearVelocity=this.bodySpeed)},e.prototype.setMoveTo=function(t){var e=t.base.node.getPosition(),i=this.node.getPosition();if("otherBase"==t.base.node.name||"selfBase"==t.base.node.name){var a=t.base.node.getPosition();e={x:a.x,y:a.y+this.moveToBulidUse}}var n={x:0,y:0};c.Vector2.sub(n,e,i);var o=c.Vector2.len(n),s=new c.Vector2(n.x/o,n.y/o);this.bodySpeed.x=s.x*this.moveSpeed,this.bodySpeed.y=s.y*this.moveSpeed},e.prototype.setAtkTo=function(t){t.base&&!t.base.isDeath()&&(this.target=t.base,this.bodySpeed=cc.v2(c.Vector2.ZERO),this.playAttack(u.AttackType.AinmStart),this.roleBaseType=u.RoleBaseType.Attack)},e.prototype.setAimTo=function(t){if(t.base&&!t.base.isDeath()){this.target=t.base;var e=new c.Vector2(this.node.position),i=new c.Vector2(this.target.node.position),a=c.Vector2.angle360(e,i);this.weapon.angle=a}},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},e.prototype.move=function(){this.rigidbody&&this.isValid&&(!s.default.Instance().isEnd&&this.canMove?this.isDeath()||(this.roleBaseType==u.RoleBaseType.Birth?this.moveOn():this.detectionDis()):this.rigidbody.linearVelocity=cc.v2(c.Vector2.ZERO))},e.prototype.moveOn=function(){this.roleBaseType=u.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBirth=function(){this.roleBaseType=u.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBeginContact=function(t,e,i){if(i.node){var a=i.node.getComponent(y.RoleBase);a&&this.isEnemy!=a.isEnemy?this.OtherPhysics+=1:this.selfPhysics+=1}},e.prototype.onEndContact=function(t,e,i){if(i.node){var a=i.node.getComponent(y.RoleBase);a&&this.isEnemy!=a.isEnemy?this.OtherPhysics-=1:this.selfPhysics-=1}},e.prototype.isDeath=function(){return this.roleBaseType==u.RoleBaseType.Dide},e.prototype.setHp=function(t){this.hp=t,this.health.progress=this.hp/this.curHp},e.prototype.getHp=function(){return this.hp},e.prototype.setCurHp=function(t){this.curHp=t,this.health.progress=this.hp/this.curHp},e.prototype.getAtk=function(){return this.attack},e.prototype.setAtk=function(t){this.attack=t},e.prototype.onDestroy=function(){console.log(1)},__decorate([S(cc.Sprite)],e.prototype,"bady",void 0),__decorate([S(cc.Sprite)],e.prototype,"icon",void 0),__decorate([S(cc.Node)],e.prototype,"weapon",void 0),__decorate([S(cc.Sprite)],e.prototype,"other",void 0),__decorate([S()],e.prototype,"bullet",void 0),__decorate([S(cc.Vec2)],e.prototype,"bulletPos",void 0),__decorate([S()],e.prototype,"bulletRotation",void 0),__decorate([S()],e.prototype,"bulletScale",void 0),__decorate([S()],e.prototype,"bulletEff",void 0),__decorate([T],e)}(o.default);n.BaitRoleBase=D,cc._RF.pop()},{}],BaitRole:[function(t,e,i){"use strict";cc._RF.push(e,"819b7Jb++VPQrVFPmYl8htf","BaitRole");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("UtilOne"),s=a("typeEnum"),r=a("BaitRoleBase"),l=cc._decorator,c=l.ccclass,h=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(){return 1==this.roleDate.warriortype?this.node.group=this.isEnemy?"enemy":"my":this.node.group=this.isEnemy?"enemy_3":"my_3",this.bady.spriteFrame&&this.bady.spriteFrame.name,this.icon.spriteFrame&&this.icon.spriteFrame.name,this.other.spriteFrame&&this.other.spriteFrame.name,this.other.spriteFrame?this.other.node.active=!0:this.other.node.active=!1,this.icon.spriteFrame,this.health.node.setPosition(0,this.bady.spriteFrame.getRect().height+10),this.health.node.active=!1,t=this.bady.spriteFrame.getRect().height,this.physics.offset=cc.v2(0,t/4),this.physics.radius=t/4,this.physics.apply(),this.node.setContentSize(this.bady.spriteFrame.getRect().width,this.bady.spriteFrame.getRect().height),e=o.default.randInt(-1,1),i=o.default.randInt(-1,1),this.isEnemy?(this.nowBirthpoint=cc.v2(this.Birthpoint.enemyBirthpoint.x+e,this.Birthpoint.enemyBirthpoint.y+i),this.node.setPosition(this.nowBirthpoint)):(this.nowBirthpoint=cc.v2(this.Birthpoint.myBirthpoint.x+e,this.Birthpoint.myBirthpoint.y+i),this.node.setPosition(this.nowBirthpoint)),this.roleBaseType=s.RoleBaseType.Birth,[2]})})},__decorate([c],e)}(r.BaitRoleBase));n.default=h,cc._RF.pop()},{}],BattleFightMgr:[function(t,e,i){"use strict";cc._RF.push(e,"ec8759XYwNN16qDLPkXIfQq","BattleFightMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("TalentBase"),r=a("Singleton"),l=a("EventMgr"),c=cc._decorator,h=c.ccclass,d=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.playerlevel=1,e.levels=null,e.enemyLevels=null,e._suspend=!1,e._coinNum=0,e._isEnd=!1,e.coinChange=!1,e.RoleMap=new Map([[10011,{pos:cc.v2(0,19),scale:1.5,rotation:-10,anchor:cc.v2(.1,.2),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[10012,{pos:cc.v2(1.5,13.5),scale:1,rotation:0,anchor:cc.v2(.5,.5),bulletPos:cc.v2(-22,20),bulletRotation:null,bulletScale:1,otherPos:null}],[10013,{pos:cc.v2(-8,53),scale:1,rotation:0,anchor:cc.v2(.5,.5),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[10021,{pos:cc.v2(-1,47),scale:.9,rotation:0,anchor:cc.v2(.3,.7),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[10022,{pos:cc.v2(-10.5,17),scale:1,rotation:0,anchor:cc.v2(.3,.7),bulletPos:cc.v2(48,43),bulletRotation:0,bulletScale:1,otherPos:null}],[10023,{pos:cc.v2(14,27),scale:1,rotation:180,anchor:cc.v2(.3,.22),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[10031,{pos:cc.v2(24,35),scale:1,rotation:67,anchor:cc.v2(.5,.5),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[10032,{pos:cc.v2(24,35),scale:1,rotation:40,anchor:cc.v2(.3,.2),bulletPos:cc.v2(26,56),bulletRotation:null,bulletScale:2,otherPos:null}],[10033,{pos:cc.v2(24,53),scale:1,rotation:0,anchor:cc.v2(.5,.5),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[10041,{pos:cc.v2(24,35),scale:1,rotation:67,anchor:cc.v2(.5,.5),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[10042,{pos:cc.v2(16.5,21),scale:1,rotation:-20,anchor:cc.v2(.3,.5),bulletPos:cc.v2(31,13.5),bulletRotation:null,bulletScale:1,otherPos:null}],[10043,{pos:cc.v2(24,21),scale:1,rotation:0,anchor:cc.v2(.3,.5),bulletPos:cc.v2(49,23),bulletRotation:null,bulletScale:1,otherPos:cc.v2(26,10)}],[10051,{pos:cc.v2(4,18),scale:1,rotation:0,anchor:cc.v2(.2,.3),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[10052,{pos:cc.v2(4,18),scale:1,rotation:-20,anchor:cc.v2(.2,.3),bulletPos:cc.v2(49,23),bulletRotation:null,bulletScale:1,otherPos:null}],[10053,{pos:cc.v2(24.5,25),scale:1,rotation:0,anchor:cc.v2(.1,.5),bulletPos:cc.v2(31,12),bulletRotation:null,bulletScale:1,otherPos:cc.v2(5,11)}],[10061,{pos:cc.v2(6,18),scale:1,rotation:-40,anchor:cc.v2(.1,.2),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[10062,{pos:cc.v2(10,18),scale:1,rotation:-20,anchor:cc.v2(.2,.3),bulletPos:cc.v2(19,16),bulletRotation:null,bulletScale:1,otherPos:null}],[10063,{pos:cc.v2(10,18),scale:1,rotation:0,anchor:cc.v2(.5,.5),bulletPos:cc.v2(17,-6),bulletRotation:null,bulletScale:1,otherPos:null}],[20011,{pos:cc.v2(-6,13),scale:1,rotation:0,anchor:cc.v2(.1,.15),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[20012,{pos:cc.v2(8,19),scale:1,rotation:0,anchor:cc.v2(.5,.5),bulletPos:cc.v2(-22.5,20),bulletRotation:90,bulletScale:1,otherPos:null}],[20013,{pos:cc.v2(-11,54),scale:1,rotation:0,anchor:cc.v2(.5,.5),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[20021,{pos:cc.v2(-8,16),scale:1,rotation:0,anchor:cc.v2(.3,.35),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[20022,{pos:cc.v2(23,24),scale:1,rotation:0,anchor:cc.v2(.5,.5),bulletPos:cc.v2(24.5,13),bulletRotation:null,bulletScale:1,otherPos:null}],[20023,{pos:cc.v2(0,16),scale:1,rotation:0,anchor:cc.v2(.3,.3),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[20031,{pos:cc.v2(10,20.5),scale:1,rotation:0,anchor:cc.v2(.3,.3),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[20032,{pos:cc.v2(9.5,24),scale:1,rotation:0,anchor:cc.v2(.5,.5),bulletPos:cc.v2(26,7.5),bulletRotation:null,bulletScale:1,otherPos:null}],[20033,{pos:cc.v2(-4,100),scale:1.5,rotation:-60,anchor:cc.v2(.3,.5),bulletPos:cc.v2(45,19),bulletRotation:5,bulletScale:1,otherPos:null}],[20041,{pos:cc.v2(2,16),scale:1,rotation:0,anchor:cc.v2(.3,.35),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[20042,{pos:cc.v2(1,22),scale:1,rotation:0,anchor:cc.v2(.4,.68),bulletPos:cc.v2(65,19.5),bulletRotation:null,bulletScale:1,otherPos:null}],[20043,{pos:cc.v2(-6.8,24),scale:1,rotation:-20,anchor:cc.v2(.35,.55),bulletPos:cc.v2(53,7.4),bulletRotation:null,bulletScale:1,otherPos:null}],[20051,{pos:cc.v2(1,15),scale:1,rotation:0,anchor:cc.v2(.2,.3),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[20052,{pos:cc.v2(5,19),scale:1,rotation:0,anchor:cc.v2(.3,.3),bulletPos:cc.v2(21,21),bulletRotation:null,bulletScale:1,otherPos:null}],[20053,{pos:cc.v2(20,63),scale:1,rotation:0,anchor:cc.v2(.15,.4),bulletPos:cc.v2(64,7),bulletRotation:2.5,bulletScale:1,otherPos:cc.v2(0,57.5)}],[20061,{pos:cc.v2(1.7,20),scale:1,rotation:0,anchor:cc.v2(.45,.45),bulletPos:null,bulletRotation:null,bulletScale:1,otherPos:null}],[20062,{pos:cc.v2(11,21),scale:1,rotation:-20,anchor:cc.v2(.45,.55),bulletPos:cc.v2(40,8),bulletRotation:null,bulletScale:1,otherPos:null}],[20063,{pos:cc.v2(10,18),scale:1,rotation:0,anchor:cc.v2(.5,.5),bulletPos:cc.v2(58,21),bulletRotation:0,bulletScale:1,otherPos:null}]]),e}return __extends(e,t),Object.defineProperty(e.prototype,"coinNum",{get:function(){return this._coinNum},set:function(t){this._coinNum=t,l.default.Instance().emitFightCoin()},enumerable:!1,configurable:!0}),e.prototype.addCoinNum=function(t,e){void 0===e&&(e=!1);var i=o.Global.talentSkillMgr.run(s.ETalentType.coinGet,t,e);this.coinNum=this.coinNum+=i},Object.defineProperty(e.prototype,"isEnd",{get:function(){return this._isEnd},set:function(t){this._isEnd=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"suspend",{get:function(){return this._suspend},set:function(t){this._suspend=t,this._suspend?cc.director.pause():cc.director.resume()},enumerable:!1,configurable:!0}),__decorate([h],e)}(r.default));n.default=d,cc._RF.pop()},{}],BattleFightPanel:[function(t,e,i){"use strict";cc._RF.push(e,"3018eKPjnlD5KQmMIS0uwEQ","BattleFightPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("BattleFightMgr"),r=a("ConfigMgr"),l=a("DataMgr"),c=a("EventMgr"),h=a("ResMgr"),d=a("UtilOne"),u=a("DieAnimPre"),p=a("typeEnum"),f=a("BuildBase"),g=a("Bullet"),m=a("AudioMgr"),y=a("Global"),v=a("SkillMgr"),b=a("TimeScaleScript"),_=a("TalentBase"),T=a("Role"),S=cc._decorator,D=S.ccclass,k=S.property,C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selfBase=null,e.otherBase=null,e.meatGrowth=null,e.meatCount=null,e.cards=[],e.coin=null,e.diamond=null,e.costs=[],e.btnBgs=[],e.bullet=null,e.gameFactory=null,e.dieAnimShow=null,e.dieShowP=null,e.bg=null,e.selfBase_1=null,e.selfBase_2=null,e.otherBase_1=null,e.otherBase_2=null,e.jiantou=null,e.timeScale=null,e.timeScalePrefab=null,e.meatAdBtn=null,e.gold=null,e.levelNum=null,e.suspendBtn=null,e.meatPlay=null,e.battleFightStartText=null,e.die=null,e.dieShow=null,e.meatNum=0,e.gameData=null,e.id=0,e.dieshowlist=[],e.data=null,e.canUpdate=!1,e.isShowEffect=!0,e.Birthpoint={myBirthpoint:cc.v2(-375,-25),enemyBirthpoint:cc.v2(375,-25)},e.gameTime=0,e.warriortime=0,e.createRoleIndex=[],e.meatTimeScale=1,e.skillTimeScale=1,e.sendTroopsTimeScale=1,e}var i;return __extends(e,t),i=e,e.prototype.onLoad=function(){cc.game.on(cc.game.EVENT_SHOW,function(){console.log("\u8fdb\u5165\u524d\u53f0"),m.default.Instance().playMusic(1)},this),this.node.getComponent(cc.Widget).updateAlignment(),s.default.Instance().isEnd=!1,s.default.Instance().playerlevel=l.default.Instance().getPlayerData().getMaxLevel(),console.log(r.default.Instance().getTableValue("ID",s.default.Instance().playerlevel,cfgTable.evolutionData)),s.default.Instance().levels=r.default.Instance().getTableValue("ID",s.default.Instance().playerlevel,cfgTable.evolutionData),this.gold=this.findElement("uiPanel/top/gold/lay"),this.meatAdBtn=this.findElement("uiPanel/buttonRoot/meatAdBtn"),this.levelNum=this.findElement("uiPanel/top/levelNum",cc.Label),this.suspendBtn=this.findElement("uiPanel/top/suspendBtn"),this.meatPlay=this.findElement("uiPanel/buttonRoot/meatPlay"),this.battleFightStartText=this.findElement("uiPanel/top/battleFightStartTextBg/battleFightStartText",cc.Node),this.critNode=this.findElement("fightContent/Crit"),this.addBtnevent(),this.addEvent(),cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().gravity=cc.v2(),cc.director.getPhysicsManager().enabledAccumulator=!0,cc.PhysicsManager.FIXED_TIME_STEP=1/60,cc.PhysicsManager.VELOCITY_ITERATIONS=8,cc.PhysicsManager.POSITION_ITERATIONS=8,cc.PhysicsManager.PTM_RATIO=32,cc.PhysicsManager.FIXED_TIME_STEP=.01,i.roleNodePool=new cc.NodePool,i.bulletNodePool=new cc.NodePool,i.dieNodePool=new cc.NodePool,i.dieShowPool=new cc.NodePool,l.default.Instance().getPlayerData().getGuideStep()<=p.GuideStep.GetDoubleReward?this.suspendBtn.active=!1:this.suspendBtn.active=!0;var t=cc.instantiate(this.timeScalePrefab);t.getComponent(b.default).isCountdown=!0,this.timeScale.addChild(t)},e.prototype.onEnable=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return m.default.Instance().playMusic(1),c.default.Instance().onCloseBattlePanel(this.emitCloseMe,this),c.default.Instance().emitRefreshTask(),c.default.Instance().onGuideChange(this.recoverTime,this),c.default.Instance().onGameTimePause(this.pauseTime,this),m.default.Instance().playEffect(7),[2]})})},e.prototype.loadRes=function(){for(var t=[],e=0,i=this.getWarriorsInof();e<i.length;e++){var a=i[e];t.push(a.warriorsid)}this.loadBundle("level_"+s.default.Instance().playerlevel,t);var n=r.default.Instance().getTableValue("ID",s.default.Instance().enemyLevels.ID,cfgTable.evolutionData);this.loadBundle("level_"+n.ID,n.warriorsid)},e.prototype.loadBundle=function(t,e){var i=new h.PreloadConf;i.Init(t,t),cc.assetManager.loadBundle(t,function(a,n){if(a)console.error("\u52a0\u8f7dbundle:"+t+" \u9519\u8bef:"+a);else{i.setBundle(n);for(var o=[],s=0,r=e;s<r.length;s++){var l=r[s];o.push("Role_"+l)}i.AddLoadFiles(h.AssetsType.ATPrefab,o),h.default.Instance().loadRes(i,function(){}),i.AddPreloadFiles(h.AssetsType.ATPrefab,o),h.default.Instance().preloadRes(i)}})},e.prototype.update=function(t){var e=this;if(this.canUpdate&&this.gameData){var a=t*this.skillTimeScale;v.default.ins.update(a),t*=this.sendTroopsTimeScale,this.gameTime+=t,this.sortNode(),this.cardShow();for(var n=0;n<i.enemyList.length;++n)i.enemyList[n].move(t);for(n=0;n<i.roleList.length;++n)i.roleList[n].move(t);if(this.gameTime>this.warriortime&&this.data){this.gameTime+=this.warriortime;for(var o=this.data,s=function(t){var i=o.time[t][0];if(r.gameTime>i&&-1==r.createRoleIndex.indexOf(t)){for(var a=Number(o.time[t][2]),n=0;n<a;++n)r.scheduleOnce(function(){e.createRole(!0,Number(o.time[t][1]))},cfgTable.commonData.warriortime/1e3*n);r.createRoleIndex.push(t)}},r=this,l=0;l<o.time.length;++l)s(l)}var c=this.data.time[0][0]-1.5*this.meatTimeScale;this.gameTime>=c&&this.showBattleFightStartTextEffect()}},e.prototype.onDisable=function(){cc.Tween.stopAllByTag(p.TweenTag.meat),this.dieShowP.destroyAllChildren(),m.default.Instance().stopMusic()},e.prototype.onDestroy=function(){cc.director.getPhysicsManager().enabled=!1,i.roleList=[],i.enemyList=[],i.roleNodePool.clear(),i.dieNodePool.clear(),i.dieShowPool.clear()},e.prototype.guideShow=function(){this.gameData.getGuideList(0)?this.jiantou.active=this.gameData.getGuideList(0)&&this.gameData.getGuideList(1)&&!this.gameData.getGuideList(2):this.jiantou.active=!0},e.prototype.oncome=function(){this.canUpdate=!0,this.id=0,this.gameData=l.default.Instance().getPlayerData(),this.meatNum=s.default.Instance().levels.defaultfood,this.meatNum=0,this.meatCount.string=""+this.meatNum,this.initPanel(),this.meatAdBtnShow()},e.prototype.cardShow=function(){var t=this.getWarriorsInof(),e=0;for(var i in t){var a=t[i];this.meatNum>=a.Needfood?this.btnBgs[e].active&&(this.cards[e].getComponent(cc.Button).interactable=!0,this.btnBgs[e].active=!1):this.btnBgs[e].active||(this.cards[e].getComponent(cc.Button).interactable=!1,this.btnBgs[e].active=!0),e+=1}},e.prototype.getWarriorsInof=function(t){void 0===t&&(t=s.default.Instance().levels);for(var e=t.warriorsid,i=[],a=0;a<e.length;a++){var n=e[a],o=r.default.Instance().getTableValue("warriorsid",n,cfgTable.warriorsData);o&&i.push(o)}return i},e.prototype.addBtnevent=function(){this.suspendBtn.on("click",this.clicksuspendBtn,this),this.meatAdBtn.on("click",this.clickMeatAdBtn,this)},e.prototype.clicksuspendBtn=function(){c.default.Instance().emitShowPanel({prefab:"prefab/MainPanel/suspendPanel"})},e.prototype.clickMeatAdBtn=function(){var t=this;y.Global.umSDK.send(p.EnumDefine.fieldName.play_AD,{type:p.EnumDefine.fieldDes.addMeatOnPlayStat,lv:l.default.Instance().getPlayerData().getMaxLevel()}),y.Global.sdkMgr.openAd(function(){var e=t.gameData.getMeatLevel(),i=r.default.Instance().getTableValue("ID",e,cfgTable.skillData).adfood;t.meatNum+=i,t.meatCount.string=""+t.meatNum,t.gameData.addMeataAdNum(1),m.default.Instance().playEffect(6),t.meatAdBtn.active=!1,l.default.Instance().getPlayerData(),y.Global.umSDK.send(p.EnumDefine.fieldName.play_AD,{type:p.EnumDefine.fieldDes.addMeatOnPlayEnd,lv:l.default.Instance().getPlayerData().getMaxLevel()})},null)},e.prototype.addEvent=function(){var t=this;c.default.Instance().onFireBullet(function(e){var a;(a=i.bulletNodePool.size()>0?i.bulletNodePool.get():cc.instantiate(t.bullet)).getComponent(g.default).initBullet(e),t.gameFactory.addChild(a)},this),c.default.Instance().onRoleDie(this.onDieShow,this),c.default.Instance().onFightCoin(this.UpdateGold,this),c.default.Instance().onCoinChange(this.setCoinShow,this),c.default.Instance().onDiamondChange(this.setDiamondShow,this),c.default.Instance().onTimeScaleChange(this.initTimeScale,this)},e.prototype.meatAdBtnShow=function(){this.gameData=l.default.Instance().getPlayerData();var t=this.gameData.getMeataAdNum(),e=cfgTable.commonData.adfoodnumber,i=y.Global.sdkMgr.curSdk.option.parameter;if(i&&i.adfoodnumber&&-1!=i.adfoodnumber&&(e=i.adfoodnumber),t>=e)this.meatAdBtn.active=!1;else{var a=this.gameData.getMeatLevel(),n=r.default.Instance().getTableValue("ID",a,cfgTable.skillData);this.meatAdBtn.active=!0,this.meatAdBtn.getChildByName("num").getComponent(cc.Label).string=""+n.adfood}},e.prototype.sortNode=function(){this.gameFactory.children.sort(function(t,e){return t.y+1<e.y-1?1:t.y-1>e.y+1?-1:0})},e.prototype.meatNumUp=function(t){var e=this;void 0===t&&(t=0);var i=this.gameData.getMeatLevel(),a=r.default.Instance().getTableValue("ID",i,cfgTable.skillData),n=y.Global.common.getFoodNumber(a.foodnumber),o=1/n;n>=2?(cc.Tween.stopAllByTag(p.TweenTag.meat),this.meatGrowth.fillRange=0,this.meatGrowth.node.active=!1,this.meatPlay.active=!0,this.meatTween=cc.tween(this),this.meatTween.repeatForever(cc.tween().delay(o).call(function(){e.meatNum+=1,e.meatCount.string=""+e.meatNum,l.default.Instance().getPlayerData().addCurTaskCount(1,3),e.meatNum>=3&&e.initGuide()})).tag(p.TweenTag.meatTow).start()):(this.meatGrowth.fillRange=t,this.meatGrowth.node.active=!0,this.meatPlay.active=!1,t&&(o*=1-t),cc.Tween.stopAllByTag(p.TweenTag.meatTow),this.meatTween=cc.tween(this.meatGrowth),this.meatTween.repeatForever(cc.tween().to(o,{fillRange:1}).call(function(){e.meatNum+=1,e.meatCount.string=""+e.meatNum,e.meatGrowth.fillRange=0;var t=l.default.Instance().getPlayerData();o=1/n,t.addCurTaskCount(1,3),e.meatNum>=3&&e.initGuide()})).tag(p.TweenTag.meat).start())},e.prototype.initPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,a,n,o,s,r;return __generator(this,function(l){switch(l.label){case 0:for(s=0;s<t;s++)e=cc.instantiate(this.bullet),i.bulletNodePool.put(e);return this.die?[3,2]:(a=this,[4,h.default.Instance().loadAndGetRes("res","prefab/animPre/DieAnimPre")]);case 1:a.die=l.sent(),l.label=2;case 2:for(s=0;s<t;s++)n=cc.instantiate(this.die),i.dieNodePool.put(n);return this.dieShow?[3,4]:(o=this,[4,h.default.Instance().loadAndGetRes("res","prefab/MainPanel/DieShowPre")]);case 3:o.dieShow=l.sent(),l.label=4;case 4:for(s=0;s<t;s++)r=cc.instantiate(this.dieShow),i.dieShowPool.put(r);return[2]}})})},e.prototype.initBase=function(){return __awaiter(this,void 0,void 0,function(){var t,e,a,n,o;return __generator(this,function(){return s.default.Instance().enemyLevels=this.data,i.enemyList.push(this.otherBase.getComponent(f.default)),i.roleList.push(this.selfBase.getComponent(f.default)),t=this.gameData.getBuildLevel(),e=r.default.Instance().getTableValue("ID",t,cfgTable.skillData),this.id++,a=s.default.Instance().playerlevel%6==0?6:s.default.Instance().playerlevel%6,n=e["basenumber"+a]||e.basenumber,o=y.Global.talentSkillMgr.run(_.ETalentType.baseHp,n,!1),this.selfBase.getComponent(f.default).initBase({hp:o,fightplan:this,id:this.id}),this.id++,this.otherBase.getComponent(f.default).initBase({hp:s.default.Instance().enemyLevels.enemybasehp,fightplan:this,id:this.id}),[2]})})},e.prototype.initGuide=function(){var t=this,e=l.default.Instance().getPlayerData().getGuideStep();e==p.GuideStep.ProductionSchedule&&this.scheduleOnce(function(){t.pauseTime(),y.Global.guideMgr.showGuidePanel(t.node,t.findElement("uiPanel/buttonRoot"))},.5),e==p.GuideStep.FoodSatisfaction&&this.meatNum>=3&&(this.pauseTime(),this.scheduleOnce(function(){y.Global.guideMgr.showGuidePanel(t.node,t.findElement("uiPanel/buttonRoot"))}))},e.prototype.initMeat=function(){this.meatNum=s.default.Instance().levels.defaultfood,this.meatCount.string=""+this.meatNum,this.meatNumUp()},e.prototype.initCards=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o,r,d,u,f=this;return __generator(this,function(g){switch(g.label){case 0:for(r in t=this.getWarriorsInof(),e=0,i=this.gameData.getUnlocked(),a=function(a){var o,r,d;return __generator(this,function(u){switch(u.label){case 0:return o=t[a],n.cards[e].active=-1!=i.indexOf(o.warriorsid),n.costs[e].string=""+o.Needfood,r=y.Global.common.getBdPrePath(s.default.Instance().playerlevel),[4,h.default.Instance().loadAndGetRes(r,"roleIcon",cc.SpriteAtlas)];case 1:return d=u.sent(),n.cards[e].getChildByName("bg").getChildByName("bgMask").getChildByName("logo").getComponent(cc.Sprite).spriteFrame=d.getSpriteFrame(String(o.warriorsid)),n.cards[e].on("click",function(){f.meatNum>=o.Needfood&&(y.Global.sdkMgr.vibrateShort("medium"),f.meatNum-=o.Needfood,f.meatCount.string=""+f.meatNum,f.createRole(!1,o.warriorsid),f.cardShow(),l.default.Instance().getPlayerData().getGuideStep()==p.GuideStep.FoodSatisfaction&&(c.default.Instance().emitGuideChange(l.default.Instance().getPlayerData().getGuideStep()),y.Global.guideMgr.changeGuideStep(p.GuideStep.FoodSatisfaction,p.GuideStep.GetDoubleReward)),0==Number(a)?l.default.Instance().getPlayerData().addCurTaskCount(1,6):1==Number(a)?l.default.Instance().getPlayerData().addCurTaskCount(1,7):2==Number(a)&&l.default.Instance().getPlayerData().addCurTaskCount(1,8))}),e+=1,[2]}})},n=this,o=[],t)o.push(r);d=0,g.label=1;case 1:return d<o.length?(u=o[d],[5,a(u)]):[3,4];case 2:g.sent(),g.label=3;case 3:return d++,[3,1];case 4:return[2]}})})},e.prototype.initGold=function(){s.default.Instance().coinNum=0,this.setCoinShow(),this.setDiamondShow()},e.prototype.setCoinShow=function(t){void 0===t&&(t=0),this.coin.string=t?""+d.default.ChangeNumberUnit(t):""+l.default.Instance().getPlayerData().getUserCoinStr()},e.prototype.setDiamondShow=function(t){void 0===t&&(t=0),this.diamond.string=t?""+d.default.ChangeNumberUnit(t):""+l.default.Instance().getPlayerData().getDiamondStr()},e.prototype.UpdateGold=function(){var t=s.default.Instance().coinNum;this.gold.getChildByName("num").getComponent(cc.Label).string=d.default.ChangeNumberUnit(t),cc.tween(this.gold).to(.1,{scale:1.1}).to(.1,{scale:1}).start()},e.prototype.createRole=function(t,e){void 0===t&&(t=!1),i.roleNodePool.size();var a="level_"+s.default.Instance().playerlevel;t&&(a="level_"+s.default.Instance().enemyLevels.ID);var n=h.default.Instance().getRes(a,"Role_"+e);if(n){var o;o=cc.instantiate(n),this.id++,o.name=this.id+"",o.x=0;var r=o.getComponent(T.default);if(this.gameFactory.addChild(o),o.opacity=0,1!=this.meatTimeScale){var c=y.Global.common.getTimeScale();r.moveSpeedScale=c[1],r.animTimeScale=c[2],r.attackTimeScale=c[3]}t?(o.scaleX=-1,o.setPosition(this.Birthpoint.enemyBirthpoint),i.enemyList.push(o.getComponent(T.default))):(o.scaleX=1,o.setPosition(this.Birthpoint.myBirthpoint),i.roleList.push(o.getComponent(T.default)),l.default.Instance().getPlayerData().addCurTaskCount(1,4)),r.initRole(t,e,this.id,this),t||v.default.ins.buffSkillWork(r)}else console.error("\u4e3bUI\u9884\u5236\u4f53\u4e22\u5931!")},e.prototype.initWithParam=function(t){console.log("\u901a\u8fc7\u53c2\u6570\u521d\u59cb\u5316",t),this.data=t,s.default.Instance().enemyLevels=t;var e=y.Global.dataMgr.getPlayerData().getTimeLine(),i=s.default.Instance().enemyLevels.evolution-6*(e-1);this.levelNum.string=e+" - "+i,this.randerUI(),this.oncome()},e.prototype.initPanel=function(){this.gameData=l.default.Instance().getPlayerData(),this.cards.forEach(function(t){t.active=!1}),this.initGold(),this.initPool(),this.initMeat(),this.initCards(),this.initBase(),this.initGuide(),this.loadRes(),this.initBattleFightStartTextEffect(),v.default.ins.init(v.EFightPanel.battle,this),y.Global.heroMgr.init(v.EFightPanel.battle,this),this.initTimeScale()},e.prototype.randerUI=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o,l,c,d,u,p,f;return __generator(this,function(g){switch(g.label){case 0:return t=y.Global.common.getBdPrePath(s.default.Instance().enemyLevels.evolution),[4,h.default.Instance().loadAndGetRes(t,"images/bg",cc.SpriteFrame)];case 1:return e=g.sent(),i="images/base_1",a="images/base_2",[4,h.default.Instance().findRes(t,"images","images/base_3")];case 2:return g.sent()&&(i="images/base_3"),[4,h.default.Instance().findRes(t,"images","images/base_4")];case 3:return g.sent()&&(a="images/base_4"),[4,h.default.Instance().loadAndGetRes(t,i,cc.SpriteFrame)];case 4:return n=g.sent(),[4,h.default.Instance().loadAndGetRes(t,a,cc.SpriteFrame)];case 5:return o=g.sent(),this.otherBase_1.spriteFrame=n,this.otherBase_2.spriteFrame=o,this.bg.spriteFrame=e,l=this.gameData.getMaxLevel(),c=r.default.Instance().getTableValue("ID",l,cfgTable.levelData),d=c.evolution,u=y.Global.common.getBdPrePath(d),[4,h.default.Instance().loadAndGetRes(u,"images/base_1",cc.SpriteFrame)];case 6:return p=g.sent(),[4,h.default.Instance().loadAndGetRes(u,"images/base_2",cc.SpriteFrame)];case 7:return f=g.sent(),this.selfBase_1.spriteFrame=p,this.selfBase_2.spriteFrame=f,[2]}})})},e.prototype.destroyRole=function(){cc.director.getPhysicsManager().enabled=!1},e.prototype.onDieShow=function(t,e){var a=d.default.getnodePoolNode(i.dieNodePool,this.die);a.scale=e,a&&(this.dieAnimShow.addChild(a),a.getComponent(u.default).init(t));var n=d.default.getnodePoolNode(i.dieShowPool,this.dieShow);n&&(this.dieShowP.addChild(n),n.setPosition(this.dieShowP.convertToNodeSpaceAR(t)))},e.prototype.pauseTime=function(){var t=this;this.scheduleOnce(function(){t.canUpdate=!1}),cc.Tween.stopAllByTag(p.TweenTag.meat),cc.Tween.stopAllByTag(p.TweenTag.meatTow);for(var e=0;e<i.enemyList.length;++e)i.enemyList[e].canMove=!1;for(e=0;e<i.roleList.length;++e)i.roleList[e].canMove=!1},e.prototype.recoverTime=function(t){if(t==p.GuideStep.FoodUnsatisfied||t==p.GuideStep.FoodSatisfaction||t>=p.GuideStep.Complete){this.canUpdate=!0,this.meatNumUp(this.meatGrowth.fillRange);for(var e=0;e<i.enemyList.length;++e)i.enemyList[e].canMove=!0;for(e=0;e<i.roleList.length;++e)i.roleList[e].canMove=!0}},e.prototype.addMeat=function(t){this.meatNum+=t,this.meatCount.string=""+this.meatNum},e.prototype.initBattleFightStartTextEffect=function(){this.data?(this.isShowEffect=!0,this.battleFightStartText.parent.opacity=255,this.battleFightStartText.opacity=255):this.battleFightStartText.opacity=0},e.prototype.showBattleFightStartTextEffect=function(){var t=this;if(this.isShowEffect){var e=1/this.meatTimeScale;this.isShowEffect=!1,cc.tween(this.battleFightStartText).repeat(3,cc.tween().to(.25*e,{opacity:0}).to(.25*e,{opacity:255})).call(function(){cc.tween(t.battleFightStartText.parent).to(.25*e,{opacity:0}).start()}).start()}},e.prototype.initTimeScale=function(){if(this.meatTween){var t=y.Global.common.getTimeScale();this.meatTimeScale=t[0],this.sendTroopsTimeScale=t[5],this.meatTween._finalAction._speedMethod=!0,this.meatTween._finalAction._speed=this.meatTimeScale;for(var e=0,a=i.roleList;e<a.length;e++)(s=a[e]).moveSpeedScale=t[1],s.animTimeScale=t[2],s.attackTimeScale=t[3];for(var n=0,o=i.enemyList;n<o.length;n++){var s;(s=o[n]).moveSpeedScale=t[1],s.animTimeScale=t[2],s.attackTimeScale=t[3]}v.default.ins.timeScale=t[4],this.skillTimeScale=t[4];for(var r=0,l=v.default.ins.skillBtnItemArr;r<l.length;r++)l[r].timeScale=t[4]}},e.roleList=[],e.enemyList=[],e.roleNodePool=null,e.bulletNodePool=null,e.dieNodePool=null,e.dieShowPool=null,__decorate([k({type:cc.Node,displayName:"\u6211\u65b9\u57fa\u5730"})],e.prototype,"selfBase",void 0),__decorate([k({type:cc.Node,displayName:"\u5bf9\u65b9\u57fa\u5730"})],e.prototype,"otherBase",void 0),__decorate([k({type:cc.Sprite,displayName:"\u8089\u7684\u589e\u957f"})],e.prototype,"meatGrowth",void 0),__decorate([k({type:cc.Label,displayName:"\u8089\u7684\u6570\u91cf"})],e.prototype,"meatCount",void 0),__decorate([k({type:cc.Node,displayName:"\u5361\u724c"})],e.prototype,"cards",void 0),__decorate([k({type:cc.Label,displayName:"\u91d1\u5e01"})],e.prototype,"coin",void 0),__decorate([k({type:cc.Label,displayName:"\u94bb\u77f3"})],e.prototype,"diamond",void 0),__decorate([k(cc.Label)],e.prototype,"costs",void 0),__decorate([k(cc.Node)],e.prototype,"btnBgs",void 0),__decorate([k(cc.Prefab)],e.prototype,"bullet",void 0),__decorate([k(cc.Node)],e.prototype,"gameFactory",void 0),__decorate([k(cc.Node)],e.prototype,"dieAnimShow",void 0),__decorate([k(cc.Node)],e.prototype,"dieShowP",void 0),__decorate([k(cc.Sprite)],e.prototype,"bg",void 0),__decorate([k(cc.Sprite)],e.prototype,"selfBase_1",void 0),__decorate([k(cc.Sprite)],e.prototype,"selfBase_2",void 0),__decorate([k(cc.Sprite)],e.prototype,"otherBase_1",void 0),__decorate([k(cc.Sprite)],e.prototype,"otherBase_2",void 0),__decorate([k(cc.Node)],e.prototype,"jiantou",void 0),__decorate([k(cc.Node)],e.prototype,"timeScale",void 0),__decorate([k(cc.Prefab)],e.prototype,"timeScalePrefab",void 0),i=__decorate([D],e)}(o.default);n.default=C,cc._RF.pop()},{}],BattlePanel:[function(t,e,i){"use strict";cc._RF.push(e,"47f13BVnDpKX4GtysYkwiJ7","BattlePanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("BattleFightMgr"),r=a("ConfigMgr"),l=a("DataMgr"),c=a("EventMgr"),h=a("ResMgr"),d=a("typeEnum"),u=a("TimeScaleScript"),p=a("gameShareAdsVideo"),f=cc._decorator,g=f.ccclass,m=f.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.battleBtn=null,e.settingBtn=null,e.mapBg=null,e.leftBtn=null,e.rightBtn=null,e.selfBase_1=null,e.selfBase_2=null,e.otherBase_1=null,e.otherBase_2=null,e.timeScale=null,e.timeScalePrefab=null,e.curGameData=null,e.gameData=null,e.count=0,e.curLevel=0,e.timeLine=1,e}return __extends(e,t),e.prototype.start=function(){var t=this;this.battleBtn.on("click",function(){p.recording_Video_Start(),o.Global.umSDK.send(d.EnumDefine.fieldName.play_level,{lv:l.default.Instance().getPlayerData().getMaxLevel()}),o.Global.sdkMgr.vibrateShort("medium"),c.default.Instance().emitShowPanel({data:t.curGameData,prefab:"prefab/MainPanel/BattleFightPanel"}),o.Global.guideMgr.changeGuideStep(d.GuideStep.StartFight,d.GuideStep.ProductionSchedule)}),this.settingBtn.on("click",function(){c.default.Instance().emitShowPanel({prefab:"prefab/MainPanel/SettingPanel"})}),c.default.Instance().onGameOver(function(e,i){e&&(t.gameData.addMiniLevel(t.count),t.initPanel(),o.Global.umSDK.send(d.EnumDefine.fieldName.new_level_pass,{lv:l.default.Instance().getPlayerData().getMinLevel()},!0));var a=l.default.Instance().getPlayerData(),n=s.default.Instance().levels.basemoney>0,r=s.default.Instance().coinNum>0,h=n&&i,u=n&&1==a.getTimeLine()&&1==a.getMinLevel()&&1==a.getMaxLevel();r||h||u?c.default.Instance().emitShowPanel({prefab:"prefab/MainPanel/GameOverPanel",data:{win:e}}):(l.default.Instance().getPlayerData().setPassInfo(),c.default.Instance().emitCloseBattlePanel())},this),this.leftBtn.on("click",function(){t.count--,t.count<=1+6*(t.timeLine-1)&&(t.count=1+6*(t.timeLine-1),t.leftBtn.active=!1),t.count<t.curLevel&&(t.rightBtn.active=!0),t.initArrow(),t.randerUI()},this),this.rightBtn.on("click",function(){t.count++,t.count>=t.curLevel&&(t.count=t.curLevel,t.rightBtn.active=!1),t.count<t.curLevel&&(t.leftBtn.active=!0),t.initArrow(),t.randerUI()},this),this.initPanel(),this.initArrow()},e.prototype.randerUI=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,s,l,c,d,u;return __generator(this,function(p){switch(p.label){case 0:return this.curGameData=r.default.Instance().getTableValue("ID",this.count,cfgTable.levelData),t=o.Global.common.getBdPrePath(this.count),[4,h.default.Instance().loadAndGetRes(t,"images/bg",cc.SpriteFrame)];case 1:return e=p.sent(),this.mapBg.spriteFrame=e,i="images/base_1",a="images/base_2",[4,h.default.Instance().findRes(t,"images","images/base_3")];case 2:return p.sent()&&(i="images/base_3"),[4,h.default.Instance().findRes(t,"images","images/base_4")];case 3:return p.sent()&&(a="images/base_4"),[4,h.default.Instance().loadAndGetRes(t,i,cc.SpriteFrame)];case 4:return n=p.sent(),[4,h.default.Instance().loadAndGetRes(t,a,cc.SpriteFrame)];case 5:return s=p.sent(),this.otherBase_1.spriteFrame=n,this.otherBase_2.spriteFrame=s,l=this.gameData.getMaxLevel(),c=o.Global.common.getBdPrePath(l),[4,h.default.Instance().loadAndGetRes(c,"images/base_1",cc.SpriteFrame)];case 6:return d=p.sent(),[4,h.default.Instance().loadAndGetRes(c,"images/base_2",cc.SpriteFrame)];case 7:return u=p.sent(),this.selfBase_1.spriteFrame=d,this.selfBase_2.spriteFrame=u,[2]}})})},e.prototype.onEnable=function(){c.default.Instance().onRefreshBattleUI(this.initPanel,this),c.default.Instance().onCloseBattlePanel(this.initArrow,this),this.showArrowEffect(),this.initArrow()},e.prototype.initPanel=function(){this.gameData=l.default.Instance().getPlayerData(),this.curLevel=this.gameData.getMinLevel(),this.curGameData=r.default.Instance().getTableValue("ID",this.curLevel,cfgTable.levelData),this.timeLine=this.gameData.getTimeLine(),console.log(this.curLevel,"\u6e38\u620f\u5173\u5361\u4fe1\u606f\uff1a",this.curGameData),this.count=this.curLevel;var t=cc.instantiate(this.timeScalePrefab);t.getComponent(u.default).isCountdown=!1,this.timeScale.addChild(t),this.randerUI()},e.prototype.initArrow=function(){this.rightBtn.active=this.leftBtn.active=this.curLevel!=1+6*(this.timeLine-1),this.count>=this.curLevel&&(this.count=this.curLevel,this.rightBtn.active=!1),this.count<=1+6*(this.timeLine-1)&&(this.leftBtn.active=!1)},e.prototype.showArrowEffect=function(){cc.tween(this.leftBtn).then(cc.jumpTo(.2,cc.v2(this.leftBtn.x,this.leftBtn.y),10,1)).start(),cc.tween(this.rightBtn).then(cc.jumpTo(.2,cc.v2(this.rightBtn.x,this.rightBtn.y),10,1)).start()},__decorate([m({type:cc.Node,displayName:"\u5f00\u59cb\u6218\u6597\u6309\u94ae"})],e.prototype,"battleBtn",void 0),__decorate([m({type:cc.Node,displayName:"\u8bbe\u7f6e\u6309\u94ae"})],e.prototype,"settingBtn",void 0),__decorate([m({type:cc.Sprite,displayName:"\u80cc\u666f"})],e.prototype,"mapBg",void 0),__decorate([m(cc.Node)],e.prototype,"leftBtn",void 0),__decorate([m(cc.Node)],e.prototype,"rightBtn",void 0),__decorate([m(cc.Sprite)],e.prototype,"selfBase_1",void 0),__decorate([m(cc.Sprite)],e.prototype,"selfBase_2",void 0),__decorate([m(cc.Sprite)],e.prototype,"otherBase_1",void 0),__decorate([m(cc.Sprite)],e.prototype,"otherBase_2",void 0),__decorate([m(cc.Node)],e.prototype,"timeScale",void 0),__decorate([m(cc.Prefab)],e.prototype,"timeScalePrefab",void 0),__decorate([g],e)}(cc.Component);n.default=y,cc._RF.pop()},{}],BossBuild:[function(t,e,i){"use strict";cc._RF.push(e,"472b7xXOlxKqqRv7KcalOIa","BossBuild");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("AudioMgr"),r=a("EventMgr"),l=a("TweenMaterial"),c=a("UtilOne"),h=a("typeEnum"),d=a("DungeonFightMgr"),u=cc._decorator,p=u.ccclass,f=u.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.xueliang=null,e.xueliangNum=null,e.anim=null,e.hp=0,e.curHp=0,e.iocn_1=null,e.iocn_2=null,e.material=[],e.fightplan=null,e.id=1e8,e.killRewards=null,e.canMove=!0,e.tween=cc.tween().to(.1,{mainAny:9.99}).to(.1,{mainAny:0}).tag(h.TweenTag.white),e.tweenDie=cc.tween().to(2,{mainAny:9.99}).tag(h.TweenTag.buildDie),e}return __extends(e,t),e.prototype.onEnable=function(){this.addEvent(),this.uiSet()},e.prototype.addEvent=function(){var t=this;r.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this),r.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this)},e.prototype.uiSet=function(){this.anim.node.active=!1,this.iocn_1.setMaterial(0,this.material[0]),this.iocn_2.setMaterial(0,this.material[0])},e.prototype.attackedFunc=function(t,e,i,a){var n=this,o=i;if(t&&(o=t[1]),!(this.hp<=0)){if(o>=this.hp&&(o=this.hp),this.hp-=o,s.default.Instance().playEffect(5),this.playEff(t),this.hp<=0)return this.hp=0,s.default.Instance().playEffect(8),d.default.Instance().isEnd=!0,this.playDie(),this.xueliangNum.string="0",this.xueliang.progress=0,this.scheduleOnce(function(){r.default.Instance().emitBossGameOver(!1),n.anim.stopSystem(),n.anim.node.active=!1},2.2),this.xueliangNum.string=""+c.default.ChangeNumberUnit(this.hp,1),void(this.xueliang.progress=this.hp/this.curHp);if(this.xueliangNum.string=""+c.default.ChangeNumberUnit(this.hp,1),this.xueliang.progress=this.hp/this.curHp,a){for(var l=this.fightplan.roleList,h=[],u=0;u<l.length;++u)if(!l[u].isDeath()){var p=l[u].node;this.node!=p&&this.getDistance(this.node,p)<=a&&h.push(l[u])}h.forEach(function(t){t.attackedFunc(null,e,i,null)})}}},e.prototype.playEff=function(t){var e=this.xueliang.node.getChildByName("white");e.active=!0,e.width=(this.hp+t)/this.curHp*62,cc.tween(e).to(.2,{width:this.hp/this.curHp*62}).call(function(){e.active=!1}).start();var i=new l.TweenMaterial(this.iocn_1,"time",0),a=new l.TweenMaterial(this.iocn_2,"time",0);if(this.tween.clone().target(i).start(),this.tween.clone().target(a).start(),s.default.Instance().getVibrateEnabled()){o.Global.sdkMgr.vibrateShort("heavy");var n=cc.v3(c.default.randInt(-3,3),c.default.randInt(-3,3));cc.tween(this.node.parent).to(.1,{position:n}).to(.1,{position:cc.v3(0,0,0)}).start()}},e.prototype.playDie=function(){cc.Tween.stopAllByTag(h.TweenTag.white),this.anim.node.active=!0,this.anim.resetSystem(),this.iocn_1.setMaterial(0,this.material[1]),this.iocn_2.setMaterial(0,this.material[1]);var t=new l.TweenMaterial(this.iocn_1,"time",0),e=new l.TweenMaterial(this.iocn_2,"time",0);this.tweenDie.clone().target(t).start(),this.tweenDie.clone().target(e).start()},e.prototype.getHp=function(){return this.hp},e.prototype.subHp=function(t){this.hp-=t},e.prototype.isDeath=function(){return this.hp<=0},e.prototype.initBase=function(t){this.hp=t.hp,this.curHp=t.hp,this.xueliangNum.string=""+c.default.ChangeNumberUnit(this.curHp,1),this.xueliang.progress=this.hp/this.curHp,this.fightplan=t.fightplan,this.id=t.id},e.prototype.move=function(){},e.prototype.getId=function(){return this.id},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},__decorate([f(cc.ProgressBar)],e.prototype,"xueliang",void 0),__decorate([f(cc.Label)],e.prototype,"xueliangNum",void 0),__decorate([f(cc.ParticleSystem)],e.prototype,"anim",void 0),__decorate([f(cc.Sprite)],e.prototype,"iocn_1",void 0),__decorate([f(cc.Sprite)],e.prototype,"iocn_2",void 0),__decorate([f(cc.Material)],e.prototype,"material",void 0),__decorate([p],e)}(cc.Component);n.default=g,cc._RF.pop()},{}],BossDropItem:[function(t,e,i){"use strict";cc._RF.push(e,"e5418/snvxI1Yq/KItkwaQF","BossDropItem");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("CompBase"),s=a("TweenMaterial"),r=cc._decorator,l=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.logo=null,e.bg=null,e.new=null,e.isnew=!1,e.spr=null,e}return __extends(e,t),e.prototype.init=function(t,e){this.isnew=e,this.spr=t,this.logo=this.findElement("logo",cc.Sprite),this.bg=this.findElement("bg",cc.Sprite),this.new=this.findElement("new"),this.showUI()},e.prototype.showUI=function(){this.new.active=!1,this.bg.node.opacity=255,this.logo.node.opacity=0,this.logo.spriteFrame=this.spr;var t=new s.TweenMaterial(this.bg,"time",1);cc.tween(t).to(.5,{mainAny:0}).start(),cc.tween(this.logo.node).delay(.1).to(.5,{opacity:255}).start(),this.isnew&&(this.new.active=!0)},__decorate([l],e)}(o.default));n.default=c,cc._RF.pop()},{}],BossDropPanel:[function(t,e,i){"use strict";cc._RF.push(e,"cb05f5uhmBGL6oAOLqIiUr9","BossDropPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("EquipMgr"),l=a("EventMgr"),c=a("ResMgr"),h=a("typeEnum"),d=a("DungeonFightMgr"),u=a("BossDropItem"),p=cc._decorator,f=p.ccclass,g=p.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.item=null,e.content=null,e.get=null,e.isFullScreen=!1,e.isget=!1,e.time=0,e}return __extends(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.content=this.findElement("content"),this.get=this.findElement("content/get"),this.isget=!1,this.time=0,this.uiSet(),this.startShow()},e.prototype.onEnable=function(){},e.prototype.onDisable=function(){},e.prototype.emitCloseMe=function(){t.prototype.emitCloseMe.call(this)},e.prototype.uiSet=function(){this.content.opacity=0},e.prototype.startShow=function(){var t=this;cc.tween(this.content).to(.3,{opacity:255}).call(function(){t.getdrop(),l.default.Instance().emitCloseBossBattlePanel()}).start(),this.schedule(this.showEnd,.1)},e.prototype.getdrop=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o;return __generator(this,function(s){switch(s.label){case 0:return t=d.default.Instance().Bossleve.battle,e=r.default.ins.getRandEquip(t),i=null,e?[4,c.default.Instance().loadAndGetRes("equip","res/equip",cc.SpriteAtlas)]:[3,2];case 1:a=s.sent(),i=a.getSpriteFrame(e+""),s.label=2;case 2:return n=cc.instantiate(this.item),o=r.default.ins.isEquipNew(e),r.default.ins.getEquip(e),n.getComponent(u.default).init(i,o),n.parent=this.get,this.isget=!0,[2]}})})},e.prototype.showEnd=function(){var t=this;this.time+=.1,this.isget&&this.time>=3&&(this.unschedule(this.showEnd),cc.tween(this.content).to(.3,{opacity:0}).call(function(){var e=d.default.Instance().Bossleve.id;d.default.Instance().dieNum=0;var i=o.Global.dataMgr.getPlayerData(),a=i.getBossKays(),n=i.getBossMaxLevel();a>0&&(a-=1,i.setBossKays(a)),e>=n&&(n<h.MaxLevel.Boss?n+=1:n=h.MaxLevel.Boss),i.setBossMaxLevel(n),t.emitCloseMe()}).start())},__decorate([g(cc.Prefab)],e.prototype,"item",void 0),__decorate([f],e)}(s.default);n.default=m,cc._RF.pop()},{}],BossDropProbabilityPanel:[function(t,e,i){"use strict";cc._RF.push(e,"05fe1SzGcVCV6wTid7iBzMB","BossDropProbabilityPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("ConfigMgr"),r=cc._decorator,l=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.BtnClose=null,e.LabelProbability=[],e.isFullScreen=!1,e.battle=null,e.cfg=null,e}return __extends(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.BtnClose=this.findElement("content/close"),this.LabelProbability=[];for(var e=0;e<4;e++)this.LabelProbability.push(this.findElement("content/Label_probability_"+(e+1),cc.Label))},e.prototype.onEnable=function(){this.subClicks(this.BtnClose),this.addClicks(this.BtnClose)},e.prototype.onDisable=function(){this.subClicks(this.BtnClose)},e.prototype.initWithParam=function(t){console.log("\u5f53\u524d\u7684\u8fdb\u5165\u7b49\u7ea7",t),this.battle=t,this.cfg=s.default.Instance().getTableValue("battle",t,cfgTable.bosslevelData),this.probabilityShow()},e.prototype.emitCloseMe=function(){t.prototype.emitCloseMe.call(this)},e.prototype.probabilityShow=function(){for(var t=0;t<4;t++){var e=Number(this.cfg.reward[t][1])/1e4;this.LabelProbability[t].string=Math.round(100*e)+"%"}},e.prototype.onClick=function(t){switch(t.target){case this.BtnClose:this.emitCloseMe()}},__decorate([l],e)}(o.default));n.default=c,cc._RF.pop()},{}],BossEnemy:[function(t,e,i){"use strict";cc._RF.push(e,"bc72d9PNvFCe6ipBBGuhX37","BossEnemy");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.BossEnemy=void 0;var o=a("ConfigMgr"),s=a("EventMgr"),r=a("IVector2"),l=a("TweenMaterial"),c=a("UtilOne"),h=a("typeEnum"),d=a("DataMgr"),u=a("AudioMgr"),p=a("Global"),f=a("DungeonFightMgr"),g=a("TalentBase"),m=a("BossNPCBase"),y=a("ResMgr"),v=cc._decorator,b=v.ccclass,_=v.property,T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bady=null,e.bullet="",e.bulletPos=cc.v2(0,0),e.bulletRotation=0,e.bulletScale=1,e.bulletEff=null,e.Atlas=null,e.health=null,e.warriorsname="",e.attack=1,e.defense=1,e.attackDis=2,e.moveSpeed=1,e.sputRange=1,e.sputAttack=1,e.target=null,e.attackAim=!1,e.skillNowIndex=0,e.skillNowCfgData=null,e.anim=null,e.roleDate=null,e.roleBaseType=h.RoleBaseType.Birth,e.OnAttackAim=!1,e.NowBossAttackType=h.BossAttackType.Default,e.moveToBulidUse=0,e.canMove=!0,e.moveSpeedScale=1,e.animTimeScale=1,e.attackTimeScale=1,e}return __extends(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.physics=this.getComponent(cc.PhysicsCircleCollider),this.moveToBulidUse=c.default.rand(40,135),this.addEvent()},e.prototype.addEvent=function(){var t=this;s.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this),s.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this)},e.prototype.initRole=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var a,n,s;return __generator(this,function(){return this.canMove=!0,this.fightplan=i,this.health=this.fightplan.BossHealth,this.isEnemy=!0,a=1,n=1,d.default.Instance().getPlayerData().getCardsTotalAddition(),this.roleDate=o.default.Instance().getTableValue("warriorsid",t,cfgTable.bossData),this.health.node.getChildByName("name").getComponent(cc.Label).string=p.Global.languageMgr.getText(Number(this.roleDate.nameid)),this.skillNowIndex=0,this.skillNowCfgData=o.default.Instance().getTableValue("id",this.roleDate.skill[this.skillNowIndex][0],cfgTable.bossskillData),this.attackDis=this.skillNowCfgData.attackdistance,s=f.default.Instance().Bossleve,n*=Number(s.aihpcorrect),a*=Number(s.aiaktcorrect),this.attack=this.skillNowCfgData.attack*a,this.sputAttack=this.skillNowCfgData.splashdamage,this.sputRange=this.skillNowCfgData.splashrange,this.id=e,this.hp=Number(this.roleDate.hp)*n,this.curHp=this.hp,this.warriorsname=p.Global.languageMgr.getText(Number(this.roleDate.nameid)),this.moveSpeed=this.roleDate.movespeed,this.OtherPhysics=0,this.NowBossAttackType=h.BossAttackType.Default,this.OnAttackAim=!1,this.roleBaseType=h.RoleBaseType.Birth,this.attackAim=!1,this.onShow(),[2]})})},e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(){return 1==this.roleDate.warriortype?this.node.group=this.isEnemy?"enemy":"my":this.node.group=this.isEnemy?"enemy_3":"my_3",t=c.default.randInt(-1,1),e=c.default.randInt(-1,1),this.isEnemy?(this.nowBirthpoint=cc.v2(this.Birthpoint.enemyBirthpoint.x+t,this.Birthpoint.enemyBirthpoint.y),this.node.setPosition(this.nowBirthpoint)):(this.nowBirthpoint=cc.v2(this.Birthpoint.myBirthpoint.x+t,this.Birthpoint.myBirthpoint.y+e),this.node.setPosition(this.nowBirthpoint)),this.roleBaseType=h.RoleBaseType.Birth,[2]})})},e.prototype.attackOver=function(){var t=this;if(!this.isDeath()&&this.NowBossAttackType!=h.BossAttackType.Over){this.NowBossAttackType=h.BossAttackType.Over,this.OnAttackAim=!1,this.roleBaseType=h.RoleBaseType.Interval;var e=this.roleDate.skill[this.skillNowIndex][1];this.addSkillNow(),this.playAttack(h.BossAttackType.AinmStandby),this.scheduleOnce(function(){t.roleBaseType=h.RoleBaseType.Move},e*this.attackTimeScale)}},e.prototype.attackEnd=function(){this.isDeath()||this.NowBossAttackType==h.BossAttackType.End||(this.NowBossAttackType=h.BossAttackType.End,this.playAttack(h.BossAttackType.AinmOver))},e.prototype.playAtkAuio=function(){this.skillNowCfgData.audioId&&u.default.Instance().playEffect(Number(this.skillNowCfgData.audioId))},e.prototype.onGoAtk=function(){if(this.NowBossAttackType!=h.BossAttackType.OnGo){this.NowBossAttackType=h.BossAttackType.OnGo,this.playAtkAuio();for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}if(e.minDts<=this.attackDis)this.onGoAtkTo(e);else{if(!(i.minDts<=this.attackDis))return void this.attackEnd();this.onGoAtkTo(i)}if(2==this.skillNowCfgData.warriortype){var r={root:this.bady,target:this.target,father:this};s.default.Instance().emitFireBullet(r)}else{var l=[this.attack,this.attack,this.attack];s.default.Instance().emitAttacked({id:this.target.getId(),attack:l,killRewards:0,sputAttack:this.sputAttack,sputRange:this.sputRange})}}},e.prototype.prepareAtk=function(){if(!this.isDeath()&&this.NowBossAttackType!=h.BossAttackType.Prepare){this.NowBossAttackType=h.BossAttackType.Prepare;for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}e.minDts<=this.attackDis?this.prepareAtkTo(e):i.minDts<=this.attackDis?this.prepareAtkTo(i):this.playAttack(h.BossAttackType.AinmOver)}},e.prototype.attackedFunc=function(t,e,i,a){var n=this,o=i;if(t&&(o=t[0],this.isEnemy)){var c=p.Global.common.isCrit(!1);o=p.Global.common.getCritAtk(c,o,!1),c&&p.Global.talentSkillMgr.playEft(this,g.ETalentEft.crit)}if(!this.isDeath()){this.hp-=o,u.default.Instance().playEffect(4),this.bady.children.forEach(function(t){var e=t.getComponent(cc.Sprite),i=new l.TweenMaterial(e,"time",0);cc.tween(i).to(.1,{mainAny:1}).to(.1,{mainAny:0}).start()}),this.health.node.active=!0,this.health.progress=this.hp/this.curHp;var d=this.health.node.getChildByName("white");d.active=!0;var m=(this.hp+o)/this.curHp*348,y=this.hp/this.curHp*348;if(m=m<0?m=0:m,y=y<0?y=0:y,d.width=m,cc.tween(d).to(.2,{width:y}).call(function(){d.active=!1}).start(),this.hp<=0){this.playAttack(h.BossAttackType.AinmDie),this.roleBaseType=h.RoleBaseType.Dide,f.default.Instance().isEnd=!0,p.Global.common.isDropMeat();var v=(b=this.fightplan.enemyList).indexOf(this);v>-1&&b.splice(v,1),this.scheduleOnce(function(){s.default.Instance().emitBossGameOver(!0),n.node.destroy()},2.2),this.bodySpeed=cc.v2(r.Vector2.ZERO),this.rigidbody.linearVelocity=this.bodySpeed}if(a){for(var b=this.isEnemy?this.fightplan.enemyList:this.fightplan.roleList,_=[],T=0;T<b.length;++T)if(!b[T].isDeath()){var S=b[T].node;this.node!=S&&this.getDistance(this.node,S)<=a&&_.push(b[T])}_.forEach(function(t){t.attackedFunc(null,e,i,null)})}}},e.prototype.prepareAtkTo=function(t){!t.base||t.base.isDeath()?this.playAttack(h.BossAttackType.AinmOver):(this.target=t.base,this.startAtk())},e.prototype.onGoAtkTo=function(t){t.base&&!t.base.isDeath()?this.target=t.base:this.attackEnd()},e.prototype.startAtk=function(){this.isDeath()||(this.attackAim&&(this.OnAttackAim=!0),this.target&&!this.target.isDeath()||this.playAttack(h.BossAttackType.AinmOver))},e.prototype.playAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(){return this.isDeath()?[2]:(t==h.BossAttackType.AinmAttack&&(t+=this.skillNowCfgData.attackType-1),e=this.anim.getClips(),this.anim.play(e[t].name).speed=1*this.animTimeScale,[2])})})},e.prototype.detectionDis=function(){for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node,o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}this.roleBaseType==h.RoleBaseType.Attack&&this.attackAim&&this.OnAttackAim&&(e.minDts<=this.attackDis?this.setAimTo(e):i.minDts<=this.attackDis&&this.setAimTo(i)),this.roleBaseType==h.RoleBaseType.Move&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.setAtkTo(e):i.minDts<=this.attackDis&&this.setAtkTo(i)),2==this.roleDate.warriortype&&(this.roleBaseType==h.RoleBaseType.Attack?("enemy_3"!=this.node.group&&"my_3"!=this.node.group||(this.node.group=this.isEnemy?"enemy_2":"my_2"),this.bodySpeed=cc.v2(r.Vector2.ZERO)):("enemy_2"!=this.node.group&&"my_2"!=this.node.group||(this.node.group=this.isEnemy?"enemy_3":"my_3"),this.bodySpeed=this.bodySpeed)),this.OtherPhysics>0&&500!=this.physics.density?(this.physics.density=500,this.physics.apply()):500!=this.physics.density&&(this.physics.density=500,this.physics.apply()),this.roleBaseType==h.RoleBaseType.Interval&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.bodySpeed=cc.v2(r.Vector2.ZERO):i.minDts<=this.attackDis&&(this.bodySpeed=cc.v2(r.Vector2.ZERO))),this.isDeath()&&(this.bodySpeed=cc.v2(r.Vector2.ZERO),this.rigidbody.linearVelocity=this.bodySpeed),f.default.Instance().isEnd||this.isDeath()||(this.bodySpeed.x*=this.moveSpeedScale,this.bodySpeed.y*=this.moveSpeedScale,this.rigidbody.linearVelocity=this.bodySpeed)},e.prototype.setMoveTo=function(t){var e=t.base.node.getPosition(),i=this.node.getPosition();if("selfBuild"==t.base.node.name){var a=t.base.node.getPosition();e={x:a.x,y:a.y+this.moveToBulidUse}}var n={x:0,y:0};r.Vector2.sub(n,e,i);var o=r.Vector2.len(n),s=new r.Vector2(n.x/o,n.y/o);this.bodySpeed.x=s.x*this.moveSpeed,this.bodySpeed.y=s.y*this.moveSpeed},e.prototype.setAtkTo=function(t){t.base&&!t.base.isDeath()&&(this.target=t.base,this.bodySpeed=cc.v2(r.Vector2.ZERO),this.playAttack(h.BossAttackType.AinmAttack),this.roleBaseType=h.RoleBaseType.Attack)},e.prototype.setAimTo=function(t){if(t.base&&!t.base.isDeath()){this.target=t.base;var e=new r.Vector2(this.node.position),i=new r.Vector2(this.target.node.position),a=r.Vector2.angle360(e,i);this.bady.angle=a}},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},e.prototype.move=function(){!f.default.Instance().isEnd&&this.canMove?this.isDeath()||(this.roleBaseType==h.RoleBaseType.Birth?this.moveOn():this.detectionDis()):this.rigidbody.linearVelocity=cc.v2(r.Vector2.ZERO)},e.prototype.moveOn=function(){this.node.opacity=255,this.bady.scale=0,this.playAttack(h.BossAttackType.AinmBirth),this.roleBaseType=h.RoleBaseType.Move},e.prototype.BirthOver=function(){this.playAttack(h.BossAttackType.AinmStandby)},e.prototype.onBeginContact=function(t,e,i){if(i.node){var a=i.node.getComponent(m.default);a&&this.isEnemy!=a.isEnemy?this.OtherPhysics+=1:this.selfPhysics+=1}},e.prototype.onEndContact=function(t,e,i){if(i.node){var a=i.node.getComponent(m.default);a&&this.isEnemy!=a.isEnemy?this.OtherPhysics-=1:this.selfPhysics-=1}},e.prototype.isDeath=function(){return this.roleBaseType==h.RoleBaseType.Dide},e.prototype.setHp=function(t){this.hp=t,this.health.progress=this.hp/this.curHp},e.prototype.getHp=function(){return this.hp},e.prototype.setCurHp=function(t){this.curHp=t,this.health.progress=this.hp/this.curHp},e.prototype.getAtk=function(){return this.attack},e.prototype.setAtk=function(t){this.attack=t},e.prototype.addSkillNow=function(){var t=f.default.Instance().Bossleve;this.skillNowIndex+=1,this.skillNowIndex>=this.roleDate.skill.length&&(this.skillNowIndex=0),this.skillNowCfgData=o.default.Instance().getTableValue("id",this.roleDate.skill[this.skillNowIndex][0],cfgTable.bossskillData),this.attackDis=this.skillNowCfgData.attackdistance;var e=1*Number(t.aiaktcorrect);this.attack=this.skillNowCfgData.attack*e,this.sputAttack=this.skillNowCfgData.splashdamage,this.sputRange=this.skillNowCfgData.splashrange},e.prototype.createWave=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return(t=new cc.Node("waveNode")).parent=this.node,(e=t.addComponent(cc.Sprite)).type=cc.Sprite.Type.SIMPLE,e.sizeMode=cc.Sprite.SizeMode.CUSTOM,[4,y.default.Instance().loadAndGetRes("res","skill/wave",cc.SpriteFrame)];case 1:return i=s.sent(),[4,y.default.Instance().loadAndGetRes("res","skill/wave2",cc.SpriteFrame)];case 2:return a=s.sent(),[4,y.default.Instance().loadAndGetRes("res","skill/wave3",cc.SpriteFrame)];case 3:return n=s.sent(),e.spriteFrame=i,this.waveSprite=e,t.width=400,t.height=400,t.x=0,t.y=0,cc.tween(t).delay(.02).to(.02,{scale:1.08,opacity:230}).call(function(){e.spriteFrame=a,e.node.opacity=255}).delay(.02).call(function(){e.spriteFrame=n}).to(.5,{opacity:50}).to(.3,{opacity:0}).call(function(){o.destroyWave()}).start(),[2]}})})},e.prototype.destroyWave=function(){this.waveSprite.node.destroy(),this.waveSprite=null},__decorate([_(cc.Node)],e.prototype,"bady",void 0),__decorate([_()],e.prototype,"bullet",void 0),__decorate([_(cc.Vec2)],e.prototype,"bulletPos",void 0),__decorate([_()],e.prototype,"bulletRotation",void 0),__decorate([_()],e.prototype,"bulletScale",void 0),__decorate([_(cc.Prefab)],e.prototype,"bulletEff",void 0),__decorate([_(cc.SpriteAtlas)],e.prototype,"Atlas",void 0),__decorate([b],e)}(m.default);n.BossEnemy=T,cc._RF.pop()},{}],BossEnterPanel:[function(t,e,i){"use strict";cc._RF.push(e,"f5aa1DiwQdMsbF8mtE4qeRl","BossEnterPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("EventMgr"),l=a("typeEnum"),c=a("spriteFrameControl"),h=cc._decorator,d=h.ccclass,u=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.SpriteIconKey=null,e.LabelNowLevel=null,e.LabelKeyNum=null,e.BtnEnter=null,e.BtnRight=null,e.BtnLift=null,e.BtnClose=null,e.BtnReward=null,e.enterTxt=null,e.IocnIndex=0,e.nowlevel=1,e}return __extends(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.SpriteIconKey=this.findElement("content/SpriteIconKey",c.default),this.LabelNowLevel=this.findElement("content/LabelNowLevel",cc.Label),this.LabelKeyNum=this.findElement("content/LabelKeyNum",cc.Label),this.BtnEnter=this.findElement("content/BtnEnter"),this.BtnRight=this.findElement("content/BtnRight"),this.BtnLift=this.findElement("content/BtnLift"),this.BtnClose=this.findElement("content/BtnClose"),this.BtnReward=this.findElement("content/BtnReward"),this.enterTxt=this.findElement("content/BtnEnter/Label",cc.Label),this.nowlevel=o.Global.dataMgr.getPlayerData().getBossMaxLevel(),r.default.Instance().onBossLevelChange(this.onBossLevelChange,this)},e.prototype.onEnable=function(){this.subClicks(this.BtnEnter,this.BtnRight,this.BtnLift,this.BtnClose,this.BtnReward),this.addClicks(this.BtnEnter,this.BtnRight,this.BtnLift,this.BtnClose,this.BtnReward),this.showOherUI(),this.showKeyUI(),this.showLevelUI()},e.prototype.onDisable=function(){this.subClicks(this.BtnEnter,this.BtnRight,this.BtnLift,this.BtnClose,this.BtnReward)},e.prototype.onBossLevelChange=function(){this.nowlevel=o.Global.dataMgr.getPlayerData().getBossMaxLevel(),this.showKeyUI(),this.showLevelUI()},e.prototype.showOherUI=function(){},e.prototype.showKeyUI=function(){var t=o.Global.dataMgr.getPlayerData(),e=cfgTable.commonData.bosskeymax,i=cfgTable.commonData.bossadnumber,a=o.Global.sdkMgr.curSdk.option.parameter;a&&(a.bossadnumber||0==a.bossadnumber)&&-1!=a.bossadnumber&&(i=a.bossadnumber);var n=t.getBossKays(),s=t.getBossADKays(),r="0/"+e;this.IocnIndex=0;var l=!0;n>0?r=n+"/"+e:s>0?(this.IocnIndex=1,r=s+"/"+i):l=!1,this.SpriteIconKey.setSpriteFramebyIndex(this.IocnIndex),this.LabelKeyNum.string=r,this.BtnEnter.getComponent(cc.Button).interactable=l},e.prototype.showLevelUI=function(){var t=o.Global.configMgr.getTableValue("id",this.nowlevel,cfgTable.bosslevelData);this.LabelNowLevel.string=t.level},e.prototype.emitCloseMe=function(){t.prototype.emitCloseMe.call(this)},e.prototype.onClick=function(t){switch(t.target){case this.BtnEnter:this.onbtnEnter();break;case this.BtnRight:this.onBtnRight();break;case this.BtnLift:this.onBtnLift();break;case this.BtnReward:this.onBtnReward();break;case this.BtnClose:this.emitCloseMe()}},e.prototype.onbtnEnter=function(){var t=o.Global.configMgr.getTableValue("id",this.nowlevel,cfgTable.bosslevelData);this.IocnIndex?o.Global.sdkMgr.openAd(function(){var e=o.Global.dataMgr.getPlayerData(),i=e.getBossADKays();e.setBossKays(1),i-=1,e.setBossADKays(i),r.default.Instance().emitBossLevelChange(),r.default.Instance().emitShowPanel({data:t.battle,prefab:"prefab/Dungeons/BossFightPanel"})},null):r.default.Instance().emitShowPanel({data:t.battle,prefab:"prefab/Dungeons/BossFightPanel"})},e.prototype.onBtnRight=function(){this.nowlevel++,this.nowlevel>o.Global.dataMgr.getPlayerData().getBossMaxLevel()&&(this.nowlevel>l.MaxLevel.Boss&&r.default.Instance().emitTips(o.Global.languageMgr.getText(911010)),this.nowlevel=o.Global.dataMgr.getPlayerData().getBossMaxLevel()),this.showLevelUI()},e.prototype.onBtnLift=function(){this.nowlevel--,this.nowlevel<1&&(this.nowlevel=1),this.showLevelUI()},e.prototype.onBtnReward=function(){var t=o.Global.configMgr.getTableValue("id",this.nowlevel,cfgTable.bosslevelData);r.default.Instance().emitShowPanel({data:t.battle,prefab:"prefab/Dungeons/BossDropProbabilityPanel"})},__decorate([d],e)}(s.default));n.default=u,cc._RF.pop()},{}],BossFightPanel:[function(t,e,i){"use strict";cc._RF.push(e,"6e57ctqYWVJFLntAu6WkKeC","BossFightPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("ConfigMgr"),r=a("DataMgr"),l=a("EventMgr"),c=a("ResMgr"),h=a("UtilOne"),d=a("typeEnum"),u=a("AudioMgr"),p=a("Global"),f=a("DungeonBullet"),g=a("SkillMgr"),m=a("DungeonFightMgr"),y=a("TalentBase"),v=a("ZembieDieAnimPre"),b=a("spriteFrameControl"),_=a("BossBuild"),T=a("BossRole"),S=a("BossEnemy"),D=cc._decorator,k=D.ccclass,C=D.property,I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selfBase=null,e.meatGrowth=null,e.meatCount=null,e.cards=[],e.coin=null,e.diamond=null,e.costs=[],e.btnBgs=[],e.bullet=null,e.gameFactory=null,e.dieAnimShow=null,e.dieShowP=null,e.bg=null,e.selfBase_1=null,e.selfBase_2=null,e.otherBuild=null,e.meatPlay=null,e.die=null,e.dieShow=null,e.suspendBtn=null,e.meatNum=0,e.gameData=null,e.id=0,e.BossHealth=null,e.bulletNodePool=null,e.dieNodePool=null,e.dieShowPool=null,e.dieshowlist=[],e.roleList=[],e.enemyList=[],e.canUpdate=!1,e.Birthpoint={myBirthpoint:cc.v2(-375,15),enemyBirthpoint:cc.v2(330,-55)},e.meatTimeScale=1,e.skillTimeScale=1,e.sendTroopsTimeScale=1,e}return __extends(e,t),e.prototype.onLoad=function(){cc.game.on(cc.game.EVENT_SHOW,function(){console.log("\u8fdb\u5165\u524d\u53f0"),u.default.Instance().playMusic(1)},this),this.node.getComponent(cc.Widget).updateAlignment(),m.default.Instance().isEnd=!1,this.meatPlay=this.findElement("uiPanel/buttonRoot/meatPlay"),this.suspendBtn=this.findElement("uiPanel/top/suspendBtn"),this.critNode=this.findElement("fightContent/Crit"),this.BossHealth=this.findElement("fightContent/BossHealth",cc.ProgressBar),this.addBtnevent(),this.addEvent(),c.default.Instance().sideGamePrefab.push("BossFightPanel"),cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().gravity=cc.v2(),cc.director.getPhysicsManager().enabledAccumulator=!0,cc.PhysicsManager.FIXED_TIME_STEP=1/60,cc.PhysicsManager.VELOCITY_ITERATIONS=8,cc.PhysicsManager.POSITION_ITERATIONS=8,cc.PhysicsManager.PTM_RATIO=32,cc.PhysicsManager.FIXED_TIME_STEP=.01,this.bulletNodePool=new cc.NodePool,this.dieNodePool=new cc.NodePool,this.dieShowPool=new cc.NodePool},e.prototype.onEnable=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return u.default.Instance().playMusic(1),l.default.Instance().onCloseBossBattlePanel(this.onClaseSelf,this),l.default.Instance().emitRefreshTask(),l.default.Instance().onGameTimePause(this.onGameTimePause,this),u.default.Instance().playEffect(7),[2]})})},e.prototype.onClaseSelf=function(){var t=this;this.scheduleOnce(function(){t.emitCloseMe()},.5)},e.prototype.loadRes=function(){for(var t=[],e=0,i=this.getWarriorsInof();e<i.length;e++){var a=i[e];t.push(a.warriorsid)}this.getDataAndLoad(t,"bossPlayer_"),t=[];var n=m.default.Instance().Bossleve,o=s.default.Instance().getTableValue("warriorsid",n.time,cfgTable.bossData);o&&t.push(o.name),this.getDataAndLoad(t,"boss_",!0)},e.prototype.getDataAndLoad=function(t,e,i){var a=this;void 0===i&&(i=!1);for(var n=new Map,o=0;o<t.length;++o){var s=i?Number(t[o][t[o].length-2]):Math.round(t[o]/1e3%10);n.has(s)?n.get(s).push(t[o]):n.set(s,[t[o]])}n.forEach(function(t,i){var n=t.concat();c.default.Instance().sideGamebundles.push(e+i),a.loadBundle(e+i,n)}),n.clear()},e.prototype.loadBundle=function(t,e){var i=new c.PreloadConf;i.Init(t,t),cc.assetManager.loadBundle(t,function(a,n){if(a)console.error("\u52a0\u8f7dbundle:"+t+" \u9519\u8bef:"+a);else{i.setBundle(n);for(var o=[],s=0,r=e;s<r.length;s++){var l=r[s];o.push("Role_"+l)}i.AddLoadFiles(c.AssetsType.ATPrefab,o),c.default.Instance().loadRes(i,function(){}),i.AddPreloadFiles(c.AssetsType.ATPrefab,o),c.default.Instance().preloadRes(i)}})},e.prototype.update=function(t){if(this.canUpdate&&this.gameData){var e=t*this.skillTimeScale;g.default.ins.update(e),t*=this.sendTroopsTimeScale,this.sortNode(),this.cardShow();for(var i=0;i<this.enemyList.length;++i)this.enemyList[i].move(t);for(i=0;i<this.roleList.length;++i)this.roleList[i].move(t)}},e.prototype.onDisable=function(){cc.Tween.stopAllByTag(d.TweenTag.meat),this.dieShowP.destroyAllChildren(),u.default.Instance().stopMusic()},e.prototype.onDestroy=function(){cc.director.getPhysicsManager().enabled=!1,this.roleList=[],this.enemyList=[],this.dieNodePool.clear(),this.dieShowPool.clear()},e.prototype.oncome=function(){this.id=0,this.canUpdate=!0,this.gameData=r.default.Instance().getPlayerData(),this.meatNum=0,this.meatCount.string=""+this.meatNum,m.default.Instance().Bossleve,this.initPanel()},e.prototype.cardShow=function(){var t=this.getWarriorsInof(),e=0;for(var i in t){var a=t[i];this.meatNum>=a.Needfood?this.btnBgs[e].active&&(this.cards[e].getComponent(cc.Button).interactable=!0,this.btnBgs[e].active=!1):this.btnBgs[e].active||(this.cards[e].getComponent(cc.Button).interactable=!1,this.btnBgs[e].active=!0),e+=1}},e.prototype.getWarriorsInof=function(){for(var t=m.default.Instance().Bossleve.warriorsid,e=[],i=0;i<t.length;i++){var a=t[i],n=s.default.Instance().getTableValue("warriorsid",a,cfgTable.bosswarriorsData);n&&e.push(n)}return e},e.prototype.addBtnevent=function(){this.suspendBtn.on("click",this.clicksuspendBtn,this)},e.prototype.addEvent=function(){var t=this;l.default.Instance().onFireBullet(function(e){var i;i=t.bulletNodePool.size()>0?t.bulletNodePool.get():cc.instantiate(t.bullet),t.gameFactory.addChild(i),i.getComponent(f.default).initBullet(e,t)},this),l.default.Instance().onDungeonRoleDie(this.onDieShow,this),l.default.Instance().onCoinChange(this.setCoinShow,this),l.default.Instance().onDiamondChange(this.setDiamondShow,this),l.default.Instance().onTimeScaleChange(this.initTimeScale,this)},e.prototype.sortNode=function(){this.gameFactory.children.sort(function(t,e){return t.y+1<e.y-1?1:t.y-1>e.y+1?-1:0})},e.prototype.meatNumUp=function(t){var e=this;void 0===t&&(t=0);var i=m.default.Instance().Bossleve.foodspeed*(1+p.Global.common.getCardMeatRate()),a=1/i;i>=2?(cc.Tween.stopAllByTag(d.TweenTag.meat),this.meatGrowth.fillRange=0,this.meatGrowth.node.active=!1,this.meatPlay.active=!0,this.meatTween=cc.tween(this),this.meatTween.repeatForever(cc.tween().delay(a).call(function(){e.meatNum+=1,e.meatCount.string=""+e.meatNum})).tag(d.TweenTag.BossMeatTow).start()):(this.meatGrowth.fillRange=t,this.meatGrowth.node.active=!0,this.meatPlay.active=!1,t&&(a*=1-t),cc.Tween.stopAllByTag(d.TweenTag.meatTow),this.meatTween=cc.tween(this.meatGrowth),this.meatTween.repeatForever(cc.tween().to(a,{fillRange:1}).call(function(){e.meatNum+=1,e.meatCount.string=""+e.meatNum,e.meatGrowth.fillRange=0,a=1/i})).tag(d.TweenTag.BossMeat).start())},e.prototype.initPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,i,a,n,o,s;return __generator(this,function(r){switch(r.label){case 0:for(o=0;o<t;o++)e=cc.instantiate(this.bullet),this.bulletNodePool.put(e);return this.die?[3,2]:(i=this,[4,c.default.Instance().loadAndGetRes("res","prefab/animPre/ZembieDieAnimPre")]);case 1:i.die=r.sent(),r.label=2;case 2:for(o=0;o<t;o++)a=cc.instantiate(this.die),this.dieNodePool.put(a);return this.dieShow?[3,4]:(n=this,[4,c.default.Instance().loadAndGetRes("res","prefab/MainPanel/DieShowPre")]);case 3:n.dieShow=r.sent(),r.label=4;case 4:for(o=0;o<t;o++)s=cc.instantiate(this.dieShow),this.dieShowPool.put(s);return[2]}})})},e.prototype.initBase=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(){return this.roleList.push(this.selfBase.getComponent(_.default)),this.id++,t=m.default.Instance().Bossleve.enemybasehp,e=p.Global.talentSkillMgr.run(y.ETalentType.baseHp,t,!1),this.selfBase.getComponent(_.default).initBase({hp:e,fightplan:this,id:this.id}),this.id++,i=Number(m.default.Instance().Bossleve.level[0]),this.selfBase_1.getComponent(b.default).setSpriteFramebyIndex(i-1),this.selfBase_2.getComponent(b.default).setSpriteFramebyIndex(i-1),this.otherBuild.active=!0,this.otherBuild.getComponent(b.default).getSpriteFramebyIndex(i-1)?this.otherBuild.getComponent(b.default).setSpriteFramebyIndex(i-1):this.otherBuild.active=!1,[2]})})},e.prototype.initMeat=function(){this.meatNum=0,this.meatCount.string=""+this.meatNum,this.meatNumUp()},e.prototype.initCards=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o=this;return __generator(this,function(){for(n in t=this.getWarriorsInof(),e=0,i=function(i){var n=t[i];a.cards[e].active=!0,a.costs[e].string=""+n.Needfood;var s=Math.round(n.warriorsid/1e3%10);a.getCardIcon(e,s,n.warriorsid),a.cards[e].on("click",function(){o.meatNum>=n.Needfood&&(p.Global.sdkMgr.vibrateShort("medium"),o.meatNum-=n.Needfood,o.meatCount.string=""+o.meatNum,o.createRole(n.warriorsid),o.cardShow(),0==Number(i)?r.default.Instance().getPlayerData().addCurTaskCount(1,6):1==Number(i)?r.default.Instance().getPlayerData().addCurTaskCount(1,7):2==Number(i)&&r.default.Instance().getPlayerData().addCurTaskCount(1,8))}),e+=1},a=this,t)i(n);return[2]})})},e.prototype.initBoss=function(){var t=m.default.Instance().Bossleve,e=s.default.Instance().getTableValue("warriorsid",t.time,cfgTable.bossData);e&&this.createEnemy(e)},e.prototype.getCardIcon=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var a,n;return __generator(this,function(o){switch(o.label){case 0:return a="bossPlayer_"+e,[4,c.default.Instance().loadAndGetRes(a,"roleIcon",cc.SpriteAtlas)];case 1:return n=o.sent(),this.cards[t].getChildByName("bg").getChildByName("bgMask").getChildByName("logo").getComponent(cc.Sprite).spriteFrame=n.getSpriteFrame(String(i)),[2]}})})},e.prototype.initGold=function(){this.setCoinShow(),this.setDiamondShow()},e.prototype.setCoinShow=function(t){void 0===t&&(t=0),this.coin.string=t?""+h.default.ChangeNumberUnit(t):""+r.default.Instance().getPlayerData().getUserCoinStr()},e.prototype.setDiamondShow=function(t){void 0===t&&(t=0),this.diamond.string=t?""+h.default.ChangeNumberUnit(t):""+r.default.Instance().getPlayerData().getDiamondStr()},e.prototype.createRole=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a,n,o;return __generator(this,function(s){switch(s.label){case 0:return e=Math.round(t/1e3%10),i="bossPlayer_"+e,[4,c.default.Instance().loadAndGetRes(i,"Role_"+t)];case 1:return(a=s.sent())?(n=cc.instantiate(a),this.gameFactory.addChild(n),this.id++,n.name=this.id+"",n.opacity=0,n.scaleX=1,n.setPosition(this.Birthpoint.myBirthpoint),o=n.getComponent(T.BossRole),1!=this.meatTimeScale&&(o.moveSpeedScale=2,o.animTimeScale=2,o.attackTimeScale=.5),o.initRole(t,this.id,this),this.roleList.push(n.getComponent(T.BossRole)),g.default.ins.buffSkillWork(o),[2]):(console.error("\u4e3bUI\u9884\u5236\u4f53\u4e22\u5931!"),[2])}})})},e.prototype.createEnemy=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a,n,o;return __generator(this,function(s){switch(s.label){case 0:return e=t.name[t.name.length-2],i="boss_"+e,[4,c.default.Instance().loadAndGetRes(i,"Role_"+t.name)];case 1:return(a=s.sent())?(n=cc.instantiate(a),this.gameFactory.addChild(n),this.id++,n.name=this.id+"",n.opacity=0,n.setPosition(this.Birthpoint.enemyBirthpoint),o=n.getComponent(S.BossEnemy),1!=this.meatTimeScale&&(o.moveSpeedScale=2,o.animTimeScale=2,o.attackTimeScale=.5),o.initRole(t.warriorsid,this.id,this),this.enemyList.push(n.getComponent(S.BossEnemy)),[2]):(console.error("\u4e3bUI\u9884\u5236\u4f53\u4e22\u5931!"),[2])}})})},e.prototype.initWithParam=function(t){console.log("\u5f53\u524d\u7684\u8fdb\u5165\u7b49\u7ea7",t);var e=m.default.Instance();e.gameType=d.dungeonsGameType.Boss,e.battle=t,e.Bossleve=s.default.Instance().getTableValue("battle",t,cfgTable.bosslevelData),this.showBG(),this.oncome()},e.prototype.initPanel=function(){this.gameData=r.default.Instance().getPlayerData(),this.loadRes(),this.initGold(),this.initPool(),this.initMeat(),this.initCards(),this.initBase(),this.initBoss(),g.default.ins.init(g.EFightPanel.boss,this),p.Global.heroMgr.init(g.EFightPanel.boss,this),this.initTimeScale()},e.prototype.showBG=function(){var t=Number(m.default.Instance().Bossleve.level[0]);this.bg.getComponent(b.default).setSpriteFramebyIndex(t-1)},e.prototype.destroyRole=function(){cc.director.getPhysicsManager().enabled=!1},e.prototype.onDieShow=function(t,e){var i=h.default.getnodePoolNode(this.dieNodePool,this.die);i.scale=e,i&&(this.dieAnimShow.addChild(i),i.getComponent(v.default).init(t,this.dieNodePool));var a=h.default.getnodePoolNode(this.dieShowPool,this.dieShow);a&&(this.dieShowP.addChild(a),a.setPosition(this.dieShowP.convertToNodeSpaceAR(t)))},e.prototype.onGameTimePause=function(t){t?this.pauseTime():this.recoverTime()},e.prototype.pauseTime=function(){var t=this;this.scheduleOnce(function(){t.canUpdate=!1}),cc.Tween.stopAllByTag(d.TweenTag.meat),cc.Tween.stopAllByTag(d.TweenTag.meatTow);for(var e=0;e<this.enemyList.length;++e)this.enemyList[e].canMove=!1;for(e=0;e<this.roleList.length;++e)this.roleList[e].canMove=!1},e.prototype.recoverTime=function(){this.canUpdate=!0,this.meatNumUp(this.meatGrowth.fillRange);for(var t=0;t<this.enemyList.length;++t)this.enemyList[t].canMove=!0;for(t=0;t<this.roleList.length;++t)this.roleList[t].canMove=!0},e.prototype.clicksuspendBtn=function(){l.default.Instance().emitShowPanel({prefab:"prefab/Dungeons/DungeonSuspendPanel"})},e.prototype.addMeat=function(t){this.meatNum+=t,this.meatCount.string=""+this.meatNum},e.prototype.initTimeScale=function(){if(this.meatTween){var t=p.Global.common.getTimeScale();this.meatTimeScale=t[0],this.sendTroopsTimeScale=t[5],this.meatTween._finalAction._speedMethod=!0,this.meatTween._finalAction._speed=this.meatTimeScale;for(var e=0,i=this.roleList;e<i.length;e++)(o=i[e]).moveSpeedScale=t[1],o.animTimeScale=t[2],o.attackTimeScale=t[3];for(var a=0,n=this.enemyList;a<n.length;a++){var o;(o=n[a]).moveSpeedScale=t[1],o.animTimeScale=t[2],o.attackTimeScale=t[3]}g.default.ins.timeScale=t[4],this.skillTimeScale=t[4];for(var s=0,r=g.default.ins.skillBtnItemArr;s<r.length;s++)r[s].timeScale=t[4]}},__decorate([C({type:cc.Node,displayName:"\u6211\u65b9\u57fa\u5730"})],e.prototype,"selfBase",void 0),__decorate([C({type:cc.Sprite,displayName:"\u8089\u7684\u589e\u957f"})],e.prototype,"meatGrowth",void 0),__decorate([C({type:cc.Label,displayName:"\u8089\u7684\u6570\u91cf"})],e.prototype,"meatCount",void 0),__decorate([C({type:cc.Node,displayName:"\u5361\u724c"})],e.prototype,"cards",void 0),__decorate([C({type:cc.Label,displayName:"\u91d1\u5e01"})],e.prototype,"coin",void 0),__decorate([C({type:cc.Label,displayName:"\u94bb\u77f3"})],e.prototype,"diamond",void 0),__decorate([C(cc.Label)],e.prototype,"costs",void 0),__decorate([C(cc.Node)],e.prototype,"btnBgs",void 0),__decorate([C(cc.Prefab)],e.prototype,"bullet",void 0),__decorate([C(cc.Node)],e.prototype,"gameFactory",void 0),__decorate([C(cc.Node)],e.prototype,"dieAnimShow",void 0),__decorate([C(cc.Node)],e.prototype,"dieShowP",void 0),__decorate([C(cc.Node)],e.prototype,"bg",void 0),__decorate([C(cc.Node)],e.prototype,"selfBase_1",void 0),__decorate([C(cc.Node)],e.prototype,"selfBase_2",void 0),__decorate([C(cc.Node)],e.prototype,"otherBuild",void 0),__decorate([k],e)}(o.default);n.default=I,cc._RF.pop()},{}],BossItem:[function(t,e,i){"use strict";cc._RF.push(e,"0fea8D1kMRPNJwzRCATA1GD","BossItem");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("CompBase"),s=a("Global"),r=a("EventMgr"),l=a("spriteFrameControl"),c=cc._decorator,h=c.ccclass,d=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.btnEnter=null,e.LabelKeyNum=null,e.SpriteIconKey=null,e.ClickON=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.init(),r.default.Instance().onBossLevelChange(this.showUI,this),r.default.Instance().onDungeonKeyChange(this.showUI,this)},e.prototype.onEnable=function(){this.btnEnter&&this.onClick()},e.prototype.onDisable=function(){this.offClick()},e.prototype.init=function(){this.btnEnter=this.findElement("btnEnter"),this.LabelKeyNum=this.findElement("LabelKeyNum",cc.Label),this.SpriteIconKey=this.findElement("SpriteIconKey",l.default),this.onClick(),this.showUI()},e.prototype.onClick=function(){this.ClickON||(this.ClickON=!0,this.btnEnter.on("click",this.onBtnEnter,this))},e.prototype.offClick=function(){this.ClickON&&(this.ClickON=!1,this.btnEnter.off("click",this.onBtnEnter,this))},e.prototype.showUI=function(){var t=s.Global.dataMgr.getPlayerData(),e=cfgTable.commonData.bosskeymax,i=t.getBossKays(),a=t.getBossADKays(),n="0/"+e,o=0,r=cfgTable.commonData.bossadnumber,l=s.Global.sdkMgr.curSdk.option.parameter;l&&(l.bossadnumber||0==l.bossadnumber)&&-1!=l.bossadnumber&&(r=l.bossadnumber);var c=cc.assetManager.builtins.getBuiltin("material","builtin-2d-sprite");i>0?n=i+"/"+e:a>0?(o=1,n=a+"/"+r):c=cc.assetManager.builtins.getBuiltin("material","builtin-2d-gray-sprite"),this.btnEnter.getComponent(cc.Sprite).setMaterial(0,c),this.SpriteIconKey.setSpriteFramebyIndex(o),this.LabelKeyNum.string=n},e.prototype.onBtnEnter=function(){r.default.Instance().emitShowPanel({prefab:"prefab/Dungeons/BossEnterPanel"})},__decorate([h],e)}(o.default));n.default=d,cc._RF.pop()},{}],BossNPCBase:[function(t,e,i){"use strict";cc._RF.push(e,"e13f501w49NUYhPot3lhLpm","BossNPCBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("CompBase"),s=a("typeEnum"),r=cc._decorator,l=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.isEnemy=!1,e.hp=1,e.curHp=0,e.attackDis=2,e.moveSpeed=1,e.roleBaseType=s.RoleBaseType.Birth,e.rigidbody=null,e.bodySpeed=cc.v2(0,0),e.physics=null,e.OtherPhysics=0,e.selfPhysics=0,e.Birthpoint={myBirthpoint:cc.v2(-375,15),enemyBirthpoint:cc.v2(330,-55)},e.nowBirthpoint=null,e}return __extends(e,t),e.prototype.getCurHp=function(){return this.curHp},e.prototype.getId=function(){return this.id},e.prototype.isDeath=function(){return this.roleBaseType==s.RoleBaseType.Dide},__decorate([l],e)}(o.default));n.default=c,cc._RF.pop()},{}],BossRole:[function(t,e,i){"use strict";cc._RF.push(e,"7941fnQ/i9M36CALAf+rHBj","BossRole");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.BossRole=void 0;var o=a("ConfigMgr"),s=a("EventMgr"),r=a("IVector2"),l=a("TweenMaterial"),c=a("UtilOne"),h=a("typeEnum"),d=a("DataMgr"),u=a("AudioMgr"),p=a("Global"),f=a("DungeonFightMgr"),g=a("TalentBase"),m=a("BossNPCBase"),y=cc._decorator,v=y.ccclass,b=y.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bady=null,e.icon=null,e.weapon=null,e.other=null,e.bullet="",e.bulletPos=cc.v2(0,0),e.bulletRotation=0,e.bulletScale=1,e.bulletEff=null,e.Atlas=null,e.health=null,e.warriorsname="",e.attack=1,e.defense=1,e.attackDis=2,e.moveSpeed=1,e.sputRange=1,e.sputAttack=1,e.attakInterval=1,e.attakIngInterval=.5,e.perpetualAttack=!1,e.playReverse=!1,e.attackAim=!1,e.killRewards=1,e.needFood=1,e.damageToOurBuild=1,e.damageToOtherBuild=1,e.bulletspeed=.2,e.target=null,e.anim=null,e.roleDate=null,e.roleBaseType=h.RoleBaseType.Birth,e.OnAttackAim=!1,e.playReverseing=!1,e.NowAttackType=h.AttackType.Default,e.moveToBulidUse=0,e.canMove=!0,e.moveSpeedScale=1,e.animTimeScale=1,e.attackTimeScale=1,e}return __extends(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.physics=this.getComponent(cc.PhysicsCircleCollider),this.health=this.findElement("health",cc.ProgressBar),this.moveToBulidUse=c.default.rand(40,135),this.addEvent()},e.prototype.addEvent=function(){var t=this;s.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this),s.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this)},e.prototype.initRole=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var a,n,s,r,l,c,u;return __generator(this,function(){return this.canMove=!0,this.fightplan=i,this.isEnemy=!1,a=1,n=1,s=d.default.Instance().getPlayerData().getCardsTotalAddition(),this.roleDate=o.default.Instance().getTableValue("warriorsid",t,cfgTable.bosswarriorsData),this.isEnemy?(r=f.default.Instance().Bossleve,n*=Number(r.aihpcorrect),a*=Number(r.aiaktcorrect)):(l=s.find(function(t){return t.type==h.CardAddType.RoleAtk}),(c=s.find(function(t){return t.type==h.CardAddType.RoleHP}))&&(n+=c.addition),l&&(a+=l.addition)),(u=s.find(function(t){return t.type==h.CardAddType.coinAdd}))&&u.addition,this.id=e,this.attack=this.roleDate.attack*a,this.defense=this.roleDate.armor,this.hp=Number(this.roleDate.hp)*n,this.curHp=this.hp,this.warriorsname=p.Global.languageMgr.getText(Number(this.roleDate.nameid)),this.damageToOtherBuild=Number(this.roleDate.enemybasedamage),this.damageToOurBuild=this.roleDate.ourbasedamage,this.attackDis=this.roleDate.attackdistance,this.attakInterval=Number(this.roleDate.attackspeed),this.attakIngInterval=this.roleDate.attakIngInterval,this.perpetualAttack=!!this.roleDate.perpetualAttack,this.playReverse=!!this.roleDate.playReverse,this.moveSpeed=this.roleDate.movespeed,this.sputAttack=this.roleDate.splashdamage,this.sputRange=this.roleDate.splashrange,this.needFood=this.roleDate.Needfood,this.killRewards=1*this.roleDate.Killrewards,this.bulletspeed=this.roleDate.bulletspeed?Number(this.roleDate.bulletspeed):.2,this.OtherPhysics=0,this.NowAttackType=h.AttackType.Default,this.OnAttackAim=!1,this.playReverseing=!1,this.roleBaseType=h.RoleBaseType.Birth,this.onShow(),this.isEnemy||(p.Global.talentSkillMgr.run(g.ETalentType.armyHp,this,!1),p.Global.talentSkillMgr.run(g.ETalentType.armyAtk,this,!1)),[2]})})},e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o;return __generator(this,function(){return 1==this.roleDate.warriortype?this.node.group=this.isEnemy?"enemy":"my":this.node.group=this.isEnemy?"enemy_3":"my_3",t="",e="",i="",this.bady.spriteFrame&&(t=this.bady.spriteFrame.name),this.icon.spriteFrame&&(e=this.icon.spriteFrame.name),this.other.spriteFrame&&(i=this.other.spriteFrame.name),this.isEnemy&&(t=t.replace("e1","e2"),e=e.replace("e1","e2"),i=i.replace("e1","e2"),this.Atlas.getSpriteFrame(e)||(e=e.replace("e2","e1")),this.Atlas.getSpriteFrame(t)||(t=t.replace("e2","e1")),this.Atlas.getSpriteFrame(i)||(i=i.replace("e2","e1"))),this.bady.spriteFrame=this.Atlas.getSpriteFrame(t),this.other.spriteFrame?(this.other.node.active=!0,this.other.spriteFrame=this.Atlas.getSpriteFrame(i)):this.other.node.active=!1,this.icon.spriteFrame?this.icon.spriteFrame=this.Atlas.getSpriteFrame(e):this.icon.spriteFrame=null,this.health.node.setPosition(0,this.bady.spriteFrame.getRect().height+10),this.health.node.active=!1,a=this.bady.spriteFrame.getRect().height,this.physics.offset=cc.v2(0,a/4),this.physics.radius=a/4,this.physics.apply(),this.node.setContentSize(this.bady.spriteFrame.getRect().width,this.bady.spriteFrame.getRect().height),n=c.default.randInt(-1,1),o=c.default.randInt(-1,1),this.isEnemy?(this.nowBirthpoint=cc.v2(this.Birthpoint.enemyBirthpoint.x+n,this.Birthpoint.enemyBirthpoint.y),this.node.setPosition(this.nowBirthpoint)):(this.nowBirthpoint=cc.v2(this.Birthpoint.myBirthpoint.x+n,this.Birthpoint.myBirthpoint.y+o),this.node.setPosition(this.nowBirthpoint)),this.roleBaseType=h.RoleBaseType.Birth,[2]})})},e.prototype.attackOver=function(){var t=this;this.isDeath()||this.NowAttackType==h.AttackType.Over||(this.NowAttackType=h.AttackType.Over,this.OnAttackAim=!1,this.roleBaseType=h.RoleBaseType.Interval,this.scheduleOnce(function(){t.roleBaseType=h.RoleBaseType.Move},this.attakInterval*this.attackTimeScale))},e.prototype.attackEnd=function(){this.isDeath()||this.NowAttackType==h.AttackType.End||(this.NowAttackType=h.AttackType.End,this.playReverseing||(this.perpetualAttack?this.playReverse?(this.anim.on(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.playReverseAttack(h.AttackType.AinmIng)):this.prepareAtk():this.playAttack(h.AttackType.AinmOver)))},e.prototype.playAtkAuio=function(){this.roleDate.audioId&&u.default.Instance().playEffect(Number(this.roleDate.audioId))},e.prototype.onplayReverse=function(){this.playReverseing=!1,this.anim.off(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.prepareAtk()},e.prototype.onGoAtk=function(){if(this.NowAttackType!=h.AttackType.OnGo&&(this.NowAttackType=h.AttackType.OnGo,!this.playReverseing)){this.playAtkAuio();for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}if(e.minDts<=this.attackDis)this.onGoAtkTo(e);else{if(!(i.minDts<=this.attackDis))return void this.attackEnd();this.onGoAtkTo(i)}if(2==this.roleDate.warriortype){var r={root:this.weapon,target:this.target,father:this};s.default.Instance().emitFireBullet(r)}else{var l=[this.attack,this.damageToOurBuild,this.damageToOtherBuild],c=this.killRewards;s.default.Instance().emitAttacked({id:this.target.getId(),attack:l,killRewards:c,sputAttack:this.sputAttack,sputRange:this.sputRange})}}},e.prototype.prepareAtk=function(){if(!this.isDeath()&&this.NowAttackType!=h.AttackType.Prepare){this.NowAttackType=h.AttackType.Prepare;for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}e.minDts<=this.attackDis?this.prepareAtkTo(e):i.minDts<=this.attackDis?this.prepareAtkTo(i):this.playAttack(h.AttackType.AinmOver)}},e.prototype.attackedFunc=function(t,e,i,a){var n=i;if(t&&(n=t[0]),this.isEnemy||!p.Global.common.isMiss(!1)){if(!this.isDeath()){this.hp-=n,u.default.Instance().playEffect(4);var o=this.bady.getComponent(cc.Sprite),r=new l.TweenMaterial(o,"time",0);cc.tween(r).to(.1,{mainAny:1}).to(.1,{mainAny:0}).start(),this.health.node.active=!0,this.health.progress=this.hp/this.curHp;var c=this.health.node.getChildByName("white");if(c.active=!0,c.width=(this.hp+n)/this.curHp*52,cc.tween(c).to(.2,{width:this.hp/this.curHp*52}).call(function(){c.active=!1}).start(),this.hp<=0){this.roleBaseType=h.RoleBaseType.Dide,p.Global.common.isDropMeat();var d=this.node.getContentSize().height;s.default.Instance().emitDungeonRoleDie(this.node.convertToWorldSpaceAR(cc.v2(0,d/2)),d/56.6,this.isEnemy);var m=(y=this.fightplan.roleList).indexOf(this);m>-1&&y.splice(m,1),this.isEnemy&&f.default.Instance().addDieNum(1),this.node.destroy()}if(a){for(var y=this.isEnemy?this.fightplan.enemyList:this.fightplan.roleList,v=[],b=0;b<y.length;++b)if(!y[b].isDeath()){var _=y[b].node;this.node!=_&&this.getDistance(this.node,_)<=a&&v.push(y[b])}v.forEach(function(t){t.attackedFunc(null,e,i,null)})}}}else p.Global.talentSkillMgr.playEft(this,g.ETalentEft.defence)},e.prototype.prepareAtkTo=function(t){!t.base||t.base.isDeath()?this.playAttack(h.AttackType.AinmOver):(this.target=t.base,this.startAtk())},e.prototype.onGoAtkTo=function(t){t.base&&!t.base.isDeath()?this.target=t.base:this.attackEnd()},e.prototype.startAtk=function(){var t=this;this.isDeath()||(this.attackAim&&(this.OnAttackAim=!0),this.scheduleOnce(function(){t.target&&!t.target.isDeath()?t.playAttack(h.AttackType.AinmIng):t.playAttack(h.AttackType.AinmOver)},this.attakIngInterval*this.attackTimeScale))},e.prototype.playAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(){return this.isDeath()?[2]:(e=this.anim.getClips(),(i=this.anim.play(e[t].name)).speed=1*this.animTimeScale,i.wrapMode=cc.WrapMode.Normal,[2])})})},e.prototype.playReverseAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(){return this.isDeath()?[2]:(e=this.anim.getClips(),(i=this.anim.play(e[t].name)).wrapMode=cc.WrapMode.Reverse,i.speed=1*this.animTimeScale,this.playReverseing=!0,[2])})})},e.prototype.detectionDis=function(){for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node,o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}this.roleBaseType==h.RoleBaseType.Attack&&this.attackAim&&this.OnAttackAim&&(e.minDts<=this.attackDis?this.setAimTo(e):i.minDts<=this.attackDis&&this.setAimTo(i)),this.roleBaseType==h.RoleBaseType.Move&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.setAtkTo(e):i.minDts<=this.attackDis&&this.setAtkTo(i)),2==this.roleDate.warriortype&&(this.roleBaseType==h.RoleBaseType.Attack?("enemy_3"!=this.node.group&&"my_3"!=this.node.group||(this.node.group=this.isEnemy?"enemy_2":"my_2"),this.bodySpeed=cc.v2(r.Vector2.ZERO)):("enemy_2"!=this.node.group&&"my_2"!=this.node.group||(this.node.group=this.isEnemy?"enemy_3":"my_3"),this.bodySpeed=this.bodySpeed)),this.OtherPhysics>0&&50!=this.physics.density?(this.physics.density=50,this.physics.apply()):10!=this.physics.density&&(this.physics.density=10,this.physics.apply()),this.roleBaseType==h.RoleBaseType.Interval&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.bodySpeed=cc.v2(r.Vector2.ZERO):i.minDts<=this.attackDis&&(this.bodySpeed=cc.v2(r.Vector2.ZERO))),f.default.Instance().isEnd||(this.bodySpeed.x*=this.moveSpeedScale,this.bodySpeed.y*=this.moveSpeedScale,this.rigidbody.linearVelocity=this.bodySpeed)},e.prototype.setMoveTo=function(t){var e=t.base.node.getPosition(),i=this.node.getPosition();if("selfBuild"==t.base.node.name){var a=t.base.node.getPosition();e={x:a.x,y:a.y+this.moveToBulidUse}}var n={x:0,y:0};r.Vector2.sub(n,e,i);var o=r.Vector2.len(n),s=new r.Vector2(n.x/o,n.y/o);this.bodySpeed.x=s.x*this.moveSpeed,this.bodySpeed.y=s.y*this.moveSpeed},e.prototype.setAtkTo=function(t){t.base&&!t.base.isDeath()&&(this.target=t.base,this.bodySpeed=cc.v2(r.Vector2.ZERO),this.playAttack(h.AttackType.AinmStart),this.roleBaseType=h.RoleBaseType.Attack)},e.prototype.setAimTo=function(t){if(t.base&&!t.base.isDeath()){this.target=t.base;var e=new r.Vector2(this.node.position),i=new r.Vector2(this.target.node.position),a=r.Vector2.angle360(e,i);this.weapon.angle=a}},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},e.prototype.move=function(){!f.default.Instance().isEnd&&this.canMove?this.isDeath()||(this.roleBaseType==h.RoleBaseType.Birth?this.moveOn():this.detectionDis()):this.rigidbody.linearVelocity=cc.v2(r.Vector2.ZERO)},e.prototype.moveOn=function(){this.roleBaseType=h.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBirth=function(){this.roleBaseType=h.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBeginContact=function(t,e,i){if(i.node){var a=i.node.getComponent(m.default);a&&this.isEnemy!=a.isEnemy?this.OtherPhysics+=1:this.selfPhysics+=1}},e.prototype.onEndContact=function(t,e,i){if(i.node){var a=i.node.getComponent(m.default);a&&this.isEnemy!=a.isEnemy?this.OtherPhysics-=1:this.selfPhysics-=1}},e.prototype.isDeath=function(){return this.roleBaseType==h.RoleBaseType.Dide},e.prototype.setHp=function(t){this.hp=t,this.health.progress=this.hp/this.curHp},e.prototype.getHp=function(){return this.hp},e.prototype.setCurHp=function(t){this.curHp=t,this.health.progress=this.hp/this.curHp},e.prototype.getAtk=function(){return this.attack},e.prototype.setAtk=function(t){this.attack=t},__decorate([b(cc.Sprite)],e.prototype,"bady",void 0),__decorate([b(cc.Sprite)],e.prototype,"icon",void 0),__decorate([b(cc.Node)],e.prototype,"weapon",void 0),__decorate([b(cc.Sprite)],e.prototype,"other",void 0),__decorate([b()],e.prototype,"bullet",void 0),__decorate([b(cc.Vec2)],e.prototype,"bulletPos",void 0),__decorate([b()],e.prototype,"bulletRotation",void 0),__decorate([b()],e.prototype,"bulletScale",void 0),__decorate([b(cc.Prefab)],e.prototype,"bulletEff",void 0),__decorate([b(cc.SpriteAtlas)],e.prototype,"Atlas",void 0),__decorate([v],e)}(m.default);n.BossRole=_,cc._RF.pop()},{}],BtnEffect:[function(t,e,i){"use strict";cc._RF.push(e,"6f107BT6rxB8obWbKlnjwFj","BtnEffect");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("AudioMgr"),s=cc._decorator,r=s.ccclass,l=s.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.clickPlay=!1,e}return __extends(e,t),e.prototype.onEnable=function(){this.clickPlay&&this.node.on(cc.Node.EventType.TOUCH_END,this.on_touch_ended,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.on_touch_ended,this),this.node.on(cc.Node.EventType.TOUCH_START,this.on_touch_begin,this)},e.prototype.on_touch_ended=function(){o.default.Instance().playEffect(6)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_END,this.on_touch_ended,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.on_touch_ended,this),this.node.off(cc.Node.EventType.TOUCH_START,this.on_touch_begin,this)},e.prototype.on_touch_begin=function(){o.default.Instance().playEffect(16)},__decorate([l],e.prototype,"clickPlay",void 0),__decorate([r],e)}(cc.Component);n.default=c,cc._RF.pop()},{}],BuildBase:[function(t,e,i){"use strict";cc._RF.push(e,"f2f5alyUmJGxLDVfsbYhxIZ","BuildBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("AudioMgr"),r=a("BattleFightMgr"),l=a("DataMgr"),c=a("EventMgr"),h=a("TweenMaterial"),d=a("UtilOne"),u=a("typeEnum"),p=a("BattleFightPanel"),f=a("TalentBase"),g=cc._decorator,m=g.ccclass,y=g.property,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.xueliang=null,e.xueliangNum=null,e.anim=null,e.hp=0,e.curHp=0,e.iocn_1=null,e.iocn_2=null,e.material=[],e.fightplan=null,e.id=1e8,e.killRewards=null,e.rigidbody=null,e.canMove=!0,e.tween=cc.tween().to(.1,{mainAny:9.99}).to(.1,{mainAny:0}).tag(u.TweenTag.white),e.tweenDie=cc.tween().to(2,{mainAny:9.99}).tag(u.TweenTag.buildDie),e}return __extends(e,t),e.prototype.onEnable=function(){this.addEvent(),this.uiSet()},e.prototype.addEvent=function(){var t=this;c.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange,e.owner)},this),c.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange,e.owner)},this)},e.prototype.uiSet=function(){this.anim.node.active=!1,this.iocn_1.setMaterial(0,this.material[0]),this.iocn_2.setMaterial(0,this.material[0])},e.prototype.attackedFunc=function(t,e,i,a,n){var h=this;void 0===n&&(n=null);var g=i;if(t&&(g="selfBase"!=this.node.name?t[2]:t[1]),!(this.hp<=0)){if(g>=this.hp&&(g=this.hp),this.hp-=g,s.default.Instance().playEffect(5),this.playEff(t),"selfBase"!=this.node.name){var m=1,y=n&&n.heroId;o.Global.talentSkillMgr.run(f.ETalentType.coinDouble,null,y)&&(m=2,o.Global.talentSkillMgr.playEft(this,f.ETalentEft.doubleCoin));for(var v=function(){var t=1,e=l.default.Instance().getPlayerData().getCardsTotalAddition().find(function(t){return t.type==u.CardAddType.coinAdd});e&&(t+=e.addition);var i=Math.round(r.default.Instance().enemyLevels.atkbase*g*t),a=b.fightplan.gold.convertToWorldSpaceAR(cc.v3(0,0)),n=b.node.convertToWorldSpaceAR(cc.v3(d.default.randInt(0,50),d.default.randInt(140,160)));r.default.Instance().coinChange=!0,c.default.Instance().emitCoinEffect(n,a,function(){s.default.Instance().playEffect(21),r.default.Instance().addCoinNum(i),r.default.Instance().coinChange=!1})},b=this,_=0;_<m;_++)v()}if(this.hp<=0){this.hp=0,s.default.Instance().playEffect(8),r.default.Instance().isEnd=!0,this.playDie(),this.xueliangNum.string="0",this.xueliang.progress=0;var T=!1;return"selfBase"!=this.node.name&&(T=!0),this.scheduleOnce(function(){c.default.Instance().emitGameOver(T,!0),h.anim.stopSystem(),h.anim.node.active=!1},2.2),this.xueliangNum.string=""+d.default.ChangeNumberUnit(this.hp,1),void(this.xueliang.progress=this.hp/this.curHp)}if(this.xueliangNum.string=""+d.default.ChangeNumberUnit(this.hp,1),this.xueliang.progress=this.hp/this.curHp,a){var S="selfBase"!=this.node.name?p.default.enemyList:p.default.roleList,D=[];for(_=0;_<S.length;++_)if(!S[_].isDeath()){var k=S[_].node;this.node!=k&&this.getDistance(this.node,k)<=a&&D.push(S[_])}D.forEach(function(t){t.attackedFunc(null,e,i,null)})}}},e.prototype.playEff=function(t){var e=this.xueliang.node.getChildByName("white");e.active=!0,e.width=(this.hp+t)/this.curHp*62,cc.tween(e).to(.2,{width:this.hp/this.curHp*62}).call(function(){e.active=!1}).start();var i=new h.TweenMaterial(this.iocn_1,"time",0),a=new h.TweenMaterial(this.iocn_2,"time",0);if(this.tween.clone().target(i).start(),this.tween.clone().target(a).start(),s.default.Instance().getVibrateEnabled()){o.Global.sdkMgr.vibrateShort("heavy");var n=cc.v3(d.default.randInt(-3,3),d.default.randInt(-3,3));cc.tween(this.node.parent).to(.1,{position:n}).to(.1,{position:cc.v3(0,0,0)}).start()}},e.prototype.playDie=function(){cc.Tween.stopAllByTag(u.TweenTag.white),this.anim.node.active=!0,this.anim.resetSystem(),this.iocn_1.setMaterial(0,this.material[1]),this.iocn_2.setMaterial(0,this.material[1]);var t=new h.TweenMaterial(this.iocn_1,"time",0),e=new h.TweenMaterial(this.iocn_2,"time",0);this.tweenDie.clone().target(t).start(),this.tweenDie.clone().target(e).start()},e.prototype.getHp=function(){return this.hp},e.prototype.subHp=function(t){this.hp-=t},e.prototype.isDeath=function(){return this.hp<=0},e.prototype.initBase=function(t){this.hp=t.hp,this.curHp=t.hp,this.xueliangNum.string=""+d.default.ChangeNumberUnit(this.curHp,1),this.xueliang.progress=this.hp/this.curHp,this.fightplan=t.fightplan,this.id=t.id},e.prototype.move=function(){},e.prototype.getId=function(){return this.id},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},__decorate([y(cc.ProgressBar)],e.prototype,"xueliang",void 0),__decorate([y(cc.Label)],e.prototype,"xueliangNum",void 0),__decorate([y(cc.ParticleSystem)],e.prototype,"anim",void 0),__decorate([y(cc.Sprite)],e.prototype,"iocn_1",void 0),__decorate([y(cc.Sprite)],e.prototype,"iocn_2",void 0),__decorate([y(cc.Material)],e.prototype,"material",void 0),__decorate([m],e)}(cc.Component);n.default=v,cc._RF.pop()},{}],Bullet:[function(t,e,i){"use strict";cc._RF.push(e,"fe39a4ZKHxP/qWJuAY6Movn","Bullet");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("CompBase"),s=a("EventMgr"),r=a("ResMgr"),l=a("IVector2"),c=a("BattleFightPanel"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.logo=null,e.ParticleNode=null,e.dir=0,e.lastPos=cc.v2(0,0),e.data=null,e.parabola=!1,e.rotateNum=0,e}return __extends(e,t),e.prototype.show=function(){return __awaiter(this,void 0,Promise,function(){var t,e,i,a,n,o,s,l,c,h,d,u,p,f=this;return __generator(this,function(g){switch(g.label){case 0:return this.ParticleNode.active=!1,(e=this.data.father.heroId)?(a="hero/hero_"+e+"/level",[4,r.default.Instance().loadAndGetRes("equip",a,cc.SpriteAtlas)]):[3,2];case 1:return t=g.sent(),[3,4];case 2:return[4,r.default.Instance().loadAndGetRes(this.data.father.levelUrl,"level",cc.SpriteAtlas)];case 3:t=g.sent(),g.label=4;case 4:return this.data.target&&this.data.target.isValid&&this.data.root?(i="e1_"+this.data.father.bullet,this.data.father.isEnemy&&(i="e2_"+this.data.father.bullet,t.getSpriteFrame(i)||(i="e1_"+this.data.father.bullet)),this.data.father.bulletEff?(this.ParticleNode.active=!0,this.ParticleNode.removeAllChildren(),a="e1_",this.data.father.isEnemy&&(a="e2_"),n=null,e?(o="hero/hero_"+e+"/",[4,r.default.Instance().loadAndGetRes("equip",o+a+this.data.father.bulletEff,cc.Prefab)]):[3,6]):[3,9]):(this.node.destroy(),[2]);case 5:return n=g.sent(),[3,8];case 6:return[4,r.default.Instance().loadAndGetRes(this.data.father.levelUrl,a+this.data.father.bulletEff,cc.Prefab)];case 7:n=g.sent(),g.label=8;case 8:s=cc.instantiate(n),this.ParticleNode.addChild(s),g.label=9;case 9:return this.logo.spriteFrame=t.getSpriteFrame(i),l=this.data.root.convertToWorldSpaceAR(this.data.father.bulletPos),c=this.data.target.node.convertToWorldSpaceAR(cc.v2(0,this.data.target.node.height/2)),h=this.data.father.bulletRotation||0,this.node.angle=h,this.node.setPosition(this.node.parent.convertToNodeSpaceAR(l)),this.lastPos=this.node.getPosition(),d=this.node.parent.convertToNodeSpaceAR(c),u=this.data.father.bulletspeed,this.logo.node.scale=this.data.father.bulletScale,this.rotateNum=this.data.father.roleDate.ratation,1==this.data.father.roleDate.track?(p=Math.sqrt(Math.pow(d.x-this.node.getPosition().x,2)+Math.pow(d.y-this.node.getPosition().y,2)),cc.tween(this.node).then(cc.jumpTo(u,d.x,d.y,p/500*60,1)).call(function(){f.over()}).start()):cc.tween(this.node).to(u,{x:d.x,y:d.y}).call(function(){f.over()}).start(),[2]}})})},e.prototype.over=function(){if(this.unscheduleAllCallbacks(),this.data.target&&this.data.target.isValid){var t=this.fatherData.attack,e=this.fatherData.killRewards;s.default.Instance().emitBulletHuit({id:this.data.target.getId(),attack:t,killRewards:e,sputAttack:this.fatherData.sputAttack,sputRange:this.fatherData.sputRange,owner:this.data.father})}this.logo.spriteFrame=null,this.ParticleNode.removeAllChildren(),this.ParticleNode.active=!1,c.default.bulletNodePool.put(this.node)},e.prototype.initBullet=function(t){this.data=t,this.fatherData={attack:[this.data.father.attack,this.data.father.damageToOurBuild,this.data.father.damageToOtherBuild],damageToOurBuild:this.data.father.damageToOurBuild,damageToOtherBuild:this.data.father.damageToOtherBuild,killRewards:this.data.target.killRewards,sputAttack:this.data.father.sputAttack,sputRange:this.data.father.sputRange},this.show()},e.prototype.update=function(){if(this.node)if(this.rotateNum)this.node.angle-=this.rotateNum/30;else{var t=this.node.getPosition();if(t!=this.lastPos){var e=new l.Vector2(this.lastPos),i=new l.Vector2(t),a=l.Vector2.angle360(e,i);this.node.angle=a,this.lastPos=t}}},__decorate([u(cc.Sprite)],e.prototype,"logo",void 0),__decorate([u(cc.Node)],e.prototype,"ParticleNode",void 0),__decorate([d],e)}(o.default);n.default=p,cc._RF.pop()},{}],CacheMgr:[function(t,e,i){"use strict";cc._RF.push(e,"efb90AckXRJqrRc8bTJKLzk","CacheMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("base64"),s=a("TTCloudMgr"),r=function(){function t(){}return t.SaveData=function(t,e){if(void 0===e&&(e=!1),e)for(var i in this.curData=JSON.stringify(t),this.curDataTemp=JSON.parse(this.curData),this.curDataTemp){var a=this.preKey+i,n=cc.sys.localStorage.getItem(a),o=this.curDataTemp[i];if(null!=o){var r=JSON.stringify(o);r!=n&&cc.sys.localStorage.setItem(a,r)}}else{s.default.ins.uploadData(!1);var l={},c=!1;for(var a in this.curDataTemp=JSON.parse(this.curData),t){var h=t[a],d=JSON.stringify(h);void 0===this.curDataTemp[a]?(l[a]=h,c=!0):JSON.stringify(this.curDataTemp[a])!=d&&(l[a]=h,c=!0)}if(c){var u=(new Date).getTime();for(var i in l){a=this.preKey+i,h=l[i],cc.sys.localStorage.setItem(a,JSON.stringify(h));var p=this.timeKey+this.preKey+i;cc.sys.localStorage.setItem(p,JSON.stringify(u))}this.curData=JSON.stringify(t)}}},t.LoadServer=function(){return s.default.ins.LoadServer()},t.LoadOld=function(t){var e=cc.sys.localStorage.getItem(t);if(e){var i;if(this.isBase64(e)){i=o.default.Instance().decode(e);try{i=JSON.parse(i)}catch(r){console.error("\u89e3\u5bc6json\u9519\u8bef:",r,i)}}else i=JSON.parse(e);var a=i.data;return cc.sys.localStorage.removeItem(t),a}},t.isBase64=function(t){return/^[a-zA-Z0-9+\/]+={0,2}$/.test(t)},t.iv="JBtatQYbaIaF5STz",t.key="t3N6tu8asLeLd4FV",t.SignKey="1F81BC0B9C89AEC9A9373AF174C7FB00",t.KeyList=void 0,t.oldKey="_game_data",t.preKey="goose_",t.timeKey="t_",t}();n.default=r,cc._RF.pop()},{}],CardGetPanel:[function(t,e,i){"use strict";cc._RF.push(e,"86c03T08fBO3p0Xh75Sp+Se","CardGetPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("AudioMgr"),r=a("ConfigMgr"),l=a("EventMgr"),c=a("CardsItemForGet"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.more=null,e.one=null,e.item=null,e.arr=null,e}return __extends(e,t),e.prototype.initWithParam=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a,n=this;return __generator(this,function(o){switch(o.label){case 0:if(this.more.removeAllChildren(),this.one.removeAllChildren(),!t)return[3,6];if(this.arr=t,!(t.length>1))return[3,5];e=function(e){var i,a;return __generator(this,function(o){switch(o.label){case 0:return i=r.default.Instance().getTableValue("ID",t[e],cfgTable.cardData),a=.2,Number(i.quality)>1&&(a=.25),[4,new Promise(function(o){n.scheduleOnce(function(){n.createItem(t[e],i),e==t.length-1&&n.scheduleOnce(n.emitCloseMe,2.5),o(1)},a)})];case 1:return o.sent(),[2]}})},i=0,o.label=1;case 1:return i<t.length?[5,e(i)]:[3,4];case 2:o.sent(),o.label=3;case 3:return++i,[3,1];case 4:return[3,6];case 5:for(i=0;i<t.length;++i)a=r.default.Instance().getTableValue("ID",t[i],cfgTable.cardData),this.createItem1(t[i],a),i==t.length-1&&this.scheduleOnce(this.emitCloseMe,2.5);o.label=6;case 6:return[2]}})})},e.prototype.createItem=function(t,e){var i=cc.instantiate(this.item);i.getComponent(c.default).setData(t),this.more.addChild(i),s.default.Instance().playEffect(9),Number(e.quality)>1&&cc.tween(i).to(.15,{scale:1.3}).to(.2,{scale:1}).start()},e.prototype.createItem1=function(t,e){var i=cc.instantiate(this.item);i.getComponent(c.default).setData(t),this.one.addChild(i),s.default.Instance().playEffect(9),Number(e.quality)>1&&cc.tween(i).to(.15,{scale:1.3}).to(.2,{scale:1}).start()},e.prototype.onDestroy=function(){l.default.Instance().emitRefreshCardPanel()},e.prototype.start=function(){},__decorate([u(cc.Node)],e.prototype,"more",void 0),__decorate([u(cc.Node)],e.prototype,"one",void 0),__decorate([u(cc.Prefab)],e.prototype,"item",void 0),__decorate([d],e)}(o.default);n.default=p,cc._RF.pop()},{}],CardUIScript:[function(t,e,i){"use strict";cc._RF.push(e,"af422NK/FRDgJEpI6corihm","CardUIScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("ConfigMgr"),r=a("DataMgr"),l=a("EventMgr"),c=a("typeEnum"),h=a("SuperScrollView"),d=a("UtilOne"),u=cc._decorator,p=u.ccclass,f=u.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.superScrollView=null,e.pointBtn=null,e.summonx1=null,e.summonx10=null,e.summonx1Cost=null,e.summonx10Cost=null,e.summonProgress=null,e.summonPer=null,e.summonLevel=null,e.summonBtn=null,e.sprs=[],e.getCardLevel=0,e.gameData=null,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.onEnable=function(){this.pointBtn.on("click",function(){o.Global.guideMgr.changeGuideStep(c.GuideStep.CheckAllCardAttribute,c.GuideStep.Complete),l.default.Instance().emitShowPanel({prefab:"prefab/MainPanel/CardsAddition"})}),this.summonBtn.on("click",this.openSummonPanel,this),l.default.Instance().onRefreshCardPanel(this.initUI,this),l.default.Instance().onRefreshCardPanel(this.initEvent,this),l.default.Instance().onDiamondChange(this.initCoinText,this),this.gameData=r.default.Instance().getPlayerData(),this.initUI(),this.initEvent()},e.prototype.initEvent=function(){this.summonx1.on("click",this.onSummonx1CallFunc,this),this.summonx10.on("click",this.onSummonx10CallFunc,this)},e.prototype.changeFunc=function(){for(var t=this.gameData.getCardIdList(),e=[],i=[],a=0;a<t.length;++a){var n=s.default.Instance().getTableValue("ID",t[a].ID,cfgTable.cardData);e.push(n)}e.sort(function(t,e){return Number(e.quality)-Number(t.quality)});for(var o=0;o<e.length;++o)for(var r=0;r<t.length;++r)e[o].ID==t[r].ID&&i.push(t[r]);this.superScrollView.setData(i)},e.prototype.initUI=function(){this.getCardLevel=this.gameData.getTakeCardLevel(),this.changeFunc(),this.initCoinText(),this.summonBtn.active=this.getCardLevel>1,this.summonProgress.node.active=this.getCardLevel>1;var t=cfgTable.cardlevelData[this.getCardLevel+""].condition;this.summonLevel.string=""+this.getCardLevel;var e=Object.getOwnPropertyNames(cfgTable.cardlevelData).length;this.getCardLevel>=e?(this.summonProgress.progress=1,this.summonPer.string="max"):(this.summonProgress.progress=this.gameData.getTakeCardCount()/t,this.summonPer.string=this.gameData.getTakeCardCount()+"/"+t);var i=cfgTable.cardData,a=[];for(var n in i)a.push({ID:i[n].ID,maxCount:i[n].maxnumber});var s=this.summonx1.getChildByName("free"),h=this.summonx1.getChildByName("lettleGreen");r.default.Instance().getPlayerData().getFreeGetCard()&&(s.active=!0,h.active=!1,this.summonx1Cost.node.active=!1,this.summonx1.getComponent(cc.Sprite).setMaterial(0,this.sprs[1])),this.gameData.setCardsTotalCount(a);var d=[o.Global.languageMgr.getText(933001)],u=r.default.Instance().getPlayerData().getCardIdList().length+"/"+Object.getOwnPropertyNames(cfgTable.cardData).length;d.push(u),l.default.Instance().emitUpdateMainPanelTitle(d,c.MainPanelTitleType.ShowTextAndNum)},e.prototype.initCoinText=function(){var t=cfgTable.commonData.costcard,e=cfgTable.commonData.tencostcard;this.gameData.getDiamond()<e?(this.summonx10.getComponent(cc.Sprite).setMaterial(0,this.sprs[0]),this.summonx10Cost.node.color=cc.color().fromHEX("#FF0000")):(this.summonx10.getComponent(cc.Sprite).setMaterial(0,this.sprs[1]),this.summonx10Cost.node.color=cc.color().fromHEX("#FFFFFF")),this.gameData.getDiamond()<t?(this.summonx1.getComponent(cc.Sprite).setMaterial(0,this.sprs[0]),this.summonx1Cost.node.color=cc.color().fromHEX("#FF0000")):(this.summonx1.getComponent(cc.Sprite).setMaterial(0,this.sprs[1]),this.summonx1Cost.node.color=cc.color().fromHEX("#FFFFFF")),this.summonx1Cost.string=""+t,this.summonx10Cost.string=""+e},e.prototype.openSummonPanel=function(){},e.prototype.onSummonx1CallFunc=function(){var t=this;if(!this.gameData.getFreeGetCard()){var e=cfgTable.commonData.costcard;if(this.gameData.getDiamond()<e)return void l.default.Instance().emitTips(o.Global.languageMgr.getText(933106));this.gameData.setDiamond(-e)}if(this.summonx1.targetOff(this),this.summonx10.targetOff(this),function e(){var i=cfgTable.cardlevelData[t.getCardLevel+""],a=i.probability,n=d.default.get_weight_random(a,"1"),o=i.probability[n][0],s=[];for(var c in cfgTable.cardData)Number(cfgTable.cardData[c].quality)==o&&s.push(cfgTable.cardData[c]);var h=s[Math.floor(Math.random()*s.length)];if(t.gameData.subCardsTotalCount(h.ID)){var u=[];u.push(h.ID),t.gameData.setTakeCardCount(),l.default.Instance().emitShowPanel({data:u,prefab:"prefab/MainPanel/CardGetPanel"})}else for(var p=0,f=r.default.Instance().getPlayerData().getCardsTotalCount();p<f.length;p++)if(f[p].maxCount>0){e();break}}(),this.gameData.getFreeGetCard()){var i=this.summonx1.getChildByName("free"),a=this.summonx1.getChildByName("lettleGreen");i.active=!1,a.active=!0,this.summonx1Cost.node.active=!0,this.summonx1.getComponent(cc.Sprite).setMaterial(0,this.sprs[0]),this.gameData.setFreeGetCard(!1),this.gameData.getGuideStep()==c.GuideStep.ClickDrawCard&&o.Global.guideMgr.changeGuideStep(c.GuideStep.ClickDrawCard,c.GuideStep.ClickNewCard,!1)}o.Global.umSDK.send(c.EnumDefine.fieldName.card_draws,{type:c.EnumDefine.fieldDes.cardOne})},e.prototype.switchBtnClick=function(){},e.prototype.onSummonx10CallFunc=function(){var t=this,e=cfgTable.commonData.tencostcard;if(this.gameData.getDiamond()<e)l.default.Instance().emitTips(o.Global.languageMgr.getText(933106));else{this.gameData.setDiamond(-e),this.summonx1.targetOff(this),this.summonx10.targetOff(this);for(var i=[],a=0;a<10;++a)!function e(){var a=cfgTable.cardlevelData[t.getCardLevel+""],n=a.probability,o=d.default.get_weight_random(n,"1"),s=a.probability[o][0],l=[];for(var c in cfgTable.cardData)Number(cfgTable.cardData[c].quality)==s&&l.push(cfgTable.cardData[c]);var h=l[Math.floor(Math.random()*l.length)];if(t.gameData.subCardsTotalCount(h.ID))i.push(h.ID),t.gameData.setTakeCardCount();else for(var u=0,p=r.default.Instance().getPlayerData().getCardsTotalCount();u<p.length;u++)if(p[u].maxCount>0){e();break}}();i.length>0&&l.default.Instance().emitShowPanel({data:i,prefab:"prefab/MainPanel/CardGetPanel"}),o.Global.umSDK.send(c.EnumDefine.fieldName.card_draws,{type:c.EnumDefine.fieldDes.cardTen})}},e.prototype.onDisable=function(){this.summonx1.off("click",this.onSummonx1CallFunc,this),this.summonx10.off("click",this.onSummonx10CallFunc,this),this.summonBtn.off("click",this.openSummonPanel,this)},__decorate([f({type:h.default,displayName:"\u6ed1\u52a8\u6761"})],e.prototype,"superScrollView",void 0),__decorate([f({type:cc.Node,displayName:"\u611f\u53f9\u53f7"})],e.prototype,"pointBtn",void 0),__decorate([f({type:cc.Node,displayName:"\u62bd1\u6b21"})],e.prototype,"summonx1",void 0),__decorate([f({type:cc.Node,displayName:"\u62bd10\u6b21"})],e.prototype,"summonx10",void 0),__decorate([f({type:cc.Label,displayName:"\u62bd1\u6b21\u82b1\u8d39"})],e.prototype,"summonx1Cost",void 0),__decorate([f({type:cc.Label,displayName:"\u62bd10\u6b21\u82b1\u8d39"})],e.prototype,"summonx10Cost",void 0),__decorate([f({type:cc.ProgressBar,displayName:"\u53ec\u5524\u6b21\u6570\u8fdb\u5ea6\u6761"})],e.prototype,"summonProgress",void 0),__decorate([f({type:cc.Label,displayName:"\u53ec\u5524\u6b21\u6570\u767e\u5206\u6bd4"})],e.prototype,"summonPer",void 0),__decorate([f({type:cc.Label,displayName:"\u53ec\u5524\u7b49\u7ea7"})],e.prototype,"summonLevel",void 0),__decorate([f({type:cc.Node,displayName:"\u67e5\u770b\u53ec\u5524\u6982\u7387\u5165\u53e3"})],e.prototype,"summonBtn",void 0),__decorate([f({type:cc.Material,displayName:"\u6309\u94ae\u66f4\u6362\u56fe\u7247"})],e.prototype,"sprs",void 0),__decorate([p],e)}(cc.Component);n.default=g,cc._RF.pop()},{}],CardsAddition:[function(t,e,i){"use strict";cc._RF.push(e,"cd88cvbXEdOPan8KBoeDTr9","CardsAddition");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("DataMgr"),l=cc._decorator,c=l.ccclass,h=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.closeBtn=null,e.item=null,e.content=null,e}return __extends(e,t),e.prototype.start=function(){this.closeBtn.on("click",this.emitCloseMe,this)},e.prototype.onLoad=function(){var t;t=r.default.Instance().getPlayerData().getCardsTotalAddition(),console.log(t),this.content.removeAllChildren();for(var e=0;e<t.length;++e){var i=cc.instantiate(this.item),a="";switch(t[e].type){case 1:a=o.Global.languageMgr.getText(933101);break;case 2:a=o.Global.languageMgr.getText(933102);break;case 3:a=o.Global.languageMgr.getText(933105);break;case 4:a=o.Global.languageMgr.getText(933104);break;case 5:a=o.Global.languageMgr.getText(933103)}i.getComponent(cc.Label).string=(100*t[e].addition).toFixed(0)+"%"+a,this.content.addChild(i)}},__decorate([h(cc.Node)],e.prototype,"closeBtn",void 0),__decorate([h(cc.Node)],e.prototype,"item",void 0),__decorate([h(cc.Node)],e.prototype,"content",void 0),__decorate([c],e)}(s.default);n.default=d,cc._RF.pop()},{}],CardsInfo:[function(t,e,i){"use strict";cc._RF.push(e,"4b7fbN1Dy5MzLhAkw4HwcA7","CardsInfo");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("ConfigMgr"),l=a("DataMgr"),c=a("EventMgr"),h=a("typeEnum"),d=cc._decorator,u=d.ccclass,p=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.logo=null,e.logoAtils=null,e.level=null,e.count=null,e.qualityBg=null,e.jiantou=null,e.qualitySpr=[],e.m_name=null,e.info=null,e.total=null,e.closeBtn=null,e.UpgradesBtn=null,e.progress=null,e.sprs=[],e.canLevelUp=!1,e.data=null,e}return __extends(e,t),e.prototype.initWithParam=function(t){this.showEffect(),this.init(t)},e.prototype.init=function(t){var e=this;this.data=t;var i=r.default.Instance().getTableValue("ID",t.ID,cfgTable.cardData);this.count.string=t.count+"/"+i.level[t.level][0],this.logo.spriteFrame=this.logoAtils.getSpriteFrame(i.picture),this.level.string="LV"+(t.level+1),this.qualityBg.spriteFrame=this.qualitySpr[Number(i.quality)-1],this.UpgradesBtn.active=this.jiantou.active=t.count>=i.level[t.level][0],this.m_name.string=""+o.Global.languageMgr.getText(Number(i.nameid)),this.info.string=""+o.Global.languageMgr.getText(Number(i.textid));var a=o.Global.languageMgr.getText(Number(i.typetextid[0])),n=o.Global.languageMgr.getText(Number(i.typetextid[1])),s=0;if(t.level<=0)s=i.typenumber[0];else{for(var c=0,d=0;d<t.level;++d)c+=i.level[d][1];s=i.typenumber[0]+c}var u,p=a.replace("{0}",(100*s).toFixed(0)+"%");if(u=t.count>=i.level[t.level][0]?p.replace("{1}","<color=#00ff00>(+"+(100*i.level[t.level][1]).toFixed(0)+"%)</c >"):p.replace("{1}",""),n){for(d=0;d<t.level+2;++d)i.level[d][2];var f=0;if(t.level<=0)f=i.typenumber[1];else{for(c=0,d=0;d<t.level;++d)c+=i.level[d][1];f=i.typenumber[1]+c}var g=(t.count>=i.level[t.level][0]?n.replace("{1}","<color=#00ff00>(+"+(100*i.level[t.level][2]).toFixed(0)+"%)</c >"):n.replace("{1}","")).replace("{0}",(100*f).toFixed(0)+"%");this.total.string=u+"\n"+g}else this.total.string=u;this.progress.fillRange=t.count/i.level[t.level][0],this.progress.spriteFrame=t.count>=i.level[t.level][0]?this.sprs[1]:this.sprs[0],l.default.Instance().getPlayerData().getGuideStep()==h.GuideStep.CardAttributeIntroduction&&this.scheduleOnce(function(){o.Global.guideMgr.showGuidePanel(e.node)})},e.prototype.start=function(){var t=this;this.closeBtn.on("click",function(){l.default.Instance().getPlayerData().getGuideStep()==h.GuideStep.CheckAllCardAttribute?t.scheduleOnce(function(){o.Global.guideMgr.showGuidePanel(),t.emitCloseMe()}):t.emitCloseMe()},this),this.UpgradesBtn.on("click",this.onUpgradesBtnClick,this)},e.prototype.onUpgradesBtnClick=function(){var t=l.default.Instance().getPlayerData().setCardLevelUp(this.data.ID);this.init(t),c.default.Instance().emitRefreshCardPanel()},__decorate([p({type:cc.Sprite,displayName:"\u4eba\u7269"})],e.prototype,"logo",void 0),__decorate([p({type:cc.SpriteAtlas,displayName:"\u4eba\u7269\u56fe\u96c6"})],e.prototype,"logoAtils",void 0),__decorate([p({type:cc.Label,displayName:"\u7b49\u7ea7"})],e.prototype,"level",void 0),__decorate([p({type:cc.Label,displayName:"\u6570\u91cf"})],e.prototype,"count",void 0),__decorate([p({type:cc.Sprite,displayName:"\u54c1\u8d28\u80cc\u666f\u677f"})],e.prototype,"qualityBg",void 0),__decorate([p({type:cc.Node,displayName:"\u662f\u5426\u53ef\u4ee5\u5347\u7ea7"})],e.prototype,"jiantou",void 0),__decorate([p({type:cc.SpriteFrame,displayName:"\u54c1\u8d28\u6846"})],e.prototype,"qualitySpr",void 0),__decorate([p({type:cc.Label,displayName:"\u540d\u5b57"})],e.prototype,"m_name",void 0),__decorate([p({type:cc.Label,displayName:"\u4fe1\u606f"})],e.prototype,"info",void 0),__decorate([p({type:cc.RichText,displayName:"\u603b\u52a0\u6210"})],e.prototype,"total",void 0),__decorate([p(cc.Node)],e.prototype,"closeBtn",void 0),__decorate([p({type:cc.Node,displayName:"\u5347\u7ea7\u6309\u94ae"})],e.prototype,"UpgradesBtn",void 0),__decorate([p({type:cc.Sprite,displayName:"\u8fdb\u5ea6\u6761"})],e.prototype,"progress",void 0),__decorate([p({type:cc.SpriteFrame,displayName:"\u8fdb\u5ea6\u6761\u4e24\u79cd\u72b6\u6001"})],e.prototype,"sprs",void 0),__decorate([u],e)}(s.default);n.default=f,cc._RF.pop()},{}],CardsItemForGet:[function(t,e,i){"use strict";cc._RF.push(e,"2ff6buHjWxCAa5HQD1Dj+84","CardsItemForGet");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("ConfigMgr"),s=a("DataMgr"),r=cc._decorator,l=r.ccclass,c=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.logo=null,e.logoAtils=null,e.level=null,e.qualitySpr=[],e.qualityBg=null,e.isNewLogo=null,e.content=null,e}return __extends(e,t),e.prototype.setData=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a,n,r,l=this;return __generator(this,function(c){switch(c.label){case 0:for(e=s.default.Instance().getPlayerData(),i=o.default.Instance().getTableValue("ID",t,cfgTable.cardData),a=!1,this.logo.spriteFrame=this.logoAtils.getSpriteFrame(i.picture),n=e.getCardIdList(),this.qualityBg.spriteFrame=this.qualitySpr[Number(i.quality)-1],r=0;r<n.length;++r)t==n[r].ID&&(this.level.string="LV"+(n[r].level+1));return[4,new Promise(function(i){for(var n=e.getCardIdList(),o=0;o<n.length;++o)n[o].ID==t&&(a=!0);l.isNewLogo.active=!a,1==l.isNewLogo.active?l.level.string="LV0":console.log("\u6709"),i(1)})];case 1:return c.sent(),e.setCardIdList(t),this.showEffect(),[2]}})})},e.prototype.showEffect=function(){cc.tween(this.content).to(.5,{opacity:255}).start()},__decorate([c({type:cc.Sprite,displayName:"\u4eba\u7269"})],e.prototype,"logo",void 0),__decorate([c({type:cc.SpriteAtlas,displayName:"\u4eba\u7269\u56fe\u96c6"})],e.prototype,"logoAtils",void 0),__decorate([c({type:cc.Label,displayName:"\u7b49\u7ea7"})],e.prototype,"level",void 0),__decorate([c({type:cc.SpriteFrame,displayName:"\u54c1\u8d28\u6846"})],e.prototype,"qualitySpr",void 0),__decorate([c({type:cc.Sprite,displayName:"\u54c1\u8d28\u80cc\u666f\u677f"})],e.prototype,"qualityBg",void 0),__decorate([c({type:cc.Node,displayName:"\u65b0\u5361\u6807\u5fd7"})],e.prototype,"isNewLogo",void 0),__decorate([c({type:cc.Node,displayName:"\u5185\u5bb9"})],e.prototype,"content",void 0),__decorate([l],e)}(cc.Component);n.default=h,cc._RF.pop()},{}],CardsItem:[function(t,e,i){"use strict";cc._RF.push(e,"cb82eAC8qBPIbxi1oF4wFsj","CardsItem");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("ConfigMgr"),r=a("EventMgr"),l=a("typeEnum"),c=a("SuperListItem"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.logo=null,e.logoAtils=null,e.level=null,e.count=null,e.qualityBg=null,e.jiantou=null,e.qualitySpr=[],e.progress=null,e.sprs=[],e.data=null,e}return __extends(e,t),e.prototype.setData=function(t){this.data=t;var e=s.default.Instance().getTableValue("ID",t.ID,cfgTable.cardData);this.count.string=t.count+"/"+e.level[t.level][0],this.logo.spriteFrame=this.logoAtils.getSpriteFrame(e.picture),this.level.string="LV"+(t.level+1),this.qualityBg.spriteFrame=this.qualitySpr[Number(e.quality)-1],this.jiantou.active=t.count>=e.level[t.level][0],this.progress.fillRange=t.count/e.level[t.level][0],this.progress.spriteFrame=t.count>=e.level[t.level][0]?this.sprs[1]:this.sprs[0]},e.prototype.start=function(){var t=this;this.node.on("click",function(){r.default.Instance().emitShowPanel({data:t.data,prefab:"prefab/MainPanel/CardsInfo"}),o.Global.guideMgr.changeGuideStep(l.GuideStep.ClickNewCard,l.GuideStep.CardAttributeIntroduction)},this)},__decorate([u({type:cc.Sprite,displayName:"\u4eba\u7269"})],e.prototype,"logo",void 0),__decorate([u({type:cc.SpriteAtlas,displayName:"\u4eba\u7269\u56fe\u96c6"})],e.prototype,"logoAtils",void 0),__decorate([u({type:cc.Label,displayName:"\u7b49\u7ea7"})],e.prototype,"level",void 0),__decorate([u({type:cc.Label,displayName:"\u6570\u91cf"})],e.prototype,"count",void 0),__decorate([u({type:cc.Sprite,displayName:"\u54c1\u8d28\u80cc\u666f\u677f"})],e.prototype,"qualityBg",void 0),__decorate([u({type:cc.Node,displayName:"\u662f\u5426\u53ef\u4ee5\u5347\u7ea7"})],e.prototype,"jiantou",void 0),__decorate([u({type:cc.SpriteFrame,displayName:"\u54c1\u8d28\u6846"})],e.prototype,"qualitySpr",void 0),__decorate([u({type:cc.Sprite,displayName:"\u8fdb\u5ea6\u6761"})],e.prototype,"progress",void 0),__decorate([u({type:cc.SpriteFrame,displayName:"\u8fdb\u5ea6\u6761\u4e24\u79cd\u72b6\u6001"})],e.prototype,"sprs",void 0),__decorate([d],e)}(c.default);n.default=p,cc._RF.pop()},{}],CardsPanel:[function(t,e,i){"use strict";cc._RF.push(e,"d7f2dR7uYpIe79p1XaSBb24","CardsPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("DataMgr"),l=a("EventMgr"),c=a("typeEnum"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.switchBtnRoot=null,e.nodes=[],e.index=0,e.playerData=null,e}return __extends(e,t),e.prototype.start=function(){this.initUI(),this.changeUI()},e.prototype.onEnable=function(){l.default.Instance().onRefreshUpgrad(this.initUI,this),this.initGuide()},e.prototype.initUI=function(){var t=this;this.playerData=r.default.Instance().getPlayerData(),this.switchBtnRoot.children.forEach(function(e,i){e.off("click"),e.on("click",function(){if(i!=t.index){var e="",a=[];switch(i){case c.CardsPanelInterfaceType.card:t.index=i,a=[o.Global.languageMgr.getText(933001)];var n=t.playerData.getCardIdList().length+"/"+Object.getOwnPropertyNames(cfgTable.cardData).length;a.push(n),l.default.Instance().emitUpdateMainPanelTitle(a,c.MainPanelTitleType.ShowTextAndNum);break;case c.CardsPanelInterfaceType.skill:if(t.playerData.getTimeLine()<cfgTable.commonData.cardsFeatureOpen[1])e=""+o.Global.languageMgr.getText(933004)+cfgTable.commonData.cardsFeatureOpen[1]+o.Global.languageMgr.getText(913001).replace("{0}","");else{a[0]=o.Global.languageMgr.getText(933112);var s=t.playerData.getSkillIdList().length+"/"+Object.getOwnPropertyNames(cfgTable.cardskillData).length;a.push(s),l.default.Instance().emitUpdateMainPanelTitle(a,c.MainPanelTitleType.ShowTextAndNum),t.index=i,t.playerData.getGuideStep()==c.GuideStep.SkillClickCardsSkillBtn&&o.Global.guideMgr.changeGuideStep(c.GuideStep.SkillClickCardsSkillBtn,c.GuideStep.SKillClickDrawSkill,!0)}break;case c.CardsPanelInterfaceType.talent:t.playerData.getTimeLine()<cfgTable.commonData.cardsFeatureOpen[2]?e=""+o.Global.languageMgr.getText(933004)+cfgTable.commonData.cardsFeatureOpen[2]+o.Global.languageMgr.getText(913001).replace("{0}",""):(a[0]=o.Global.languageMgr.getText(933117),l.default.Instance().emitUpdateMainPanelTitle(a,c.MainPanelTitleType.ShowText),t.index=i);break;case c.CardsPanelInterfaceType.equip:t.playerData.getTimeLine()<cfgTable.commonData.cardsFeatureOpen[3]?e=""+o.Global.languageMgr.getText(933004)+cfgTable.commonData.cardsFeatureOpen[3]+o.Global.languageMgr.getText(913001).replace("{0}",""):(a[0]=o.Global.languageMgr.getText(933115),l.default.Instance().emitUpdateMainPanelTitle(a,c.MainPanelTitleType.ShowText),t.index=i)}e?l.default.Instance().emitTips(e):(t.changeUI(),l.default.Instance().emitCardsChange(t.index))}},t)}),this.initSwitchBtn()},e.prototype.changeUI=function(){for(var t=0,e=this.nodes;t<e.length;t++)e[t].active=!1;this.nodes[this.index].active=!0,this.initSwitchBtn()},e.prototype.initSwitchBtn=function(){var t=this;this.switchBtnRoot.children.forEach(function(e,i){var a=e.getChildByName("lock"),n=e.getChildByName("inactive"),s=e.getChildByName("active");a.active=!0,s.active=i==t.index,0==i?a.active=!1:1==i?a.active=t.playerData.getTimeLine()<cfgTable.commonData.cardsFeatureOpen[1]:2==i?a.active=t.playerData.getTimeLine()<cfgTable.commonData.cardsFeatureOpen[2]:3==i&&(a.active=t.playerData.getTimeLine()<cfgTable.commonData.cardsFeatureOpen[3]),a.getChildByName("lockLabel").getComponent(cc.Label).string=o.Global.languageMgr.getText(913004).replace("{0}",cfgTable.commonData.cardsFeatureOpen[i].toString()),n.active=!a.active&&i!=t.index})},e.prototype.initGuide=function(){var t=r.default.Instance().getPlayerData().getGuideStep();t!=c.GuideStep.ClickDrawCard&&t!=c.GuideStep.ClickNewCard&&t!=c.GuideStep.CheckAllCardAttribute&&t!=c.GuideStep.SkillClickCardsSkillBtn||this.scheduleOnce(function(){o.Global.guideMgr.showGuidePanel()})},__decorate([u({type:cc.Node,displayName:"\u4e0b\u65b9\u6309\u94ae"})],e.prototype,"switchBtnRoot",void 0),__decorate([u({type:cc.Node,displayName:"\u529f\u80fd\u8282\u70b9"})],e.prototype,"nodes",void 0),__decorate([d],e)}(s.default);n.default=p,cc._RF.pop()},{}],CardsProbabilityPanel:[function(t,e,i){"use strict";cc._RF.push(e,"37151EWE6VAsKDBddF6FlKG","CardsProbabilityPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("DataMgr"),r=cc._decorator,l=r.ccclass,c=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.level=null,e.se=[],e.closeBtn=null,e}return __extends(e,t),e.prototype.onEnable=function(){var t=s.default.Instance().getPlayerData().getTakeCardLevel();this.level.string="LV"+t;var e=cfgTable.cardlevelData[t+""];if(e)for(var i=0;i<e.probability.length;++i){var a=(e.probability[i][1]/1e4*100).toString().split("."),n=5;a[0]&&(n-=a[0].length),this.se[i].string=(e.probability[i][1]/1e4*100).toFixed(n)+"%"}},e.prototype.start=function(){this.closeBtn.on("click",this.emitCloseMe,this)},__decorate([c(cc.Label)],e.prototype,"level",void 0),__decorate([c(cc.Label)],e.prototype,"se",void 0),__decorate([c(cc.Node)],e.prototype,"closeBtn",void 0),__decorate([l],e)}(o.default);n.default=h,cc._RF.pop()},{}],Common:[function(t,e,i){"use strict";cc._RF.push(e,"e5dc5YgmmtL8Z6Tg6DaAYns","Common");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("TalentBase"),r=a("CacheMgr"),l=a("ConfigMgr"),c=a("DataMgr"),h=a("EventMgr"),d=a("ResMgr"),u=a("SkillMgr"),p=a("TalentSkillMgr"),f=a("typeEnum"),g=a("BattleFightPanel"),m=function(){function t(){this.saveTime=0,this.isNewDay=!1,this.equipSlot=[f.EquipType.ring,f.EquipType.head,f.EquipType.ring,f.EquipType.armour,f.EquipType.necklace,f.EquipType.weapon],this.qualityStr=[933006,933007,933008,933009],this.qualityColor=["#FFFFFF","#009CFF","#AA28D5","#FFC332"],this.tempCoin=0,this.tempDiamond=0,this.tempPotion=0,this.tempTalentPotion=0,this.tempZembieKay=0,this.tempLegendKey=0,this.tempBossKey=0}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.flyProp=function(t,e,i,a,n){var o=this;void 0===a&&(a=null),void 0===n&&(n=null);var s=c.default.Instance().getPlayerData(),r="";switch(e){case f.CurrencyType.Coin:r="emitCoinFlyEffect",this.tempCoin=s.getUserCoin(),s.setUserCoin(i,!0,!1);break;case f.CurrencyType.Diamond:r="emitflyDiamond",this.tempDiamond=s.getDiamond(),s.setDiamond(i,!0,!1);break;case f.CurrencyType.Potion:r="emitflyPotion",this.tempPotion=s.getPotion(),s.setPotion(i,!0,!1);break;case f.CurrencyType.Talent:r="emitflyTalentPotion",this.tempTalentPotion=s.getTalentPotion(),s.setTalentPotion(i,!0,!1);break;case f.CurrencyType.ZembieKey:r="emitflyZembieKey",this.tempZembieKay=s.getZembieKays(),s.setZembieKays(this.tempZembieKay+i,!0,!0);break;case f.CurrencyType.LegendKey:r="emitflyLegendKey",this.tempLegendKey=s.getLegendKays(),s.setLegendKays(this.tempLegendKey+i,!0,!0);break;case f.CurrencyType.BossKey:r="emitflyBossKey",this.tempBossKey=s.getBossKays(),s.setBossKays(this.tempBossKey+i,!0,!0)}h.default.Instance()[r]({beginPos:t,callBack:function(t){var a=i/t;switch(e){case f.CurrencyType.Coin:o.tempCoin+=a,h.default.Instance().emitCoinChange(o.tempCoin);break;case f.CurrencyType.Diamond:o.tempDiamond+=a,h.default.Instance().emitDiamondChange(o.tempDiamond);break;case f.CurrencyType.Potion:o.tempPotion+=a,h.default.Instance().emitPotionChange(o.tempPotion);break;case f.CurrencyType.Talent:o.tempTalentPotion+=a,h.default.Instance().emitTalentPotionChange(o.tempTalentPotion);break;case f.CurrencyType.ZembieKey:o.tempZembieKay+=a,h.default.Instance().emitDungeonKeyChange(o.tempZembieKay);break;case f.CurrencyType.LegendKey:o.tempLegendKey+=a,h.default.Instance().emitDungeonKeyChange(o.tempLegendKey);break;case f.CurrencyType.BossKey:o.tempBossKey+=a,h.default.Instance().emitDungeonKeyChange(o.tempBossKey)}n&&n()},allCallBack:function(){switch(e){case f.CurrencyType.Coin:o.tempCoin=s.getUserCoin(),h.default.Instance().emitCoinChange(o.tempCoin);break;case f.CurrencyType.Diamond:o.tempDiamond=s.getDiamond(),h.default.Instance().emitDiamondChange(o.tempDiamond);break;case f.CurrencyType.Potion:o.tempPotion=s.getPotion(),h.default.Instance().emitPotionChange(o.tempPotion);break;case f.CurrencyType.Talent:o.tempTalentPotion=s.getTalentPotion(),h.default.Instance().emitTalentPotionChange(o.tempTalentPotion);break;case f.CurrencyType.ZembieKey:o.tempZembieKay=s.getZembieKays(),h.default.Instance().emitDungeonKeyChange(o.tempZembieKay);break;case f.CurrencyType.LegendKey:o.tempLegendKey+=s.getLegendKays(),h.default.Instance().emitDungeonKeyChange(o.tempLegendKey);break;case f.CurrencyType.BossKey:o.tempBossKey+=s.getBossKays(),h.default.Instance().emitDungeonKeyChange(o.tempBossKey)}a&&a()}})},t.prototype.getBdPrePath=function(t){return t>15?"level_"+t:"localBundles/level_"+t},t.prototype.preLoadLv=function(){for(var t=c.default.Instance().getPlayerData().getMaxLevel(),e=[],i=0,a=this.getWarriorsInof(t);i<a.length;i++){var n=a[i];e.push(n.warriorsid)}this.loadBundle("level_"+t,e)},t.prototype.getWarriorsInof=function(t){for(var e=l.default.Instance().getTableValue("ID",t,cfgTable.evolutionData).warriorsid,i=[],a=0;a<e.length;a++){var n=e[a],o=l.default.Instance().getTableValue("warriorsid",n,cfgTable.warriorsData);o&&i.push(o)}return i},t.prototype.loadBundle=function(t,e){var i=new d.PreloadConf;i.Init(t,t),cc.assetManager.loadBundle(t,function(a,n){if(a)console.error("\u52a0\u8f7dbundle:"+t+" \u9519\u8bef:"+a);else{i.setBundle(n);for(var o=[],s=0,r=e;s<r.length;s++){var l=r[s];o.push("Role_"+l)}i.AddLoadFiles(d.AssetsType.ATPrefab,o),i.AddPreloadFiles(d.AssetsType.ATPrefab,o),d.default.Instance().preloadRes(i)}})},t.prototype.getCardAtkRate=function(){var t=(c.default.Instance().getPlayerData().getCardsTotalAddition()||[]).find(function(t){return t.type==f.CardAddType.RoleAtk});return t&&t.addition?t.addition:0},t.prototype.getCardHpRate=function(){var t=(c.default.Instance().getPlayerData().getCardsTotalAddition()||[]).find(function(t){return t.type==f.CardAddType.RoleHP});return t&&t.addition?t.addition:0},t.prototype.getCardBaseHpRate=function(){var t=(c.default.Instance().getPlayerData().getCardsTotalAddition()||[]).find(function(t){return t.type==f.CardAddType.BuildHp});return t&&t.addition?t.addition:0},t.prototype.getCardMeatRate=function(){var t=(c.default.Instance().getPlayerData().getCardsTotalAddition()||[]).find(function(t){return t.type==f.CardAddType.meatUp});return t&&t.addition?t.addition:0},t.prototype.getTalentVal=function(t){var e=0,i=[],a=0,n=o.Global.dataMgr.getPlayerData().getAllTalentData();for(var s in n){var r=n[s].id,l=n[s].level,c=cfgTable.talentData[r];if(c.type==t){var h=c.val[l-1]||0;l>0&&(a=1),i.push(h)}}if(i.length<=1)return[e=i[0]||0,a];for(var d=0;d<i.length;d++){for(var u=i[d],p=d+1;p<i.length;p++)u*=1+i[p];e+=u}return[e,a]},t.prototype.getFoodNumber=function(t){return p.default.ins.run(s.ETalentType.meatProduce,t,!1)},t.prototype.getCritAtk=function(t,e,i){return t?p.default.ins.run(s.ETalentType.critAtk,e,i):e},t.prototype.getMoveRate=function(t,e){return void 0===e&&(e=!0),p.default.ins.run(s.ETalentType.moveRate,t,e)},t.prototype.getSpeedRate=function(t,e){return void 0===e&&(e=!0),p.default.ins.run(s.ETalentType.speedRate,t,e)},t.prototype.isCrit=function(t){var e=this.getTalentVal(s.ETalentType.critAtk);return p.default.ins.run(s.ETalentType.critRate,null,t)&&!!e[1]},t.prototype.isMiss=function(t){return p.default.ins.run(s.ETalentType.missRate,null,t)},t.prototype.isDropMeat=function(){return p.default.ins.run(s.ETalentType.dropRate,null,!1)},t.prototype.isSweepZembie=function(){return p.default.ins.run(s.ETalentType.sweepZombie,null,!1)},t.prototype.checkSubscribe=function(){if(this.isNewDay){this.isNewDay=!1;var t=o.Global.dataMgr.getPlayerData();t.getTTSubscribe()||o.Global.sdkMgr.subscribe(function(){t.setTTSubscribe(1)})}},t.prototype.getUniqueId=function(){var t=cc.sys.localStorage.getItem(r.default.preKey+"my_tt_unique_id");if(t)return t;for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789",i="",a=0;a<16;a++)i+=e[Math.floor(e.length*Math.random())];return cc.sys.localStorage.setItem(r.default.preKey+"my_tt_unique_id",i),i},t.prototype.copyStr=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:if(cc.sys.platform!=cc.sys.BYTEDANCE_GAME)return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,window.tt.setClipboardData({data:t})];case 2:return i.sent(),console.log("\u590d\u5236\u6210\u529f\uff01"),[3,4];case 3:return i.sent(),[3,4];case 4:return[2];case 5:if(!cc.sys.isBrowser)return[3,9];i.label=6;case 6:return i.trys.push([6,8,,9]),[4,navigator.clipboard.writeText(JSON.stringify(t))];case 7:return i.sent(),console.log("\u590d\u5236\u6210\u529f\uff01"),[3,9];case 8:return e=i.sent(),console.error("\u65e0\u6cd5\u590d\u5236\u6587\u672c: ",e),[3,9];case 9:return[2]}})})},t.prototype.allSkillIsMax=function(){for(var t=!0,e=0,i=c.default.Instance().getPlayerData().getSkillTotalCount();e<i.length;e++)i[e].maxCount>0&&(t=!1);return t},t.prototype.getTimeScale=function(){return c.default.Instance().getPlayerData().getTimeScaleData().isOpen?cfgTable.commonData.timeScale:[1,1,1,1,1,1]},t.prototype.getEquipCfgByUid=function(t){var e=cfgTable.equipData,i=[];for(var a in e)e[a].equipid==t&&i.push(e[a]);return i},t.prototype.getEquipByUid=function(t){for(var e=o.Global.dataMgr.getPlayerData().getEquipList(),i=0;i<e.length;i++)if(e[i].id==t)return e[i];return{id:t,lv:0,count:0}},t.prototype.getHeroCfgById=function(t){var e=cfgTable.heroData;for(var i in e)if(e[i].heroid==t)return e[i]},t.prototype.getOneHero=function(t){var e=o.Global.dataMgr.getPlayerData().getHeroList();return t&&e.includes(t)},t.prototype.getEquipSlot=function(t){for(var e=o.Global.dataMgr.getPlayerData().getEquipSlotList(),i=0;i<e.length;i++)if(e[i]==t)return i},t.prototype.getEnemyList=function(t,e){var i=[];return e==u.EFightPanel.battle?i=g.default.enemyList:e==u.EFightPanel.Zembie?i=t.enemyList:e==u.EFightPanel.Legend?i=t.enemyList:e==u.EFightPanel.boss&&(i=t.enemyList),i},t.prototype.getRoleList=function(t,e){var i=[];return e==u.EFightPanel.battle?i=g.default.roleList:e==u.EFightPanel.Zembie?i=t.roleList:e==u.EFightPanel.Legend?i=t.roleList:e==u.EFightPanel.boss&&(i=t.roleList),i},t}();n.default=m,cc._RF.pop()},{}],CompBase:[function(t,e,i){"use strict";cc._RF.push(e,"20089+wojJGFqtdVMK8D23k","CompBase");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator.ccclass,o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.btnList=[],e}return __extends(e,t),e.prototype.findElement=function(t,e){void 0===e&&(e=cc.Node);var i=cc.find(t,this.node);if(i){if(e===cc.Node)return i;var a=i.getComponent(e);return i?a:void console.error("\u627e\u4e0d\u5230\u8be5\u7ec4\u4ef6",t,e.name)}console.error("\u627e\u4e0d\u5012\u8be5\u8282\u70b9",t)},e.prototype.addClick=function(t,e,i,a,n){var o;void 0===e&&(e=cc.Button.Transition.SCALE),void 0===i&&(i="onClick"),void 0===a&&(a=""),void 0===n&&(n="");var s=(o=t instanceof cc.Node?t:cc.find(t,this.node)).getComponent(cc.Button);s||(s=o.addComponent(cc.Button)),e==cc.Button.Transition.SCALE?(s.transition=cc.Button.Transition.SCALE,s.duration=.1,s.zoomScale=1.2):e==cc.Button.Transition.NONE&&(s.transition=cc.Button.Transition.NONE);var r=new cc.Component.EventHandler;r.target=this.node,r.handler=i,r.component=""===n?this.node.name:n,r.customEventData=a;var l=new cc.Component.EventHandler;l.target=this.node,l.handler="playBtn",l.component=this.node.name,s.clickEvents.push(r,l),this.btnList.push(s)},e.prototype.subClick=function(t){var e,i=(e=t instanceof cc.Node?t:cc.find(t,this.node)).getComponent(cc.Button);i||(i=e.addComponent(cc.Button));var a=this.btnList.findIndex(function(t){return t==i});-1!=a&&this.btnList.splice(a,1),i.clickEvents=[]},e.prototype.addClicks=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<t.length;i++)this.addClick(t[i])},e.prototype.subClicks=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<t.length;i++)this.subClick(t[i])},e.prototype.btnEnable=function(t,e){for(var i=0;i<this.btnList.length;i++){var a=this.btnList[i];if(a.node===t){a.interactable=e,a.enabled=e;break}}},e.prototype.playBtn=function(){},__decorate([n],e)}(cc.Component);a.default=o,cc._RF.pop()},{}],ConfigMgr:[function(t,e,i){"use strict";cc._RF.push(e,"0cf0edjVthKl5qGQsYmYszz","ConfigMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getCardQuality=function(t){var e=[];for(var i in cfgTable.cardData)Number(cfgTable.cardData[i].quality)==t&&e.push(cfgTable.cardData[i]);return e[Math.floor(Math.random()*e.length)]},e.prototype.getTableValue=function(t,e,i){var a=[];for(var n in i){var o=i[n];o[t]==e&&a.push(o)}return 0==a.length?void 0:1==a.length?a[0]:a},e}(a("Singleton").default);n.default=o,cc._RF.pop()},{}],ContinuousClick:[function(t,e,i){"use strict";cc._RF.push(e,"ad90dVffmJN155MhlD0A+qX","ContinuousClick");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Interactable=!0,e.Delay=300,e.Material=[],e.loop=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.Material[0]=cc.assetManager.builtins.getBuiltin("material","builtin-2d-sprite"),this.Material[1]=cc.assetManager.builtins.getBuiltin("material","builtin-2d-gray-sprite")},e.prototype.start=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEen,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEen,this),this.Delay/=1e3},e.prototype.onTouchStart=function(){this.Interactable&&(this.loop=!0,cc.tween(this.node).to(.1,{scale:.9}).start(),this.Continuous())},e.prototype.onTouchEen=function(){this.loop=!1,this.unscheduleAllCallbacks(),cc.tween(this.node).to(.1,{scale:1}).start()},e.prototype.Continuous=function(){var t=this;this.loop&&(this.node.emit("click",this),this.scheduleOnce(function(){t.Continuous()},this.Delay))},e.prototype.setInteractable=function(t){this.Interactable=t,this.node.getComponent(cc.Sprite).setMaterial(0,this.Material[t?0:1])},__decorate([s({displayName:"\u53ef\u4ea4\u4e92"})],e.prototype,"Interactable",void 0),__decorate([s({displayName:"\u95f4\u9694(\u6beb\u79d2)"})],e.prototype,"Delay",void 0),__decorate([o],e)}(cc.Component);a.default=r,cc._RF.pop()},{}],DailyTaskMgr:[function(t,e,i){"use strict";cc._RF.push(e,"d4decZPL7ZKJYGIM3kX4K/9","DailyTaskMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Singleton"),s=a("UtilOne"),r=a("ConfigMgr"),l=a("DataMgr"),c=a("EventMgr"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isInit=!1,e}return __extends(e,t),e.prototype.initTaskList=function(){if(!(l.default.Instance().getPlayerData().getPassInfo().passCount<cfgTable.commonData.dailytaskopen)){this.isInit=!0;var t=l.default.Instance().getPlayerData().getTaskTimestamp();if(s.default.isToday(t))this.RefreshTask();else{var e=l.default.Instance().getPlayerData();l.default.Instance().getPlayerData().RefreshTaskOverID();var i={task:this.craterTask(),timestamp:s.default.getlocalTime(),curIndex:0,finishCount:0,maxleves:e.getMaxLevel(),meatLevel:e.getMeatLevel()};console.log("\u751f\u6210\u4efb\u52a1",i),e.setTaskData(i)}c.default.Instance().emitTaskStart()}},e.prototype.onOverTask=function(){var t=l.default.Instance().getPlayerData(),e=t.getCurTaskData();if(e){var i=this.craterTask();e.task=i,e.curIndex+=1,e.finishCount=0,e.maxleves=t.getMaxLevel(),e.meatLevel=t.getMeatLevel(),console.log("\u5b8c\u6210\u4efb\u52a1\u540e\u521b\u5efa\u65b0\u4efb\u52a1",e),t.setTaskData(e),c.default.Instance().emitTaskStart()}},e.prototype.RefreshTask=function(){var t=l.default.Instance().getPlayerData(),e=t.getCurTaskData();e&&(e.maxleves=t.getMaxLevel(),e.meatLevel=t.getMeatLevel(),console.log("\u5237\u65b0\u4efb\u52a1",e),t.setTaskData(e))},e.prototype.ResetTask=function(){if(!(l.default.Instance().getPlayerData().getPassInfo().passCount<cfgTable.commonData.dailytaskopen)){var t=l.default.Instance().getPlayerData(),e=t.getCurTaskData();if(e&&e.task){var i=t.getUnlocked(),a=t.getMaxLevel(),n=r.default.Instance().getTableValue("ID",a,cfgTable.evolutionData).warriorsid,o=[];if(n.forEach(function(t,e){-1==i.indexOf(t)&&o.push(e+6)}),o.find(function(t){return e.task.ID==t})){var s=this.craterTask();e.task=s,e.finishCount=0,e.maxleves=t.getMaxLevel(),e.meatLevel=t.getMeatLevel(),console.log("\u91cd\u7f6e\u4efb\u52a1",e),t.setTaskData(e)}else 6!=e.task.ID&&7!=e.task.ID&&8!=e.task.ID||(e.finishCount=0,e.maxleves=t.getMaxLevel(),e.meatLevel=t.getMeatLevel(),console.log("\u91cd\u7f6e\u4efb\u52a1",e),t.setTaskData(e));c.default.Instance().emitTaskStart()}}},e.prototype.craterTask=function(){var t=l.default.Instance().getPlayerData(),e=cfgTable.dailytaskData,i=[],a=t.getUnlocked(),n=t.getMaxLevel(),o=r.default.Instance().getTableValue("ID",n,cfgTable.evolutionData).warriorsid,c=[];o.forEach(function(t,e){-1==a.indexOf(t)&&c.push(e+6)});var h=function(a){var n=t.getTaskOverID(e[a].ID),o=c.find(function(t){return e[a].ID==t});n||o||i.push(e[a])};for(var d in e)h(d);var u=s.default.get_weight_random(i,"weight");return i[u]},e.prototype.onTaskMgr=function(){c.default.Instance().onTaskEnd(this.onTaskEnd,this),c.default.Instance().onPassInfo(this.onPassInfo,this),c.default.Instance().onLevelChange(this.onLevelChange,this),c.default.Instance().onRefreshUpgrad(this.onRefreshUpgrad,this)},e.prototype.onPassInfo=function(){e.Instance().isInit||e.Instance().initTaskList()},e.prototype.onTaskEnd=function(){this.onOverTask()},e.prototype.onRefreshUpgrad=function(){this.ResetTask()},e.prototype.onLevelChange=function(){this.ResetTask()},e}(o.default);n.default=h,cc._RF.pop()},{}],DataMgrBase:[function(t,e,i){"use strict";cc._RF.push(e,"5f9e5Fa39ZG06h58ra9f0WG","DataMgrBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.autoSaveTimerId=0,e}return __extends(e,t),e.prototype.SaveToCache=function(){},e.prototype.LoadFromCache=function(){},e}(a("Singleton").default);n.default=o,cc._RF.pop()},{}],DataMgr:[function(t,e,i){"use strict";cc._RF.push(e,"4a5ac8/mSZES6L9YjizeHue","DataMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("DataMgrBase"),s=a("GameData"),r=a("AudioMgr"),l=a("CacheMgr"),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getPlayerData=function(){return this.GameData},e.prototype.SaveToCache=function(){console.log("\u4fdd\u5b58\u6570\u636e");var t=this.GameData.getData();l.default.SaveData(t,!0)},e.prototype.LoadFromCache=function(){console.log("\u52a0\u8f7d\u6570\u636e"),this.Load_PlayerData()},e.prototype.Save_PlayerData=function(){var t=this.GameData.getData();l.default.SaveData(t,!1)},e.prototype.Load_PlayerData=function(){this.GameData=new s.GameData;var t=l.default.LoadOld(l.default.oldKey);this.GameData.resetData(t);var e=this._loadLocal(l.default.preKey);this.GameData.resetData(e)},e.prototype._loadLocal=function(t){var e={};for(var i in this.GameData){var a=cc.sys.localStorage.getItem(t+i);a&&(a=JSON.parse(a),e[i]=a)}return e},e.prototype.Save_AudioData=function(){this.GameData.setEffectEnable(r.default.Instance().getEffectEnable()),this.GameData.setMusicEnable(r.default.Instance().getMusicEnable()),this.GameData.setVibrate(r.default.Instance().getVibrateEnabled());var t=this.GameData.getData();l.default.SaveData(t,!1)},e}(o.default);n.default=c,cc._RF.pop()},{}],DebugSDK:[function(t,e,i){"use strict";cc._RF.push(e,"476c8gFr8pLvr4T2WQm7w/5","DebugSDK");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.videoShareWordArr=["\u591a\u8bfb\u4e66,\u591a\u770b\u62a5"],e.normalShareWordArr=["\u591a\u8bfb\u4e66,\u591a\u770b\u62a5"],e.localShareImg=["share/share1.png"],e.appName="\u6361\u94b1\u6211\u6700\u884c",e.isLogin=!1,e.rewardStr="ocb1hdj4kd22043jg3",e.rewardAd=null,e.initedRewardAd=!1,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e)},enumerable:!1,configurable:!0}),e.prototype.init=function(){},e.prototype.openAd=function(t,e){void 0===e&&(e=null),t&&t()},e.prototype.shareGame=function(t){t&&t()},e.prototype.videoShare=function(t){t&&t()},e.prototype.getMenuButtonBoundingClientRect=function(){},e.prototype.uploadMsg=function(){},e.prototype.createMoreGameBtn=function(){},e.prototype.showMoreGamesModal=function(){},e.prototype.vibrateShort=function(t,e){void 0===e&&(e=null)},e}(a("SDKBase").default);n.default=o,cc._RF.pop()},{}],DieAnimPre:[function(t,e,i){"use strict";cc._RF.push(e,"c9084GhxglGepXTddBBFT4e","DieAnimPre");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("BattleFightPanel"),s=cc._decorator,r=s.ccclass,l=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(t){o.default.dieNodePool;var e=this.node.parent.convertToNodeSpaceAR(t);this.node.setPosition(e),this.node.opacity=255,this.play(),this.scheduleOnce(this.onfinished,1)},e.prototype.play=function(){this.node.getComponent(cc.Animation).play(),this.node.on(cc.Animation.EventType.FINISHED,this.onfinished,this)},e.prototype.onfinished=function(){this.putBack(),o.default.dieNodePool.put(this.node)},e.prototype.putBack=function(){this.unschedule(this.onfinished),this.node.off(cc.Animation.EventType.FINISHED,this.onfinished,this),this.node.opacity=0},__decorate([r],e)}(cc.Component));n.default=l,cc._RF.pop()},{}],DungeonBullet:[function(t,e,i){"use strict";cc._RF.push(e,"82f46KKbWdL34KQMJZ1HVV2","DungeonBullet");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("CompBase"),s=a("EventMgr"),r=a("ResMgr"),l=a("IVector2"),c=cc._decorator,h=c.ccclass,d=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.logo=null,e.ParticleNode=null,e.dir=0,e.fightplan=null,e.lastPos=cc.v2(0,0),e.rotateNum=0,e.data=null,e.parabola=!1,e}return __extends(e,t),e.prototype.show=function(t){return __awaiter(this,void 0,Promise,function(){var e,i,a,n,o,s,c,h,d,u,p,f,g=this;return __generator(this,function(m){switch(m.label){case 0:return t?[3,2]:(a=this.data.father.heroId,n="hero/hero_"+a+"/level",[4,r.default.Instance().loadAndGetRes("equip",n,cc.SpriteAtlas)]);case 1:t=m.sent(),m.label=2;case 2:return this.ParticleNode.active=!1,this.data.target&&this.data.target.isValid&&this.data.root?(e="e1_"+this.data.father.bullet,this.data.father.isEnemy&&(e="e2_"+this.data.father.bullet,t.getSpriteFrame(e)||(e="e1_"+this.data.father.bullet)),this.data.father.bulletEff?(this.ParticleNode.active=!0,this.ParticleNode.removeAllChildren(),i=null,(a=this.data.father.heroId)?(n="e1_",this.data.father.isEnemy&&(n="e2_"),o="hero/hero_"+a+"/",[4,r.default.Instance().loadAndGetRes("equip",o+n+this.data.father.bulletEff,cc.Prefab)]):[3,4]):[3,6]):(this.node.destroy(),[2]);case 3:return i=m.sent(),[3,5];case 4:i=this.data.father.bulletEff,m.label=5;case 5:s=cc.instantiate(i),this.ParticleNode.addChild(s),m.label=6;case 6:return this.logo.spriteFrame=t.getSpriteFrame(e),c=this.data.root.convertToWorldSpaceAR(this.data.father.bulletPos),h=this.data.target.node.convertToWorldSpaceAR(cc.v2(0,this.data.target.node.height/2)),d=this.data.father.bulletRotation||0,this.node.angle=d,this.node.setPosition(this.node.parent.convertToNodeSpaceAR(c)),this.lastPos=this.node.getPosition(),u=this.node.parent.convertToNodeSpaceAR(h),p=this.data.father.bulletspeed,this.logo.node.scale=this.data.father.bulletScale,this.rotateNum=this.data.father.roleDate.ratation,1==this.data.father.roleDate.track?(f=Math.sqrt(Math.pow(u.x-this.node.getPosition().x,2)+Math.pow(u.y-this.node.getPosition().y,2)),cc.tween(this.node).then(cc.jumpTo(p,u.x,u.y,f/500*60,1)).call(function(){g.over()}).start(),this.schedule(function(){var t=g.node.getPosition();if(t!=g.lastPos){var e=new l.Vector2(g.lastPos),i=new l.Vector2(t),a=l.Vector2.angle360(e,i);g.node.angle=a,g.lastPos=t}})):cc.tween(this.node).to(p,{x:u.x,y:u.y}).call(function(){g.over()}).start(),[2]}})})},e.prototype.over=function(){if(this.unscheduleAllCallbacks(),this.data.target&&this.data.target.isValid){var t=this.fatherData.attack,e=this.fatherData.killRewards;s.default.Instance().emitBulletHuit({id:this.data.target.getId(),attack:t,killRewards:e,sputAttack:this.fatherData.sputAttack,sputRange:this.fatherData.sputRange})}this.logo.spriteFrame=null,this.ParticleNode.removeAllChildren(),this.ParticleNode.active=!1,this.fightplan&&this.fightplan.isValid?this.fightplan.bulletNodePool.put(this.node):this.node.destroy()},e.prototype.initBullet=function(t,e){this.data=t,this.fightplan=e,this.fatherData={attack:[this.data.father.attack,this.data.father.damageToOurBuild,this.data.father.damageToOtherBuild],damageToOurBuild:this.data.father.damageToOurBuild,damageToOtherBuild:this.data.father.damageToOtherBuild,killRewards:this.data.target.killRewards,sputAttack:this.data.father.sputAttack,sputRange:this.data.father.sputRange},this.data.father.heroId?this.show(null):this.show(this.data.father.Atlas)},e.prototype.update=function(){if(this.node)if(this.rotateNum)this.node.angle-=this.rotateNum/30;else{var t=this.node.getPosition();if(t!=this.lastPos){var e=new l.Vector2(this.lastPos),i=new l.Vector2(t),a=l.Vector2.angle360(e,i);this.node.angle=a,this.lastPos=t}}},__decorate([d(cc.Sprite)],e.prototype,"logo",void 0),__decorate([d(cc.Node)],e.prototype,"ParticleNode",void 0),__decorate([h],e)}(o.default);n.default=u,cc._RF.pop()},{}],DungeonFightMgr:[function(t,e,i){"use strict";cc._RF.push(e,"fad9d6ZtkhA5KsQYikR8GgA","DungeonFightMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("EventMgr"),s=a("Singleton"),r=a("typeEnum"),l=cc._decorator,c=l.ccclass,h=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gameType=r.dungeonsGameType.Zembie,e.battle=1,e.zoombieleve=null,e.Legendleve=null,e.Bossleve=null,e._suspend=!1,e._dieNum=0,e._isEnd=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"dieNum",{get:function(){return this._dieNum},set:function(t){this._dieNum=t,o.default.Instance().emitDieNumChange()},enumerable:!1,configurable:!0}),e.prototype.addDieNum=function(t){this.dieNum=Math.round(this._dieNum+=t)},Object.defineProperty(e.prototype,"isEnd",{get:function(){return this._isEnd},set:function(t){this._isEnd=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"suspend",{get:function(){return this._suspend},set:function(t){this._suspend=t,this._suspend?cc.director.pause():cc.director.resume()},enumerable:!1,configurable:!0}),__decorate([c],e)}(s.default));n.default=h,cc._RF.pop()},{}],DungeonSuspendPanel:[function(t,e,i){"use strict";cc._RF.push(e,"a8b6cdPWl1PCaz8PW6Vjc7H","DungeonSuspendPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("AudioMgr"),r=a("EventMgr"),l=a("typeEnum"),c=a("DungeonFightMgr"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.closeBtn=null,e.yesBtn=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.getComponent(cc.Widget).updateAlignment()},e.prototype.onEnable=function(){c.default.Instance().suspend=!0,this.closeBtn.on("click",this.emitCloseMe,this),this.yesBtn.on("click",this.yesBtnClick,this)},e.prototype.onDisable=function(){this.closeBtn.off("click",this.emitCloseMe,this),this.yesBtn.off("click",this.yesBtnClick,this)},e.prototype.emitCloseMe=function(){c.default.Instance().suspend=!1,t.prototype.emitCloseMe.call(this)},e.prototype.yesBtnClick=function(){s.default.Instance().playEffect(6),c.default.Instance().suspend=!1,c.default.Instance().gameType==l.dungeonsGameType.Zembie?r.default.Instance().emitZembieGameOver(!1):c.default.Instance().gameType==l.dungeonsGameType.Legend?r.default.Instance().emitLegendGameOver(!1):c.default.Instance().gameType==l.dungeonsGameType.Boss&&r.default.Instance().emitBossGameOver(!1),t.prototype.emitCloseMe.call(this)},__decorate([u(cc.Node)],e.prototype,"closeBtn",void 0),__decorate([u(cc.Node)],e.prototype,"yesBtn",void 0),__decorate([d],e)}(o.default);n.default=p,cc._RF.pop()},{}],DungeonsEnd:[function(t,e,i){"use strict";cc._RF.push(e,"d0f6b61W75LeZxvQzrGfbNZ","DungeonsEnd");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("EventMgr"),l=a("typeEnum"),c=a("spriteFrameControl"),h=a("DungeonFightMgr"),d=cc._decorator,u=d.ccclass,p=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.SpriteIconReward=null,e.LabelTitle=null,e.LabelLevelTitle=null,e.LabelNum=null,e.BtnGet=null,e}return __extends(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.SpriteIconReward=this.findElement("content/SpriteIconReward",c.default),this.LabelTitle=this.findElement("content/LabelTitle",cc.Label),this.LabelLevelTitle=this.findElement("content/LabelLevelTitle",cc.Label),this.LabelNum=this.findElement("content/LabelNum",cc.Label),this.BtnGet=this.findElement("content/BtnGet")},e.prototype.onEnable=function(){this.subClicks(this.BtnGet),this.addClicks(this.BtnGet),this.showOherUI(),this.showLevelUI()},e.prototype.onDisable=function(){this.subClicks(this.BtnGet)},e.prototype.showOherUI=function(){var t=h.default.Instance().gameType,e=0,i=0;t==l.dungeonsGameType.Zembie?(e=900004,i=900009):t==l.dungeonsGameType.Legend&&(e=900020,i=Number(h.default.Instance().Legendleve.name)),this.LabelTitle.string=o.Global.languageMgr.getText(e),this.LabelLevelTitle.string=o.Global.languageMgr.getText(i),this.BtnGet.getChildByName("Label").getComponent(cc.Label).string=o.Global.languageMgr.getText(900010)},e.prototype.showLevelUI=function(){var t=h.default.Instance().gameType,e=null;t==l.dungeonsGameType.Zembie?e=h.default.Instance().zoombieleve.reward:t==l.dungeonsGameType.Legend&&(e=h.default.Instance().Legendleve.reward),this.SpriteIconReward.setSpriteFramebyIndex(Number(e[0])-1),this.LabelNum.string=e[1]},e.prototype.emitCloseMe=function(){t.prototype.emitCloseMe.call(this)},e.prototype.onClick=function(t){switch(t.target){case this.BtnGet:this.onBtnGet()}},e.prototype.onBtnGet=function(){this.subClicks(this.BtnGet);var t=h.default.Instance().gameType;t==l.dungeonsGameType.Zembie?this.zembieGet():t==l.dungeonsGameType.Legend&&this.LegendGet()},e.prototype.LegendGet=function(){var t=this,e=h.default.Instance().Legendleve.reward,i=Number(e[0]),a=Number(e[1]),n=h.default.Instance().Legendleve.id;h.default.Instance().dieNum=0;var s=o.Global.dataMgr.getPlayerData(),c=s.getLegendKays(),d=s.getLegendMaxLevel();c>0&&(c-=1,s.setLegendKays(c)),n>=d&&(d<l.MaxLevel.Legend?d+=1:d=l.MaxLevel.Legend),s.setLegendMaxLevel(d),o.Global.common.flyProp(this.node,i,a,function(){t.emitCloseMe(),r.default.Instance().emitInterludeMask(!0),r.default.Instance().emitCloseLegendBattlePanel()})},e.prototype.zembieGet=function(){var t=this,e=h.default.Instance().zoombieleve.reward,i=Number(e[0]),a=Number(e[1]),n=h.default.Instance().zoombieleve.id;h.default.Instance().dieNum=0;var s=o.Global.dataMgr.getPlayerData(),c=s.getZembieKays(),d=s.getzombieMaxLevel();c>0&&(c-=1,s.setZembieKays(c)),n>=d&&(d<l.MaxLevel.Zembie?d+=1:d=l.MaxLevel.Zembie),s.setzombieMaxLevel(d),o.Global.common.flyProp(this.node,i,a,function(){t.emitCloseMe(),r.default.Instance().emitInterludeMask(!0),r.default.Instance().emitCloseZembieBattlePanel()})},__decorate([u],e)}(s.default));n.default=p,cc._RF.pop()},{}],DungeonsItem:[function(t,e,i){"use strict";cc._RF.push(e,"ea2ed2jW/5AcZGc79QNnQta","DungeonsItem");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("CompBase"),s=a("Global"),r=a("EventMgr"),l=a("ResMgr"),c=a("typeEnum"),h=cc._decorator,d=h.ccclass,u=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.spriteIconLuck=null,e.unLuck=null,e.labelName=null,e.luck=null,e.data=null,e.ClickON=!1,e}return __extends(e,t),e.prototype.init=function(t){this.data=t,console.log("\u6253\u5370\u6d1e\u7a74\u6570\u636e",this.data),this.spriteIconLuck=this.findElement("luck/spriteIconLuck"),this.unLuck=this.findElement("unLuck"),this.luck=this.findElement("luck"),this.labelName=this.findElement("luck/labelName",cc.Label),r.default.Instance().onRefreshUpgrad(this.showUI,this),this.showUI()},e.prototype.showUI=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o;return __generator(this,function(r){switch(r.label){case 0:if(t=s.Global.dataMgr.getPlayerData(),e=!1,this.data.open)switch(this.data.open[0]){case c.dungeonsOpenType.timeline:i=t.getTimeLine(),Number(this.data.open[1])<=i&&(e=!0)}return e?(a="",1==this.data.ID&&(a="prefab/Dungeons/item/ZembieItem"),2==this.data.ID&&(a="prefab/Dungeons/item/LegendItem"),3==this.data.ID&&(a="prefab/Dungeons/item/BossItem"),this.unLuck.destroyAllChildren(),this.unLuck.opacity=255,this.luck.opacity=0,[4,l.default.Instance().loadAndGetRes("res",a)]):[3,2];case 1:return n=r.sent(),o=cc.instantiate(n),this.unLuck.addChild(o),[3,3];case 2:if(this.unLuck.destroyAllChildren(),this.luck.opacity=255,this.unLuck.opacity=0,this.data.open)switch(this.data.open[0]){case c.dungeonsOpenType.timeline:this.labelName.string=s.Global.languageMgr.getText(913001)+"-"+this.data.open[1]}r.label=3;case 3:return[2]}})})},__decorate([d],e)}(o.default));n.default=u,cc._RF.pop()},{}],DungeonsPanel:[function(t,e,i){"use strict";cc._RF.push(e,"4ed04BH6MFKrqCdX6AMz5Ka","DungeonsPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("EventMgr"),r=a("ResMgr"),l=a("dataList"),c=a("typeEnum"),h=a("DungeonFightMgr"),d=cc._decorator,u=d.ccclass,p=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.list=null,e.ScrollView=null,e.DungeonsItem=null,e}return __extends(e,t),e.prototype.onLoad=function(){return __awaiter(this,void 0,Promise,function(){var t,e,i,a,n;return __generator(this,function(o){switch(o.label){case 0:return this.ScrollView=this.findElement("content/ScrollView",cc.ScrollView),t=this,[4,r.default.Instance().loadAndGetRes("res","prefab/Dungeons/item/DungeonsItem")];case 1:for(a in t.DungeonsItem=o.sent(),this.list=new l.dataList(this.ScrollView,this.DungeonsItem,207,!1,10),e=cfgTable.dungeonsopenData,i=[],e)n=e[a],i.push(n);return this.list.itemRenderer=function(t,e){e.getComponent("DungeonsItem").init(i[t])},this.list.SetItemNum(i.length),s.default.Instance().onZembieGameOver(this.gameOver,this),s.default.Instance().onLegendGameOver(this.gameOver,this),s.default.Instance().onBossGameOver(this.gameOver,this),[2]}})})},e.prototype.gameOver=function(t){s.default.Instance().emitGameTimePause(),h.default.Instance().dieNum=0,t?h.default.Instance().gameType==c.dungeonsGameType.Boss?s.default.Instance().emitShowPanel({prefab:"prefab/Dungeons/BossDropPanel",data:{win:t}}):s.default.Instance().emitShowPanel({prefab:"prefab/Dungeons/DungeonsEnd",data:{win:t}}):(s.default.Instance().emitInterludeMask(!0),h.default.Instance().gameType==c.dungeonsGameType.Zembie&&s.default.Instance().emitCloseZembieBattlePanel(),h.default.Instance().gameType==c.dungeonsGameType.Legend&&s.default.Instance().emitCloseLegendBattlePanel(),h.default.Instance().gameType==c.dungeonsGameType.Boss&&s.default.Instance().emitCloseBossBattlePanel())},__decorate([u],e)}(o.default));n.default=p,cc._RF.pop()},{}],EquipDetailPanel:[function(t,e,i){"use strict";cc._RF.push(e,"f63eeGjwaVDY5ulmNR8w1UJ","EquipDetailPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("Observer"),l=a("ResMgr"),c=a("typeEnum"),h=cc._decorator,d=h.ccclass,u=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.playingAni=!1,e}return __extends(e,t),e.prototype.initWithParam=function(t){this.id=t.id,this.slotIndex=t.slot,this.showEffect(),this.data=o.Global.dataMgr.getPlayerData(),this.init()},e.prototype.onLoad=function(){this.btnClose=this.findElement("Panel/close"),this.btnUpgrade=this.findElement("Panel/btnNode/btnUpgrade"),this.btnNotUpgrade=this.findElement("Panel/btnNode/btnNotUpgrade"),this.btnMax=this.findElement("Panel/btnNode/btnMax"),this.btnEquip=this.findElement("Panel/btnNode/btnEquip"),this.btnRemove=this.findElement("Panel/btnNode/btnRemove"),this.iconImg=this.findElement("Panel/headNode/iconImg",cc.Sprite),this.nameTxt=this.findElement("Panel/nameTxt",cc.Label),this.propRoot=this.findElement("Panel/propRoot"),this.globalPropRoot=this.findElement("Panel/globalPropRoot"),this.qualityTxt=this.findElement("Panel/qualityTxt",cc.Label),this.lvTxt=this.findElement("Panel/lvTxt",cc.Label),this.progressTxt=this.findElement("Panel/progressNode/progressTxt",cc.Label),this.upLvNode=this.findElement("Panel/progressNode/upLvNode"),this.barImg=this.findElement("Panel/progressNode/barImg",cc.Sprite),this.tipsView=this.findElement("Panel/tipsView"),this.tipsNode=this.findElement("Panel/tipsView/tipsNode"),this.btnTips=this.findElement("Panel/btnTips"),this.addEvent(),this.addCustomEvent(),this.playingAni=!1,this.tipsView.active=!1},e.prototype.addEvent=function(){this.addClick(this.btnClose),this.addClick(this.btnTips),this.addClick(this.tipsView,cc.Button.Transition.NONE),this.addClick(this.btnEquip,cc.Button.Transition.NONE),this.addClick(this.btnRemove,cc.Button.Transition.NONE),this.addClick(this.btnUpgrade,cc.Button.Transition.NONE)},e.prototype.addCustomEvent=function(){r.default.ins.watch(r.EGameEvent.UPGRADE_EQUIP,this.updateSelf,this),r.default.ins.watch(r.EGameEvent.CHANGE_EQUIP_SLOT,this.updateSelf,this)},e.prototype.init=function(){this.updateSelf(),this.renderUI()},e.prototype.updateSelf=function(){this.updateUI(),this.checkBtns()},e.prototype.updateUI=function(){var t=o.Global.common.getEquipCfgByUid(this.id)[0],e=this.id;this.qualityTxt.string=o.Global.languageMgr.getText(o.Global.common.qualityStr[t.quality-1]),this.qualityTxt.node.color=cc.color(o.Global.common.qualityColor[t.quality-1]),this.nameTxt.string=o.Global.languageMgr.getText(t.nameid);var i=o.Global.common.getEquipByUid(e);this.lvTxt.string="Level"+i.lv;var a=t.prop.length;if(i.lv>=a)this.barImg.fillRange=1,this.upLvNode.active=!1,this.progressTxt.string="Max";else{var n=t.card[i.lv];this.progressTxt.string=i.count+"/"+n,i.count>=n?this.upLvNode.active=!0:(this.barImg.fillRange=i.count/n,this.upLvNode.active=!1)}this.updateProp(c.EquipGlobalType.equip,this.propRoot,i.lv),this.updateProp(c.EquipGlobalType.global,this.globalPropRoot,i.lv)},e.prototype.updateProp=function(t,e,i){var a=this.id;if(a){var n=o.Global.common.getEquipCfgByUid(a),s=[];n.forEach(function(e){e.globaltype==t&&s.push(e)});var r=e.children,l=r[0];r.forEach(function(t){t.active=!1});for(var c=i>=n[0].prop.length,h=0;h<s.length;h++){var d=s[h],u=r[h];u||((u=cc.instantiate(l)).parent=e),u.active=!0;var p=u.getComponent(cc.RichText),f=d.prop[i-1];f=Math.floor(1e4*f)/100;var g=o.Global.languageMgr.getText(d.typetextid),m="";if(!c){var y=d.prop[i],v=(y=Math.floor(1e4*y)/100)-f;m=0==(v=Math.floor(100*v)/100)?"":"<color=#00ff00>(+"+v+"%)</c>"}g=g.format(f+"%",m),p.string=g}}},e.prototype.checkBtns=function(){var t=this.data.getEquipSlotList(),e=this.id&&t.includes(this.id);this.btnRemove.active=e,this.btnEquip.active=!e;var i=o.Global.common.getEquipCfgByUid(this.id)[0],a=i.prop.length,n=o.Global.common.getEquipByUid(this.id);if(n.lv>=a)this.btnUpgrade.active=!1,this.btnMax.active=!0,this.btnNotUpgrade.active=!1;else{var s=i.card[n.lv];n.count>=s?(this.btnUpgrade.active=!0,this.btnMax.active=!1,this.btnNotUpgrade.active=!1):(this.btnUpgrade.active=!1,this.btnMax.active=!1,this.btnNotUpgrade.active=!0)}},e.prototype.renderUI=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,l.default.Instance().loadAndGetRes("equip","res/equip",cc.SpriteAtlas)];case 1:return t=e.sent(),this.iconImg.spriteFrame=t.getSpriteFrame(this.id+""),[2]}})})},e.prototype.showTipsView=function(t){var e=this;this.playingAni||(this.playingAni=!0,t?(this.tipsView.active=!0,this.tipsNode.scale=0,cc.tween(this.tipsNode).to(.15,{scale:1}).call(function(){e.playingAni=!1}).start()):(this.tipsNode.scale=1,cc.tween(this.tipsNode).to(.15,{scale:0}).call(function(){e.tipsView.active=!1,e.playingAni=!1}).start()))},e.prototype.doUpgrade=function(){var t=o.Global.common.getEquipCfgByUid(this.id)[0],e=o.Global.common.getEquipByUid(this.id),i=t.card[e.lv];this.data.upgradeEquip(this.id,i)},e.prototype.doEquip=function(){this.data.setEquipSlot(this.slotIndex,this.id),this.emitCloseMe()},e.prototype.doRemove=function(){var t=o.Global.common.getEquipSlot(this.id);null!=t&&this.data.setEquipSlot(t,0),this.emitCloseMe()},e.prototype.onClick=function(t){switch(t.target){case this.btnClose:this.emitCloseMe();break;case this.btnTips:this.showTipsView(!0);break;case this.tipsView:this.showTipsView(!1);break;case this.btnUpgrade:this.doUpgrade();break;case this.btnEquip:this.doEquip();break;case this.btnRemove:this.doRemove()}},__decorate([d],e)}(s.default));n.default=u,cc._RF.pop()},{}],EquipMgr:[function(t,e,i){"use strict";cc._RF.push(e,"256f2AnoA9EEo/y3x0PU5nI","EquipMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("typeEnum"),r=a("UtilOne"),l=function(){function t(){}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.getProp=function(t,e){for(var i=o.Global.dataMgr.getPlayerData(),a=i.getEquipList(),n=0,r=i.getEquipSlotList(),l=function(i){var l=a[i];o.Global.common.getEquipCfgByUid(l.id).forEach(function(i){i.type==t&&i.globaltype==e&&(i.globaltype==s.EquipGlobalType.global?n+=i.prop[l.lv-1]:i.globaltype==s.EquipGlobalType.equip&&r.includes(i.equipid)&&(n+=i.prop[l.lv-1]))})},c=0;c<a.length;c++)l(c);return n},t.prototype.getRandEquip=function(t){var e,i=this,a=cfgTable.bosslevelData;for(var n in a)if(a[n].battle==t){e=a[n];break}if(!e)return null;var s=e.reward,l=[];if(s.forEach(function(t){var e=parseInt(t[0]),a=parseInt(t[1]),n=i.getEquipsByQuality(e);n.length>0&&l.push({list:n,weight:a})}),l.length<=0)return null;for(var c=r.default.getRandWeight(l).list,h=[],d=0;d<c.length;d++){var u=c[d],p=o.Global.common.getEquipCfgByUid(u)[0];h.push({equipId:u,weight:p.weight})}return r.default.getRandWeight(h).equipId},t.prototype.getEquipsByQuality=function(t){var e=[],i=cfgTable.equipData,a=o.Global.dataMgr.getPlayerData();for(var n in i)if(i[n].quality==t){var s=i[n].equipid;if(!(a.getTimeLine()<this.getMinTimeLine(s))){var r=i[n].prop.length;o.Global.common.getEquipByUid(s).lv>=r||e.push(s)}}return e},t.prototype.getMinTimeLine=function(t){for(var e=Number((t+"")[0]),i=o.Global.common.equipSlot,a=9999,n=cfgTable.commonData.equipUnlock,s=0;s<i.length;s++)e==i[s]&&(a=Math.min(n[s],a));return a},t.prototype.isEquipNew=function(t){for(var e=!1,i=o.Global.dataMgr.getPlayerData().getEquipList(),a=0;a<i.length;a++){var n=i[a];if(n.id==t&&n.lv>0){e=!0;break}}return!e},t.prototype.getEquip=function(t){o.Global.dataMgr.getPlayerData().addEquip(t)},t}();n.default=l,cc._RF.pop()},{}],EquipPanel:[function(t,e,i){"use strict";cc._RF.push(e,"a746eln9aZIVoPKKRiJo0M2","EquipPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("EventMgr"),l=a("Observer"),c=a("ResMgr"),h=a("typeEnum"),d=a("ItemEquipUpLv"),u=cc._decorator,p=u.ccclass,f=u.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.itemPrefab=null,e.canUpLv=!1,e.playingAni=!1,e}return __extends(e,t),e.prototype.initWithParam=function(t){this.showEffect(),this.slotIndex=t,this.data=o.Global.dataMgr.getPlayerData(),this.init()},e.prototype.onLoad=function(){this.btnClose=this.findElement("Panel/close"),this.btnTips=this.findElement("Panel/equipNode/btnTips"),this.emptyNode=this.findElement("Panel/iconNode/emptyNode"),this.wearNode=this.findElement("Panel/iconNode/wearNode"),this.equipNode=this.findElement("Panel/equipNode"),this.emptyImg=this.findElement("Panel/iconNode/emptyNode/emptyImg",cc.Sprite),this.wearImg=this.findElement("Panel/iconNode/wearNode/wearImg",cc.Sprite),this.progressTxt=this.findElement("Panel/equipNode/progressNode/progressTxt",cc.Label),this.barImg=this.findElement("Panel/equipNode/progressNode/barImg",cc.Sprite),this.upLvNode=this.findElement("Panel/equipNode/progressNode/upLvNode"),this.nameTxt=this.findElement("Panel/nameTxt",cc.Label),this.qualityTxt=this.findElement("Panel/equipNode/qualityTxt",cc.Label),this.lvTxt=this.findElement("Panel/equipNode/lvTxt",cc.Label),this.propRoot=this.findElement("Panel/equipNode/propRoot"),this.globalPropRoot=this.findElement("Panel/equipNode/globalPropRoot"),this.itemRoot=this.findElement("Panel/myList/view/content"),this.btnHead=this.findElement("Panel/btnHead"),this.tipsView=this.findElement("Panel/tipsView"),this.tipsNode=this.findElement("Panel/tipsView/tipsNode"),this.addEvent(),this.addCustomEvent(),this.playingAni=!1,this.tipsView.active=!1},e.prototype.addEvent=function(){this.addClick(this.btnClose),this.addClick(this.btnTips),this.addClick(this.btnHead),this.addClick(this.tipsView,cc.Button.Transition.NONE)},e.prototype.addCustomEvent=function(){l.default.ins.watch(l.EGameEvent.UPGRADE_EQUIP,this.init,this),l.default.ins.watch(l.EGameEvent.CHANGE_EQUIP_SLOT,this.init,this)},e.prototype.init=function(){this.updateSelf(),this.renderEquip(),this.renderEmpty(),this.updateItems()},e.prototype.getWearId=function(){return this.data.getEquipSlotList()[this.slotIndex]},e.prototype.updateSelf=function(){var t=this.getWearId();this.canUpLv=!1,t?(this.wearNode.active=!0,this.emptyNode.active=!1,this.equipNode.active=!0,this.updateEquip()):(this.wearNode.active=!1,this.emptyNode.active=!0,this.equipNode.active=!1,this.nameTxt.string=o.Global.languageMgr.getText(960029)),this.btnEnable(this.btnHead,this.canUpLv)},e.prototype.updateEquip=function(){var t=this.getWearId(),e=o.Global.common.getEquipCfgByUid(t)[0];this.qualityTxt.string=o.Global.languageMgr.getText(o.Global.common.qualityStr[e.quality-1]),this.qualityTxt.node.color=cc.color(o.Global.common.qualityColor[e.quality-1]),this.nameTxt.string=o.Global.languageMgr.getText(e.nameid);var i=o.Global.common.getEquipByUid(t);this.lvTxt.string="Level"+i.lv;var a=e.prop.length;if(i.lv>=a)this.barImg.fillRange=1,this.upLvNode.active=!1,this.progressTxt.string="Max";else{var n=e.card[i.lv];this.progressTxt.string=i.count+"/"+n,i.count>=n?(this.upLvNode.active=!0,this.canUpLv=!0):(this.barImg.fillRange=i.count/n,this.upLvNode.active=!1)}this.updateProp(h.EquipGlobalType.equip,this.propRoot,i.lv),this.updateProp(h.EquipGlobalType.global,this.globalPropRoot,i.lv)},e.prototype.updateProp=function(t,e,i){var a=this.getWearId();if(a){var n=o.Global.common.getEquipCfgByUid(a),s=[];n.forEach(function(e){e.globaltype==t&&s.push(e)});var r=e.children,l=r[0];r.forEach(function(t){t.active=!1});for(var c=0;c<s.length;c++){var h=s[c],d=r[c];d||((d=cc.instantiate(l)).parent=e),d.active=!0;var u=d.getComponent(cc.Label),p=h.prop[i-1];p=Math.floor(1e4*p)/100;var f=o.Global.languageMgr.getText(h.typetextid);f=f.format(p+"%",""),u.string=f}}},e.prototype.renderEquip=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return(t=this.getWearId())?[4,c.default.Instance().loadAndGetRes("equip","res/equip",cc.SpriteAtlas)]:[2];case 1:return e=i.sent(),this.wearImg.spriteFrame=e.getSpriteFrame(t+""),[2]}})})},e.prototype.renderEmpty=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return this.getWearId()?[2]:(t=o.Global.common.equipSlot[this.slotIndex],[4,c.default.Instance().loadAndGetRes("equip","res/empty_"+t,cc.SpriteFrame)]);case 1:return e=i.sent(),this.emptyImg.spriteFrame=e,[2]}})})},e.prototype.updateItems=function(){var t=this.itemRoot.children;t.forEach(function(t){t.active=!1});for(var e=o.Global.common.equipSlot[this.slotIndex],i=this.data.getEquipsByType(e),a=0;a<i.length;a++){var n=i[a],s=t[a];s||((s=cc.instantiate(this.itemPrefab)).parent=this.itemRoot),s.active=!0,s.getComponent(d.default).init(n,this.slotIndex)}},e.prototype.showTipsView=function(t){var e=this;this.playingAni||(this.playingAni=!0,t?(this.tipsView.active=!0,this.tipsNode.scale=0,cc.tween(this.tipsNode).to(.15,{scale:1}).call(function(){e.playingAni=!1}).start()):(this.tipsNode.scale=1,cc.tween(this.tipsNode).to(.15,{scale:0}).call(function(){e.tipsView.active=!1,e.playingAni=!1}).start()))},e.prototype.onClick=function(t){switch(t.target){case this.btnClose:this.emitCloseMe();break;case this.btnTips:this.showTipsView(!0);break;case this.btnHead:var e=this.getWearId();r.default.Instance().emitShowPanel({data:{id:e,slot:this.slotIndex},abName:"equip",prefab:"ui/EquipDetailPanel"});break;case this.tipsView:this.showTipsView(!1)}},__decorate([f(cc.Prefab)],e.prototype,"itemPrefab",void 0),__decorate([p],e)}(s.default);n.default=g,cc._RF.pop()},{}],EquipUIScript:[function(t,e,i){"use strict";cc._RF.push(e,"9a90e8l1/BCWY8+jlG3Amrj","EquipUIScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("EventMgr"),r=a("Observer"),l=a("ResMgr"),c=a("ItemEquipSlot"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.slotPrefab=null,e.slotRoot=null,e.heroImg=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.addCustomEvent()},e.prototype.addCustomEvent=function(){r.default.ins.watch(r.EGameEvent.UPGRADE_EQUIP,this.updateItems,this),r.default.ins.watch(r.EGameEvent.CHANGE_EQUIP_SLOT,this.updateItems,this),r.default.ins.watch(r.EGameEvent.CHANGE_HERO_SLOT,this.renderHero,this)},e.prototype.onEnable=function(){this.checkFunctionOpen(),this.init(),this.updateItems(),this.renderHero()},e.prototype.onDisable=function(){},e.prototype.checkFunctionOpen=function(){var t=o.Global.dataMgr.getPlayerData();t.getOpenHero()||(t.setOpenHero(1),t.addHero(10011),t.setHeroSlot(10011))},e.prototype.init=function(){},e.prototype.updateItems=function(){var t=this.slotRoot.children;t.forEach(function(t){t.active=!1});for(var e=o.Global.common.equipSlot,i=0;i<e.length;i++){var a=e[i],n=t[i];n||((n=cc.instantiate(this.slotPrefab)).parent=this.slotRoot),n.active=!0,n.getComponent(c.default).init(i,a)}},e.prototype.renderHero=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(a){switch(a.label){case 0:return t=o.Global.dataMgr.getPlayerData(),(e=t.getHeroSlot())||(e=1e4),[4,l.default.Instance().loadAndGetRes("equip","res/hero_"+e,cc.SpriteFrame)];case 1:return i=a.sent(),this.heroImg.spriteFrame=i,[2]}})})},e.prototype.openHeroPanel=function(){var t=o.Global.dataMgr.getPlayerData().getHeroSlot();s.default.Instance().emitShowPanel({data:t,abName:"equip",prefab:"ui/HeroPanel"})},__decorate([u(cc.Prefab)],e.prototype,"slotPrefab",void 0),__decorate([u(cc.Node)],e.prototype,"slotRoot",void 0),__decorate([u(cc.Sprite)],e.prototype,"heroImg",void 0),__decorate([d],e)}(cc.Component);n.default=p,cc._RF.pop()},{}],EventMgrBase:[function(t,e,i){"use strict";cc._RF.push(e,"ab325FKoZlLXoPuuUK7oHLn","EventMgrBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Singleton"),s=a("typeEnum"),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Events=[],e}return __extends(e,t),e.prototype.GetCanvas=function(){return this.canvas||(this.canvas=cc.find("Canvas")),this.canvas},e.prototype.on=function(t,e,i){this.findEvent(t,e,i).have||(this.GetCanvas().on(t,e,i),this.Events.push({name:t,cb:e,_obj:i}))},e.prototype.off=function(t,e,i){var a=this.findEvent(t,e,i);a.have&&(this.GetCanvas().off(a.have.name,a.have.cb,a.have._obj),this.Events.splice(a.findIndex,1))},e.prototype.findEvent=function(t,e,i){var a=-1;return{have:this.Events.find(function(n,o){return a=o,n.name===t&&n.cb===e&&n._obj===i}),findIndex:a}},e.prototype.emitShowPanel=function(t){t.panelType=t.panelType?t.panelType:s.PanelType.NormalPanel,this.GetCanvas().emit("_ev_UIComp_show_panel",t)},e.prototype.onShowPanel=function(t,e){t&&e&&this.on("_ev_UIComp_show_panel",t,e)},e.prototype.emitHidePanel=function(t){this.GetCanvas().emit("_ev_UIComp_hide_panel",t)},e.prototype.onHidePanel=function(t,e){t&&e&&this.on("_ev_UIComp_hide_panel",t,e)},e.prototype.emitShowOrHideMainPanel=function(t){this.GetCanvas().emit("_ev_UIComp_show_main_panel",{show:t})},e}(o.default);n.default=r,cc._RF.pop()},{}],EventMgr:[function(t,e,i){"use strict";cc._RF.push(e,"b507dYRuxNBsZkKswWjchnL","EventMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("EventMgrBase"),s=a("typeEnum"),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.notice=function(t){this.GetCanvas().emit(t)},e.prototype.onShowOrHideMainPanel=function(t,e){t&&e&&this.on("_ev_UIComp_show_main_panel",t,e)},e.prototype.emitTips=function(t){this.GetCanvas().emit("show_tips",t)},e.prototype.onTips=function(t,e){t&&e&&this.on("show_tips",t,e)},e.prototype.emitHideTips=function(){this.GetCanvas().emit("hide_tips")},e.prototype.onHideTips=function(t,e){t&&e&&this.on("hide_tips",t,e)},e.prototype.emitCoinChange=function(t){void 0===t&&(t=0),this.GetCanvas().emit("Coin_Change",t)},e.prototype.onCoinChange=function(t,e){t&&e&&this.on("Coin_Change",t,e)},e.prototype.emitDiamondChange=function(t){void 0===t&&(t=0),this.GetCanvas().emit("diamond_Change",t)},e.prototype.onDiamondChange=function(t,e){t&&e&&this.on("diamond_Change",t,e)},e.prototype.emitPotionChange=function(t){void 0===t&&(t=0),this.GetCanvas().emit("potion_Change",t)},e.prototype.onPotionChange=function(t,e){t&&e&&this.on("potion_Change",t,e)},e.prototype.emitTalentPotionChange=function(t){void 0===t&&(t=0),this.GetCanvas().emit("talent_potion_Change",t)},e.prototype.onTalentPotionChange=function(t,e){t&&e&&this.on("talent_potion_Change",t,e)},e.prototype.emitDungeonKeyChange=function(t){void 0===t&&(t=0),this.GetCanvas().emit("dungeon_key_Change",t)},e.prototype.onDungeonKeyChange=function(t,e){t&&e&&this.on("dungeon_key_Change",t,e)},e.prototype.emitTalentLevelChange=function(){this.GetCanvas().emit("talent_level_Change")},e.prototype.onTalentLevelChange=function(t,e){t&&e&&this.on("talent_level_Change",t,e)},e.prototype.emitCoinEffect=function(t,e,i,a,n,o){void 0===i&&(i=null),void 0===a&&(a=s.AnimType.Bounce),void 0===n&&(n=1),void 0===o&&(o=null),this.GetCanvas().emit("Coin_Effect",{startPos:t,endPos:e,callBack:i,animNum:a,type:n,allCallback:o})},e.prototype.onCoinEffect=function(t,e){t&&e&&this.on("Coin_Effect",t,e)},e.prototype.emitDiamondEffect=function(t,e,i,a,n,o){void 0===i&&(i=null),void 0===a&&(a=s.AnimType.Bounce),void 0===n&&(n=2),void 0===o&&(o=null),this.GetCanvas().emit("diamond_effect",{startPos:t,endPos:e,callBack:i,animNum:a,type:n,allCallback:o})},e.prototype.onDiamondEffect=function(t,e){t&&e&&this.on("diamond_effect",t,e)},e.prototype.emitPotionEffect=function(t,e,i,a,n,o){void 0===i&&(i=null),void 0===a&&(a=s.AnimType.Bounce),void 0===n&&(n=2),void 0===o&&(o=null),this.GetCanvas().emit("potion_effect",{startPos:t,endPos:e,callBack:i,animNum:a,type:n,allCallback:o})},e.prototype.onPotionEffect=function(t,e){t&&e&&this.on("potion_effect",t,e)},e.prototype.emitTalentPotionEffect=function(t,e,i,a,n,o){void 0===i&&(i=null),void 0===a&&(a=s.AnimType.Bounce),void 0===n&&(n=2),void 0===o&&(o=null),this.GetCanvas().emit("talent_potion_effect",{startPos:t,endPos:e,callBack:i,animNum:a,type:n,allCallback:o})},e.prototype.onTalentPotionEffect=function(t,e){t&&e&&this.on("talent_potion_effect",t,e)},e.prototype.emitZembieKeyEffect=function(t,e,i,a,n,o){void 0===i&&(i=null),void 0===a&&(a=s.AnimType.Bounce),void 0===n&&(n=2),void 0===o&&(o=null),this.GetCanvas().emit("zembie_key_effect",{startPos:t,endPos:e,callBack:i,animNum:a,type:n,allCallback:o})},e.prototype.onZembieKeyEffect=function(t,e){t&&e&&this.on("zembie_key_effect",t,e)},e.prototype.emitLegendKeyEffect=function(t,e,i,a,n,o){void 0===i&&(i=null),void 0===a&&(a=s.AnimType.Bounce),void 0===n&&(n=2),void 0===o&&(o=null),this.GetCanvas().emit("legend_key_effect",{startPos:t,endPos:e,callBack:i,animNum:a,type:n,allCallback:o})},e.prototype.onLegendKeyEffect=function(t,e){t&&e&&this.on("legend_key_effect",t,e)},e.prototype.emitBossKeyEffect=function(t,e,i,a,n,o){void 0===i&&(i=null),void 0===a&&(a=s.AnimType.Bounce),void 0===n&&(n=2),void 0===o&&(o=null),this.GetCanvas().emit("boss_key_effect",{startPos:t,endPos:e,callBack:i,animNum:a,type:n,allCallback:o})},e.prototype.onBossKeyEffect=function(t,e){t&&e&&this.on("boss_key_effect",t,e)},e.prototype.emitFightCoin=function(){this.GetCanvas().emit("Fight_Coin")},e.prototype.onFightCoin=function(t,e){t&&e&&this.on("Fight_Coin",t,e)},e.prototype.emitAttacked=function(t){this.GetCanvas().emit("Attacked",t)},e.prototype.onAttacked=function(t,e){t&&e&&this.on("Attacked",t,e)},e.prototype.emitFireBullet=function(t){this.GetCanvas().emit("Fire_Bullet",t)},e.prototype.onFireBullet=function(t,e){t&&e&&this.on("Fire_Bullet",t,e)},e.prototype.emitBulletHuit=function(t){this.GetCanvas().emit("huit_Bullet",t)},e.prototype.onBulletHuit=function(t,e){t&&e&&this.on("huit_Bullet",t,e)},e.prototype.emitOverToMain=function(){this.GetCanvas().emit("over_to_main")},e.prototype.onOverToMain=function(t,e){t&&e&&this.on("over_to_main",t,e)},e.prototype.emitCloseBattlePanel=function(){this.GetCanvas().emit("close_panel")},e.prototype.onCloseBattlePanel=function(t,e){t&&e&&this.on("close_panel",t,e)},e.prototype.onRoleDie=function(t,e){t&&e&&this.on("Role_Die",t,e)},e.prototype.emitRoleDie=function(t,e){this.GetCanvas().emit("Role_Die",t,e)},e.prototype.emitGameOver=function(t,e){void 0===e&&(e=!1),this.GetCanvas().emit("game_over",t,e)},e.prototype.onGameOver=function(t,e){t&&e&&this.on("game_over",t,e)},e.prototype.emitGetBroadsideAward=function(){this.GetCanvas().emit("Get_Broadside_Award")},e.prototype.onGetBroadsideAward=function(t,e){t&&e&&this.on("Get_Broadside_Award",t,e)},e.prototype.emitCoinFlyEffect=function(t){this.GetCanvas().emit("fly_coin_effect",t)},e.prototype.onCoinFlyEffect=function(t,e){t&&e&&this.on("fly_coin_effect",t,e)},e.prototype.emitZembieKeyFlyEffect=function(t){this.GetCanvas().emit("fly_zembie_key_effect",t)},e.prototype.onZembieKeyFlyEffect=function(t,e){t&&e&&this.on("fly_zembie_key_effect",t,e)},e.prototype.emitflyDiamond=function(t){this.GetCanvas().emit("fly_Diamond",t)},e.prototype.onflyDiamond=function(t,e){t&&e&&this.on("fly_Diamond",t,e)},e.prototype.emitflyPotion=function(t){this.GetCanvas().emit("fly_Potion",t)},e.prototype.onflyPotion=function(t,e){t&&e&&this.on("fly_Potion",t,e)},e.prototype.emitflyTalentPotion=function(t){this.GetCanvas().emit("fly_Talent_Potion",t)},e.prototype.onflyTalentPotion=function(t,e){t&&e&&this.on("fly_Talent_Potion",t,e)},e.prototype.emitflyZembieKey=function(t){this.GetCanvas().emit("fly_Zembie_Key",t)},e.prototype.onflyZembieKey=function(t,e){t&&e&&this.on("fly_Zembie_Key",t,e)},e.prototype.emitflyLegendKey=function(t){this.GetCanvas().emit("fly_legend_Key",t)},e.prototype.onflyLegendKey=function(t,e){t&&e&&this.on("fly_legend_Key",t,e)},e.prototype.emitflyBossKey=function(t){this.GetCanvas().emit("fly_boss_Key",t)},e.prototype.onflyBossKey=function(t,e){t&&e&&this.on("fly_boss_Key",t,e)},e.prototype.emitProgressOver=function(){this.GetCanvas().emit("progress_over")},e.prototype.onProgressOver=function(t,e){t&&e&&this.on("progress_over",t,e)},e.prototype.emitRefreshCardPanel=function(){this.GetCanvas().emit("refresh_card_panel")},e.prototype.onRefreshCardPanel=function(t,e){t&&e&&this.on("refresh_card_panel",t,e)},e.prototype.emitTaskStart=function(){this.GetCanvas().emit("task_Start")},e.prototype.onTaskStart=function(t,e){t&&e&&this.on("task_Start",t,e)},e.prototype.emitRefreshTask=function(){this.GetCanvas().emit("refresh_task")},e.prototype.onRefreshTask=function(t,e){t&&e&&this.on("refresh_task",t,e)},e.prototype.emitTaskEnd=function(){this.GetCanvas().emit("task_End")},e.prototype.onTaskEnd=function(t,e){t&&e&&this.on("task_End",t,e)},e.prototype.emitTaskHide=function(){this.GetCanvas().emit("task_Hide")},e.prototype.onTaskHide=function(t,e){t&&e&&this.on("task_Hide",t,e)},e.prototype.emitPassInfo=function(){this.GetCanvas().emit("PassInfo")},e.prototype.onPassInfo=function(t,e){t&&e&&this.on("PassInfo",t,e)},e.prototype.emitRefreshUpgrad=function(){this.GetCanvas().emit("refresh_Upgrad")},e.prototype.onRefreshUpgrad=function(t,e){t&&e&&this.on("refresh_Upgrad",t,e)},e.prototype.emitLevelChange=function(){this.GetCanvas().emit("level_change")},e.prototype.onLevelChange=function(t,e){t&&e&&this.on("level_change",t,e)},e.prototype.emitGuideChange=function(t){this.GetCanvas().emit("guide_change",t)},e.prototype.onGuideChange=function(t,e){t&&e&&this.on("guide_change",t,e)},e.prototype.emitGameTimePause=function(t){void 0===t&&(t=!0),this.GetCanvas().emit("game_pause",t)},e.prototype.onGameTimePause=function(t,e){t&&e&&this.on("game_pause",t,e)},e.prototype.emitLanguageChange=function(){this.GetCanvas().emit("language_change")},e.prototype.onLanguageChange=function(t,e){t&&this.on("language_change",t,e)},e.prototype.emitOnlineRewardIconChange=function(){this.GetCanvas().emit("online_reward_icon_change")},e.prototype.onOnlineRewardIconChange=function(t,e){t&&this.on("online_reward_icon_change",t,e)},e.prototype.emitonOnlineTimeChange=function(){this.GetCanvas().emit("online_reward_time_change")},e.prototype.ononOnlineTimeChange=function(t,e){t&&this.on("online_reward_time_change",t,e)},e.prototype.emitRefreshBattleUI=function(){this.GetCanvas().emit("refresh_battle_ui")},e.prototype.onRefreshBattleUI=function(t,e){t&&this.on("refresh_battle_ui",t,e)},e.prototype.emitUpdateMainPanelTitle=function(t,e){this.GetCanvas().emit("update_main_panel_title",t,e)},e.prototype.onUpdateMainPanelTitle=function(t,e){this.on("update_main_panel_title",t,e)},e.prototype.emitCardsChange=function(t){this.GetCanvas().emit("cards_change",t)},e.prototype.onCardsChange=function(t,e){this.on("cards_change",t,e)},e.prototype.onDungeonRoleDie=function(t,e){t&&e&&this.on("Dungeon_Role_Die",t,e)},e.prototype.emitDungeonRoleDie=function(t,e,i){this.GetCanvas().emit("Dungeon_Role_Die",t,e,i)},e.prototype.emitDieNumChange=function(){this.GetCanvas().emit("DieNum_Change")},e.prototype.onDieNumChange=function(t,e){t&&e&&this.on("DieNum_Change",t,e)},e.prototype.emitZembieGameOver=function(t){this.GetCanvas().emit("Zembie_game_over",t)},e.prototype.onZembieGameOver=function(t,e){t&&e&&this.on("Zembie_game_over",t,e)},e.prototype.emitCloseZembieBattlePanel=function(){this.GetCanvas().emit("close_Zembie_Panel")},e.prototype.onCloseZembieBattlePanel=function(t,e){t&&e&&this.on("close_Zembie_Panel",t,e)},e.prototype.emitZembieLevelChange=function(){this.GetCanvas().emit("Zembie_Level_Change")},e.prototype.onZembieLevelChange=function(t,e){t&&this.on("Zembie_Level_Change",t,e)},e.prototype.emitLegendGameOver=function(t){this.GetCanvas().emit("Legend_game_over",t)},e.prototype.onLegendGameOver=function(t,e){t&&e&&this.on("Legend_game_over",t,e)},e.prototype.emitCloseLegendBattlePanel=function(){this.GetCanvas().emit("close_Legend_Panel")},e.prototype.onCloseLegendBattlePanel=function(t,e){t&&e&&this.on("close_Legend_Panel",t,e)},e.prototype.emitLegendLevelChange=function(){this.GetCanvas().emit("Legend_Level_Change")},e.prototype.onLegendLevelChange=function(t,e){t&&this.on("Legend_Level_Change",t,e)},e.prototype.emitBossGameOver=function(t){this.GetCanvas().emit("Boss_game_over",t)},e.prototype.onBossGameOver=function(t,e){t&&e&&this.on("Boss_game_over",t,e)},e.prototype.emitCloseBossBattlePanel=function(){this.GetCanvas().emit("close_Boss_Panel")},e.prototype.onCloseBossBattlePanel=function(t,e){t&&e&&this.on("close_Boss_Panel",t,e)},e.prototype.emitBossLevelChange=function(){this.GetCanvas().emit("Boss_Level_Change")},e.prototype.onBossLevelChange=function(t,e){t&&this.on("Boss_Level_Change",t,e)},e.prototype.emitInterludeMask=function(t){this.GetCanvas().emit("Inter_ludeMask",t)},e.prototype.onInterludeMask=function(t,e){t&&e&&this.on("Inter_ludeMask",t,e)},e.prototype.emitRefreshSkillUI=function(){this.GetCanvas().emit("refresh_skill_ui")},e.prototype.onRefreshSkillUI=function(t,e){t&&e&&this.on("refresh_skill_ui",t,e)},e.prototype.emitRefreshRedDot=function(t){this.GetCanvas().emit("refresh_Red_Dot",t)},e.prototype.onRefreshRedDot=function(t,e){t&&e&&this.on("refresh_Red_Dot",t,e)},e.prototype.emitTimeScaleChange=function(){this.GetCanvas().emit("time_scale_change")},e.prototype.onTimeScaleChange=function(t,e){t&&e&&this.on("time_scale_change",t,e)},e.prototype.emitTimeScaleTimeChange=function(){this.GetCanvas().emit("time_scale_time_change")},e.prototype.onTimeScaleTimeChange=function(t,e){t&&e&&this.on("time_scale_time_change",t,e)},e.instance=null,e}(o.default);n.default=r,cc._RF.pop()},{}],EvoPassPanel:[function(t,e,i){"use strict";cc._RF.push(e,"63a65IarudPoZexcntXMgxE","EvoPassPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("DataMgr"),r=a("EventMgr"),l=a("typeEnum"),c=cc._decorator,h=c.ccclass,d=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.feichuan=null,e.bg=null,e.guangquan=[],e.dt=0,e}return __extends(e,t),e.prototype.start=function(){var t=this;this.feichuan.y=850,cc.tween(this.feichuan).to(.5,{y:0}).call(function(){cc.tween(t.bg).to(.3,{color:cc.color(0,0,0,0)}).delay(2.3).to(.5,{color:cc.color(255,255,255)}).call(function(){t.emitCloseMe()}).start()}).to(3,{scale:0,angle:35}).call(function(){s.default.Instance().getPlayerData().getTimeLine()==cfgTable.commonData.cardsFeatureOpen[1]?(s.default.Instance().getPlayerData().setRedDot(l.RedDotId.CardsPanlBtn,!0),s.default.Instance().getPlayerData().setRedDot(l.RedDotId.CardsPanelSkillBtn,!0)):s.default.Instance().getPlayerData().getTimeLine()==cfgTable.commonData.cardsFeatureOpen[2]&&(s.default.Instance().getPlayerData().setRedDot(l.RedDotId.CardsPanlBtn,!0),s.default.Instance().getPlayerData().setRedDot(l.RedDotId.CardsPanelTalentBtn,!0)),r.default.Instance().emitRefreshUpgrad(),r.default.Instance().emitRefreshBattleUI(),r.default.Instance().emitShowPanel({data:{data:1},prefab:"prefab/MainPanel/EvolutionProcessPanel"})}).start()},e.prototype.update=function(t){for(var e=0;e<this.guangquan.length;++e)this.guangquan[e].scale+=.5*t,this.guangquan[e].scale>=1.2&&(this.guangquan[e].scale=.1)},__decorate([d(cc.Node)],e.prototype,"feichuan",void 0),__decorate([d(cc.Node)],e.prototype,"bg",void 0),__decorate([d(cc.Node)],e.prototype,"guangquan",void 0),__decorate([h],e)}(o.default);n.default=u,cc._RF.pop()},{}],EvolutionProcessPanelItem:[function(t,e,i){"use strict";cc._RF.push(e,"c1747Kcd9hGK44GOeWKPdZL","EvolutionProcessPanelItem");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("DataMgr"),r=a("EventMgr"),l=a("ResMgr"),c=cc._decorator,h=c.ccclass,d=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ageName=null,e.ageTimer=null,e.ageInfo=null,e.logo=null,e.line=null,e.leftZz=null,e.rightZz=null,e.data=null,e.isCurEvo=!1,e.isNextEvo=!1,e.isNext=!1,e}return __extends(e,t),e.prototype.setData=function(t,e,i,a,n){return void 0===e&&(e=this.data.getMaxLevel()),void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===n&&(n=!0),__awaiter(this,void 0,void 0,function(){var r,c,h,d,u;return __generator(this,function(p){switch(p.label){case 0:return this.data=s.default.Instance().getPlayerData(),n?(r=e+1,this.isCurEvo=!1,this.isNextEvo=!1,t.ID<e?this.line.fillRange=1:t.ID==e?(this.line.fillRange=.515,this.isCurEvo=!0):this.line.fillRange=0,t.ID==r&&(this.isNextEvo=!0),this.isCurEvo&&this.schedule(this.lineRun,.001),this.leftZz.active=i,this.rightZz.active=a,c=this.data.getCurTimeLineEve(),h=c.length,t.ID-h==0&&(this.rightZz.active=!0),this.ageName.string=""+o.Global.languageMgr.getText(Number(t.evolutionnameid)),this.ageName.node.color=cc.color().fromHEX("#000000"),this.ageTimer.string=""+o.Global.languageMgr.getText(Number(t.evolutiontimeid)),this.ageInfo.string=""+o.Global.languageMgr.getText(Number(t.evolutiontextid)),d=this.logo,[4,l.default.Instance().loadAndGetRes("res","image/evolutionIcon/"+t.evolutionPic,cc.SpriteFrame)]):[3,2];case 1:return d.spriteFrame=p.sent(),[3,6];case 2:return t.ID<=e?(this.ageName.string=""+o.Global.languageMgr.getText(Number(t.evolutionnameid)),this.ageName.node.color=cc.color().fromHEX("#000000"),this.ageTimer.string=""+o.Global.languageMgr.getText(Number(t.evolutiontimeid)),this.ageInfo.string=""+o.Global.languageMgr.getText(Number(t.evolutiontextid)),u=this.logo,[4,l.default.Instance().loadAndGetRes("res","image/evolutionIcon/"+t.evolutionPic,cc.SpriteFrame)]):[3,4];case 3:return u.spriteFrame=p.sent(),this.line.fillRange=1,t.ID==e&&(this.isCurEvo=!0,this.line.fillRange=.515),[3,5];case 4:this.line.fillRange=0,t.ID-e==0&&(this.line.fillRange=.487),this.ageName.string="?",this.ageName.node.color=cc.color().fromHEX("#675E5E"),this.logo.node.active=!1,this.ageTimer.string="",this.ageInfo.string="",p.label=5;case 5:this.leftZz.active=i,this.rightZz.active=a,p.label=6;case 6:return[2]}})})},e.prototype.getIsCUrEvo=function(){return this.isCurEvo},e.prototype.getIsNextEvo=function(){return this.isNextEvo},e.prototype.beginLineRun=function(){this.isNext=!0,this.schedule(this.lineRun,1e-4)},e.prototype.lineRun=function(){this.isNext&&this.line.fillRange>=.513&&(this.unschedule(this.lineRun),r.default.Instance().emitProgressOver(),r.default.Instance().emitRefreshBattleUI()),this.line.fillRange+=.003},e.prototype.start=function(){},__decorate([d(cc.Label)],e.prototype,"ageName",void 0),__decorate([d(cc.Label)],e.prototype,"ageTimer",void 0),__decorate([d(cc.Label)],e.prototype,"ageInfo",void 0),__decorate([d(cc.Sprite)],e.prototype,"logo",void 0),__decorate([d(cc.Sprite)],e.prototype,"line",void 0),__decorate([d(cc.Node)],e.prototype,"leftZz",void 0),__decorate([d(cc.Node)],e.prototype,"rightZz",void 0),__decorate([h],e)}(cc.Component);n.default=u,cc._RF.pop()},{}],EvolutionProcessPanel:[function(t,e,i){"use strict";cc._RF.push(e,"112620mqLZOF5FGnG4eFLRs","EvolutionProcessPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("DataMgr"),l=a("EventMgr"),c=a("typeEnum"),h=a("EvolutionProcessPanelItem"),d=cc._decorator,u=d.ccclass,p=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ScrollView=null,e.item=null,e.content=null,e.timerLine=null,e.continueBtn=null,e.mask=null,e.data=null,e}return __extends(e,t),e.prototype.initWithParam=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a,n,s,c,d;return __generator(this,function(u){switch(u.label){case 0:if(this.data=r.default.Instance().getPlayerData(),2!=t.data)return[3,9];e=this.data.getCurTimeLineEve(),i=e.length,this.continueBtn.active=!1,this.mask.active=!0,this.content.removeAllChildren(),n=1,u.label=1;case 1:return n<i+1?(s=cc.instantiate(this.item),this.content.addChild(s),1!=n?[3,3]:[4,s.getComponent(h.default).setData(e[n-1],t.maxLevel,!0,!1)]):[3,8];case 2:return u.sent(),[3,7];case 3:return n!=i?[3,5]:[4,s.getComponent(h.default).setData(e[n-1],t.maxLevel,!1,!1)];case 4:return u.sent(),[3,7];case 5:return[4,s.getComponent(h.default).setData(e[n-1],t.maxLevel)];case 6:u.sent(),u.label=7;case 7:return++n,[3,1];case 8:return this.findBeginItem(),l.default.Instance().onProgressOver(this.onProgressOver,this),[3,18];case 9:this.mask.active=!1,e=this.data.getCurTimeLineEve(),i=e.length,this.content.removeAllChildren(),n=1,u.label=10;case 10:return n<i+1?(s=cc.instantiate(this.item),this.content.addChild(s),1!=n?[3,12]:[4,s.getComponent(h.default).setData(e[n-1],this.data.getMaxLevel(),!0,!1,!1)]):[3,17];case 11:return u.sent(),[3,16];case 12:return n!=i?[3,14]:[4,s.getComponent(h.default).setData(e[n-1],this.data.getMaxLevel(),!1,!0,!1)];case 13:return u.sent(),[3,16];case 14:return[4,s.getComponent(h.default).setData(e[n-1],this.data.getMaxLevel(),!1,!1,!1)];case 15:u.sent(),u.label=16;case 16:return++n,[3,10];case 17:for(a=-1,n=0;n<this.content.children.length&&(s=this.content.children[n],c=s.getComponent(h.default),a++,!c.getIsCUrEvo());++n);d=1/(this.content.childrenCount-1),this.ScrollView.scrollToPercentHorizontal(d*a,0),u.label=18;case 18:return this.timerLine.string=o.Global.languageMgr.getText(913001)+" - "+this.data.getTimeLine(),[2]}})})},e.prototype.findBeginItem=function(){for(var t=this,e=-1,i=-1,a=null,n=0;n<this.content.children.length&&(e++,!(o=this.content.children[n].getComponent(h.default)).getIsCUrEvo());++n);for(n=0;n<this.content.children.length;++n){var o=this.content.children[n].getComponent(h.default);if(i++,o.getIsNextEvo()){a=o;break}}var s=1/(this.content.childrenCount-1);this.ScrollView.scrollToPercentHorizontal(s*e,0),cc.game.getFrameRate()<=30?this.scheduleOnce(function(){a.beginLineRun()},1.2):this.scheduleOnce(function(){a.beginLineRun()},.6),cc.game.getFrameRate()<=30?this.scheduleOnce(function(){t.ScrollView.scrollToPercentHorizontal(s*i,3)},3):this.scheduleOnce(function(){t.ScrollView.scrollToPercentHorizontal(s*i,3)},1.5)},e.prototype.onProgressOver=function(){this.mask.active=!1,this.continueBtn.active=!0},e.prototype.onDisable=function(){},e.prototype.start=function(){this.continueBtn.on("click",this.closeSelf,this)},e.prototype.closeSelf=function(){this.data.getGuideStep()==c.GuideStep.Complete&&this.data.getTimeLine()>=3&&(this.data.setGuideStep(c.GuideStep.SkillClickCards),l.default.Instance().emitGuideChange()),this.emitCloseMe()},__decorate([p(cc.ScrollView)],e.prototype,"ScrollView",void 0),__decorate([p(cc.Prefab)],e.prototype,"item",void 0),__decorate([p(cc.Node)],e.prototype,"content",void 0),__decorate([p(cc.Label)],e.prototype,"timerLine",void 0),__decorate([p(cc.Node)],e.prototype,"continueBtn",void 0),__decorate([p(cc.Node)],e.prototype,"mask",void 0),__decorate([u],e)}(s.default);n.default=f,cc._RF.pop()},{}],FlyCoin:[function(t,e,i){"use strict";cc._RF.push(e,"b9f239nAkBIj5pp9hwpD4Ec","FlyCoin");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("AudioMgr"),s=a("EventMgr"),r=a("ResMgr"),l=a("UtilOne"),c=a("typeEnum"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.startPoint=null,e.endPoint=null,e.coinPrefab=null,e.coinPool=null,e.diamondPrefab=null,e.diamondPool=null,e.potionPrefab=null,e.potionPool=null,e.talentPotionPrefab=null,e.talentPotionPool=null,e.zembieKeyPrefab=null,e.zembieKeyPool=null,e.legendKeyPrefab=null,e.legendKeyPool=null,e.bossKeyPrefab=null,e.bossKeyPool=null,e.diamondScale=1,e.coinScale=1,e.potionScale=1,e.talentPotionScale=1,e.zembieKeyScale=1,e.legendKeyScale=1,e.bossKeyScale=1,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){s.default.Instance().onCoinEffect(this.playAnim,this),s.default.Instance().onDiamondEffect(this.playAnim,this),s.default.Instance().onPotionEffect(this.playAnim,this),s.default.Instance().onTalentPotionEffect(this.playAnim,this),s.default.Instance().onZembieKeyEffect(this.playAnim,this),s.default.Instance().onLegendKeyEffect(this.playAnim,this),s.default.Instance().onBossKeyEffect(this.playAnim,this),this.coinPool=new cc.NodePool,this.diamondPool=new cc.NodePool,this.potionPool=new cc.NodePool,this.talentPotionPool=new cc.NodePool,this.zembieKeyPool=new cc.NodePool,this.legendKeyPool=new cc.NodePool,this.bossKeyPool=new cc.NodePool,this.initPool()},e.prototype.initPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.initCoinPool()];case 1:return t.sent(),[4,this.initDiamondPool()];case 2:return t.sent(),[4,this.initPotionPool()];case 3:return t.sent(),[4,this.initTalentPotionPool()];case 4:return t.sent(),[4,this.initZembieKeyPool()];case 5:return t.sent(),[4,this.initLegendKeyPool()];case 6:return t.sent(),[4,this.initBossKeyPool()];case 7:return t.sent(),[2]}})})},e.prototype.initCoinPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,i,a;return __generator(this,function(n){switch(n.label){case 0:return this.coinPrefab?[3,2]:(e=this,[4,r.default.Instance().loadAndGetRes("res","prefab/MainPanel/AssetPre")]);case 1:e.coinPrefab=n.sent(),n.label=2;case 2:for(i=0;i<t;i++)a=cc.instantiate(this.coinPrefab),this.coinScale=a.scale,this.coinPool.put(a);return[2]}})})},e.prototype.initDiamondPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,i,a;return __generator(this,function(n){switch(n.label){case 0:return this.diamondPrefab?[3,2]:(e=this,[4,r.default.Instance().loadAndGetRes("res","prefab/MainPanel/AssetPreDia")]);case 1:e.diamondPrefab=n.sent(),n.label=2;case 2:for(i=0;i<t;i++)a=cc.instantiate(this.diamondPrefab),this.diamondScale=a.scale,this.diamondPool.put(a);return[2]}})})},e.prototype.initPotionPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,i,a;return __generator(this,function(n){switch(n.label){case 0:return this.potionPrefab?[3,2]:(e=this,[4,r.default.Instance().loadAndGetRes("res","prefab/MainPanel/AssetPotion")]);case 1:e.potionPrefab=n.sent(),n.label=2;case 2:for(i=0;i<t;i++)a=cc.instantiate(this.potionPrefab),this.potionScale=a.scale,this.potionPool.put(a);return[2]}})})},e.prototype.initTalentPotionPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,i,a;return __generator(this,function(n){switch(n.label){case 0:return this.talentPotionPrefab?[3,2]:(e=this,[4,r.default.Instance().loadAndGetRes("res","prefab/MainPanel/AssetTalentPotion")]);case 1:e.talentPotionPrefab=n.sent(),n.label=2;case 2:for(i=0;i<t;i++)a=cc.instantiate(this.talentPotionPrefab),this.talentPotionScale=a.scale,this.talentPotionPool.put(a);return[2]}})})},e.prototype.initZembieKeyPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,i,a;return __generator(this,function(n){switch(n.label){case 0:return this.zembieKeyPrefab?[3,2]:(e=this,[4,r.default.Instance().loadAndGetRes("res","prefab/MainPanel/AssetZembieKey")]);case 1:e.zembieKeyPrefab=n.sent(),n.label=2;case 2:for(i=0;i<t;i++)a=cc.instantiate(this.zembieKeyPrefab),this.zembieKeyScale=a.scale,this.zembieKeyPool.put(a);return[2]}})})},e.prototype.initLegendKeyPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,i,a;return __generator(this,function(n){switch(n.label){case 0:return this.legendKeyPrefab?[3,2]:(e=this,[4,r.default.Instance().loadAndGetRes("res","prefab/MainPanel/AssetLegendKey")]);case 1:e.legendKeyPrefab=n.sent(),n.label=2;case 2:for(i=0;i<t;i++)a=cc.instantiate(this.legendKeyPrefab),this.legendKeyScale=a.scale,this.legendKeyPool.put(a);return[2]}})})},e.prototype.initBossKeyPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,i,a;return __generator(this,function(n){switch(n.label){case 0:return this.bossKeyPrefab?[3,2]:(e=this,[4,r.default.Instance().loadAndGetRes("res","prefab/MainPanel/AssetBossKey")]);case 1:e.bossKeyPrefab=n.sent(),n.label=2;case 2:for(i=0;i<t;i++)a=cc.instantiate(this.bossKeyPrefab),this.bossKeyScale=a.scale,this.bossKeyPool.put(a);return[2]}})})},e.prototype.playAnim=function(t){if(t.endPos?this.endpos=this.node.convertToNodeSpaceAR(t.endPos):this.endpos=this.endPoint.position,t.startPos?this.startpos=this.node.convertToNodeSpaceAR(t.startPos):this.startpos=this.startPoint.position,t.animNum==c.AnimType.Bounce)this.playBounceFlyAnim(this.startpos,this.endpos,t.callBack,t.allCallback,t.type);else{var e=15*Math.random()+10;this.playCircularFlyAnim(e,this.startpos,this.endpos,null,t.callBack,t.allCallback,t.type)}},e.prototype.playBounceFlyAnim=function(t,e,i,a,n){void 0===i&&(i=null),void 0===a&&(a=null),void 0===n&&(n=1),o.default.Instance().playEffect(20);var s=this.coinPool,r=this.coinPrefab;n==c.CurrencyType.Diamond?(s=this.diamondPool,r=this.diamondPrefab):n==c.CurrencyType.Potion?(s=this.potionPool,r=this.potionPrefab):n==c.CurrencyType.Talent?(s=this.talentPotionPool,r=this.talentPotionPrefab):n==c.CurrencyType.ZembieKey?(s=this.zembieKeyPool,r=this.zembieKeyPrefab):n==c.CurrencyType.LegendKey?(s=this.legendKeyPool,r=this.legendKeyPrefab):n==c.CurrencyType.BossKey&&(s=this.bossKeyPool,r=this.bossKeyPrefab);var h=s.get();h||(h=cc.instantiate(r)),h.setPosition(t),this.node.addChild(h),h.scale=0;var d=t.x>0?-1:1,u=t.y>0?1:-1,p=cc.v2(l.default.randInt(50,60),l.default.randInt(100,120));p.x=t.x+p.x*d,p.y=t.y+p.y*u;var f=p.clone();f.x=p.x+l.default.randInt(20,30)*d,f.y=p.y+l.default.randInt(30,40)*u,cc.tween(h).parallel(cc.tween(h).to(.3,{scale:.4}),cc.tween(h).bezierTo(.3,cc.v2(p.x,t.y),cc.v2(p.x,t.y),p)).delay(.05).parallel(cc.tween(h).to(.2,{scale:.5}),cc.tween(h).bezierTo(.2,cc.v2(f.x,p.y),cc.v2(f.x,p.y),f)).delay(.5).to(1,{position:e}).call(function(){s.put(h),i&&i(),a&&a()}).start()},e.prototype.playCircularFlyAnim=function(t,e,i,a,n,s,r){var l=this;if(void 0===a&&(a=130),void 0===n&&(n=null),void 0===s&&(s=null),void 0===r&&(r=1),o.default.Instance().playEffect(20),r==c.CurrencyType.Coin){var h=(d=this.coinPool.size())>t?0:t-d;this.initCoinPool(h)}else if(r==c.CurrencyType.Diamond)h=(d=this.diamondPool.size())>t?0:t-d,this.initDiamondPool(h);else if(r==c.CurrencyType.Potion)h=(d=this.potionPool.size())>t?0:t-d,this.initPotionPool(h);else if(r==c.CurrencyType.Talent)h=(d=this.talentPotionPool.size())>t?0:t-d,this.initTalentPotionPool(h);else if(r==c.CurrencyType.ZembieKey)h=(d=this.zembieKeyPool.size())>t?0:t-d,this.initZembieKeyPool(h);else if(r==c.CurrencyType.LegendKey)h=(d=this.legendKeyPool.size())>t?0:t-d,this.initLegendKeyPool(h);else if(r==c.CurrencyType.BossKey){var d;h=(d=this.bossKeyPool.size())>t?0:t-d,this.initBossKeyPool(h)}var u=this.getCirclePoints(a,e,t).map(function(t){var a=l.coinPool;r==c.CurrencyType.Diamond?a=l.diamondPool:r==c.CurrencyType.Potion?a=l.potionPool:r==c.CurrencyType.Talent?a=l.talentPotionPool:r==c.CurrencyType.ZembieKey?a=l.zembieKeyPool:r==c.CurrencyType.LegendKey?a=l.legendKeyPool:r==c.CurrencyType.BossKey&&(a=l.bossKeyPool);var n=a.get();return n.scale=0,n.setPosition(e),l.node.addChild(n),{node:n,stPos:e,mdPos:t,edPos:i,dis:t.sub(i).mag()}});u=u.sort(function(t,e){return t.dis-e.dis>0?1:t.dis-e.dis<0?-1:0});var p=this.coinPool,f=this.coinScale;r==c.CurrencyType.Diamond?(p=this.diamondPool,f=this.diamondScale):r==c.CurrencyType.Potion?(p=this.potionPool,f=this.potionScale):r==c.CurrencyType.Talent?(p=this.talentPotionPool,f=this.talentPotionScale):r==c.CurrencyType.ZembieKey?(p=this.zembieKeyPool,f=this.zembieKeyScale):r==c.CurrencyType.LegendKey?(p=this.legendKeyPool,f=this.legendKeyScale):r==c.CurrencyType.BossKey&&(p=this.bossKeyPool,f=this.bossKeyScale),1!=r?u.forEach(function(t,e){t.node.scale=0,cc.tween(t.node).to(0,{scale:0}).to(.2,{position:new cc.Vec3(t.mdPos.x,t.mdPos.y),scale:1.1*f}).delay(.02*e).to(.3,{position:new cc.Vec3(t.edPos.x,t.edPos.y),scale:f}).call(function(){p.put(t.node),n&&n(u.length,e),e>=u.length-1&&s&&s(u.length)}).start()}):u.forEach(function(t,e){t.node.scale=0,cc.tween(t.node).to(0,{scale:0}).to(.3,{position:new cc.Vec3(t.mdPos.x,t.mdPos.y),scale:1.1*f}).delay(.05*e).to(.5,{position:new cc.Vec3(t.edPos.x,t.edPos.y),scale:f}).call(function(){p.put(t.node),n&&n(u.length,e),e>=u.length-1&&s&&s(u.length)}).start()})},e.prototype.getCirclePoints=function(t,e,i,a){void 0===a&&(a=200);for(var n=[],o=Math.PI/180*Math.round(360/i),s=0;s<i;s++){var r=e.x+t*Math.sin(o*s),l=e.y+t*Math.cos(o*s);n.unshift(cc.v3(r+Math.random()*a,l+Math.random()*a,0))}return n},__decorate([u(cc.Node)],e.prototype,"startPoint",void 0),__decorate([u(cc.Node)],e.prototype,"endPoint",void 0),__decorate([d],e)}(cc.Component);n.default=p,cc._RF.pop()},{}],GameData:[function(t,e,i){"use strict";cc._RF.push(e,"169f8P2WRhEbYcCnpzNaLIi","GameData");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.GameData=void 0;var o=a("Global"),s=a("ConfigMgr"),r=a("DataMgr"),l=a("EventMgr"),c=a("UtilOne"),h=a("typeEnum"),d=a("TalentBase"),u=a("TTCloudMgr"),p=a("Observer"),f=function(){function t(){this.EffectEnable=!0,this.MusicEnable=!0,this.Vibrate=!0,this.diamond=0,this.potion=0,this.talentPotion=0,this.timeLine=1,this.canTravel=!1,this.maxleves=1,this.minleves=1,this.meataAdNum=0,this.zombieKeys=0,this.zombieADKeys=0,this.zombieMaxLevel=1,this.LegendKeys=0,this.LegendADKeys=0,this.LegendMaxLevel=1,this.BossKeys=0,this.BossADKeys=0,this.BossMaxLevel=1,this.cardList=[],this.takeCardLevel=1,this.takeCardCount=0,this.admaxList=[],this.cardsTotalCountList=[],this.taskOverID=[],this.guideList=[{step:1,finish:!1},{step:2,finish:!1},{step:3,finish:!1},{step:4,finish:!1}],this.guideStep=h.GuideStep.StartFight,console.log("\u5f15\u5bfc\u6b65\u9aa400",this.guideStep),this.language=h.LanguageType.CN,this.freeGetCrad=!0,this.showBroadside=!1,this.logTime=0,this.onlineTime=0,this.onlineRewardIds=[],this.skillList=[],this.skillSlot=[],this.skillTotalCountList=[],this.takeSkillLevel=1,this.takeSkillCount=0,this.freeGetSkill=!0,this.redDotData=[],this.talentData=[],this.firstLogin=0,this.perLogin=0,this.ttSubscribe=0,this.lastTime=0,this.useDefault()}return t.prototype.resetData=function(t){if(t)for(var e in t)this[e]=t[e]},t.prototype.useDefault=function(){this.minleves=1,this.maxleves=1,this.meataAdNum=0,this.diamond=0;var t=[],e=this.getMaxLevel(),i=s.default.Instance().getTableValue("ID",e,cfgTable.levelData),a=s.default.Instance().getTableValue("battle",i.battle,cfgTable.warriorsData);t.push(a[0].warriorsid),this.curlevelData={coin:0,meatLevel:1,unlocked:t,BuildLevel:1},this.cardList=[],this.takeCardLevel=1,this.takeCardCount=0,this.admaxList=[],this.cardsTotalCountList=[],this.taskData={task:0,timestamp:0,curIndex:0,finishCount:0,meatLevel:1,maxleves:1},this.taskOverID=[],this.timeLine=1,this.passLeveInfo={passCount:0,passLevelId:0},this.guideList=[{step:1,finish:!1},{step:2,finish:!1},{step:3,finish:!1},{step:4,finish:!1}],this.guideStep=h.GuideStep.StartFight,console.log("\u5f15\u5bfc\u6b65\u9aa4",h.GuideStep.StartFight),this.freeGetCrad=!0,this.showBroadside=!1,this.logTime=0,this.canTravel=!1,this.language=h.LanguageType.CN,this.onlineTime=0,this.zombieKeys=cfgTable.commonData.zombieinitkey,this.zombieADKeys=cfgTable.commonData.zombieadnumber,this.LegendKeys=cfgTable.commonData.legendsinitkey,this.LegendADKeys=cfgTable.commonData.legendsadnumber,this.BossKeys=cfgTable.commonData.bossinitkey,this.BossADKeys=cfgTable.commonData.bossadnumber,this.zombieMaxLevel=1,this.LegendMaxLevel=1,this.BossMaxLevel=1,this.onlineRewardIds=[],this.skillList=[],this.skillSlot=[0,0,0],this.skillTotalCountList=[],this.takeSkillLevel=1,this.takeSkillCount=0,this.freeGetSkill=!0,this.potion=0,this.redDotData=[],this.timeScaleData={isOpen:!1,timeLeft:0},this.talentData=[{id:cfgTable.talentData[101].id,level:0}],this.talentPotion=0,this.firstLogin=0,this.perLogin=0,this.ttSubscribe=0,this.heroData=[],this.equipData=[],this.equipSlot=[0,0,0,0,0,0],this.heroSlot=0,this.openHero=0},t.prototype.setMaxLeves=function(t){void 0===t&&(t=!0),this.maxleves++;var e=this.maxleves+6*(this.timeLine-1),i=s.default.Instance().getTableValue("ID",e,cfgTable.evolutionData);this.clearUnlocked(),this.setUnlocked(i.warriorsid[0]),t?this.minleves=1:o.Global.talentSkillMgr.run(d.ETalentType.keepProgress,null,!1)||(this.minleves=1),this.curlevelData.BuildLevel=1,this.curlevelData.meatLevel=1,this.canTravel=!1,this.curlevelData.coin=0,l.default.Instance().emitLevelChange(),l.default.Instance().emitCoinChange(),this.save(),this.saveInCloud()},t.prototype.getMaxLevel=function(){return this.maxleves+6*(this.timeLine-1)},t.prototype.getMaxLevels=function(){return console.log("\u5173\u6570",this.maxleves),this.maxleves},t.prototype.setUnlocked=function(t){this.curlevelData.unlocked.push(t),this.save()},t.prototype.isUnlock=function(t){return-1!=this.curlevelData.unlocked.indexOf(t)},t.prototype.getUnlocked=function(){return this.curlevelData.unlocked},t.prototype.clearUnlocked=function(){this.curlevelData.unlocked=[],this.save()},t.prototype.setCardIdList=function(t){for(var e=!1,i=0;i<this.cardList.length;++i)this.cardList[i].ID==t&&(this.cardList[i].count+=1,e=!0);e||this.cardList.push({ID:t,level:0,count:0}),this.save(),this.saveInCloud()},t.prototype.setCardLevelUp=function(t){for(var e=null,i=0;i<this.cardList.length;++i)if(t==this.cardList[i].ID){var a=this.cardList[i].level,n=this.cardList[i].count,o=s.default.Instance().getTableValue("ID",t,cfgTable.cardData);n>=o.level[a][0]&&(this.cardList[i].level+=1,this.cardList[i].level>o.level.length&&(this.cardList[i].level=o.level.length),this.cardList[i].count-=o.level[a][0],e=this.cardList[i])}return this.save(),this.saveInCloud(),e},t.prototype.getCardIdList=function(){return this.cardList},t.prototype.getTakeCardLevel=function(){return this.takeCardLevel},t.prototype.setTakeCardLevel=function(){var t=Object.getOwnPropertyNames(cfgTable.cardlevelData).length;this.takeCardLevel!=t?(this.takeCardLevel++,this.takeCardLevel==t&&(this.takeCardLevel=t),this.save()):this.takeCardLevel=t},t.prototype.save=function(){r.default.Instance().Save_PlayerData()},t.prototype.getMinLevel=function(){return this.minleves+6*(this.timeLine-1)},t.prototype.addMiniLevel=function(t){this.setPassInfoPassLevel(),t>=this.minleves+6*(this.timeLine-1)&&this.minleves++,this.minleves>6&&(this.canTravel=!0,this.minleves=6),this.save(),this.saveInCloud()},t.prototype.getMinlevels=function(){return this.minleves},t.prototype.getUserCoin=function(){return this.curlevelData.coin},t.prototype.getUserCoinStr=function(){return c.default.ChangeNumberUnit(this.curlevelData.coin)},t.prototype.setUserCoin=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this.curlevelData.coin+=t,this.save(),e&&this.saveInCloud(),i&&l.default.Instance().emitCoinChange()},t.prototype.setUserCoinToInt=function(){this.curlevelData.coin=Math.round(this.curlevelData.coin),this.save(),this.saveInCloud(),l.default.Instance().emitCoinChange()},t.prototype.getBuildLevel=function(){return this.curlevelData.BuildLevel},t.prototype.setBuildLevel=function(){this.curlevelData.BuildLevel+=1,this.save()},t.prototype.getMeatLevel=function(){return this.curlevelData.meatLevel},t.prototype.setMeatLevel=function(t){this.curlevelData.meatLevel+=t||1,this.curlevelData.meatLevel>Object.getOwnPropertyNames(cfgTable.skillData).length&&(this.curlevelData.meatLevel=Object.getOwnPropertyNames(cfgTable.skillData).length),this.save()},t.prototype.getTakeCardCount=function(){return this.takeCardCount},t.prototype.setTakeCardCount=function(){var t=cfgTable.cardlevelData[this.takeCardLevel+""];this.takeCardCount+=1,this.takeCardCount>=t.condition&&(this.takeCardCount-=t.condition,this.setTakeCardLevel(),o.Global.umSDK.send(h.EnumDefine.fieldName.Card_pool_level,{lv:this.takeCardLevel})),this.save()},t.prototype.setAdmaxList=function(t){for(var e=0;e<this.admaxList.length;++e)if(this.admaxList[e].ID==t.ID)return;this.admaxList.push(t),this.save()},t.prototype.canAdClick=function(t){for(var e=0;e<this.admaxList.length;++e){var i=s.default.Instance().getTableValue("ID",t,cfgTable.shopData).admax,a=o.Global.sdkMgr.curSdk.option.shop;if(a&&a[String(t)]&&a[String(t)].admax&&-1!=a[String(t)].admax&&(i=a[String(t)].admax),this.admaxList[e].ID==t)return this.admaxList[e].max<i}},t.prototype.addAdClick=function(t){for(var e=0;e<this.admaxList.length;++e)if(this.admaxList[e].ID==t){this.admaxList[e].max+=1;var i=1e3*c.default.getlocalTime(),a=c.default.getNextDayMidnightTimestamp(i);this.admaxList[e].endTime=a,this.save();break}},t.prototype.getAdMaxList=function(){return this.admaxList},t.prototype.getAdMax=function(t){for(var e=0;e<this.admaxList.length;++e)if(this.admaxList[e].ID==t)return this.admaxList[e]},t.prototype.resetAdMax=function(t,e){for(var i=0;i<this.admaxList.length;++i)this.admaxList[i].ID==t&&(this.admaxList[i].max=0,this.admaxList[i].endTime=e,this.save())},t.prototype.setDiamond=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this.diamond+=t,this.save(),e&&this.saveInCloud(),i&&l.default.Instance().emitDiamondChange()},t.prototype.setDiamondToInt=function(){this.diamond=Math.round(this.diamond),this.save(),this.saveInCloud(),l.default.Instance().emitDiamondChange()},t.prototype.getDiamond=function(){return this.diamond},t.prototype.getDiamondStr=function(){return c.default.ChangeNumberUnit(this.diamond)},t.prototype.getCardsTotalAddition=function(){for(var t=[],e=r.default.Instance().getPlayerData().getCardIdList(),i=0;i<e.length;++i)for(var a=s.default.Instance().getTableValue("ID",e[i].ID,cfgTable.cardData),n=0;n<a.type.length;++n){var o=0;if(e[i].level<=0)o=a.typenumber[n];else{for(var l=0,c=0;c<e[i].level;++c)l+=a.level[c][1];o=a.typenumber[n]+l}for(var h=!1,d=0;d<t.length;++d)t[d].type==a.type[n]&&(h=!0,t[d].addition+=o);h||t.push({type:a.type[n],addition:o})}return t},t.prototype.getCardsTotalCount=function(){return this.cardsTotalCountList},t.prototype.setCardsTotalCount=function(t){this.cardsTotalCountList.length<=0&&(this.cardsTotalCountList=t),this.save()},t.prototype.subCardsTotalCount=function(t){for(var e=0;e<this.cardsTotalCountList.length;++e)if(this.cardsTotalCountList[e].ID==t)return!(this.cardsTotalCountList[e].maxCount<=0||(this.cardsTotalCountList[e].maxCount--,0));this.save()},t.prototype.setTaskData=function(t){this.taskData=t,this.save()},t.prototype.getTaskTimestamp=function(){return this.taskData.timestamp},t.prototype.getCurTaskData=function(){return this.taskData.curIndex==cfgTable.commonData.dailytasknumber?null:this.taskData},t.prototype.addCurTaskCount=function(t,e){this.getPassInfo().passCount<cfgTable.commonData.dailytaskopen||this.taskData.task&&e==this.taskData.task.ID&&(this.taskData.finishCount+=t,this.save(),l.default.Instance().emitRefreshTask())},t.prototype.finishCurTask=function(){this.taskData.curIndex>=cfgTable.commonData.dailytasknumber-1&&(this.taskData.curIndex=cfgTable.commonData.dailytasknumber),this.taskData.finishCount=0,this.addTaskOverID(this.taskData.task.ID),l.default.Instance().emitTaskEnd()},t.prototype.getTimeLine=function(){return this.timeLine},t.prototype.setTimeLine=function(){this.timeLine+=1,this.maxleves=0,this.setMaxLeves(),this.save(),this.saveInCloud()},t.prototype.getCurTimeLineEve=function(){var t=cfgTable.evolutionData,e=[],i=[];for(var a in t)i.push(t[a]),t[a].Timelinelevel>0&&(e.push(i),i=[]);return e[this.timeLine-1]},t.prototype.setPassInfo=function(){this.passLeveInfo.passCount+=1,l.default.Instance().emitPassInfo(),this.save()},t.prototype.setPassInfoPassLevel=function(){var t=s.default.Instance().getTableValue("ID",this.getMinLevel(),cfgTable.levelData);t.battle==cfgTable.commonData.holeopen&&(this.passLeveInfo.passLevelId=t.battle,this.setRedDot(h.RedDotId.DungeonsBtn,!0)),l.default.Instance().emitPassInfo(),this.save()},t.prototype.getPassInfo=function(){return this.passLeveInfo},t.prototype.getMeataAdNum=function(){return this.meataAdNum},t.prototype.addMeataAdNum=function(t){this.meataAdNum+=t,this.save()},t.prototype.setMeataAdNum=function(t){this.meataAdNum=t,this.save()},t.prototype.getGuideList=function(t){return this.guideList[t].finish},t.prototype.setGuideList=function(t){this.guideList[t].finish=!0,this.save()},t.prototype.addTaskOverID=function(t){this.taskOverID.push(t),this.save()},t.prototype.getTaskOverID=function(t){return this.taskOverID.find(function(e){return e==t})},t.prototype.RefreshTaskOverID=function(){this.taskOverID=[],this.save()},t.prototype.getGuideStep=function(){return this.guideStep},t.prototype.setGuideStep=function(t){t&&(o.Global.guideMgr.getStepCfg()&&o.Global.umSDK.send(h.EnumDefine.fieldName.guide_step,{step:o.Global.guideMgr.getStepCfg().ID}),this.guideStep=t,l.default.Instance().emitOnlineRewardIconChange(),this.save())},t.prototype.getFreeGetCard=function(){return this.freeGetCrad},t.prototype.setFreeGetCard=function(t){this.freeGetCrad=t,this.save()},t.prototype.getLanguage=function(){return this.language},t.prototype.changeLanguage=function(t){t&&(this.language=t,this.save())},t.prototype.getShowBroadside=function(){return this.showBroadside},t.prototype.setShowBroadside=function(t,e){void 0===e&&(e=!0),this.showBroadside=t,this.save(),e&&this.saveInCloud()},t.prototype.setLogTime=function(t){this.logTime=t,this.save()},t.prototype.setOnlineTime=function(t){this.onlineTime=t,this.save()},t.prototype.getOnlineTime=function(){return this.onlineTime},t.prototype.resetOnlineTime=function(){this.onlineTime=0,this.save()},t.prototype.getZembieKays=function(){return this.zombieKeys},t.prototype.setZembieKays=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this.zombieKeys=Math.round(t),this.save(),e&&this.saveInCloud(),i&&l.default.Instance().emitDungeonKeyChange()},t.prototype.getZembieADKays=function(){return this.zombieADKeys},t.prototype.setZembieADKays=function(t,e){void 0===e&&(e=!0),this.zombieADKeys=Math.round(t),o.Global.isDebug&&console.log("zombieADKeys",this.zombieADKeys),this.save(),e&&this.saveInCloud()},t.prototype.getzombieMaxLevel=function(){return this.zombieMaxLevel},t.prototype.setzombieMaxLevel=function(t){this.zombieMaxLevel=Math.round(t),this.save(),l.default.Instance().emitZembieLevelChange()},t.prototype.getLegendKays=function(){return this.LegendKeys},t.prototype.setLegendKays=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this.LegendKeys=Math.round(t),this.save(),e&&this.saveInCloud(),i&&l.default.Instance().emitDungeonKeyChange()},t.prototype.getLegendADKays=function(){return this.LegendADKeys},t.prototype.setLegendADKays=function(t,e){void 0===e&&(e=!0),this.LegendADKeys=Math.round(t),o.Global.isDebug&&console.log("LegendADKeys",this.LegendADKeys),this.save(),e&&this.saveInCloud()},t.prototype.getLegendMaxLevel=function(){return this.LegendMaxLevel},t.prototype.setLegendMaxLevel=function(t){this.LegendMaxLevel=Math.round(t),this.save(),l.default.Instance().emitLegendLevelChange(),this.saveInCloud()},t.prototype.getBossKays=function(){return this.BossKeys},t.prototype.setBossKays=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this.BossKeys=Math.round(t),this.save(),e&&this.saveInCloud(),i&&l.default.Instance().emitDungeonKeyChange()},t.prototype.getBossADKays=function(){return this.BossADKeys},t.prototype.setBossADKays=function(t,e){void 0===e&&(e=!0),this.BossADKeys=Math.round(t),this.save(),e&&this.saveInCloud()},t.prototype.getBossMaxLevel=function(){return this.BossMaxLevel},t.prototype.setBossMaxLevel=function(t){this.BossMaxLevel=Math.round(t),this.save(),l.default.Instance().emitBossLevelChange(),this.saveInCloud()},t.prototype.setOnlineRewardIds=function(t,e){var i=this.onlineRewardIds;-1==i.indexOf(t)&&i.push(t),this.onlineTime=e,this.onlineRewardIds=i,this.save()},t.prototype.resetOnlineRewardIds=function(){this.onlineRewardIds=[],this.save()},t.prototype.getOnlineRewardIds=function(){return this.onlineRewardIds},t.prototype.setSkillIdList=function(t){for(var e=!1,i=0;i<this.skillList.length;++i)this.skillList[i].ID==t&&(this.skillList[i].count+=1,e=!0);e||this.skillList.push({ID:t,level:0,count:0}),this.save(),this.saveInCloud()},t.prototype.setSkillSlot=function(t,e){void 0===e&&(e=0),this.skillSlot[e]=t,this.save()},t.prototype.getSkillSlot=function(){return this.skillSlot},t.prototype.getTakeSkillLevel=function(){return this.takeSkillLevel},t.prototype.getTakeSkillCount=function(){return this.takeSkillCount},t.prototype.setTakeSkillCount=function(){var t=cfgTable.cardskilllevelData[this.takeSkillLevel+""];this.takeSkillCount+=1,this.takeSkillCount>=t.condition&&(this.takeSkillCount-=t.condition,this.setTakeSkillLevel()),this.save()},t.prototype.setTakeSkillLevel=function(){var t=Object.getOwnPropertyNames(cfgTable.cardskilllevelData).length;this.takeSkillLevel!=t?(this.takeSkillLevel++,this.takeSkillLevel==t&&(this.takeSkillLevel=t),this.save()):this.takeSkillLevel=t},t.prototype.setSkillTotalCount=function(t){this.skillTotalCountList.length<=0&&(this.skillTotalCountList=t),this.save()},t.prototype.getSkillTotalCount=function(){return this.skillTotalCountList},t.prototype.subSkillTotalCount=function(t){for(var e=0;e<this.skillTotalCountList.length;++e)if(this.skillTotalCountList[e].ID==t)return!(this.skillTotalCountList[e].maxCount<=0||(this.skillTotalCountList[e].maxCount--,0));this.save()},t.prototype.getSkillIdList=function(){return this.skillList},t.prototype.setSkillLevelUp=function(t){for(var e=null,i=0;i<this.skillList.length;++i)if(t==this.skillList[i].ID){var a=this.skillList[i].level,n=this.skillList[i].count,o=s.default.Instance().getTableValue("ID",t,cfgTable.cardskillData);n>=o.level[a][0]&&(this.skillList[i].level+=1,this.skillList[i].level>o.level.length&&(this.skillList[i].level=o.level.length),this.skillList[i].count-=o.level[a][0],e=this.skillList[i])}return this.save(),e},t.prototype.setFreeGetSkill=function(t){this.freeGetSkill=t,this.save()},t.prototype.getFreeGetSkill=function(){return this.freeGetSkill},t.prototype.setPotion=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this.potion+=t,this.save(),e&&this.saveInCloud(),i&&l.default.Instance().emitPotionChange()},t.prototype.getPotion=function(){return this.potion},t.prototype.getPotionStr=function(){return c.default.ChangeNumberUnit(this.potion)},t.prototype.setPotionToInt=function(){this.potion=Math.round(this.potion),this.save(),this.saveInCloud(),l.default.Instance().emitPotionChange()},t.prototype.addRedDot=function(){for(var t=Object.keys(h.RedDotId).length/2,e=0,i=0,a=Object.keys(h.RedDotId);i<a.length;i++){var n=a[i];if(e>=t)break;if(!Number(n))break;for(var o=!1,s=0,r=this.redDotData;s<r.length;s++)if(r[s].redDotId==Number(n)){o=!0;break}!o&&this.redDotData.push({redDotId:Number(n),isShow:!1}),e++}this.save()},t.prototype.resetDraw=function(){this.skillList=[],this.takeSkillLevel=1,this.skillTotalCountList=[],this.takeSkillCount=0,this.skillSlot=[0,0,0],this.freeGetSkill=!0},t.prototype.getRedDot=function(t){for(var e=0,i=this.redDotData;e<i.length;e++){var a=i[e];if(a.redDotId==t)return a}return null},t.prototype.setRedDot=function(t,e){for(var i=0,a=this.redDotData;i<a.length;i++){var n=a[i];n.redDotId==t&&(n.isShow=e,l.default.Instance().emitRefreshRedDot(t))}this.save()},t.prototype.setTimeScaleData=function(t,e){this.timeScaleData.isOpen=t,this.timeScaleData.timeLeft=e,e<=0&&(this.timeScaleData.isOpen=!1,l.default.Instance().emitTimeScaleChange()),l.default.Instance().emitTimeScaleTimeChange(),this.save(),this.saveInCloud()},t.prototype.getTimeScaleData=function(){return this.timeScaleData},t.prototype.setTalentPotion=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this.talentPotion+=t,this.save(),e&&this.saveInCloud(),i&&l.default.Instance().emitTalentPotionChange()},t.prototype.getTalentPotion=function(){return this.talentPotion},t.prototype.getTalentPotionStr=function(){return c.default.ChangeNumberUnit(this.talentPotion)},t.prototype.setTalentPotionToInt=function(){this.talentPotion=Math.round(this.talentPotion),this.save(),this.saveInCloud(),l.default.Instance().emitTalentPotionChange()},t.prototype.getAllTalentData=function(){return this.talentData},t.prototype.getTalentData=function(t){for(var e,i=0,a=this.talentData;i<a.length;i++){var n=a[i];if(n.id==t){e=n;break}}return e},t.prototype.setTalentData=function(t){for(var e=cfgTable.talentData[t].maxlevel,i=0,a=this.talentData;i<a.length;i++){var n=a[i];if(n.id==t&&n.level<e){n.level+=1,this.addTalentData(cfgTable.talentData[t]);break}}this.save(),l.default.Instance().emitTalentLevelChange()},t.prototype.resetTalentData=function(){for(var t=0,e=0,i=this.talentData;e<i.length;e++)for(var a=i[e],n=cfgTable.talentData[a.id],o=0;o<a.level;o++)t+=n.cost[o];this.talentData=[{id:cfgTable.talentData[101].id,level:0}],this.setTalentPotion(t),this.save(),l.default.Instance().emitTalentLevelChange()},t.prototype.addTalentData=function(t){var e=t.maxlevel;if(this.getTalentData(t.id).level>=e)for(var i=0,a=t.active;i<a.length;i++){var n=a[i];!this.getTalentData(n[0])&&this.talentData.push({id:n[0],level:0})}this.save()},t.prototype.setFirstLogin=function(t){this.firstLogin=t,this.save()},t.prototype.getFirstLogin=function(){return this.firstLogin},t.prototype.setPerLogin=function(t){this.perLogin=t,this.save()},t.prototype.setTTSubscribe=function(t){this.ttSubscribe=t,this.save()},t.prototype.getTTSubscribe=function(){return this.ttSubscribe},t.prototype.getHeroList=function(){return this.heroData},t.prototype.getEquipList=function(){return this.equipData},t.prototype.getEquipsByUid=function(t){var e=Number((t+"")[0]);return this.getEquipsByType(e)},t.prototype.getEquipsByType=function(t){for(var e=[],i=0;i<this.equipData.length;i++){var a=this.equipData[i],n=a.id+"";Number(n[0])==t&&e.push(a)}return e},t.prototype.getEquipSlotList=function(){return this.equipSlot},t.prototype.addHero=function(t){this.heroData.includes(t)||this.heroData.push(t),this.save()},t.prototype.upgradeEquip=function(t,e){for(var i,a=0;a<this.equipData.length;a++){var n=this.equipData[a];if(n.id==t){i=n;break}}i||(i={id:t,lv:0,count:0},this.equipData.push(i)),i.lv++,i.count-=e,p.default.ins.notice(p.EGameEvent.UPGRADE_EQUIP),this.save()},t.prototype.addEquip=function(t){for(var e,i=0;i<this.equipData.length;i++){var a=this.equipData[i];if(a.id==t){e=a;break}}e?e.count++:(e={id:t,lv:1,count:0},this.equipData.push(e)),p.default.ins.notice(p.EGameEvent.UPGRADE_EQUIP),this.save()},t.prototype.setEquipSlot=function(t,e){null!=this.equipSlot[t]&&(this.equipSlot[t]=e,p.default.ins.notice(p.EGameEvent.CHANGE_EQUIP_SLOT,t,e),this.save())},t.prototype.getHeroSlot=function(){return this.heroSlot},t.prototype.setHeroSlot=function(t){this.heroSlot=t,p.default.ins.notice(p.EGameEvent.CHANGE_HERO_SLOT,t),this.save()},t.prototype.getOpenHero=function(){return this.openHero},t.prototype.setOpenHero=function(t){this.openHero=t,this.save()},t.prototype.setEffectEnable=function(t){this.EffectEnable=t},t.prototype.setMusicEnable=function(t){this.MusicEnable=t},t.prototype.setVibrate=function(t){this.Vibrate=t},t.prototype.getEffectEnable=function(){return this.EffectEnable},t.prototype.getMusicEnable=function(){return this.MusicEnable},t.prototype.getVibrate=function(){return this.Vibrate},t.prototype.saveInCloud=function(){var t=c.default.getlocalTime();t-this.lastTime>1&&(this.lastTime=t,console.log("AAAAA\u5b58!"),u.default.ins.uploadData(!0))},t.prototype.getData=function(){return{EffectEnable:this.EffectEnable,MusicEnable:this.MusicEnable,Vibrate:this.Vibrate,maxleves:this.maxleves,diamond:this.diamond,zombieKeys:this.zombieKeys,zombieADKeys:this.zombieADKeys,zombieMaxLevel:this.zombieMaxLevel,LegendKeys:this.LegendKeys,LegendADKeys:this.LegendADKeys,LegendMaxLevel:this.LegendMaxLevel,BossKeys:this.BossKeys,BossADKeys:this.BossADKeys,BossMaxLevel:this.BossMaxLevel,curlevelData:this.curlevelData,cardList:this.cardList,takeCardLevel:this.takeCardLevel,minleves:this.minleves,takeCardCount:this.takeCardCount,admaxList:this.admaxList,cardsTotalCountList:this.cardsTotalCountList,taskData:this.taskData,timeLine:this.timeLine,passLeveInfo:this.passLeveInfo,guideList:this.guideList,guideStep:this.guideStep,freeGetCrad:this.freeGetCrad,language:this.language,logTime:this.logTime,onlineTime:this.onlineTime,onlineRewardIds:this.onlineRewardIds,meataAdNum:this.meataAdNum,showBroadside:this.showBroadside,canTravel:this.canTravel,skillList:this.skillList,skillSlot:this.skillSlot,skillTotalCountList:this.skillTotalCountList,takeSkillLevel:this.takeSkillLevel,takeSkillCount:this.takeSkillCount,freeGetSkill:this.freeGetSkill,potion:this.potion,redDotData:this.redDotData,timeScaleData:this.timeScaleData,talentData:this.talentData,talentPotion:this.talentPotion,taskOverID:this.taskOverID,firstLogin:this.firstLogin,perLogin:this.perLogin,ttSubscribe:this.ttSubscribe,heroData:this.heroData,equipData:this.equipData,equipSlot:this.equipSlot,heroSlot:this.heroSlot,openHero:this.openHero}},t}();n.GameData=f,cc._RF.pop()},{}],GameMgr:[function(t,e,i){"use strict";cc._RF.push(e,"de16ew39o1F4I2B0Ivekgfv","GameMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("LoadingPanel"),s=a("ResMgr"),r=cc._decorator,l=r.ccclass,c=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.LoadingPanel=null,e}return __extends(e,t),e.prototype.start=function(){this.startLoading(),this.initDebug()},e.prototype.initDebug=function(){},e.prototype.startLoading=function(){var t=this,e=cc.instantiate(this.LoadingPanel);this.node.addChild(e),e.getComponent(o.default).startLoading(function(){var e=s.default.Instance().getRes("res","prefab/MainPanel/mainUI");if(e){var i=cc.instantiate(e);t.node.addChild(i),cc.assetManager.releaseAsset(t.LoadingPanel)}else console.error("\u4e3bUI\u9884\u5236\u4f53\u4e22\u5931!")})},__decorate([c({type:cc.Prefab,displayName:"\u767b\u5f55\u754c\u9762"})],e.prototype,"LoadingPanel",void 0),__decorate([l],e)}(cc.Component);n.default=h,cc._RF.pop()},{}],GameOverPanel:[function(t,e,i){"use strict";cc._RF.push(e,"8af94tmH/xObJ7N9s01BZAE","GameOverPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("AudioMgr"),l=a("BattleFightMgr"),c=a("DataMgr"),h=a("EventMgr"),d=a("UtilOne"),u=a("typeEnum"),p=a("gameShareAdsVideo"),f=cc._decorator,g=f.ccclass,m=f.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.closeBtn=null,e.shareBtn=null,e.doubleBtn=null,e.titlepng=[],e.coinNumNd=null,e.shiping=null,e.shipingdikuangLabel=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.coinNumNd=this.findElement("Panel/lay/coinNum",cc.Label),this.shiping=this.findElement("Panel/shipingdikuang/shiping",cc.Node),this.shipingdikuangLabel=this.findElement("Panel/shipingdikuang/shipingdikuang_label",cc.Node);var t=l.default.Instance().coinNum;t<=1&&(t=l.default.Instance().levels.basemoney),this.coinNumNd.string=d.default.ChangeNumberUnit(t),c.default.Instance().getPlayerData().getGuideStep()==u.GuideStep.GetDoubleReward&&(this.shiping.active=!1,this.shipingdikuangLabel.x=0),l.default.Instance().isEnd=!0},e.prototype.onEnable=function(){p.recording_Video_End(),this.shipingdikuangLabel.getComponent(cc.Label).string=o.Global.languageMgr.getText(Number(920002))+"x2",this.closeBtn.on("click",this.oncloseBtn,this),this.shareBtn.on("click",function(){p.recording_Video_Share(function(){},function(){})},this),this.doubleBtn.on("click",this.doubleBtnClick,this),c.default.Instance().getPlayerData().setPassInfo()},e.prototype.onDisable=function(){this.closeBtn.off("click",this.oncloseBtn,this),this.doubleBtn.off("click",this.doubleBtnClick,this)},e.prototype.initWithParam=function(t){var e=this;this.isWin=t.win,t.win?(this.titlepng[0].active=!0,this.titlepng[1].active=!1,console.log("\u80dc\u5229")):(this.titlepng[0].active=!1,this.titlepng[1].active=!0,console.log("\u5931\u8d25")),this.showEffect(),this.scheduleOnce(function(){h.default.Instance().emitGameTimePause(),e.initGuide()})},e.prototype.oncloseBtn=function(){o.Global.common.checkSubscribe(),this.emitCloseMe(!1)},e.prototype.emitCloseMe=function(e){if(void 0===e&&(e=!1),t.prototype.emitCloseMe.call(this),"0"!=this.coinNumNd.string){var i=c.default.Instance().getPlayerData(),a=this.getAward(e);l.default.Instance().coinNum=0,o.Global.common.flyProp(this.node,u.CurrencyType.Coin,a),i.addCurTaskCount(a,1),o.Global.redDotMgr.initUpgradeRedDot(),h.default.Instance().emitCloseBattlePanel(),l.default.Instance().suspend=!1,l.default.Instance().isEnd=!1,h.default.Instance().emitOverToMain()}},e.prototype.getAward=function(t){var e=1;t&&(e=2);var i=l.default.Instance().coinNum;return i<=1&&(i=9),i*e},e.prototype.doubleBtnClick=function(){var t=this;r.default.Instance().playEffect(6),o.Global.umSDK.send(u.EnumDefine.fieldName.play_AD,{type:u.EnumDefine.fieldDes.addGodOnGameOverStat,lv:c.default.Instance().getPlayerData().getMaxLevel()}),c.default.Instance().getPlayerData().getGuideStep()==u.GuideStep.GetDoubleReward?(o.Global.guideMgr.changeGuideStep(u.GuideStep.GetDoubleReward,u.GuideStep.ClickUpgradesPanel),this.emitCloseMe(!0),o.Global.umSDK.send(u.EnumDefine.fieldName.play_AD,{type:u.EnumDefine.fieldDes.addGodOnGameOverEnd,lv:c.default.Instance().getPlayerData().getMaxLevel()}),o.Global.common.checkSubscribe()):o.Global.sdkMgr.openAd(function(){t.emitCloseMe(!0),o.Global.umSDK.send(u.EnumDefine.fieldName.play_AD,{type:u.EnumDefine.fieldDes.addGodOnGameOverEnd,lv:c.default.Instance().getPlayerData().getMaxLevel()})})},e.prototype.initGuide=function(){var t=this;c.default.Instance().getPlayerData().getGuideStep()==u.GuideStep.GetDoubleReward&&this.scheduleOnce(function(){o.Global.guideMgr.showGuidePanel(t.node)})},__decorate([m(cc.Node)],e.prototype,"closeBtn",void 0),__decorate([m(cc.Node)],e.prototype,"shareBtn",void 0),__decorate([m(cc.Node)],e.prototype,"doubleBtn",void 0),__decorate([m([cc.Node])],e.prototype,"titlepng",void 0),__decorate([g],e)}(s.default);n.default=y,cc._RF.pop()},{}],Global:[function(t,e,i){"use strict";cc._RF.push(e,"833e2rwO2JKxIbsoCfxQmtT","Global");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.initOption=n.CDN_URL=n.Global=void 0;var o=a("ConfigMgr"),s=a("DataMgr"),r=a("EventMgr"),l=a("GuideMgr"),c=a("LanguageMgr"),h=a("OnlineRewardMgr"),d=a("SDKMgr"),u=a("umSDK"),p=a("Common"),f=a("TalentMgr"),g=a("TalentSkillMgr"),m=a("RedDotMgr"),y=a("HeroMgr"),v=a("EquipMgr");n.Global={localTime:0,TbTime:0,isDebug:0,guideMgr:l.default.ins,sdkMgr:d.default.ins,umSDK:u.default.ins,languageMgr:c.default.ins,onlineRewardMgr:h.default.ins,dataMgr:s.default.Instance(),eventMgr:r.default.Instance(),configMgr:o.default.Instance(),common:p.default.ins,talentMgr:f.default.ins,talentSkillMgr:g.default.ins,redDotMgr:m.default.ins,heroMgr:y.default.ins,equipMgr:v.default.ins,event:{TT_VIDEO_BEGIN:"TT_VIDEO_BEGIN",TT_MAX_VIDEO_TIME:"TT_MAX_VIDEO_TIME",TT_VIDEO_END:"TT_VIDEO_END"}},n.CDN_URL="",n.initOption={hideData:{hide_pro:[],hide_city:[],hide_ONOFF_area:!0,hide_scene:[]},banner:{hide:{},unHide:{}},inter:{hide:{},unHide:{}},view:{hide:{},unHide:{}},costom:{hide:{TimeScaleScript:!1},unHide:{TimeScaleScript:!0}},parameter:{adfoodnumber:-1,timeScaleTime:-1,zombieadnumber:-1,legendsadnumber:-1,bossadnumber:-1},shop:{1:{admax:-1,condition:-1},2:{admax:-1,condition:-1}},share_config:{0:{title:"",imageUrl:"",imageUrlId:""}},debug:!1},window.Global=n.Global,cc._RF.pop()},{}],GuideMgr:[function(t,e,i){"use strict";cc._RF.push(e,"aaefdfSLs1A3ra+8shaMFTl","GuideMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("typeEnum"),r=a("GuidePanel"),l=a("DataMgr"),c=a("ResMgr"),h=function(){function t(){}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.init=function(){this.playerData=l.default.Instance().getPlayerData(),this.cfgs=cfgTable.guideData,this.playerData.getUserCoin()>0&&this.playerData.getGuideStep()==s.GuideStep.StartFight&&this.skipGuide(!1)},t.prototype.getStepCfg=function(){for(var t in this.cfgs){var e=this.cfgs[t];if(e.Step==this.playerData.getGuideStep())return e}return null},t.prototype.showGuidePanel=function(t,e){console.log("\u5c55\u793a\u5f15\u5bfc showGuidePanel"),t||(t=this.mainPanelContent),this.highlightNode=e;var i=c.default.Instance().getRes("res","prefab/guide/GuidePanel");i?(this.guideNode&&this.guideNode.destroy(),this.guideNode=cc.instantiate(i),t.addChild(this.guideNode)):console.error("guide\u9884\u5236\u4f53\u4e22\u5931!")},t.prototype.changeGuideStep=function(t,e,i){void 0===i&&(i=!0),this.playerData.getGuideStep()==t&&(this.playerData.setGuideStep(e),i?this.guideNode&&this.guideNode.destroy():this.guideNode.getComponent(r.default).updateUI())},t.prototype.skipGuide=function(t){void 0===t&&(t=!0),t&&o.Global.umSDK.send(s.EnumDefine.fieldName.skip_guide,{step:o.Global.guideMgr.getStepCfg().ID}),s.GuideStep.Complete>this.playerData.getGuideStep()?this.playerData.setGuideStep(s.GuideStep.Complete):this.playerData.getGuideStep()>s.GuideStep.Complete&&this.playerData.getGuideStep()<s.GuideStep.SkillComplete&&this.playerData.setGuideStep(s.GuideStep.SkillComplete),this.guideNode&&this.guideNode.destroy()},t}();n.default=h,cc._RF.pop()},{}],GuidePanel:[function(t,e,i){"use strict";cc._RF.push(e,"84dc5E74RNJvJr8buoclJ4L","GuidePanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("CompBase"),s=a("Global"),r=a("DataMgr"),l=a("EventMgr"),c=a("typeEnum"),h=cc._decorator.ccclass,d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){var t=this;this.mask=this.findElement("mask",cc.Node),this.maskBg=this.findElement("mask/bg",cc.Node),this.dialogBox=this.findElement("dialog_box",cc.Node),this.dialogBoxText=this.findElement("dialog_box/dialog_box_text",cc.Label),this.guideArrow=this.findElement("guide_arrow",cc.Node),this.clickNode=this.findElement("click_node",cc.Node),this.skipNode=this.findElement("skip_node",cc.Node),this.scheduleOnce(function(){t.node.opacity=255,t.updateUI()}),this.skipNode.on("click",this.openSkipGuidePanel,this)},e.prototype.start=function(){},e.prototype.updateUI=function(){var t=this,e=(cc.view.getDesignResolutionSize(),cc.view.getFrameSize(),cc.view.getFrameSize()),i=(cc.view.getDesignResolutionSize(),e.width,e.height,s.Global.guideMgr.getStepCfg()),a=s.Global.guideMgr.highlightNode,n=new cc.Vec2(0,0);a&&(n.y=a.y-Number(i.maskPos[1])),console.log("\u6253\u5370\u5f15\u5bfc\u6b65\u6570",i);var o=new cc.Vec2(0,0);i.maskOffsetPos.length&&(o.x=Number(i.maskOffsetPos[0]),o.y=Number(i.maskOffsetPos[1])),this.mask.x=Number(i.maskPos[0])+n.x+o.x,this.mask.y=Number(i.maskPos[1])+n.y+o.y-5,cc.tween(this.mask).repeatForever(cc.tween().to(.2,{width:Number(i.maskSize[0]),height:Number(i.maskSize[1])})).start(),cc.Tween.stopAllByTarget(this.guideArrow),this.guideArrow.x=Number(i.arrowPos[0])-n.x+o.x,this.guideArrow.y=Number(i.arrowPos[1])+n.y+o.y,this.guideArrow.scaleX=Number(i.arrowDir[0]),this.guideArrow.scaleY=Number(i.arrowDir[1]),this.arrowEffect(),this.dialogBox.x=Number(i.dialogPos[0])-n.x+o.x,this.dialogBox.y=Number(i.dialogPos[1])+n.y+o.y,this.dialogBoxText.string=s.Global.languageMgr.getText(Number(i.Text)),i.Force?(this.clickNode.active=!1,this.clickNode.off(cc.Node.EventType.TOUCH_START,this.setGuideStep,this)):(this.clickNode.active=!0,this.clickNode.on(cc.Node.EventType.TOUCH_START,this.setGuideStep,this)),this.scheduleOnce(function(){t.maskBg.x=-t.mask.x,t.maskBg.y=-t.mask.y,t.dialogBox.height=t.dialogBoxText.node.height+40})},e.prototype.updateText=function(){var t=s.Global.guideMgr.getStepCfg();this.dialogBoxText.string=s.Global.languageMgr.getText(Number(t.Text)),this.dialogBox.height=this.dialogBoxText.node.height+40},e.prototype.arrowEffect=function(){cc.tween(this.guideArrow).repeatForever(cc.tween().to(.3,{y:this.guideArrow.y+30}).to(.5,{y:this.guideArrow.y-15})).start()},e.prototype.setGuideStep=function(){var t=r.default.Instance().getPlayerData().getGuideStep();t==c.GuideStep.FoodUnsatisfied&&l.default.Instance().emitGuideChange(t),t==c.GuideStep.SkillCheckSkillUse?t=c.GuideStep.SkillComplete:t+=1,r.default.Instance().getPlayerData().setGuideStep(t),t!=c.GuideStep.SendArmySpeedTips&&t!=c.GuideStep.BaseBloodVolumeTips&&t!=c.GuideStep.UnlockArmyTips&&t!=c.GuideStep.ClickEvolve?t-1==c.GuideStep.ProductionSchedule||t-1==c.GuideStep.EvolutionaryAgeUnlockArmyTips||t-1==c.GuideStep.SkillCheckSkillSlot?this.updateText():this.node.destroy():this.updateUI()},e.prototype.openSkipGuidePanel=function(){l.default.Instance().emitShowPanel({prefab:"prefab/guide/SkipGuidePanel"})},__decorate([h],e)}(o.default);n.default=d,cc._RF.pop()},{}],Guide:[function(t,e,i){"use strict";cc._RF.push(e,"14a22gLb8tCc4Zy2iCP6hgk","Guide");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,s=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(){this.node.scale=-.5,cc.tween(this.node).repeatForever(cc.tween().to(.3,{y:this.node.y+30}).to(.5,{y:this.node.y-15})).start()},__decorate([o],e)}(cc.Component));a.default=s,cc._RF.pop()},{}],HeroDetailPanel:[function(t,e,i){"use strict";cc._RF.push(e,"bf5766JeERL+6qov0cEW8zs","HeroDetailPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("ResMgr"),l=cc._decorator,c=l.ccclass,h=(l.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e}return __extends(e,t),e.prototype.initWithParam=function(t){this.heroId=t,this.showEffect(),this.data=o.Global.dataMgr.getPlayerData(),this.init()},e.prototype.onLoad=function(){this.btnClose=this.findElement("Panel/close"),this.btnEquip=this.findElement("Panel/btnNode/btnEquip"),this.btnRemove=this.findElement("Panel/btnNode/btnRemove"),this.iconImg=this.findElement("Panel/headNode/iconImg",cc.Sprite),this.nameTxt=this.findElement("Panel/nameTxt",cc.Label),this.propRoot=this.findElement("Panel/propRoot"),this.addEvent(),this.addCustomEvent()},e.prototype.addEvent=function(){this.addClick(this.btnClose),this.addClick(this.btnEquip,cc.Button.Transition.NONE),this.addClick(this.btnRemove,cc.Button.Transition.NONE)},e.prototype.addCustomEvent=function(){},e.prototype.init=function(){this.updateSelf(),this.renderUI()},e.prototype.updateSelf=function(){this.updateUI()},e.prototype.updateUI=function(){var t=o.Global.common.getHeroCfgById(this.heroId);t&&(this.nameTxt.string=o.Global.languageMgr.getText(t.nameid),this.checkBtns(),this.updateProp())},e.prototype.checkBtns=function(){var t=this.data.getHeroSlot(),e=this.heroId==t;this.btnEquip.active=!e,this.btnRemove.active=e},e.prototype.updateProp=function(){var t=o.Global.common.getHeroCfgById(this.heroId);if(t){var e=this.propRoot,i=e.children,a=i[0];i.forEach(function(t){t.active=!1});for(var n=[t.attack,t.hp],s=[1000122,1000172],r=0;r<n.length;r++){var l=i[r];l||((l=cc.instantiate(a)).parent=e),l.active=!0;var c=l.getComponent(cc.Label),h=Math.floor(1e4*n[r])/100,d=o.Global.languageMgr.getText(s[r]);d=d.format(h+"%",""),c.string=d}}},e.prototype.renderUI=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,r.default.Instance().loadAndGetRes("equip","res/heroicon",cc.SpriteAtlas)];case 1:return t=e.sent(),this.iconImg.spriteFrame=t.getSpriteFrame(this.heroId+""),[2]}})})},e.prototype.doEquip=function(){this.data.setHeroSlot(this.heroId),this.emitCloseMe()},e.prototype.doRemove=function(){this.data.setHeroSlot(0),this.emitCloseMe()},e.prototype.onClick=function(t){switch(t.target){case this.btnClose:this.emitCloseMe();break;case this.btnEquip:this.doEquip();break;case this.btnRemove:this.doRemove()}},__decorate([c],e)}(s.default));n.default=h,cc._RF.pop()},{}],HeroGetPanel:[function(t,e,i){"use strict";cc._RF.push(e,"4120cAWKNVLWrNWeY8pY6GO","HeroGetPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("AudioMgr"),r=a("Observer"),l=a("HeroItemForGet"),c=cc._decorator,h=c.ccclass,d=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.one=null,e.item=null,e.arr=null,e}return __extends(e,t),e.prototype.initWithParam=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return this.one.destroyAllChildren(),this.createItem(t),this.scheduleOnce(this.emitCloseMe,2.5),[2]})})},e.prototype.createItem=function(t){var e=cc.instantiate(this.item);e.getComponent(l.default).setData(t),e.parent=this.one,s.default.Instance().playEffect(9),cc.tween(e).to(.15,{scale:1.3}).to(.2,{scale:1}).start()},e.prototype.onDestroy=function(){r.default.ins.notice(r.EGameEvent.NEW_HERO)},__decorate([d(cc.Node)],e.prototype,"one",void 0),__decorate([d(cc.Prefab)],e.prototype,"item",void 0),__decorate([h],e)}(o.default);n.default=u,cc._RF.pop()},{}],HeroItemForGet:[function(t,e,i){"use strict";cc._RF.push(e,"fb886lcaOVBx4HJ6kJ5JHPL","HeroItemForGet");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("DataMgr"),s=a("ResMgr"),r=cc._decorator,l=r.ccclass,c=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.logo=null,e}return __extends(e,t),e.prototype.setData=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this.cfg=t,this.data=o.default.Instance().getPlayerData(),[4,s.default.Instance().loadAndGetRes("equip","res/heroicon",cc.SpriteAtlas)];case 1:return e=i.sent(),this.logo.spriteFrame=e.getSpriteFrame(t.heroid+""),this.showEffect(),[2]}})})},e.prototype.showEffect=function(){this.node.opacity=0,cc.tween(this.node).to(.5,{opacity:255}).start()},__decorate([c(cc.Sprite)],e.prototype,"logo",void 0),__decorate([l],e)}(cc.Component);n.default=h,cc._RF.pop()},{}],HeroMgr:[function(t,e,i){"use strict";cc._RF.push(e,"190d95iVAFDwJrQsFgN4bLV","HeroMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("HeroRoleBase"),r=a("ItemHeroSkill"),l=a("DataMgr"),c=a("ResMgr"),h=function(){function t(){}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.init=function(t,e){this.panelType=t,this.panel=e,this.initHeroBtn()},t.prototype.initHeroBtn=function(){var t=l.default.Instance().getPlayerData(),e=cfgTable.commonData.cardsFeatureOpen[3];if(t.getTimeLine()>=e){var i=t.getHeroSlot();this.createBtn(i)}},t.prototype.createBtn=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a,n;return __generator(this,function(o){switch(o.label){case 0:return e=cc.find("uiPanel/buttonRoot/hero",this.panel.node),i=cc.find("layout",e),[4,c.default.Instance().loadAndGetRes("equip","ui/ItemHeroSkill",cc.Prefab)];case 1:return a=o.sent(),(n=cc.instantiate(a)).parent=i,n.getComponent(r.default).init(t),[2]}})})},t.prototype.run=function(t){this.createHero(t)},t.prototype.createHero=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a,n,r,h;return __generator(this,function(d){switch(d.label){case 0:return e="hero/hero_"+t+"/hero_"+t,[4,c.default.Instance().loadAndGetRes("equip",e,cc.Prefab)];case 1:return i=d.sent(),(a=cc.instantiate(i)).name="999999",a.x=0,n=a.getComponent(s.HeroRoleBase),this.panel.gameFactory.addChild(a),a.opacity=0,a.scaleX=1,a.setPosition(this.panel.Birthpoint.myBirthpoint),r=n,1==l.default.Instance().getPlayerData().getTimeScaleData().isOpen&&(h=o.Global.common.getTimeScale(),n.moveSpeedScale=h[1],n.animTimeScale=h[2],n.attackTimeScale=h[3]),o.Global.common.getRoleList(this.panel,this.panelType).push(r),n.initRole(t,this.panel,this.panelType),[2]}})})},t}();n.default=h,cc._RF.pop()},{}],HeroPanel:[function(t,e,i){"use strict";cc._RF.push(e,"318efct0cJHFZ2f3d7TBIjk","HeroPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("EventMgr"),l=a("Observer"),c=a("ResMgr"),h=a("UtilOne"),d=a("ItemHero"),u=cc._decorator,p=u.ccclass,f=u.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.itemPrefab=null,e}return __extends(e,t),e.prototype.initWithParam=function(t){this.heroId=t,this.showEffect(),this.data=o.Global.dataMgr.getPlayerData(),this.init()},e.prototype.onLoad=function(){this.btnClose=this.findElement("Panel/close"),this.wearNode=this.findElement("Panel/iconNode/wearNode"),this.wearImg=this.findElement("Panel/iconNode/wearNode/wearImg",cc.Sprite),this.nameTxt=this.findElement("Panel/nameTxt",cc.Label),this.propRoot=this.findElement("Panel/propRoot"),this.itemRoot=this.findElement("Panel/myList/view/content"),this.potionTxt=this.findElement("Panel/potionTxt",cc.Label),this.btnGet=this.findElement("Panel/btnNode/btnGet"),this.btnNot=this.findElement("Panel/btnNode/btnNot"),this.btnMax=this.findElement("Panel/btnNode/btnMax"),this.btnGetTxt=this.findElement("Panel/btnNode/btnGet/potionTxt",cc.Label),this.btnNotTxt=this.findElement("Panel/btnNode/btnNot/potionTxt",cc.Label),this.addEvent(),this.addCustomEvent()},e.prototype.addEvent=function(){this.addClick(this.btnClose),this.addClick(this.btnGet)},e.prototype.addCustomEvent=function(){r.default.Instance().onPotionChange(this.potionChange,this),l.default.ins.watch(l.EGameEvent.CHANGE_HERO_SLOT,this.heroSlotChange,this),l.default.ins.watch(l.EGameEvent.NEW_HERO,this.init,this)},e.prototype.init=function(){this.updateSelf(),this.potionChange(),this.renderHero(),this.updateItems()},e.prototype.heroSlotChange=function(t){this.heroId=t,this.init()},e.prototype.updateSelf=function(){var t=o.Global.common.getHeroCfgById(this.heroId);if(this.btnGetTxt.string=cfgTable.commonData.heroPotion+"",this.btnNotTxt.string=cfgTable.commonData.heroPotion+"",this.updateBtns(),!t)return this.wearNode.active=!1,this.propRoot.active=!1,void(this.nameTxt.string=o.Global.languageMgr.getText(960029));this.wearNode.active=!0,this.nameTxt.string=o.Global.languageMgr.getText(t.nameid),this.propRoot.active=!0,this.updateProp()},e.prototype.updateBtns=function(){var t=cfgTable.heroData,e=Object.keys(t).length,i=this.data.getHeroList(),a=this.data.getPotion(),n=cfgTable.commonData.heroPotion;i.length>=e?(this.btnGet.active=!1,this.btnNot.active=!1,this.btnMax.active=!0):a>=n?(this.btnGet.active=!0,this.btnNot.active=!1,this.btnMax.active=!1):(this.btnGet.active=!1,this.btnNot.active=!0,this.btnMax.active=!1)},e.prototype.potionChange=function(){this.potionTxt.string=this.data.getPotionStr()},e.prototype.updateProp=function(){var t=o.Global.common.getHeroCfgById(this.heroId);if(t){var e=this.propRoot,i=e.children,a=i[0];i.forEach(function(t){t.active=!1});for(var n=[t.attack,t.hp],s=[1000122,1000172],r=0;r<n.length;r++){var l=i[r];l||((l=cc.instantiate(a)).parent=e),l.active=!0;var c=l.getComponent(cc.Label),h=Math.floor(1e4*n[r])/100,d=o.Global.languageMgr.getText(s[r]);d=d.format(h+"%",""),c.string=d}}},e.prototype.renderHero=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return o.Global.common.getOneHero(this.heroId)?[4,c.default.Instance().loadAndGetRes("equip","res/heroicon",cc.SpriteAtlas)]:[2];case 1:return t=e.sent(),this.wearImg.spriteFrame=t.getSpriteFrame(this.heroId+""),[2]}})})},e.prototype.updateItems=function(){var t=this.itemRoot.children;t.forEach(function(t){t.active=!1});for(var e=this.data.getHeroList(),i=0;i<e.length;i++){var a=e[i],n=t[i];n||((n=cc.instantiate(this.itemPrefab)).parent=this.itemRoot),n.active=!0,n.getComponent(d.default).init(a)}},e.prototype.getHero=function(){var t=[],e=cfgTable.heroData,i=this.data.getHeroList();for(var a in e){var n=e[a].heroid;i.includes(n)||t.push(e[a])}var o=h.default.getRandWeight(t);this.data.addHero(o.heroid),r.default.Instance().emitShowPanel({data:o,abName:"equip",prefab:"ui/HeroGetPanel"})},e.prototype.onClick=function(t){switch(t.target){case this.btnClose:this.emitCloseMe();break;case this.btnGet:var e=cfgTable.commonData.heroPotion;this.data.setPotion(-e),this.getHero()}},__decorate([f(cc.Prefab)],e.prototype,"itemPrefab",void 0),__decorate([p],e)}(s.default);n.default=g,cc._RF.pop()},{}],HeroRoleBase:[function(t,e,i){"use strict";cc._RF.push(e,"97f61v1VOxBpbQoJoivWoTv","HeroRoleBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.HeroRoleBase=void 0;var o=a("CompBase"),s=a("BattleFightMgr"),r=a("EventMgr"),l=a("IVector2"),c=a("TweenMaterial"),h=a("UtilOne"),d=a("typeEnum"),u=a("DataMgr"),p=a("AudioMgr"),f=a("Global"),g=a("SkillMgr"),m=a("TalentBase"),y=a("RoleBase"),v=cc._decorator,b=v.ccclass,_=v.property,T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bady=null,e.icon=null,e.weapon=null,e.other=null,e.bullet="",e.bulletPos=cc.v2(0,0),e.bulletRotation=0,e.bulletScale=1,e.bulletEff="",e.health=null,e.levelUrl="",e.warriorsname="",e.attack=1,e.hp=1,e.curHp=0,e.defense=1,e.attackDis=2,e.moveSpeed=1,e.sputRange=1,e.sputAttack=1,e.attakInterval=1,e.attakIngInterval=.5,e.perpetualAttack=!1,e.playReverse=!1,e.attackAim=!1,e.killRewards=1,e.needFood=1,e.damageToOurBuild=1,e.damageToOtherBuild=1,e.bulletspeed=.2,e.id=0,e.isEnemy=!1,e.target=null,e.anim=null,e.roleDate=null,e.rigidbody=null,e.bodySpeed=cc.v2(0,0),e.physics=null,e.OtherPhysics=0,e.selfPhysics=0,e.roleBaseType=d.RoleBaseType.Birth,e.OnAttackAim=!1,e.playReverseing=!1,e.NowAttackType=d.AttackType.Default,e.Birthpoint={myBirthpoint:cc.v2(-375,-25),enemyBirthpoint:cc.v2(375,-25)},e.nowBirthpoint=null,e.moveToBulidUse=0,e.canMove=!0,e.moveSpeedScale=1,e.animTimeScale=1,e.attackTimeScale=1,e}return __extends(e,t),e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.physics=this.getComponent(cc.PhysicsCircleCollider),this.health=this.findElement("health",cc.ProgressBar),this.moveToBulidUse=h.default.rand(40,135),this.addEvent()},e.prototype.addEvent=function(){var t=this;r.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this),r.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this)},e.prototype.getCurHp=function(){return this.curHp},e.prototype.getId=function(){return this.id},e.prototype.initRole=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var a,n;return __generator(this,function(){return this.canMove=!0,this.fightplan=e,this.panelType=i,this.isEnemy=!1,this.heroId=t,this.roleDate=f.Global.common.getHeroCfgById(t),this.id=999999,a=g.default.ins.getFirstBaseAtk(),n=g.default.ins.getFirstBaseHp(),this.attack=a*(this.roleDate.attack+1),this.defense=this.roleDate.armor,this.hp=(Number(this.roleDate.hp)+1)*n,this.curHp=this.hp,this.warriorsname=f.Global.languageMgr.getText(Number(this.roleDate.nameid)),this.damageToOtherBuild=Number(this.roleDate.enemybasedamage),this.damageToOurBuild=0,this.attackDis=this.roleDate.attackdistance,this.attakInterval=Number(this.roleDate.attackspeed),this.attakIngInterval=this.roleDate.attakIngInterval,this.perpetualAttack=!!this.roleDate.perpetualAttack,this.playReverse=!!this.roleDate.playReverse,this.moveSpeed=this.roleDate.movespeed,this.sputAttack=this.roleDate.splashdamage,this.sputRange=this.roleDate.splashrange,this.needFood=0,this.killRewards=0,this.bulletspeed=this.roleDate.bulletspeed?Number(this.roleDate.bulletspeed):.2,this.OtherPhysics=0,this.NowAttackType=d.AttackType.Default,this.OnAttackAim=!1,this.playReverseing=!1,this.roleBaseType=d.RoleBaseType.Birth,this.onShow(),this.isEnemy||(f.Global.talentSkillMgr.run(m.ETalentType.armyHp,this,!0),f.Global.talentSkillMgr.run(m.ETalentType.armyAtk,this,!0)),[2]})})},e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2]})})},e.prototype.attackOver=function(){var t=this;if(!this.isDeath()&&this.NowAttackType!=d.AttackType.Over){this.NowAttackType=d.AttackType.Over,this.OnAttackAim=!1,this.roleBaseType=d.RoleBaseType.Interval;var e=1/f.Global.common.getSpeedRate(1,!0);this.scheduleOnce(function(){t.roleBaseType=d.RoleBaseType.Move},this.attakInterval*this.attackTimeScale*e)}},e.prototype.attackEnd=function(){this.isDeath()||this.NowAttackType==d.AttackType.End||(this.NowAttackType=d.AttackType.End,this.playReverseing||(this.perpetualAttack?this.playReverse?(this.anim.on(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.playReverseAttack(d.AttackType.AinmIng)):this.prepareAtk():this.playAttack(d.AttackType.AinmOver)))},e.prototype.playAtkAuio=function(){this.roleDate.audioId&&p.default.Instance().playEffect(Number(this.roleDate.audioId))},e.prototype.onplayReverse=function(){this.playReverseing=!1,this.anim.off(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.prepareAtk()},e.prototype.onGoAtk=function(){if(this.NowAttackType!=d.AttackType.OnGo&&(this.NowAttackType=d.AttackType.OnGo,!this.playReverseing)){this.playAtkAuio();for(var t=this.isEnemy?this.getRoleList():this.getEnemyList(),e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"otherBase"==n.name||"selfBase"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}if(e.minDts<=this.attackDis)this.onGoAtkTo(e);else{if(!(i.minDts<=this.attackDis))return void this.attackEnd();this.onGoAtkTo(i)}if(2==this.roleDate.warriortype){var s={root:this.weapon,target:this.target,father:this};r.default.Instance().emitFireBullet(s)}else{var l=[this.attack,this.damageToOurBuild,this.damageToOtherBuild],c=this.killRewards;r.default.Instance().emitAttacked({id:this.target.getId(),attack:l,killRewards:c,sputAttack:this.sputAttack,sputRange:this.sputRange,owner:this})}}},e.prototype.prepareAtk=function(){if(!this.isDeath()&&this.NowAttackType!=d.AttackType.Prepare){this.NowAttackType=d.AttackType.Prepare;for(var t=this.isEnemy?this.getRoleList():this.getEnemyList(),e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"otherBase"==n.name||"selfBase"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}e.minDts<=this.attackDis?this.prepareAtkTo(e):i.minDts<=this.attackDis?this.prepareAtkTo(i):this.playAttack(d.AttackType.AinmOver)}},e.prototype.attackedFunc=function(t,e,i,a){var n=this,o=i;if(t&&(o=t[0],this.isEnemy)){var l=f.Global.common.isCrit(!0);o=f.Global.common.getCritAtk(l,o,!0),l&&f.Global.talentSkillMgr.playEft(this,m.ETalentEft.crit)}if(this.isEnemy||!f.Global.common.isMiss(!0)){if(!this.isDeath()){this.hp-=o,p.default.Instance().playEffect(4);var h=this.bady.getComponent(cc.Sprite),g=new c.TweenMaterial(h,"time",0);cc.tween(g).to(.1,{mainAny:1}).to(.1,{mainAny:0}).start(),this.health.node.active=!0,this.health.progress=this.hp/this.curHp;var y=this.health.node.getChildByName("white");if(y.active=!0,y.width=(this.hp+o)/this.curHp*52,cc.tween(y).to(.2,{width:this.hp/this.curHp*52}).call(function(){y.active=!1}).start(),this.hp<=0){if(this.roleBaseType=d.RoleBaseType.Dide,this.isEnemy){var v=1;f.Global.talentSkillMgr.run(m.ETalentType.coinDouble,null,!0)&&(v=2,f.Global.talentSkillMgr.playEft(this,m.ETalentEft.doubleCoin)),f.Global.common.isDropMeat()&&f.Global.talentSkillMgr.dropMeat(this,this.fightplan);for(var b=function(){var t=_.killRewards,e=_.fightplan.gold.convertToWorldSpaceAR(cc.v3(0,0)),i=_.node.convertToWorldSpaceAR(cc.v3(0,0));s.default.Instance().coinChange=!0,r.default.Instance().emitCoinEffect(i,e,function(){p.default.Instance().playEffect(21),s.default.Instance().addCoinNum(t,!0),s.default.Instance().coinChange=!1}),u.default.Instance().getPlayerData().addCurTaskCount(1,2)},_=this,T=0;T<v;T++)b()}var S=this.node.getContentSize().height;r.default.Instance().emitRoleDie(this.node.convertToWorldSpaceAR(cc.v2(0,S/2)),S/56.6);var D=(k=this.isEnemy?this.getEnemyList():this.getRoleList()).indexOf(this);D>-1&&k.splice(D,1),this.node.destroy()}if(a){var k=this.isEnemy?this.getEnemyList():this.getRoleList(),C=[];for(T=0;T<k.length;++T)if(!k[T].isDeath()){var I=k[T].node;this.node!=I&&this.getDistance(this.node,I)<=a&&C.push(k[T])}C.forEach(function(t){t.attackedFunc(null,e,i,null,n)})}}}else f.Global.talentSkillMgr.playEft(this,m.ETalentEft.defence)},e.prototype.prepareAtkTo=function(t){!t.base||t.base.isDeath()?this.playAttack(d.AttackType.AinmOver):(this.target=t.base,this.startAtk())},e.prototype.onGoAtkTo=function(t){t.base&&!t.base.isDeath()?this.target=t.base:this.attackEnd()},e.prototype.startAtk=function(){var t=this;if(!this.isDeath()){this.attackAim&&(this.OnAttackAim=!0);var e=1/f.Global.common.getSpeedRate(1,!0);this.scheduleOnce(function(){t.target&&!t.target.isDeath()?t.playAttack(d.AttackType.AinmIng):t.playAttack(d.AttackType.AinmOver)},this.attakIngInterval*this.attackTimeScale*e)}},e.prototype.playAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a;return __generator(this,function(){return this.isDeath()||s.default.Instance().isEnd?[2]:(e=this.anim.getClips(),i=this.anim.play(e[t].name),a=f.Global.common.getSpeedRate(1,!0),i.speed=1*this.animTimeScale*a,i.wrapMode=cc.WrapMode.Normal,[2])})})},e.prototype.playReverseAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a;return __generator(this,function(){return this.isDeath()?[2]:(e=this.anim.getClips(),(i=this.anim.play(e[t].name)).wrapMode=cc.WrapMode.Reverse,a=f.Global.common.getSpeedRate(1,!0),i.speed=1*this.animTimeScale*a,this.playReverseing=!0,[2])})})},e.prototype.detectionDis=function(){for(var t=this.isEnemy?this.getRoleList():this.getEnemyList(),e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node,o=this.getDistance(this.node,n);"otherBase"==n.name||"selfBase"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}if(this.roleBaseType==d.RoleBaseType.Attack&&this.attackAim&&this.OnAttackAim&&(e.minDts<=this.attackDis?this.setAimTo(e):i.minDts<=this.attackDis&&this.setAimTo(i)),this.roleBaseType==d.RoleBaseType.Move&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.setAtkTo(e):i.minDts<=this.attackDis&&this.setAtkTo(i)),2==this.roleDate.warriortype&&(this.roleBaseType==d.RoleBaseType.Attack?("enemy_3"!=this.node.group&&"my_3"!=this.node.group||(this.node.group=this.isEnemy?"enemy_2":"my_2"),this.bodySpeed=cc.v2(l.Vector2.ZERO)):("enemy_2"!=this.node.group&&"my_2"!=this.node.group||(this.node.group=this.isEnemy?"enemy_3":"my_3"),this.bodySpeed=this.bodySpeed)),this.OtherPhysics>0&&50!=this.physics.density?(this.physics.density=50,this.physics.apply()):10!=this.physics.density&&(this.physics.density=10,this.physics.apply()),this.roleBaseType==d.RoleBaseType.Interval&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.bodySpeed=cc.v2(l.Vector2.ZERO):i.minDts<=this.attackDis&&(this.bodySpeed=cc.v2(l.Vector2.ZERO))),!s.default.Instance().isEnd){var r=f.Global.common.getMoveRate(1,!0);this.bodySpeed.x*=r,this.bodySpeed.y*=r,this.bodySpeed.x*=this.moveSpeedScale,this.bodySpeed.y*=this.moveSpeedScale,this.rigidbody.linearVelocity=this.bodySpeed}},e.prototype.setMoveTo=function(t){var e=t.base.node.getPosition(),i=this.node.getPosition();if("otherBase"==t.base.node.name||"selfBase"==t.base.node.name){var a=t.base.node.getPosition();e={x:a.x,y:a.y+this.moveToBulidUse}}var n={x:0,y:0};l.Vector2.sub(n,e,i);var o=l.Vector2.len(n),s=new l.Vector2(n.x/o,n.y/o);this.bodySpeed.x=s.x*this.moveSpeed,this.bodySpeed.y=s.y*this.moveSpeed},e.prototype.setAtkTo=function(t){t.base&&!t.base.isDeath()&&(this.target=t.base,this.bodySpeed=cc.v2(l.Vector2.ZERO),this.playAttack(d.AttackType.AinmStart),this.roleBaseType=d.RoleBaseType.Attack)},e.prototype.setAimTo=function(t){if(t.base&&!t.base.isDeath()){this.target=t.base;var e=new l.Vector2(this.node.position),i=new l.Vector2(this.target.node.position),a=l.Vector2.angle360(e,i);this.weapon.angle=a}},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},e.prototype.move=function(){!s.default.Instance().isEnd&&this.canMove?this.isDeath()||(this.roleBaseType==d.RoleBaseType.Birth?this.moveOn():this.detectionDis()):this.rigidbody.linearVelocity=cc.v2(l.Vector2.ZERO)},e.prototype.moveOn=function(){this.roleBaseType=d.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBirth=function(){this.roleBaseType=d.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBeginContact=function(t,e,i){if(i.node){var a=i.node.getComponent(y.RoleBase);a&&this.isEnemy!=a.isEnemy?this.OtherPhysics+=1:this.selfPhysics+=1}},e.prototype.onEndContact=function(t,e,i){if(i.node){var a=i.node.getComponent(y.RoleBase);a&&this.isEnemy!=a.isEnemy?this.OtherPhysics-=1:this.selfPhysics-=1}},e.prototype.isDeath=function(){return this.roleBaseType==d.RoleBaseType.Dide},e.prototype.setHp=function(t){this.hp=t,this.health.progress=this.hp/this.curHp},e.prototype.getHp=function(){return this.hp},e.prototype.setCurHp=function(t){this.curHp=t,this.health.progress=this.hp/this.curHp},e.prototype.getAtk=function(){return this.attack},e.prototype.setAtk=function(t){this.attack=t},e.prototype.getRoleList=function(){return f.Global.common.getRoleList(this.fightplan,this.panelType)},e.prototype.getEnemyList=function(){return f.Global.common.getEnemyList(this.fightplan,this.panelType)},__decorate([_(cc.Sprite)],e.prototype,"bady",void 0),__decorate([_(cc.Sprite)],e.prototype,"icon",void 0),__decorate([_(cc.Node)],e.prototype,"weapon",void 0),__decorate([_(cc.Sprite)],e.prototype,"other",void 0),__decorate([_()],e.prototype,"bullet",void 0),__decorate([_(cc.Vec2)],e.prototype,"bulletPos",void 0),__decorate([_()],e.prototype,"bulletRotation",void 0),__decorate([_()],e.prototype,"bulletScale",void 0),__decorate([_()],e.prototype,"bulletEff",void 0),__decorate([b],e)}(o.default);n.HeroRoleBase=T,cc._RF.pop()},{}],HeroRole:[function(t,e,i){"use strict";cc._RF.push(e,"3bedeDG41BCrqtN1JY+4Qc1","HeroRole");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("ResMgr"),s=a("UtilOne"),r=a("typeEnum"),l=a("HeroRoleBase"),c=cc._decorator,h=c.ccclass,d=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,l,c;return __generator(this,function(h){switch(h.label){case 0:return t="hero/hero_"+this.heroId+"/level",[4,o.default.Instance().loadAndGetRes("equip",t,cc.SpriteAtlas)];case 1:return e=h.sent(),1==this.roleDate.warriortype?this.node.group=this.isEnemy?"enemy":"my":this.node.group=this.isEnemy?"enemy_3":"my_3",i="",a="",this.bady.spriteFrame&&(i=this.bady.spriteFrame.name),this.icon.spriteFrame&&(a=this.icon.spriteFrame.name),this.isEnemy&&(i=i.replace("e1","e2"),a=a.replace("e1","e2"),e.getSpriteFrame(a)||(a=a.replace("e2","e1")),e.getSpriteFrame(i)||(i=i.replace("e2","e1"))),this.bady.spriteFrame=e.getSpriteFrame(i),this.icon.spriteFrame?this.icon.spriteFrame=e.getSpriteFrame(a):this.icon.spriteFrame=null,this.health.node.setPosition(0,this.bady.spriteFrame.getRect().height+10),this.health.node.active=!1,n=this.bady.spriteFrame.getRect().height,this.physics.offset=cc.v2(0,n/4),this.physics.radius=n/4,this.physics.apply(),this.node.setContentSize(this.bady.spriteFrame.getRect().width,this.bady.spriteFrame.getRect().height),l=s.default.randInt(-1,1),c=s.default.randInt(-1,1),this.isEnemy?(this.nowBirthpoint=cc.v2(this.Birthpoint.enemyBirthpoint.x+l,this.Birthpoint.enemyBirthpoint.y+c),this.node.setPosition(this.nowBirthpoint)):(this.nowBirthpoint=cc.v2(this.Birthpoint.myBirthpoint.x+l,this.Birthpoint.myBirthpoint.y+c),this.node.setPosition(this.nowBirthpoint)),this.roleBaseType=r.RoleBaseType.Birth,[2]}})})},__decorate([h],e)}(l.HeroRoleBase));n.default=d,cc._RF.pop()},{}],Hero:[function(t,e,i){"use strict";cc._RF.push(e,"6fcb0KXc8xPG67ROSS6b/LM","Hero");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(){function t(){}return t.prototype.init=function(t){this.heroId=t,this.heroCfg=o.Global.common.getHeroCfgById(this.heroId)},t.prototype.run=function(){},t}();n.default=s,cc._RF.pop()},{}],IVector2:[function(t,e,i){"use strict";cc._RF.push(e,"39e6chpnOJEBpWqQKRhAyr2","IVector2");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.Vector2=void 0;var o=a("Maths"),s=a("poolOnce"),r=0,l=0,c=function(){function t(t,e){this.x=0,this.y=0,this.set(t,e)}return t.sort=function(t){h.set();for(var e=0,i=t;e<i.length;e++){var a=i[e];h.addSelf(a)}var n=t.length;h.x/=n,h.y/=n;for(var o=0;o<n-1;o++)for(var s=0;s<n-1-o;s++)if(this.sortItem(t[s],t[s+1],h)){var r=t[s];t[s]=t[s+1],t[s+1]=r}return t},t.sortItem=function(t,e,i){return d.set(t).subSelf(i),u.set(e).subSelf(i),!(this.dot(d,u)>0)},t.distance=function(t,e){return r=t.x-e.x,l=t.y-e.y,Math.sqrt(r*r+l*l)},t.distanceSqr=function(t,e){return r=t.x-e.x,l=t.y-e.y,r*r+l*l},t.mul=function(e,i,a){return t.set(e,i),"number"==typeof a?(e.x*=a,e.y*=a):(e.x*=a.x,e.y*=a.y),e},t.equals=function(t,e,i){return void 0===i&&(i=.01),Math.abs(t.x-e.x)<=i&&Math.abs(t.y-e.y)<=i},t.equals2f=function(t,e,i){return t.x===e&&t.y===i},t.angle360=function(e,i,a){void 0===a&&(a=0);var n=h.set(i).subSelf(e);return t.angle(n,a)},t.angle=function(e,i){void 0===i&&(i=0),0!=i&&(i=360-i,t.rotate(e,e,o.Maths.toRadian(i)));var a=o.Maths.toDegree(Math.atan2(e.y,e.x));return a<0&&(a=360-Math.abs(a)),a},t.scale=function(t,e,i){i.x=t.x*e,i.y=t.y*e},t.dot=function(t,e){return t.x*e.y-t.y*e.x},t.normalize=function(t,e){var i=e.x,a=e.y,n=i*i+a*a;return n>0&&(n=1/Math.sqrt(n),t.x=i*n,t.y=a*n),t},t.lerp=function(t,e,i,a){return r=e.x,l=e.y,t.x=r+a*(i.x-r),t.y=l+a*(i.y-l),t},t.toString=function(t){return"("+t.x.toFixed(2)+", "+t.y.toFixed(2)+")"},t.rotate=function(t,e,i){r=e.x,l=e.y;var a=Math.sin(i),n=Math.cos(i);return t.x=n*r-a*l,t.y=a*r+n*l,t},t.sub=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},t.len=function(e){return Math.sqrt(t.lengthSqr(e))},t.lengthSqr=function(t){return t.x*t.x+t.y*t.y},t.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},t.center=function(e,i,a){return t.lerp(e,i,a,.5)},t.clampf=function(t,e,i,a){return t.x=o.Maths.clampf(e.x,i.x,a.x),t.y=o.Maths.clampf(e.y,i.y,a.y),t},t.set=function(t,e,i){return Array.isArray(e)?(t.x=e[0],t.y=e[1]):e&&"object"==typeof e?(t.x=e.x,t.y=e.y):(t.x=e||0,t.y=i||0),t},t.polygonByCenterPoint=function(t,e){for(var i=e[0].x,a=e[0].x,n=e[0].y,o=e[0].y,s=0,r=e;s<r.length;s++){var l=r[s];i>l.x&&(i=l.x),a<l.x&&(a=l.x),n>l.y&&(n=l.y),o<l.y&&(o=l.y)}return t.x=i+Math.abs(a-i)/2,t.y=n+Math.abs(o-n)/2,t},t.fuzzyEquals=function(t,e,i){return t.x-i<=e.x&&e.x<=t.x+i&&t.y-i<=e.y&&e.y<=t.y+i},t.prototype.mul=function(e,i){return t.mul(e,this,i)},t.prototype.mulSelf=function(e){return t.mul(this,this,e)},t.prototype.len=function(){return t.len(this)},t.prototype.lengthSqr=function(){return t.lengthSqr(this)},t.prototype.equals=function(e){return t.equals(this,e)},t.prototype.equals2f=function(e,i){return t.equals2f(this,e,i)},t.prototype.set=function(e,i){return t.set(this,e,i)},t.prototype.sub=function(e,i){return t.sub(e,this,i)},t.prototype.subSelf=function(e){return t.sub(this,this,e)},t.prototype.rotate=function(e,i){return t.rotate(e,this,i)},t.prototype.rotateSelf=function(e){return t.rotate(this,this,e)},t.prototype.normalize=function(e){return t.normalize(e,this)},t.prototype.normalizeSelf=function(){return t.normalize(this,this)},t.prototype.add=function(e,i){return t.add(e,this,i)},t.prototype.addSelf=function(e){return t.add(this,this,e)},t.prototype.toString=function(){return t.toString(this)},t.prototype.clampf=function(e,i,a){return t.clampf(e,this,i,a)},t.prototype.clampfSelf=function(e,i){return t.clampf(this,this,e,i)},t.pool=new s.PoolOnce(1e3,function(){return new t},function(t){t.set()}),t.ZERO=new t(0,0),t.ONE=new t(1,1),t.UP=new t(0,1),t.RIGHT=new t(1,0),t.LEFT=new t(-1,0),t.DOWN=new t(0,-1),t}();n.Vector2=c;var h=new c(1,1),d=new c(1,1),u=new c(1,1);cc._RF.pop()},{}],IVector3:[function(t,e,i){"use strict";cc._RF.push(e,"820de7l5rpLrKDEmIUOTnVh","IVector3");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.Vector3=void 0;var o=a("Maths"),s=a("poolOnce"),r=0,l=0,c=0,h=function(){function t(t,e,i){this.x=0,this.y=0,this.z=0,this.set(t,e,i)}return t.equals=function(t,e,i){return void 0===i&&(i=.01),Math.abs(t.x-e.x)<=i*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=i*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=i*Math.max(1,Math.abs(t.z),Math.abs(e.z))},t.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t},t.sub=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t},t.rotateX=function(t,e,i,a){var n=e.x-i.x,s=e.y-i.y,r=e.z-i.z,l=o.Maths.toRadian(a),c=Math.cos(l),h=Math.sin(l),d=n,u=s*c-r*h,p=s*h+r*c;return t.x=d+i.x,t.y=u+i.y,t.z=p+i.z,t},t.rotateY=function(t,e,i,a){var n=e.x-i.x,s=e.y-i.y,r=e.z-i.z,l=o.Maths.toRadian(a),c=Math.cos(l),h=Math.sin(l),d=r*h+n*c,u=s,p=r*c-n*h;return t.x=d+i.x,t.y=u+i.y,t.z=p+i.z,t},t.rotateZ=function(t,e,i,a){var n=e.x-i.x,s=e.y-i.y,r=e.z-i.z,l=o.Maths.toRadian(a),c=Math.cos(l),h=Math.sin(l),d=n*c-s*h,u=n*h+s*c,p=r;return t.x=d+i.x,t.y=u+i.y,t.z=p+i.z,t},t.mul=function(t,e,i){return"number"==typeof i?(t.x=e.x*i,t.y=e.y*i,t.z=e.z*i):(t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z),t},t.cloneTo=function(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e},t.set=function(t,e,i,a){return Array.isArray(e)?(t.x=e[0],t.y=e[1],t.z=e[2]):e&&"object"==typeof e?(t.x=e.x,t.y=e.y,t.z=e.z):(t.x=e||0,t.y=i||0,t.z=a||0),t},t.toString=function(t){return"("+t.x.toFixed(2)+", "+t.y.toFixed(2)+", "+t.z.toFixed(2)+")"},t.len=function(e){return Math.sqrt(t.lengthSqr(e))},t.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z},t.normalize=function(t,e){var i=e.x,a=e.y,n=e.z,o=i*i+a*a+n*n;return o>0&&(o=1/Math.sqrt(o),t.x=i*o,t.y=a*o,t.z=n*o),t},t.distanceSqr=function(t,e){return d.x=t.x-e.x,d.y=t.y-e.y,d.z=t.z-e.z,d.x*d.x+d.y*d.y+d.z*d.z},t.distance=function(t,e){return Math.sqrt(this.distanceSqr(t,e))},t.lerp=function(t,e,i,a){return r=e.x,l=e.y,c=e.z,"number"==typeof a?d.set(a,a,a):d.set(a),t.x=r+d.x*(i.x-r),t.y=l+d.y*(i.y-l),t.z=c+d.z*(i.z-c),t},t.prototype.set=function(e,i,a){return t.set(this,e,i,a)},t.prototype.equals=function(e,i){return void 0===i&&(i=.01),t.equals(this,e,i)},t.prototype.sub=function(e,i){return t.sub(e,this,i)},t.prototype.subSelf=function(e){return t.sub(this,this,e)},t.prototype.add=function(e,i){return t.add(e,this,i)},t.prototype.addSelf=function(e){return t.add(this,this,e)},t.prototype.clone=function(){return new t(this)},t.prototype.len=function(){return t.len(this)},t.prototype.toString=function(){return t.toString(this)},t.prototype.lengthSqr=function(){return t.lengthSqr(this)},t.prototype.mul=function(e,i){return t.mul(e,this,i)},t.prototype.mulSelf=function(e){return t.mul(this,this,e)},t.prototype.rotateX=function(e,i){return t.rotateX(this,this,e,i)},t.prototype.rotateY=function(e,i){return t.rotateY(this,this,e,i)},t.prototype.rotateZ=function(e,i){return t.rotateZ(this,this,e,i)},t.prototype.normalize=function(e){return t.normalize(e,this)},t.prototype.normalizeSelf=function(){return t.normalize(this,this)},t.pool=new s.PoolOnce(1e3,function(){return new t},function(t){t.set()}),t.ZERO=new t(0,0),t}();n.Vector3=h;var d=new h;cc._RF.pop()},{}],ItemEquipSlot:[function(t,e,i){"use strict";cc._RF.push(e,"31cceuf30pOP5E6q7O8HIIx","ItemEquipSlot");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("EventMgr"),r=a("ResMgr"),l=cc._decorator,c=l.ccclass,h=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lockNode=null,e.emptyNode=null,e.takeNode=null,e.emptyImg=null,e.weaponImg=null,e.timeLineTxt=null,e.isUnlock=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.myBtn=this.node.getComponent(cc.Button)},e.prototype.init=function(t,e){this.sort=t,this.type=e,this.updateSelf()},e.prototype.updateSelf=function(){this.checkUnlock(),this.checkWear(),this.myBtn.interactable=this.isUnlock},e.prototype.checkUnlock=function(){var t=o.Global.dataMgr.getPlayerData(),e=cfgTable.commonData.equipUnlock[this.sort],i=t.getTimeLine();this.isUnlock=i>=e,this.isUnlock?this.lockNode.active=!1:(this.timeLineTxt.string=e+"",this.lockNode.active=!0,this.emptyNode.active=!1,this.takeNode.active=!1)},e.prototype.checkWear=function(){if(this.isUnlock){var t=o.Global.dataMgr.getPlayerData().getEquipSlotList()[this.sort];this.wearId=t,t?(this.emptyNode.active=!1,this.takeNode.active=!0,this.renderEquip()):(this.emptyNode.active=!0,this.takeNode.active=!1,this.renderEmpty())}},e.prototype.renderEmpty=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=this.emptyImg,[4,r.default.Instance().loadAndGetRes("equip","res/empty_"+this.type,cc.SpriteFrame)];case 1:return t.spriteFrame=e.sent(),[2]}})})},e.prototype.renderEquip=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,r.default.Instance().loadAndGetRes("equip","res/equip",cc.SpriteAtlas)];case 1:return t=e.sent(),this.weaponImg.spriteFrame=t.getSpriteFrame(this.wearId+""),[2]}})})},e.prototype.onClick=function(){s.default.Instance().emitShowPanel({data:this.sort,abName:"equip",prefab:"ui/EquipPanel"})},__decorate([h(cc.Node)],e.prototype,"lockNode",void 0),__decorate([h(cc.Node)],e.prototype,"emptyNode",void 0),__decorate([h(cc.Node)],e.prototype,"takeNode",void 0),__decorate([h(cc.Sprite)],e.prototype,"emptyImg",void 0),__decorate([h(cc.Sprite)],e.prototype,"weaponImg",void 0),__decorate([h(cc.Label)],e.prototype,"timeLineTxt",void 0),__decorate([c],e)}(cc.Component);n.default=d,cc._RF.pop()},{}],ItemEquipUpLv:[function(t,e,i){"use strict";cc._RF.push(e,"c58b7v6ZQFLP5IxvjKnDZ7S","ItemEquipUpLv");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("EventMgr"),r=a("ResMgr"),l=cc._decorator,c=l.ccclass,h=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rootNode=null,e.stateTxt=null,e.icon=null,e.lvTxt=null,e.barImg=null,e.upLvNode=null,e.arrowNode=null,e.progressTxt=null,e.redDot=null,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.init=function(t,e){this.data=t,this.slot=e,this.updateSelf(),this.checkIsEquip(),this.renderUI()},e.prototype.updateSelf=function(){this.lvTxt.string="Level"+this.data.lv;var t=o.Global.common.getEquipCfgByUid(this.data.id)[0],e=t.prop.length,i=this.data.lv,a=this.data.count;if(i>=e)this.barImg.fillRange=1,this.upLvNode.active=!1,this.arrowNode.active=!1,this.progressTxt.string="Max";else{var n=t.card[i];this.progressTxt.string=a+"/"+n,a>=n?(this.upLvNode.active=!0,this.arrowNode.active=!0):(this.barImg.fillRange=a/n,this.upLvNode.active=!1,this.arrowNode.active=!1)}},e.prototype.checkIsEquip=function(){var t=o.Global.dataMgr.getPlayerData().getEquipSlotList();this.data.id&&t.includes(this.data.id)?(this.rootNode.opacity=160,this.stateTxt.node.active=!0):(this.rootNode.opacity=255,this.stateTxt.node.active=!1)},e.prototype.renderUI=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,r.default.Instance().loadAndGetRes("equip","res/equip",cc.SpriteAtlas)];case 1:return t=e.sent(),this.icon.spriteFrame=t.getSpriteFrame(this.data.id+""),[2]}})})},e.prototype.onClick=function(){s.default.Instance().emitShowPanel({data:{id:this.data.id,slot:this.slot},abName:"equip",prefab:"ui/EquipDetailPanel"})},__decorate([h(cc.Node)],e.prototype,"rootNode",void 0),__decorate([h(cc.Label)],e.prototype,"stateTxt",void 0),__decorate([h(cc.Sprite)],e.prototype,"icon",void 0),__decorate([h(cc.Label)],e.prototype,"lvTxt",void 0),__decorate([h(cc.Sprite)],e.prototype,"barImg",void 0),__decorate([h(cc.Node)],e.prototype,"upLvNode",void 0),__decorate([h(cc.Node)],e.prototype,"arrowNode",void 0),__decorate([h(cc.Label)],e.prototype,"progressTxt",void 0),__decorate([h(cc.Node)],e.prototype,"redDot",void 0),__decorate([c],e)}(cc.Component);n.default=d,cc._RF.pop()},{}],ItemHeroSkill:[function(t,e,i){"use strict";cc._RF.push(e,"8e960TqU0hGQbJ4XfH9tvyl","ItemHeroSkill");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o,s=a("CompBase"),r=a("Global"),l=a("ResMgr"),c=a("SkillMgr"),h=cc._decorator,d=h.ccclass;h.property,function(t){t[t.normal=1]="normal",t[t.pressed=2]="pressed",t[t.cd=3]="cd",t[t.used=4]="used"}(o||(o={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeScale=1,e.startPos=new cc.Vec2,e}return __extends(e,t),e.prototype.init=function(t){this.normal=this.findElement("normal"),this.pressed=this.findElement("pressed"),this.icon=this.findElement("icon",cc.Sprite),this.used=this.findElement("used"),this.id=t,this.renderUI(),this.state=o.normal,this.updateState(),this.id&&this.addTouchEvt()},e.prototype.renderUI=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.id?[4,l.default.Instance().loadAndGetRes("equip","res/heroicon",cc.SpriteAtlas)]:(this.icon.spriteFrame=null,[2]);case 1:return t=e.sent(),this.icon.spriteFrame=t.getSpriteFrame(this.id+""),[2]}})})},e.prototype.updateState=function(){this.state==o.normal?(this.normal.active=!0,this.pressed.active=!1,this.used.active=!1):this.state==o.pressed?(this.normal.active=!1,this.pressed.active=!0,this.used.active=!1):this.state==o.used&&(this.normal.active=!1,this.pressed.active=!1,this.used.active=!0)},e.prototype.addTouchEvt=function(){this.node.on(c.touch_start,this.onCtrl,this),this.node.on(c.touch_move,this.onCtrl,this),this.node.on(c.touch_cancel,this.onCtrl,this),this.node.on(c.touch_end,this.onCtrl,this)},e.prototype.closeTouchEvt=function(){this.node.off(c.touch_start,this.onCtrl,this),this.node.off(c.touch_move,this.onCtrl,this),this.node.off(c.touch_cancel,this.onCtrl,this),this.node.off(c.touch_end,this.onCtrl,this)},e.prototype.onCtrl=function(t){var e=t,i=t;e.type==c.touch_start?(this.startPos.x=i.getLocationX(),this.startPos.y=i.getLocationY(),this.state=o.pressed,this.updateState()):e.type==c.touch_move||(this.startPos.x-=i.getLocationX(),this.startPos.y-=i.getLocationY(),this.startPos.lengthSqr()<=25?this.runSkill():(this.state=o.normal,this.updateState()))},e.prototype.runSkill=function(){this.closeTouchEvt(),r.Global.heroMgr.run(this.id),this.state=o.used,this.updateState()},__decorate([d],e)}(s.default);n.default=u,cc._RF.pop()},{}],ItemHero:[function(t,e,i){"use strict";cc._RF.push(e,"f835c4MDKBBhomDxIxEozif","ItemHero");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("EventMgr"),r=a("ResMgr"),l=cc._decorator,c=l.ccclass,h=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rootNode=null,e.stateTxt=null,e.icon=null,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.init=function(t){this.heroId=t,this.updateSelf(),this.renderUI()},e.prototype.updateSelf=function(){this.checkIsEquip()},e.prototype.checkIsEquip=function(){var t=o.Global.dataMgr.getPlayerData().getHeroSlot();this.heroId==t?(this.rootNode.opacity=160,this.stateTxt.node.active=!0):(this.rootNode.opacity=255,this.stateTxt.node.active=!1)},e.prototype.renderUI=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,r.default.Instance().loadAndGetRes("equip","res/heroicon",cc.SpriteAtlas)];case 1:return t=e.sent(),this.icon.spriteFrame=t.getSpriteFrame(this.heroId+""),[2]}})})},e.prototype.onClick=function(){s.default.Instance().emitShowPanel({data:this.heroId,abName:"equip",prefab:"ui/HeroDetailPanel"})},__decorate([h(cc.Node)],e.prototype,"rootNode",void 0),__decorate([h(cc.Label)],e.prototype,"stateTxt",void 0),__decorate([h(cc.Sprite)],e.prototype,"icon",void 0),__decorate([c],e)}(cc.Component);n.default=d,cc._RF.pop()},{}],LanguageMgr:[function(t,e,i){"use strict";cc._RF.push(e,"299c2I/GglAjbB72W6baarE","LanguageMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("DataMgr"),s=a("EventMgr"),r=function(){function t(){}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.init=function(){this.playerData=o.default.Instance().getPlayerData(),this.initLanguageCfg()},t.prototype.initLanguageCfg=function(){var t=new Map;for(var e in cfgTable.languageData){var i=cfgTable.languageData[e];t.set(Number(e),i[this.playerData.getLanguage()])}this.cfgs=t},t.prototype.changeLanguage=function(t){t!=this.playerData.getLanguage()&&(this.playerData.changeLanguage(t),this.initLanguageCfg(),s.default.Instance().emitLanguageChange())},t.prototype.getText=function(t){return t&&this.cfgs.get(t)?this.cfgs.get(t):null},t}();n.default=r,cc._RF.pop()},{}],LanguageScript:[function(t,e,i){"use strict";cc._RF.push(e,"feaec/rfaFMqJXNI/uupWoZ","LanguageScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("EventMgr"),r=cc._decorator,l=r.ccclass,c=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e.strs=[],e}return __extends(e,t),e.prototype.onLoad=function(){this.label=this.node.getComponent(cc.Label),this.richText=this.node.getComponent(cc.RichText),this.changeText(),s.default.Instance().onLanguageChange(this.changeText,this)},e.prototype.start=function(){},e.prototype.changeText=function(){if(this.id){var t=o.Global.languageMgr.getText(this.id);for(var e in this.strs)t=t.replace("{"+e+"}",this.strs[e]);this.label&&(this.label.string=t),this.richText&&(this.richText.string=t)}},__decorate([c({displayName:"ID"})],e.prototype,"id",void 0),__decorate([c({type:cc.String,displayName:"\u66ff\u6362\u6587\u672c"})],e.prototype,"strs",void 0),__decorate([l],e)}(cc.Component);n.default=h,cc._RF.pop()},{}],LegendBuildBase:[function(t,e,i){"use strict";cc._RF.push(e,"c4074Y2EldGBrLTM94YukC1","LegendBuildBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("AudioMgr"),r=a("EventMgr"),l=a("TweenMaterial"),c=a("UtilOne"),h=a("typeEnum"),d=a("DungeonFightMgr"),u=cc._decorator,p=u.ccclass,f=u.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.xueliang=null,e.xueliangNum=null,e.anim=null,e.hp=0,e.curHp=0,e.iocn_1=null,e.iocn_2=null,e.material=[],e.fightplan=null,e.id=1e8,e.killRewards=null,e.canMove=!0,e.tween=cc.tween().to(.1,{mainAny:9.99}).to(.1,{mainAny:0}).tag(h.TweenTag.white),e.tweenDie=cc.tween().to(2,{mainAny:9.99}).tag(h.TweenTag.buildDie),e}return __extends(e,t),e.prototype.onEnable=function(){this.addEvent(),this.uiSet()},e.prototype.addEvent=function(){var t=this;r.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this),r.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this)},e.prototype.uiSet=function(){this.anim.node.active=!1,this.iocn_1.setMaterial(0,this.material[0]),this.iocn_2.setMaterial(0,this.material[0])},e.prototype.attackedFunc=function(t,e,i,a){var n=this,o=i;if(t&&(o=t[1]),!(this.hp<=0)){if(o>=this.hp&&(o=this.hp),this.hp-=o,s.default.Instance().playEffect(5),this.playEff(t),this.hp<=0)return this.hp=0,s.default.Instance().playEffect(8),d.default.Instance().isEnd=!0,this.playDie(),this.xueliangNum.string="0",this.xueliang.progress=0,this.scheduleOnce(function(){r.default.Instance().emitLegendGameOver(!1),n.anim.stopSystem(),n.anim.node.active=!1},2.2),this.xueliangNum.string=""+c.default.ChangeNumberUnit(this.hp,1),void(this.xueliang.progress=this.hp/this.curHp);if(this.xueliangNum.string=""+c.default.ChangeNumberUnit(this.hp,1),this.xueliang.progress=this.hp/this.curHp,a){for(var l=this.fightplan.roleList,h=[],u=0;u<l.length;++u)if(!l[u].isDeath()){var p=l[u].node;this.node!=p&&this.getDistance(this.node,p)<=a&&h.push(l[u])}h.forEach(function(t){t.attackedFunc(null,e,i,null)})}}},e.prototype.playEff=function(t){var e=this.xueliang.node.getChildByName("white");e.active=!0,e.width=(this.hp+t)/this.curHp*62,cc.tween(e).to(.2,{width:this.hp/this.curHp*62}).call(function(){e.active=!1}).start();var i=new l.TweenMaterial(this.iocn_1,"time",0),a=new l.TweenMaterial(this.iocn_2,"time",0);if(this.tween.clone().target(i).start(),this.tween.clone().target(a).start(),s.default.Instance().getVibrateEnabled()){o.Global.sdkMgr.vibrateShort("heavy");var n=cc.v3(c.default.randInt(-3,3),c.default.randInt(-3,3));cc.tween(this.node.parent).to(.1,{position:n}).to(.1,{position:cc.v3(0,0,0)}).start()}},e.prototype.playDie=function(){cc.Tween.stopAllByTag(h.TweenTag.white),this.anim.node.active=!0,this.anim.resetSystem(),this.iocn_1.setMaterial(0,this.material[1]),this.iocn_2.setMaterial(0,this.material[1]);var t=new l.TweenMaterial(this.iocn_1,"time",0),e=new l.TweenMaterial(this.iocn_2,"time",0);this.tweenDie.clone().target(t).start(),this.tweenDie.clone().target(e).start()},e.prototype.getHp=function(){return this.hp},e.prototype.subHp=function(t){this.hp-=t},e.prototype.isDeath=function(){return this.hp<=0},e.prototype.initBase=function(t){this.hp=t.hp,this.curHp=t.hp,this.xueliangNum.string=""+c.default.ChangeNumberUnit(this.curHp,1),this.xueliang.progress=this.hp/this.curHp,this.fightplan=t.fightplan,this.id=t.id},e.prototype.move=function(){},e.prototype.getId=function(){return this.id},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},__decorate([f(cc.ProgressBar)],e.prototype,"xueliang",void 0),__decorate([f(cc.Label)],e.prototype,"xueliangNum",void 0),__decorate([f(cc.ParticleSystem)],e.prototype,"anim",void 0),__decorate([f(cc.Sprite)],e.prototype,"iocn_1",void 0),__decorate([f(cc.Sprite)],e.prototype,"iocn_2",void 0),__decorate([f(cc.Material)],e.prototype,"material",void 0),__decorate([p],e)}(cc.Component);n.default=g,cc._RF.pop()},{}],LegendEnterPanel:[function(t,e,i){"use strict";cc._RF.push(e,"0a260cwPTlKrbpSeEr6CCkO","LegendEnterPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("EventMgr"),l=a("ResMgr"),c=a("typeEnum"),h=a("spriteFrameControl"),d=cc._decorator,u=d.ccclass,p=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.SpriteIconKey=null,e.SpriteIconReward=null,e.LabelTitle=null,e.LabelLevelTitle=null,e.LabelNowLevel=null,e.LabelReward=null,e.LabelNum=null,e.LabelKeyNum=null,e.BtnEnter=null,e.BtnRight=null,e.BtnLift=null,e.BtnClose=null,e.SpriteIcon=null,e.LabelText=null,e.LabelCantEnter=null,e.IocnIndex=0,e.nowlevel=1,e}return __extends(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.SpriteIconKey=this.findElement("content/SpriteIconKey",h.default),this.SpriteIconReward=this.findElement("content/SpriteIconReward",h.default),this.LabelTitle=this.findElement("content/LabelTitle",cc.Label),this.LabelLevelTitle=this.findElement("content/LabelLevelTitle",cc.Label),this.LabelNowLevel=this.findElement("content/LabelNowLevel",cc.Label),this.LabelReward=this.findElement("content/LabelReward",cc.Label),this.LabelNum=this.findElement("content/LabelNum",cc.Label),this.LabelKeyNum=this.findElement("content/LabelKeyNum",cc.Label),this.BtnEnter=this.findElement("content/BtnEnter"),this.BtnRight=this.findElement("content/BtnRight"),this.BtnLift=this.findElement("content/BtnLift"),this.BtnClose=this.findElement("content/BtnClose"),this.SpriteIcon=this.findElement("content/SpriteIcon",cc.Sprite),this.LabelText=this.findElement("content/ScrollView/view/content/LabelText",cc.Label),this.LabelCantEnter=this.findElement("content/LabelCantEnter");var e=o.Global.dataMgr.getPlayerData().getLegendMaxLevel();this.nowlevel=e>=c.MaxLevel.Legend?c.MaxLevel.Legend-1:e,r.default.Instance().onLegendLevelChange(this.onLegendLevelChange,this)},e.prototype.onEnable=function(){this.subClicks(this.BtnEnter,this.BtnRight,this.BtnLift,this.BtnClose),this.addClicks(this.BtnEnter,this.BtnRight,this.BtnLift,this.BtnClose),this.showOherUI(),this.showKeyUI(),this.showLevelUI()},e.prototype.onDisable=function(){this.subClicks(this.BtnEnter,this.BtnRight,this.BtnLift,this.BtnClose)},e.prototype.onLegendLevelChange=function(){var t=o.Global.dataMgr.getPlayerData().getLegendMaxLevel();this.nowlevel=t>=c.MaxLevel.Legend?c.MaxLevel.Legend-1:t,this.showKeyUI(),this.showLevelUI()},e.prototype.showOherUI=function(){this.LabelTitle.string=o.Global.languageMgr.getText(900020),this.LabelCantEnter.getComponent(cc.Label).string=o.Global.languageMgr.getText(900009),this.LabelReward.string=o.Global.languageMgr.getText(900007),this.BtnEnter.getChildByName("Label").getComponent(cc.Label).string=o.Global.languageMgr.getText(900005)},e.prototype.showKeyUI=function(){var t=o.Global.dataMgr.getPlayerData(),e=cfgTable.commonData.legendskeymax,i=cfgTable.commonData.legendsadnumber,a=o.Global.sdkMgr.curSdk.option.parameter;a&&(a.legendsadnumber||0==a.legendsadnumber)&&-1!=a.legendsadnumber&&(i=a.legendsadnumber);var n=t.getLegendKays(),s=t.getLegendADKays(),r="0/"+e;this.IocnIndex=0;var l=!0;n>0?r=n+"/"+e:s>0?(this.IocnIndex=1,r=s+"/"+i):l=!1,this.SpriteIconKey.setSpriteFramebyIndex(this.IocnIndex),this.LabelKeyNum.string=r,this.BtnEnter.getComponent(cc.Button).interactable=l},e.prototype.showLevelUI=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a;return __generator(this,function(n){switch(n.label){case 0:return t=o.Global.configMgr.getTableValue("id",this.nowlevel,cfgTable.legendslevelData),this.LabelNowLevel.string=t.level,e=t.reward,this.SpriteIconReward.setSpriteFramebyIndex(Number(e[0])-1),this.LabelNum.string=e[1],this.LabelText.string=o.Global.languageMgr.getText(Number(t.text)),this.LabelLevelTitle.string=o.Global.languageMgr.getText(Number(t.name)),i=this.nowlevel<o.Global.dataMgr.getPlayerData().getLegendMaxLevel(),this.BtnEnter.active=!i,this.LabelCantEnter.active=i,a=this.SpriteIcon,[4,l.default.Instance().loadAndGetRes("res","image/evolutionIcon/"+t.icon,cc.SpriteFrame)];case 1:return a.spriteFrame=n.sent(),[2]}})})},e.prototype.emitCloseMe=function(){t.prototype.emitCloseMe.call(this)},e.prototype.onClick=function(t){switch(t.target){case this.BtnEnter:this.onbtnEnter();break;case this.BtnRight:this.onBtnRight();break;case this.BtnLift:this.onBtnLift();break;case this.BtnClose:this.emitCloseMe()}},e.prototype.onbtnEnter=function(){var t=o.Global.configMgr.getTableValue("id",this.nowlevel,cfgTable.legendslevelData);this.IocnIndex?o.Global.sdkMgr.openAd(function(){var e=o.Global.dataMgr.getPlayerData(),i=e.getLegendADKays();e.setLegendKays(1),i-=1,e.setLegendADKays(i),r.default.Instance().emitLegendLevelChange(),r.default.Instance().emitShowPanel({data:t.battle,prefab:"prefab/Dungeons/LegendFightPanel"})},null):r.default.Instance().emitShowPanel({data:t.battle,prefab:"prefab/Dungeons/LegendFightPanel"})},e.prototype.onBtnRight=function(){this.nowlevel++,this.nowlevel>=o.Global.dataMgr.getPlayerData().getLegendMaxLevel()&&(this.nowlevel=o.Global.dataMgr.getPlayerData().getLegendMaxLevel(),this.nowlevel>=c.MaxLevel.Legend&&(r.default.Instance().emitTips(o.Global.languageMgr.getText(911010)),this.nowlevel=c.MaxLevel.Legend-1)),this.showLevelUI()},e.prototype.onBtnLift=function(){this.nowlevel--,this.nowlevel<1&&(this.nowlevel=1),this.showLevelUI()},__decorate([u],e)}(s.default));n.default=p,cc._RF.pop()},{}],LegendFightPanel:[function(t,e,i){"use strict";cc._RF.push(e,"bba65Q5NuBDoJjoUyFrB1Rq","LegendFightPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("ConfigMgr"),r=a("DataMgr"),l=a("EventMgr"),c=a("ResMgr"),h=a("UtilOne"),d=a("typeEnum"),u=a("AudioMgr"),p=a("Global"),f=a("LegendRole"),g=a("LegendBuildBase"),m=a("DungeonBullet"),y=a("SkillMgr"),v=a("DungeonFightMgr"),b=a("TalentBase"),_=a("ZembieDieAnimPre"),T=a("spriteFrameControl"),S=cc._decorator,D=S.ccclass,k=S.property,C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selfBase=null,e.meatGrowth=null,e.meatCount=null,e.cards=[],e.coin=null,e.diamond=null,e.costs=[],e.btnBgs=[],e.bullet=null,e.gameFactory=null,e.dieAnimShow=null,e.dieShowP=null,e.bg=null,e.selfBase_1=null,e.selfBase_2=null,e.otherBuild=null,e.meatPlay=null,e.LegendHave=null,e.die=null,e.dieShow=null,e.meatNum=0,e.gameData=null,e.id=0,e.bulletNodePool=null,e.dieNodePool=null,e.dieShowPool=null,e.dieshowlist=[],e.roleList=[],e.enemyList=[],e.canUpdate=!1,e.suspendBtn=null,e.Birthpoint={myBirthpoint:cc.v2(-375,15),enemyBirthpoint:cc.v2(401,13)},e.enemyPosyWeight=.5,e.LegendAllNum=0,e.gameTime=0,e.warriortime=0,e.createRoleIndex=[],e.meatTimeScale=1,e.skillTimeScale=1,e.sendTroopsTimeScale=1,e}return __extends(e,t),e.prototype.onLoad=function(){cc.game.on(cc.game.EVENT_SHOW,function(){console.log("\u8fdb\u5165\u524d\u53f0"),u.default.Instance().playMusic(1)},this),this.node.getComponent(cc.Widget).updateAlignment(),v.default.Instance().isEnd=!1,this.meatPlay=this.findElement("uiPanel/buttonRoot/meatPlay"),this.LegendHave=this.findElement("uiPanel/top/LegendHave/label",cc.Label),this.suspendBtn=this.findElement("uiPanel/top/suspendBtn"),this.critNode=this.findElement("fightContent/Crit"),this.addBtnevent(),this.addEvent(),c.default.Instance().sideGamePrefab.push("LegendFightPanel"),cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().gravity=cc.v2(),cc.director.getPhysicsManager().enabledAccumulator=!0,cc.PhysicsManager.FIXED_TIME_STEP=1/60,cc.PhysicsManager.VELOCITY_ITERATIONS=8,cc.PhysicsManager.POSITION_ITERATIONS=8,cc.PhysicsManager.PTM_RATIO=32,cc.PhysicsManager.FIXED_TIME_STEP=.01,this.bulletNodePool=new cc.NodePool,this.dieNodePool=new cc.NodePool,this.dieShowPool=new cc.NodePool},e.prototype.onEnable=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return u.default.Instance().playMusic(1),l.default.Instance().onCloseLegendBattlePanel(this.onClaseSelf,this),l.default.Instance().onDieNumChange(this.onDieNumChange,this),l.default.Instance().emitRefreshTask(),l.default.Instance().onGameTimePause(this.onGameTimePause,this),u.default.Instance().playEffect(7),[2]})})},e.prototype.onClaseSelf=function(){var t=this;this.scheduleOnce(function(){t.emitCloseMe()},.5)},e.prototype.onDieNumChange=function(){var t=v.default.Instance().dieNum;this.LegendHave.string=p.Global.languageMgr.getText(Number(900011))+t+"/"+this.LegendAllNum,v.default.Instance().dieNum>=this.LegendAllNum&&(v.default.Instance().isEnd=!0,this.scheduleOnce(function(){l.default.Instance().emitLegendGameOver(!0)},.3))},e.prototype.loadRes=function(){for(var t=[],e=0,i=this.getWarriorsInof();e<i.length;e++){var a=i[e];t.push(a.warriorsid)}this.getDataAndLoad(t,"role_"),t=[];for(var n=v.default.Instance().Legendleve,o=0;o<n.time.length;++o)t.push(n.time[o][1]);this.getDataAndLoad(t,"enemy_")},e.prototype.getDataAndLoad=function(t,e){for(var i=this,a=new Map,n=0;n<t.length;++n){var o=Math.round(t[n]/1e3%10);a.has(o)?a.get(o).push(t[n]):a.set(o,[t[n]])}a.forEach(function(t,a){var n=t.concat();c.default.Instance().sideGamebundles.push(e+a),i.loadBundle(e+a,n)}),a.clear()},e.prototype.loadBundle=function(t,e){var i=new c.PreloadConf;i.Init(t,t),cc.assetManager.loadBundle(t,function(a,n){if(a)console.error("\u52a0\u8f7dbundle:"+t+" \u9519\u8bef:"+a);else{i.setBundle(n);for(var o=[],s=0,r=e;s<r.length;s++){var l=r[s];o.push("Role_"+l)}i.AddLoadFiles(c.AssetsType.ATPrefab,o),c.default.Instance().loadRes(i,function(){}),i.AddPreloadFiles(c.AssetsType.ATPrefab,o),c.default.Instance().preloadRes(i)}})},e.prototype.update=function(t){var e=this;if(this.canUpdate&&this.gameData){var i=t*this.skillTimeScale;y.default.ins.update(i),t*=this.sendTroopsTimeScale,this.gameTime+=t,this.sortNode(),this.cardShow();for(var a=0;a<this.enemyList.length;++a)this.enemyList[a].move(t);for(a=0;a<this.roleList.length;++a)this.roleList[a].move(t);if(this.gameTime>this.warriortime&&v.default.Instance().Legendleve){this.gameTime+=this.warriortime;for(var n=v.default.Instance().Legendleve,o=function(t){var i=n.time[t][0];if(s.gameTime>i&&-1==s.createRoleIndex.indexOf(t)){for(var a=Number(n.time[t][2]),o=0;o<a;++o)s.scheduleOnce(function(){e.createRole(!0,Number(n.time[t][1]))},cfgTable.commonData.warriortime/1e3*o);s.createRoleIndex.push(t)}},s=this,r=0;r<n.time.length;++r)o(r)}}},e.prototype.onDisable=function(){cc.Tween.stopAllByTag(d.TweenTag.meat),this.dieShowP.destroyAllChildren(),u.default.Instance().stopMusic()},e.prototype.onDestroy=function(){cc.director.getPhysicsManager().enabled=!1,this.roleList=[],this.enemyList=[],this.dieNodePool.clear(),this.dieShowPool.clear()},e.prototype.oncome=function(){this.enemyPosyWeight=.5,this.id=0,this.canUpdate=!0,this.gameData=r.default.Instance().getPlayerData(),this.meatNum=0,this.meatCount.string=""+this.meatNum;for(var t=v.default.Instance().Legendleve,e=0;e<t.time.length;++e)this.LegendAllNum+=t.time[e][2];this.LegendAllNum=Math.round(this.LegendAllNum),this.initPanel()},e.prototype.cardShow=function(){var t=this.getWarriorsInof(),e=0;for(var i in t){var a=t[i];this.meatNum>=a.Needfood?this.btnBgs[e].active&&(this.cards[e].getComponent(cc.Button).interactable=!0,this.btnBgs[e].active=!1):this.btnBgs[e].active||(this.cards[e].getComponent(cc.Button).interactable=!1,this.btnBgs[e].active=!0),e+=1}},e.prototype.getWarriorsInof=function(){for(var t=v.default.Instance().Legendleve.warriorsid,e=[],i=0;i<t.length;i++){var a=t[i],n=s.default.Instance().getTableValue("warriorsid",a,cfgTable.legendswarriorsData);n&&e.push(n)}return e},e.prototype.addBtnevent=function(){this.suspendBtn.on("click",this.clicksuspendBtn,this)},e.prototype.addEvent=function(){var t=this;l.default.Instance().onFireBullet(function(e){var i;i=t.bulletNodePool.size()>0?t.bulletNodePool.get():cc.instantiate(t.bullet),t.gameFactory.addChild(i),i.getComponent(m.default).initBullet(e,t)},this),l.default.Instance().onDungeonRoleDie(this.onDieShow,this),l.default.Instance().onCoinChange(this.setCoinShow,this),l.default.Instance().onDiamondChange(this.setDiamondShow,this),l.default.Instance().onTimeScaleChange(this.initTimeScale,this)},e.prototype.sortNode=function(){this.gameFactory.children.sort(function(t,e){return t.y+1<e.y-1?1:t.y-1>e.y+1?-1:0})},e.prototype.meatNumUp=function(t){var e=this;void 0===t&&(t=0);var i=v.default.Instance().Legendleve.foodspeed*(1+p.Global.common.getCardMeatRate()),a=1/i;i>=2?(cc.Tween.stopAllByTag(d.TweenTag.meat),this.meatGrowth.fillRange=0,this.meatGrowth.node.active=!1,this.meatPlay.active=!0,this.meatTween=cc.tween(this),this.meatTween.repeatForever(cc.tween().delay(a).call(function(){e.meatNum+=1,e.meatCount.string=""+e.meatNum})).tag(d.TweenTag.LegendMeatTow).start()):(this.meatGrowth.fillRange=t,this.meatGrowth.node.active=!0,this.meatPlay.active=!1,t&&(a*=1-t),cc.Tween.stopAllByTag(d.TweenTag.meatTow),this.meatTween=cc.tween(this.meatGrowth),this.meatTween.repeatForever(cc.tween().to(a,{fillRange:1}).call(function(){e.meatNum+=1,e.meatCount.string=""+e.meatNum,e.meatGrowth.fillRange=0,a=1/i})).tag(d.TweenTag.LegendMeat).start())},e.prototype.initPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,i,a,n,o,s;return __generator(this,function(r){switch(r.label){case 0:for(o=0;o<t;o++)e=cc.instantiate(this.bullet),this.bulletNodePool.put(e);return this.die?[3,2]:(i=this,[4,c.default.Instance().loadAndGetRes("res","prefab/animPre/ZembieDieAnimPre")]);case 1:i.die=r.sent(),r.label=2;case 2:for(o=0;o<t;o++)a=cc.instantiate(this.die),this.dieNodePool.put(a);return this.dieShow?[3,4]:(n=this,[4,c.default.Instance().loadAndGetRes("res","prefab/MainPanel/DieShowPre")]);case 3:n.dieShow=r.sent(),r.label=4;case 4:for(o=0;o<t;o++)s=cc.instantiate(this.dieShow),this.dieShowPool.put(s);return[2]}})})},e.prototype.initBase=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(){return this.roleList.push(this.selfBase.getComponent(g.default)),this.id++,t=v.default.Instance().Legendleve.enemybasehp,e=p.Global.talentSkillMgr.run(b.ETalentType.baseHp,t,!1),this.selfBase.getComponent(g.default).initBase({hp:e,fightplan:this,id:this.id}),this.id++,i=Number(v.default.Instance().Legendleve.level[0]),this.selfBase_1.getComponent(T.default).setSpriteFramebyIndex(i-1),this.selfBase_2.getComponent(T.default).setSpriteFramebyIndex(i-1),this.otherBuild.active=!0,this.otherBuild.getComponent(T.default).getSpriteFramebyIndex(i-1)?this.otherBuild.getComponent(T.default).setSpriteFramebyIndex(i-1):this.otherBuild.active=!1,[2]})})},e.prototype.initMeat=function(){this.meatNum=0,this.meatCount.string=""+this.meatNum,this.meatNumUp()},e.prototype.initCards=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o=this;return __generator(this,function(){for(n in t=this.getWarriorsInof(),e=0,i=function(i){var n=t[i];a.cards[e].active=!0,a.costs[e].string=""+n.Needfood;var s=Math.round(n.warriorsid/1e3%10);a.getCardIcon(e,s,n.warriorsid),a.cards[e].on("click",function(){o.meatNum>=n.Needfood&&(p.Global.sdkMgr.vibrateShort("medium"),o.meatNum-=n.Needfood,o.meatCount.string=""+o.meatNum,o.createRole(!1,n.warriorsid),o.cardShow(),0==Number(i)?r.default.Instance().getPlayerData().addCurTaskCount(1,6):1==Number(i)?r.default.Instance().getPlayerData().addCurTaskCount(1,7):2==Number(i)&&r.default.Instance().getPlayerData().addCurTaskCount(1,8))}),e+=1},a=this,t)i(n);return[2]})})},e.prototype.getCardIcon=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var a,n;return __generator(this,function(o){switch(o.label){case 0:return a="role_"+e,[4,c.default.Instance().loadAndGetRes(a,"roleIcon",cc.SpriteAtlas)];case 1:return n=o.sent(),this.cards[t].getChildByName("bg").getChildByName("bgMask").getChildByName("logo").getComponent(cc.Sprite).spriteFrame=n.getSpriteFrame(String(i)),[2]}})})},e.prototype.initGold=function(){this.setCoinShow(),this.setDiamondShow(),this.onDieNumChange()},e.prototype.setCoinShow=function(t){void 0===t&&(t=0),this.coin.string=t?""+h.default.ChangeNumberUnit(t):""+r.default.Instance().getPlayerData().getUserCoinStr()},e.prototype.setDiamondShow=function(t){void 0===t&&(t=0),this.diamond.string=t?""+h.default.ChangeNumberUnit(t):""+r.default.Instance().getPlayerData().getDiamondStr()},e.prototype.createRole=function(t,e){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,function(){var i,a,n,o,s;return __generator(this,function(r){switch(r.label){case 0:return i=Math.round(e/1e3%10),a="role_"+i,t&&(a="enemy_"+i),[4,c.default.Instance().loadAndGetRes(a,"Role_"+e)];case 1:return(n=r.sent())?(o=cc.instantiate(n),this.id++,o.name=this.id+"",o.x=0,s=o.getComponent(f.default),this.gameFactory.addChild(o),o.opacity=0,1!=this.meatTimeScale&&(s.moveSpeedScale=2,s.animTimeScale=2,s.attackTimeScale=.5),t?(o.scaleX=-1,o.setPosition(this.Birthpoint.enemyBirthpoint),this.enemyList.push(o.getComponent(f.default))):(o.scaleX=1,o.setPosition(this.Birthpoint.myBirthpoint),this.roleList.push(o.getComponent(f.default))),s.initRole(t,e,this.id,this),t||y.default.ins.buffSkillWork(s),[2]):(console.error("\u4e3bUI\u9884\u5236\u4f53\u4e22\u5931!"),[2])}})})},e.prototype.initWithParam=function(t){console.log("\u5f53\u524d\u7684\u8fdb\u5165\u7b49\u7ea7",t);var e=v.default.Instance();e.gameType=d.dungeonsGameType.Legend,e.battle=t,e.Legendleve=s.default.Instance().getTableValue("battle",t,cfgTable.legendslevelData),this.showBG(),this.oncome()},e.prototype.initPanel=function(){this.gameData=r.default.Instance().getPlayerData(),this.loadRes(),this.initGold(),this.initPool(),this.initMeat(),this.initCards(),this.initBase(),y.default.ins.init(y.EFightPanel.Legend,this),p.Global.heroMgr.init(y.EFightPanel.Legend,this),this.initTimeScale()},e.prototype.showBG=function(){var t=Number(v.default.Instance().Legendleve.level[0]);this.bg.getComponent(T.default).setSpriteFramebyIndex(t-1)},e.prototype.destroyRole=function(){cc.director.getPhysicsManager().enabled=!1},e.prototype.onDieShow=function(t,e){var i=h.default.getnodePoolNode(this.dieNodePool,this.die);i.scale=e,i&&(this.dieAnimShow.addChild(i),i.getComponent(_.default).init(t,this.dieNodePool));var a=h.default.getnodePoolNode(this.dieShowPool,this.dieShow);a&&(this.dieShowP.addChild(a),a.setPosition(this.dieShowP.convertToNodeSpaceAR(t)))},e.prototype.onGameTimePause=function(t){t?this.pauseTime():this.recoverTime()},e.prototype.pauseTime=function(){var t=this;this.scheduleOnce(function(){t.canUpdate=!1}),cc.Tween.stopAllByTag(d.TweenTag.meat),cc.Tween.stopAllByTag(d.TweenTag.meatTow);for(var e=0;e<this.enemyList.length;++e)this.enemyList[e].canMove=!1;for(e=0;e<this.roleList.length;++e)this.roleList[e].canMove=!1},e.prototype.recoverTime=function(){this.canUpdate=!0,this.meatNumUp(this.meatGrowth.fillRange);for(var t=0;t<this.enemyList.length;++t)this.enemyList[t].canMove=!0;for(t=0;t<this.roleList.length;++t)this.roleList[t].canMove=!0},e.prototype.clicksuspendBtn=function(){l.default.Instance().emitShowPanel({prefab:"prefab/Dungeons/DungeonSuspendPanel"})},e.prototype.addMeat=function(t){this.meatNum+=t,this.meatCount.string=""+this.meatNum},e.prototype.initTimeScale=function(){if(this.meatTween){var t=p.Global.common.getTimeScale();this.meatTimeScale=t[0],this.sendTroopsTimeScale=t[5],this.meatTween._finalAction._speedMethod=!0,this.meatTween._finalAction._speed=this.meatTimeScale;for(var e=0,i=this.roleList;e<i.length;e++)(o=i[e]).moveSpeedScale=t[1],o.animTimeScale=t[2],o.attackTimeScale=t[3];for(var a=0,n=this.enemyList;a<n.length;a++){var o;(o=n[a]).moveSpeedScale=t[1],o.animTimeScale=t[2],o.attackTimeScale=t[3]}y.default.ins.timeScale=t[4],this.skillTimeScale=t[4];for(var s=0,r=y.default.ins.skillBtnItemArr;s<r.length;s++)r[s].timeScale=t[4]}},__decorate([k({type:cc.Node,displayName:"\u6211\u65b9\u57fa\u5730"})],e.prototype,"selfBase",void 0),__decorate([k({type:cc.Sprite,displayName:"\u8089\u7684\u589e\u957f"})],e.prototype,"meatGrowth",void 0),__decorate([k({type:cc.Label,displayName:"\u8089\u7684\u6570\u91cf"})],e.prototype,"meatCount",void 0),__decorate([k({type:cc.Node,displayName:"\u5361\u724c"})],e.prototype,"cards",void 0),__decorate([k({type:cc.Label,displayName:"\u91d1\u5e01"})],e.prototype,"coin",void 0),__decorate([k({type:cc.Label,displayName:"\u94bb\u77f3"})],e.prototype,"diamond",void 0),__decorate([k(cc.Label)],e.prototype,"costs",void 0),__decorate([k(cc.Node)],e.prototype,"btnBgs",void 0),__decorate([k(cc.Prefab)],e.prototype,"bullet",void 0),__decorate([k(cc.Node)],e.prototype,"gameFactory",void 0),__decorate([k(cc.Node)],e.prototype,"dieAnimShow",void 0),__decorate([k(cc.Node)],e.prototype,"dieShowP",void 0),__decorate([k(cc.Node)],e.prototype,"bg",void 0),__decorate([k(cc.Node)],e.prototype,"selfBase_1",void 0),__decorate([k(cc.Node)],e.prototype,"selfBase_2",void 0),__decorate([k(cc.Node)],e.prototype,"otherBuild",void 0),__decorate([D],e)}(o.default);n.default=C,cc._RF.pop()},{}],LegendItem:[function(t,e,i){"use strict";cc._RF.push(e,"e9ef23+o91HEoGoJOSTKz10","LegendItem");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("CompBase"),s=a("Global"),r=a("EventMgr"),l=a("spriteFrameControl"),c=cc._decorator,h=c.ccclass,d=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.btnEnter=null,e.LabelTitle=null,e.LabelKeyNum=null,e.SpriteIconKey=null,e.ClickON=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.init(),r.default.Instance().onLegendLevelChange(this.showUI,this),r.default.Instance().onDungeonKeyChange(this.showUI,this)},e.prototype.onEnable=function(){this.btnEnter&&this.onClick()},e.prototype.onDisable=function(){this.offClick()},e.prototype.init=function(){this.btnEnter=this.findElement("btnEnter"),this.LabelTitle=this.findElement("LabelTitle",cc.Label),this.LabelKeyNum=this.findElement("LabelKeyNum",cc.Label),this.SpriteIconKey=this.findElement("SpriteIconKey",l.default),this.onClick(),this.showUI()},e.prototype.onClick=function(){this.ClickON||(this.ClickON=!0,this.btnEnter.on("click",this.onBtnEnter,this))},e.prototype.offClick=function(){this.ClickON&&(this.ClickON=!1,this.btnEnter.off("click",this.onBtnEnter,this))},e.prototype.showUI=function(){var t=s.Global.dataMgr.getPlayerData(),e=cfgTable.commonData.legendskeymax;this.LabelTitle.string=s.Global.languageMgr.getText(900020);var i=t.getLegendKays(),a=t.getLegendADKays(),n="0/"+e,o=0,r=cfgTable.commonData.legendsadnumber,l=s.Global.sdkMgr.curSdk.option.parameter;l&&(l.legendsadnumber||0==l.legendsadnumber)&&-1!=l.legendsadnumber&&(r=l.legendsadnumber);var c=cc.assetManager.builtins.getBuiltin("material","builtin-2d-sprite");i>0?n=i+"/"+e:a>0?(o=1,n=a+"/"+r):c=cc.assetManager.builtins.getBuiltin("material","builtin-2d-gray-sprite"),this.btnEnter.getComponent(cc.Sprite).setMaterial(0,c),this.btnEnter.getChildByName("Label").getComponent(cc.Label).string=s.Global.languageMgr.getText(900005),this.SpriteIconKey.setSpriteFramebyIndex(o),this.LabelKeyNum.string=n},e.prototype.onBtnEnter=function(){r.default.Instance().emitShowPanel({prefab:"prefab/Dungeons/LegendEnterPanel"})},__decorate([h],e)}(o.default));n.default=d,cc._RF.pop()},{}],LegendRoleBase:[function(t,e,i){"use strict";cc._RF.push(e,"37657RqzPhM/oFGeIBpC2ts","LegendRoleBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.LegendRoleBase=void 0;var o=a("CompBase"),s=a("ConfigMgr"),r=a("EventMgr"),l=a("IVector2"),c=a("TweenMaterial"),h=a("UtilOne"),d=a("typeEnum"),u=a("DataMgr"),p=a("AudioMgr"),f=a("Global"),g=a("DungeonFightMgr"),m=a("SkillMgr"),y=a("TalentBase"),v=cc._decorator,b=v.ccclass,_=v.property,T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bady=null,e.icon=null,e.weapon=null,e.other=null,e.bullet="",e.bulletPos=cc.v2(0,0),e.bulletRotation=0,e.bulletScale=1,e.bulletEff=null,e.Atlas=null,e.health=null,e.talk=null,e.warriorsname="",e.attack=1,e.hp=1,e.curHp=0,e.defense=1,e.attackDis=2,e.moveSpeed=1,e.sputRange=1,e.sputAttack=1,e.attakInterval=1,e.attakIngInterval=.5,e.perpetualAttack=!1,e.playReverse=!1,e.attackAim=!1,e.killRewards=1,e.needFood=1,e.damageToOurBuild=1,e.damageToOtherBuild=1,e.bulletspeed=.2,e.id=0,e.isEnemy=!1,e.target=null,e.anim=null,e.roleDate=null,e.rigidbody=null,e.bodySpeed=cc.v2(0,0),e.physics=null,e.OtherPhysics=0,e.selfPhysics=0,e.roleBaseType=d.RoleBaseType.Birth,e.OnAttackAim=!1,e.playReverseing=!1,e.NowAttackType=d.AttackType.Default,e.Birthpoint={myBirthpoint:cc.v2(-375,15),enemyBirthpoint:cc.v2(401,13)},e.nowBirthpoint=null,e.moveToBulidUse=0,e.canMove=!0,e.moveSpeedScale=1,e.animTimeScale=1,e.attackTimeScale=1,e}var i;return __extends(e,t),i=e,e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.physics=this.getComponent(cc.PhysicsCircleCollider),this.health=this.findElement("health",cc.ProgressBar),this.talk=this.findElement("talk",cc.Node),this.moveToBulidUse=h.default.rand(40,135),this.addEvent()},e.prototype.addEvent=function(){var t=this;r.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this),r.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this)},e.prototype.getCurHp=function(){return this.curHp},e.prototype.getId=function(){return this.id},e.prototype.initRole=function(t,e,i,a){return __awaiter(this,void 0,void 0,function(){var n,o,r,l,c,h,p;return __generator(this,function(){return t||this.setTalk(),this.canMove=!0,this.fightplan=a,this.isEnemy=t,n=1,o=1,r=u.default.Instance().getPlayerData().getCardsTotalAddition(),this.roleDate=s.default.Instance().getTableValue("warriorsid",e,cfgTable.legendswarriorsData),this.isEnemy?(l=g.default.Instance().Legendleve,o*=Number(l.aihpcorrect),n*=Number(l.aiaktcorrect)):(c=r.find(function(t){return t.type==d.CardAddType.RoleAtk}),(h=r.find(function(t){return t.type==d.CardAddType.RoleHP}))&&(o+=h.addition),c&&(n+=c.addition)),(p=r.find(function(t){return t.type==d.CardAddType.coinAdd}))&&p.addition,this.id=i,this.attack=this.roleDate.attack*n,this.defense=this.roleDate.armor,this.hp=Number(this.roleDate.hp)*o,this.curHp=this.hp,this.warriorsname=f.Global.languageMgr.getText(Number(this.roleDate.nameid)),this.damageToOtherBuild=Number(this.roleDate.enemybasedamage),this.damageToOurBuild=this.roleDate.ourbasedamage,this.attackDis=this.roleDate.attackdistance,this.attakInterval=Number(this.roleDate.attackspeed),this.attakIngInterval=this.roleDate.attakIngInterval,this.perpetualAttack=!!this.roleDate.perpetualAttack,this.playReverse=!!this.roleDate.playReverse,this.moveSpeed=this.roleDate.movespeed,this.sputAttack=this.roleDate.splashdamage,this.sputRange=this.roleDate.splashrange,this.needFood=this.roleDate.Needfood,this.killRewards=1*this.roleDate.Killrewards,this.bulletspeed=this.roleDate.bulletspeed?Number(this.roleDate.bulletspeed):.2,this.OtherPhysics=0,this.NowAttackType=d.AttackType.Default,this.OnAttackAim=!1,this.playReverseing=!1,this.roleBaseType=d.RoleBaseType.Birth,this.onShow(),this.isEnemy||(f.Global.talentSkillMgr.run(y.ETalentType.armyHp,this,!1),f.Global.talentSkillMgr.run(y.ETalentType.armyAtk,this,!1)),[2]})})},e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2]})})},e.prototype.attackOver=function(){var t=this;this.isDeath()||this.NowAttackType==d.AttackType.Over||(this.NowAttackType=d.AttackType.Over,this.OnAttackAim=!1,this.roleBaseType=d.RoleBaseType.Interval,this.scheduleOnce(function(){t.roleBaseType=d.RoleBaseType.Move},this.attakInterval*this.attackTimeScale))},e.prototype.attackEnd=function(){this.isDeath()||this.NowAttackType==d.AttackType.End||(this.NowAttackType=d.AttackType.End,this.playReverseing||(this.perpetualAttack?this.playReverse?(this.anim.on(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.playReverseAttack(d.AttackType.AinmIng)):this.prepareAtk():this.playAttack(d.AttackType.AinmOver)))},e.prototype.playAtkAuio=function(){this.roleDate.audioId&&p.default.Instance().playEffect(Number(this.roleDate.audioId))},e.prototype.onplayReverse=function(){this.playReverseing=!1,this.anim.off(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.prepareAtk()},e.prototype.onGoAtk=function(){if(this.NowAttackType!=d.AttackType.OnGo&&(this.NowAttackType=d.AttackType.OnGo,!this.playReverseing)){this.playAtkAuio();for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}if(e.minDts<=this.attackDis)this.onGoAtkTo(e);else{if(!(i.minDts<=this.attackDis))return void this.attackEnd();this.onGoAtkTo(i)}if(2==this.roleDate.warriortype){var s={root:this.weapon,target:this.target,father:this};r.default.Instance().emitFireBullet(s)}else{var l=[this.attack,this.damageToOurBuild,this.damageToOtherBuild],c=this.killRewards;r.default.Instance().emitAttacked({id:this.target.getId(),attack:l,killRewards:c,sputAttack:this.sputAttack,sputRange:this.sputRange})}}},e.prototype.prepareAtk=function(){if(!this.isDeath()&&this.NowAttackType!=d.AttackType.Prepare){this.NowAttackType=d.AttackType.Prepare;for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}e.minDts<=this.attackDis?this.prepareAtkTo(e):i.minDts<=this.attackDis?this.prepareAtkTo(i):this.playAttack(d.AttackType.AinmOver)}},e.prototype.attackedFunc=function(t,e,i,a){var n=i;if(t&&(n=t[0],this.isEnemy)){var o=f.Global.common.isCrit(!1);n=f.Global.common.getCritAtk(o,n,!1),o&&f.Global.talentSkillMgr.playEft(this,y.ETalentEft.crit)}if(this.isEnemy||!f.Global.common.isMiss(!1)){if(!this.isDeath()){this.hp-=n,p.default.Instance().playEffect(4);var s=this.bady.getComponent(cc.Sprite),l=new c.TweenMaterial(s,"time",0);cc.tween(l).to(.1,{mainAny:1}).to(.1,{mainAny:0}).start(),this.health.node.active=!0,this.health.progress=this.hp/this.curHp;var h=this.health.node.getChildByName("white");if(h.active=!0,h.width=(this.hp+n)/this.curHp*52,cc.tween(h).to(.2,{width:this.hp/this.curHp*52}).call(function(){h.active=!1}).start(),this.hp<=0){this.roleBaseType=d.RoleBaseType.Dide,f.Global.common.isDropMeat();var u=this.node.getContentSize().height;r.default.Instance().emitDungeonRoleDie(this.node.convertToWorldSpaceAR(cc.v2(0,u/2)),u/56.6,this.isEnemy);var m=(v=this.isEnemy?this.fightplan.enemyList:this.fightplan.roleList).indexOf(this);m>-1&&v.splice(m,1),this.isEnemy&&g.default.Instance().addDieNum(1),this.endTalk(),this.node.destroy()}if(a){for(var v=this.isEnemy?this.fightplan.enemyList:this.fightplan.roleList,b=[],_=0;_<v.length;++_)if(!v[_].isDeath()){var T=v[_].node;this.node!=T&&this.getDistance(this.node,T)<=a&&b.push(v[_])}b.forEach(function(t){t.attackedFunc(null,e,i,null)})}}}else f.Global.talentSkillMgr.playEft(this,y.ETalentEft.defence)},e.prototype.prepareAtkTo=function(t){!t.base||t.base.isDeath()?this.playAttack(d.AttackType.AinmOver):(this.target=t.base,this.startAtk())},e.prototype.onGoAtkTo=function(t){t.base&&!t.base.isDeath()?this.target=t.base:this.attackEnd()},e.prototype.startAtk=function(){var t=this;this.isDeath()||(this.attackAim&&(this.OnAttackAim=!0),this.scheduleOnce(function(){t.target&&!t.target.isDeath()?t.playAttack(d.AttackType.AinmIng):t.playAttack(d.AttackType.AinmOver)},this.attakIngInterval*this.attackTimeScale))},e.prototype.playAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(){return this.isDeath()?[2]:(e=this.anim.getClips(),(i=this.anim.play(e[t].name)).speed=1*this.animTimeScale,i.wrapMode=cc.WrapMode.Normal,[2])})})},e.prototype.playReverseAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(){return this.isDeath()?[2]:(e=this.anim.getClips(),(i=this.anim.play(e[t].name)).wrapMode=cc.WrapMode.Reverse,i.speed=1*this.animTimeScale,this.playReverseing=!0,[2])})})},e.prototype.detectionDis=function(){for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node,o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}this.roleBaseType==d.RoleBaseType.Attack&&this.attackAim&&this.OnAttackAim&&(e.minDts<=this.attackDis?this.setAimTo(e):i.minDts<=this.attackDis&&this.setAimTo(i)),this.roleBaseType==d.RoleBaseType.Move&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.setAtkTo(e):i.minDts<=this.attackDis&&this.setAtkTo(i)),2==this.roleDate.warriortype&&(this.roleBaseType==d.RoleBaseType.Attack?("enemy_3"!=this.node.group&&"my_3"!=this.node.group||(this.node.group=this.isEnemy?"enemy_2":"my_2"),this.bodySpeed=cc.v2(l.Vector2.ZERO)):("enemy_2"!=this.node.group&&"my_2"!=this.node.group||(this.node.group=this.isEnemy?"enemy_3":"my_3"),this.bodySpeed=this.bodySpeed)),this.OtherPhysics>0&&50!=this.physics.density?(this.physics.density=50,this.physics.apply()):10!=this.physics.density&&(this.physics.density=10,this.physics.apply()),this.roleBaseType==d.RoleBaseType.Interval&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.bodySpeed=cc.v2(l.Vector2.ZERO):i.minDts<=this.attackDis&&(this.bodySpeed=cc.v2(l.Vector2.ZERO))),g.default.Instance().isEnd||(this.bodySpeed.x*=this.moveSpeedScale,this.bodySpeed.y*=this.moveSpeedScale,this.rigidbody.linearVelocity=this.bodySpeed)},e.prototype.setMoveTo=function(t){var e=t.base.node.getPosition(),i=this.node.getPosition();if("selfBuild"==t.base.node.name){var a=t.base.node.getPosition();e={x:a.x,y:a.y+this.moveToBulidUse}}var n={x:0,y:0};l.Vector2.sub(n,e,i);var o=l.Vector2.len(n),s=new l.Vector2(n.x/o,n.y/o);this.bodySpeed.x=s.x*this.moveSpeed,this.bodySpeed.y=s.y*this.moveSpeed},e.prototype.setAtkTo=function(t){t.base&&!t.base.isDeath()&&(this.target=t.base,this.bodySpeed=cc.v2(l.Vector2.ZERO),this.playAttack(d.AttackType.AinmStart),this.roleBaseType=d.RoleBaseType.Attack)},e.prototype.setAimTo=function(t){if(t.base&&!t.base.isDeath()){this.target=t.base;var e=new l.Vector2(this.node.position),i=new l.Vector2(this.target.node.position),a=l.Vector2.angle360(e,i);this.weapon.angle=a}},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},e.prototype.move=function(){!g.default.Instance().isEnd&&this.canMove?m.default.ins.isFrozen(this)?this.rigidbody.linearVelocity=cc.v2(l.Vector2.ZERO):this.isDeath()||(this.roleBaseType==d.RoleBaseType.Birth?this.moveOn():this.detectionDis()):this.rigidbody.linearVelocity=cc.v2(l.Vector2.ZERO)},e.prototype.moveOn=function(){this.roleBaseType=d.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBirth=function(){this.roleBaseType=d.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBeginContact=function(t,e,a){if(a.node){var n=a.node.getComponent(i);n&&this.isEnemy!=n.isEnemy?this.OtherPhysics+=1:this.selfPhysics+=1}},e.prototype.onEndContact=function(t,e,a){if(a.node){var n=a.node.getComponent(i);n&&this.isEnemy!=n.isEnemy?this.OtherPhysics-=1:this.selfPhysics-=1}},e.prototype.isDeath=function(){return this.roleBaseType==d.RoleBaseType.Dide},e.prototype.setHp=function(t){this.hp=t,this.health.progress=this.hp/this.curHp},e.prototype.getHp=function(){return this.hp},e.prototype.setCurHp=function(t){this.curHp=t,this.health.progress=this.hp/this.curHp},e.prototype.getAtk=function(){return this.attack},e.prototype.setAtk=function(t){this.attack=t},e.prototype.setTalk=function(){this.talk.opacity=0;var t=g.default.Instance().Legendleve,e=t.talkchance;if(Math.random()<=e){var i=h.default.randInt(0,t.talk.length-1);this.talk.getChildByName("Label").getComponent(cc.Label).string=f.Global.languageMgr.getText(Number(t.talk[i])),this.talk.getComponent(cc.Layout).updateLayout(),cc.tween(this.talk).delay(3).to(.2,{opacity:255}).delay(2).to(.2,{opacity:0}).tag(d.TweenTag.LegendRoleBaseTalk+this.id).start()}},e.prototype.endTalk=function(){cc.Tween.stopAllByTag(d.TweenTag.LegendRoleBaseTalk+this.id),this.talk.getChildByName("Label").getComponent(cc.Label).string="",this.talk.opacity=0},__decorate([_(cc.Sprite)],e.prototype,"bady",void 0),__decorate([_(cc.Sprite)],e.prototype,"icon",void 0),__decorate([_(cc.Node)],e.prototype,"weapon",void 0),__decorate([_(cc.Sprite)],e.prototype,"other",void 0),__decorate([_()],e.prototype,"bullet",void 0),__decorate([_(cc.Vec2)],e.prototype,"bulletPos",void 0),__decorate([_()],e.prototype,"bulletRotation",void 0),__decorate([_()],e.prototype,"bulletScale",void 0),__decorate([_(cc.Prefab)],e.prototype,"bulletEff",void 0),__decorate([_(cc.SpriteAtlas)],e.prototype,"Atlas",void 0),i=__decorate([b],e)}(o.default);n.LegendRoleBase=T,cc._RF.pop()},{}],LegendRole:[function(t,e,i){"use strict";cc._RF.push(e,"6c3afII1S9ITLwqwL25EXxJ","LegendRole");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("UtilOne"),s=a("typeEnum"),r=a("LegendRoleBase"),l=cc._decorator,c=l.ccclass,h=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,r;return __generator(this,function(){return 1==this.roleDate.warriortype?this.node.group=this.isEnemy?"enemy":"my":this.node.group=this.isEnemy?"enemy_3":"my_3",t="",e="",i="",this.bady.spriteFrame&&(t=this.bady.spriteFrame.name),this.icon.spriteFrame&&(e=this.icon.spriteFrame.name),this.other.spriteFrame&&(i=this.other.spriteFrame.name),this.isEnemy&&(t=t.replace("e1","e2"),e=e.replace("e1","e2"),i=i.replace("e1","e2"),this.Atlas.getSpriteFrame(e)||(e=e.replace("e2","e1")),this.Atlas.getSpriteFrame(t)||(t=t.replace("e2","e1")),this.Atlas.getSpriteFrame(i)||(i=i.replace("e2","e1"))),this.bady.spriteFrame=this.Atlas.getSpriteFrame(t),this.other.spriteFrame?(this.other.node.active=!0,this.other.spriteFrame=this.Atlas.getSpriteFrame(i)):this.other.node.active=!1,this.icon.spriteFrame?this.icon.spriteFrame=this.Atlas.getSpriteFrame(e):this.icon.spriteFrame=null,this.health.node.setPosition(0,this.bady.spriteFrame.getRect().height+10),this.health.node.active=!1,a=this.bady.spriteFrame.getRect().height,this.physics.offset=cc.v2(0,a/4),this.physics.radius=a/4,this.physics.apply(),this.node.setContentSize(this.bady.spriteFrame.getRect().width,this.bady.spriteFrame.getRect().height),n=o.default.randInt(-1,1),r=o.default.randInt(-1,1),this.isEnemy?(this.nowBirthpoint=cc.v2(this.Birthpoint.enemyBirthpoint.x+n,this.Birthpoint.enemyBirthpoint.y),this.node.setPosition(this.nowBirthpoint)):(this.nowBirthpoint=cc.v2(this.Birthpoint.myBirthpoint.x+n,this.Birthpoint.myBirthpoint.y+r),this.node.setPosition(this.nowBirthpoint)),this.roleBaseType=s.RoleBaseType.Birth,[2]})})},__decorate([c],e)}(r.LegendRoleBase));n.default=h,cc._RF.pop()},{}],LoadingPanel:[function(t,e,i){"use strict";cc._RF.push(e,"f43f6fy/ipLG6EntiSS5b3p","LoadingPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("DailyTaskMgr"),r=a("DataMgr"),l=a("ResMgr"),c=a("UtilOne"),h=a("typeEnum"),d=a("TTCloudMgr"),u=a("AudioMgr"),p=cc._decorator,f=p.ccclass,g=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canUp=!1,e}return __extends(e,t),e.prototype.startLoading=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadGameData()];case 1:return e.sent(),[4,this.loadAccountInfo()];case 2:return e.sent(),[4,this.load_resources()];case 3:return e.sent(),this.checkIdList(),t(),this.node.destroy(),[2]}})})},e.prototype.load_resources=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(a){switch(a.label){case 0:return(t=new l.PreloadConf).Init("res","\u901a\u7528\u8d44\u6e90"),e=["prefab/MainPanel/MainPanel","prefab/MainPanel/mainUI","prefab/MainPanel/BattlePanel","prefab/MainPanel/Role","prefab/guide/GuidePanel"],t.AddLoadFiles(l.AssetsType.ATPrefab,e),[4,l.default.Instance().loadRes(t,function(){})];case 1:return a.sent(),i=["prefab/MainPanel/CardsPanel","prefab/MainPanel/ShopPanel","prefab/MainPanel/UpgradesPanel","prefab/MainPanel/BattleFightPanel","prefab/MainPanel/SettingPanel","prefab/MainPanel/CardsInfo","prefab/MainPanel/CardsAddition","prefab/MainPanel/EvolutionProcessPanel","prefab/MainPanel/CardGetPanel","prefab/MainPanel/CardsProbabilityPanel","prefab/MainPanel/EvoPassPanel","prefab/MainPanel/UIGMPlan","prefab/Dungeons/DungeonsPanel","prefab/Dungeons/ZembieEnterPanel"],t.AddPreloadFiles(l.AssetsType.ATPrefab,i),l.default.Instance().preloadRes(t),[2]}})})},e.prototype.loadGameData=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return r.default.Instance().LoadFromCache(),t=r.default.Instance().getPlayerData(),[4,d.default.ins.checkData(t)];case 1:return e.sent(),t=r.default.Instance().getPlayerData(),u.default.Instance().musicEnable=t.getMusicEnable(),u.default.Instance().effectEnable=t.getEffectEnable(),u.default.Instance().vibrate=t.getVibrate(),r.default.Instance().SaveToCache(),[2]}})})},e.prototype.loadAccountInfo=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return console.log("\u83b7\u53d6\u8d26\u53f7\u4fe1\u606floadAccountInfo"),this.canUp=!1,o.Global.sdkMgr.init(),this.loadFomatCfg(),o.Global.umSDK.send(h.EnumDefine.fieldName.loading_start),o.Global.umSDK.send(h.EnumDefine.fieldName.going_game,{lv:r.default.Instance().getPlayerData().getMaxLevel()}),o.Global.localTime=c.default.getTimestamp(),[4,this.getServerTime()];case 1:return t=e.sent(),o.Global.TbTime=t,this.nowToday(t),s.default.Instance().initTaskList(),s.default.Instance().onTaskMgr(),o.Global.guideMgr.init(),o.Global.languageMgr.init(),o.Global.onlineRewardMgr.init(),o.Global.talentMgr.init(),o.Global.talentSkillMgr.init(),o.Global.redDotMgr.init(),[2]}})})},e.prototype.getServerTime=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2,new Promise(function(t){t(Math.floor(Date.now()/1e3))})]})})},e.prototype.loadFomatCfg=function(){var t=this;o.Global.sdkMgr.getOption(function(e){o.Global.sdkMgr.allOptions=JSON.parse(e.responseText),console.log("allOptions:",o.Global.sdkMgr.allOptions),console.log("\u5f53\u524d\u573a\u666f\u503c\uff1a"+o.Global.sdkMgr.curSdk.scene),1==o.Global.sdkMgr.isHide()?(o.Global.sdkMgr.curSdk.option.view=o.Global.sdkMgr.allOptions.view.hide,o.Global.sdkMgr.curSdk.option.inter=o.Global.sdkMgr.allOptions.inter.hide,o.Global.sdkMgr.curSdk.option.costom=o.Global.sdkMgr.allOptions.costom.hide,o.Global.sdkMgr.curSdk.option.parameter=o.Global.sdkMgr.allOptions.parameter,o.Global.sdkMgr.curSdk.option.shop=o.Global.sdkMgr.allOptions.shop,console.log("hide\u7248\u672c\uff1a",o.Global.sdkMgr.curSdk.option)):(o.Global.sdkMgr.curSdk.option.view=o.Global.sdkMgr.allOptions.view.unHide,o.Global.sdkMgr.curSdk.option.inter=o.Global.sdkMgr.allOptions.inter.unHide,o.Global.sdkMgr.curSdk.option.costom=o.Global.sdkMgr.allOptions.costom.unHide,o.Global.sdkMgr.curSdk.option.parameter=o.Global.sdkMgr.allOptions.parameter,o.Global.sdkMgr.curSdk.option.shop=o.Global.sdkMgr.allOptions.shop,console.log("unHide\u7248\u672c\uff1a",o.Global.sdkMgr.curSdk.option)),t.canUp&&(t.canUp=!1,t.setUp())})},e.prototype.setUp=function(){var t=cfgTable.commonData.zombieadnumber,e=cfgTable.commonData.legendsadnumber,i=o.Global.sdkMgr.curSdk.option.parameter;i&&(i.zombieadnumber||0==i.zombieadnumber)&&-1!=i.zombieadnumber&&(t=i.zombieadnumber),i&&(i.legendsadnumber||0==i.legendsadnumber)&&-1!=i.legendsadnumber&&(e=i.legendsadnumber);var a=r.default.Instance().getPlayerData();a.setZembieADKays(t,!1),a.setLegendADKays(e,!1)},e.prototype.nowToday=function(t){var e=r.default.Instance().getPlayerData();if(t-e.logTime<1){if(!(Math.floor((e.logTime-t)/1e3)>=864e5))return void e.setLogTime(t);e.setLogTime(0)}var i=t;e.setPerLogin(i),e.getFirstLogin()||e.setFirstLogin(i),o.Global.isDebug&&console.log("\u6d4b\u8bd51",t,e.logTime),t==e.logTime||c.default.isToday(e.logTime)||(o.Global.common.isNewDay=!0,this.canUp=!0,e.setLogTime(t),e.setShowBroadside(!1,!1),e.setMeataAdNum(0),e.resetOnlineTime(),e.resetOnlineRewardIds(),e.getZembieKays()<cfgTable.commonData.zombiekeymax&&e.setZembieKays(cfgTable.commonData.zombiekeymax,!1),e.getZembieKays()<cfgTable.commonData.legendskeymax&&e.setLegendKays(cfgTable.commonData.legendskeymax,!1),this.setUp())},e.prototype.checkIdList=function(){},__decorate([f],e)}(cc.Component));n.default=g,cc._RF.pop()},{}],MainPanel:[function(t,e,i){"use strict";cc._RF.push(e,"d7f4e0E9TdErKpWKZnOXUUL","MainPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.Panel=void 0;var o,s=a("CompBase"),r=a("Global"),l=a("AudioMgr"),c=a("BattleFightMgr"),h=a("ConfigMgr"),d=a("DataMgr"),u=a("EventMgr"),p=a("ResMgr"),f=a("UtilOne"),g=a("typeEnum"),m=cc._decorator,y=m.ccclass,v=m.property;(function(t){t[t.Dungeons=0]="Dungeons",t[t.Upgrades=1]="Upgrades",t[t.Battle=2]="Battle",t[t.Cards=3]="Cards",t[t.Shop=4]="Shop"})(o=n.Panel||(n.Panel={}));var b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.panelRoot=[],e.buttonBtnsRoot=null,e.BattlePanel=null,e.ShopPanel=null,e.DungeonsPanel=null,e.CardsPanel=null,e.UpgradesPanel=null,e.curPanelName=null,e.curShopPanelName=null,e.btnChangeColor=[],e.coin=null,e.coinLogo=null,e.diamond=null,e.jiantou=null,e.btnBroadside=null,e.nameList=["\u5730\u7262","\u5347\u7ea7","\u6218\u6597","\u5361\u724c","\u5546\u5e97"],e.data=null,e.index=2,e.cardsPanelIndex=0,e}return __extends(e,t),e.prototype.onLoad=function(){r.Global.umSDK.send(g.EnumDefine.fieldName.loading_end,{lv:d.default.Instance().getPlayerData().getMaxLevel()}),this.cion_icon=this.findElement("content/top/root/cion_icon"),this.diamond_icon=this.findElement("content/top/root/diamond_icon"),this.data=d.default.Instance().getPlayerData(),this.cion_icon.on("click",function(){r.Global.isDebug&&u.default.Instance().emitShowPanel({prefab:"prefab/MainPanel/UIGMPlan"})},this),r.Global.guideMgr.mainPanelContent=this.findElement("content"),this.nameList=[r.Global.languageMgr.getText(900001),r.Global.languageMgr.getText(911001),r.Global.languageMgr.getText(920001),r.Global.languageMgr.getText(933001),r.Global.languageMgr.getText(940001)],this.addEvent(),this.btnShow(),this.initShop(),this.initGuide(),this.coinChange(),this.diamondChange(),this.render()},e.prototype.addEvent=function(){this.addClick(this.btnBroadside),u.default.Instance().onCardsChange(this.cardsPanelChange,this),u.default.Instance().onUpdateMainPanelTitle(this.updateTitle,this),u.default.Instance().onGuideChange(this.initGuide,this),u.default.Instance().onRefreshUpgrad(this.initShop,this),u.default.Instance().onCoinChange(this.coinChange,this),u.default.Instance().onDiamondChange(this.diamondChange,this),u.default.Instance().onPassInfo(this.render,this)},e.prototype.coinChange=function(t){void 0===t&&(t=0),this.coin.string=t?""+f.default.ChangeNumberUnit(t):""+d.default.Instance().getPlayerData().getUserCoinStr()},e.prototype.diamondChange=function(t){void 0===t&&(t=0),this.diamond.string=t?""+f.default.ChangeNumberUnit(t):""+d.default.Instance().getPlayerData().getDiamondStr()},e.prototype.onClick=function(t){switch(t.target){case this.btnBroadside:u.default.Instance().emitShowPanel({data:1,prefab:"prefab/MainPanel/UIBroadside"})}},e.prototype.render=function(){var t=d.default.Instance().getPlayerData().getPassInfo(),e=this.buttonBtnsRoot.children;e[0].getChildByName("suoding").active=t.passLevelId!=cfgTable.commonData.holeopen,e[1].getChildByName("suoding").active=t.passCount<cfgTable.commonData.levelipen,e[3].getChildByName("suoding").active=t.passCount<cfgTable.commonData.cardopen,e[4].getChildByName("suoding").active=t.passCount<cfgTable.commonData.shopopen},e.prototype.onEnable=function(){u.default.Instance().onOverToMain(this.overToMain,this),u.default.Instance().onGetBroadsideAward(this.getBroadAward,this),u.default.Instance().onCoinFlyEffect(this.flyCoinEffect,this),u.default.Instance().onflyDiamond(this.flyDiamond,this),u.default.Instance().onflyPotion(this.flyPoint,this),u.default.Instance().onflyTalentPotion(this.flyTalentPoint,this),u.default.Instance().onflyZembieKey(this.flyZembieKey,this),u.default.Instance().onflyLegendKey(this.flyLegendKey,this),u.default.Instance().onflyBossKey(this.flyBossKey,this)},e.prototype.hideAll=function(){var t=this;this.panelRoot.forEach(function(t){t.active=!1}),this.buttonBtnsRoot.children.forEach(function(e){var i=e.getChildByName("bg"),a=e.getChildByName("icon"),n=e.getChildByName("redDot");i.height>=107&&(cc.tween(a).to(.1,{y:20},{easing:"smooth"}).start(),cc.tween(n).to(.1,{y:20},{easing:"smooth"}).start(),cc.tween(i).to(.1,{height:96},{easing:"smooth"}).call(function(){i.getComponent(cc.Sprite).spriteFrame=t.btnChangeColor[0]}).start())})},e.prototype.openPanel=function(t){if(this.btnBroadside.active=o.Battle==t,this.panelRoot[t].childrenCount>0)this.panelRoot[t].active=!0;else{var e="";switch(t){case o.Dungeons:e="prefab/Dungeons/DungeonsPanel";break;case o.Upgrades:e="prefab/MainPanel/UpgradesPanel",r.Global.common.checkSubscribe(),r.Global.guideMgr.changeGuideStep(g.GuideStep.ClickUpgradesPanel,g.GuideStep.UpgradeOutputFoodSpeed);break;case o.Battle:e="prefab/MainPanel/BattlePanel",this.btnBroadside.active=!0;break;case o.Cards:e="prefab/MainPanel/CardsPanel";break;case o.Shop:e="prefab/MainPanel/ShopPanel"}var i=p.default.Instance().getRes("res",e),a=cc.instantiate(i);this.panelRoot[t].addChild(a)}},e.prototype.initPanel=function(){for(var t=this,e=function(e){var a=i.buttonBtnsRoot.children[e];if(a.on("click",function(){if(t.index!=e)if(a.getChildByName("suoding").active){var i="";switch(e){case 0:var n=h.default.Instance().getTableValue("battle",cfgTable.commonData.holeopen,cfgTable.levelData);i=r.Global.languageMgr.getText(918001).replace("{0}",n.evolution.toString());break;case 1:i=r.Global.languageMgr.getText(918002).replace("{0}",cfgTable.commonData.levelipen.toString());break;case 3:i=r.Global.languageMgr.getText(918002).replace("{0}",cfgTable.commonData.cardopen.toString());break;case 4:i=r.Global.languageMgr.getText(918002).replace("{0}",cfgTable.commonData.shopopen.toString())}""!=i&&u.default.Instance().emitTips(i)}else{t.data.getGuideStep()==g.GuideStep.ClickCard&&t.data.getPassInfo().passCount>=cfgTable.commonData.cardopen?r.Global.guideMgr.changeGuideStep(g.GuideStep.ClickCard,g.GuideStep.ClickDrawCard):t.data.getGuideStep()==g.GuideStep.SkillClickCards&&r.Global.guideMgr.changeGuideStep(g.GuideStep.SkillClickCards,g.GuideStep.SkillClickCardsSkillBtn),t.hideAll();var o=a.getChildByName("bg"),s=a.getChildByName("icon"),l=a.getChildByName("redDot");cc.tween(s).to(.1,{y:40},{easing:"smooth"}).start(),cc.tween(l).to(.1,{y:40},{easing:"smooth"}).start(),cc.tween(o).to(.1,{height:107},{easing:"smooth"}).call(function(){o.getComponent(cc.Sprite).spriteFrame=t.btnChangeColor[1]}).start(),t.panelRoot[e].active=!0;var c=[t.nameList[e]],d=g.MainPanelTitleType.ShowText;if(3==e)switch(t.cardsPanelIndex){case g.CardsPanelInterfaceType.card:var p=t.data.getCardIdList().length+"/"+Object.getOwnPropertyNames(cfgTable.cardData).length;c.push(p),d=g.MainPanelTitleType.ShowTextAndNum;break;case g.CardsPanelInterfaceType.skill:c[0]=r.Global.languageMgr.getText(933112),i=t.data.getSkillIdList().length+"/"+Object.getOwnPropertyNames(cfgTable.cardskillData).length,c.push(i),d=g.MainPanelTitleType.ShowTextAndNum}t.updateTitle(c,d),t.openPanel(e),t.index=e,u.default.Instance().emitHideTips()}}),e==o.Battle)return"continue"},i=this,a=0;a<this.buttonBtnsRoot.childrenCount;++a)e(a);this.openPanel(o.Battle),this.curShopPanelName.node.active=!1,this.curPanelName.node.active=!0,this.curPanelName.string=this.nameList[2],this.buttonBtnsRoot.children[2].getChildByName("bg").getComponent(cc.Sprite).spriteFrame=this.btnChangeColor[1],this.buttonBtnsRoot.children[2].getChildByName("icon").setPosition(0,40)},e.prototype.start=function(){this.initPanel()},e.prototype.overToMain=function(){this.jiantou.active=this.data.getGuideList(0)&&!this.data.getGuideList(1),this.data.getGuideStep()==g.GuideStep.ClickUpgradesPanel&&r.Global.guideMgr.showGuidePanel(this.node,this.findElement("content/buttonRoot",cc.Node)),this.data.getGuideStep()==g.GuideStep.ClickCard&&this.data.getPassInfo().passCount>=cfgTable.commonData.cardopen&&r.Global.guideMgr.showGuidePanel(this.node,this.findElement("content/buttonRoot",cc.Node))},e.prototype.getBroadAward=function(){r.Global.dataMgr.getPlayerData().setShowBroadside(!0),this.btnShow(),r.Global.common.flyProp(this.node,g.CurrencyType.Diamond,25)},e.prototype.flyCoinEffect=function(t){var e=this.cion_icon.convertToWorldSpaceAR(cc.v3(0,0)),i=t.beginPos.convertToWorldSpaceAR(cc.v3(0,0));c.default.Instance().coinChange=!0,u.default.Instance().emitCoinEffect(i,e,function(e){l.default.Instance().playEffect(21),t.callBack&&t.callBack(e)},g.AnimType.Circular,1,function(e){t.allCallBack&&t.allCallBack(e)})},e.prototype.flyDiamond=function(t){var e=this.diamond_icon.convertToWorldSpaceAR(cc.v3(0,0)),i=t.beginPos.convertToWorldSpaceAR(cc.v3(0,0));c.default.Instance().coinChange=!0,u.default.Instance().emitDiamondEffect(i,e,function(e){l.default.Instance().playEffect(21),t.callBack&&t.callBack(e)},g.AnimType.Circular,2,function(e){t.allCallBack&&t.allCallBack(e)})},e.prototype.flyPoint=function(t){var e=this.buttonBtnsRoot.children[3].convertToWorldSpaceAR(cc.v3(0,0)),i=t.beginPos.convertToWorldSpaceAR(cc.v3(0,0));c.default.Instance().coinChange=!0,u.default.Instance().emitPotionEffect(i,e,function(e){l.default.Instance().playEffect(21),t.callBack&&t.callBack(e)},g.AnimType.Circular,3,function(e){t.allCallBack&&t.allCallBack(e)})},e.prototype.flyTalentPoint=function(t){var e=this.buttonBtnsRoot.children[3].convertToWorldSpaceAR(cc.v3(0,0)),i=t.beginPos.convertToWorldSpaceAR(cc.v3(0,0));c.default.Instance().coinChange=!0,u.default.Instance().emitTalentPotionEffect(i,e,function(e){l.default.Instance().playEffect(21),t.callBack&&t.callBack(e)},g.AnimType.Circular,4,function(e){t.allCallBack&&t.allCallBack(e)})},e.prototype.flyZembieKey=function(t){var e=this.buttonBtnsRoot.children[0].convertToWorldSpaceAR(cc.v3(0,0)),i=t.beginPos.convertToWorldSpaceAR(cc.v3(0,0));c.default.Instance().coinChange=!0,u.default.Instance().emitZembieKeyEffect(i,e,function(e){l.default.Instance().playEffect(21),t.callBack&&t.callBack(e)},g.AnimType.Circular,g.CurrencyType.ZembieKey,function(e){t.allCallBack&&t.allCallBack(e)})},e.prototype.flyLegendKey=function(t){var e=this.buttonBtnsRoot.children[0].convertToWorldSpaceAR(cc.v3(0,0)),i=t.beginPos.convertToWorldSpaceAR(cc.v3(0,0));c.default.Instance().coinChange=!0,u.default.Instance().emitLegendKeyEffect(i,e,function(e){l.default.Instance().playEffect(21),t.callBack&&t.callBack(e)},g.AnimType.Circular,g.CurrencyType.LegendKey,function(e){t.allCallBack&&t.allCallBack(e)})},e.prototype.flyBossKey=function(t){var e=this.buttonBtnsRoot.children[0].convertToWorldSpaceAR(cc.v3(0,0)),i=t.beginPos.convertToWorldSpaceAR(cc.v3(0,0));c.default.Instance().coinChange=!0,u.default.Instance().emitBossKeyEffect(i,e,function(e){l.default.Instance().playEffect(21),t.callBack&&t.callBack(e)},g.AnimType.Circular,g.CurrencyType.BossKey,function(e){t.allCallBack&&t.allCallBack(e)})},e.prototype.btnShow=function(){var t=cc.sys.platform==cc.sys.BYTEDANCE_GAME,e=!r.Global.dataMgr.getPlayerData().getShowBroadside();this.btnBroadside.active=!(!t||!e)},e.prototype.updateTitle=function(t,e){e==g.MainPanelTitleType.ShowText?(this.curShopPanelName.node.active=!1,this.curPanelName.node.active=!0,this.curPanelName.string=t[0]):e==g.MainPanelTitleType.ShowTextAndNum&&(this.curShopPanelName.node.active=!0,this.curPanelName.node.active=!1,this.curShopPanelName.string=t[0],this.curShopPanelName.node.getChildByName("count").getComponent(cc.Label).string=t[1])},e.prototype.cardsPanelChange=function(t){this.cardsPanelIndex=t},e.prototype.initShop=function(){var t=cfgTable.shopData,e=d.default.Instance().getPlayerData();for(var i in t)if(t[i].rewardType==g.CurrencyType.Potion&&e.getTimeLine()>=cfgTable.commonData.cardsFeatureOpen[1]){var a=0;e.setAdmaxList({ID:t[i].ID,max:0,endTime:a})}else t[i].rewardType==g.CurrencyType.Diamond?(a=0,e.setAdmaxList({ID:t[i].ID,max:0,endTime:a})):t[i].rewardType==g.CurrencyType.Coin?(a=0,e.setAdmaxList({ID:t[i].ID,max:0,endTime:a})):t[i].rewardType==g.CurrencyType.Talent&&e.getTimeLine()>=cfgTable.commonData.cardsFeatureOpen[2]?(a=0,e.setAdmaxList({ID:t[i].ID,max:0,endTime:a})):t[i].rewardType==g.CurrencyType.ZembieKey&&e.getTimeLine()>=Number(cfgTable.dungeonsopenData[1].open[1])?(a=0,e.setAdmaxList({ID:t[i].ID,max:0,endTime:a})):t[i].rewardType==g.CurrencyType.LegendKey&&e.getTimeLine()>=Number(cfgTable.dungeonsopenData[2].open[1])?(a=0,e.setAdmaxList({ID:t[i].ID,max:0,endTime:a})):t[i].rewardType==g.CurrencyType.BossKey&&e.getTimeLine()>=Number(cfgTable.dungeonsopenData[3].open[1])&&(a=0,e.setAdmaxList({ID:t[i].ID,max:0,endTime:a}))},e.prototype.initGuide=function(){this.data.getGuideStep()==g.GuideStep.StartFight&&r.Global.guideMgr.showGuidePanel(this.node),this.data.getGuideStep()==g.GuideStep.ClickUpgradesPanel&&r.Global.guideMgr.showGuidePanel(this.node,this.findElement("content/buttonRoot",cc.Node)),this.data.getGuideStep()==g.GuideStep.ClickCard&&this.data.getPassInfo().passCount>=cfgTable.commonData.cardopen&&r.Global.guideMgr.showGuidePanel(this.node,this.findElement("content/buttonRoot",cc.Node)),(this.data.getGuideStep()==g.GuideStep.Complete||this.data.getGuideStep()==g.GuideStep.SkillClickCards)&&this.data.getTimeLine()>=3&&(this.data.setGuideStep(g.GuideStep.SkillClickCards),r.Global.guideMgr.showGuidePanel(this.node,this.findElement("content/buttonRoot",cc.Node)),d.default.Instance().getPlayerData().setRedDot(g.RedDotId.CardsPanlBtn,!0),d.default.Instance().getPlayerData().setRedDot(g.RedDotId.CardsPanelSkillBtn,!0))},__decorate([v({type:cc.Node,displayName:"\u9762\u677f\u754c\u9762"})],e.prototype,"panelRoot",void 0),__decorate([v({type:cc.Node,displayName:"\u5e95\u90e8\u6309\u94ae\u7236\u8282\u70b9"})],e.prototype,"buttonBtnsRoot",void 0),__decorate([v({type:cc.Prefab,displayName:"\u6218\u6597\u754c\u9762"})],e.prototype,"BattlePanel",void 0),__decorate([v({type:cc.Prefab,displayName:"\u5546\u5e97\u754c\u9762"})],e.prototype,"ShopPanel",void 0),__decorate([v({type:cc.Prefab,displayName:"\u6d1e\u7a74\u754c\u9762"})],e.prototype,"DungeonsPanel",void 0),__decorate([v({type:cc.Prefab,displayName:"\u5361\u724c\u754c\u9762"})],e.prototype,"CardsPanel",void 0),__decorate([v({type:cc.Prefab,displayName:"\u5347\u7ea7\u754c\u9762"})],e.prototype,"UpgradesPanel",void 0),__decorate([v({type:cc.Label,displayName:"\u5f53\u524d\u754c\u9762\u540d\u79f0"})],e.prototype,"curPanelName",void 0),__decorate([v({type:cc.Label,displayName:"\u5f53\u524d\u754c\u9762\u540d\u5b57\uff0c\u5546\u5e97\u7279\u6b8a\u663e\u793a"})],e.prototype,"curShopPanelName",void 0),__decorate([v({type:cc.SpriteFrame,displayName:"\u6309\u94ae\u6362\u8272"})],e.prototype,"btnChangeColor",void 0),__decorate([v({type:cc.Label,displayName:"\u91d1\u5e01"})],e.prototype,"coin",void 0),__decorate([v({type:cc.Node,displayName:"\u91d1\u5e01logo"})],e.prototype,"coinLogo",void 0),__decorate([v({type:cc.Label,displayName:"\u94bb\u77f3"})],e.prototype,"diamond",void 0),__decorate([v(cc.Node)],e.prototype,"jiantou",void 0),__decorate([v(cc.Node)],e.prototype,"btnBroadside",void 0),__decorate([y],e)}(s.default);n.default=b,cc._RF.pop()},{}],Maths:[function(t,e,i){"use strict";cc._RF.push(e,"449c4rFu1NAZZIF/82Cbv6T","Maths");var a=i;Object.defineProperty(a,"__esModule",{value:!0}),a.Maths=void 0;var n=function(){function t(){}return t.isRange=function(t,e,i){return Math.abs(t-e)<=i},t.isEven=function(t){return t%2==0},t.toRadian=function(e){return e*t._d2r},t.decimal=function(t){return t-Math.floor(t)},t.toDegree=function(e,i){return void 0===i&&(i=!0),null==e?0:(i&&(e=this.normalizeAngle(e)),e*t._r2d)},t.normalizeAngle=function(e){return(e%=2*t.PI)<0&&(e+=2*t.PI),e},t.lerp=function(t,e,i){return t+(e-t)*i},t.clamp01=function(t){return t<0?0:t<1?t:1},t.clampf=function(t,e,i){if(e>i){var a=e;e=i,i=a}return t<e?e:t<i?t:i},t.isClampf=function(t,e,i){if(e>i){var a=e;e=i,i=a}return t<=i&&t>=e},t.isRandom=function(t){return!!t&&(t>=1||!(t<=0)&&t>Math.random())},t.minToMax=function(t,e,i){return void 0===i&&(i=!0),t==e?t:t<0?i?Math.round(Math.random()*(Math.abs(t)+e))+t:Math.random()*(Math.abs(t)+e)+t:i?Math.round(Math.random()*(e-t))+t:Math.random()*(e-t)+t},t.zeroToMax=function(t){if(t<=1)return 0;var e=Math.random();return Math.floor((1==e?.5:e)*t)},t.toFixed=function(t,e){var i=Math.pow(10,e);return Math.floor(t*i)/i},t.arrAdd=function(t){for(var e=0,i=0,a=t;i<a.length;i++)e+=a[i];return e},t.findNumSection=function(t,e,i,a){void 0===a&&(a=!1),i||(i={i:0,count:0}),i.i=t.length,i.count=0;for(var n=0;n<t.length;n++)if(i.count+=t[n],a){if(e<=i.count)return i.i=n,i}else if(e<i.count)return i.i=n,i;return i},t.widgetRandom=function(t){for(var e=this.arrAdd(t),i=0,a=this.zeroToMax(e-1),n=0;n<t.length;n++){var o=t[n];if(a>=i&&a<i+o)return n;i+=o}return t.length-1},t.PI=Math.PI,t._d2r=t.PI/180,t._r2d=180/t.PI,t}();a.Maths=n,cc._RF.pop()},{}],OPPOSDK:[function(t,e,i){"use strict";cc._RF.push(e,"07447EulFtEAZzL2uE14XD0","OPPOSDK");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rewardStr=["1368681"],e.rewardNum=0,e.rewardAd=null,e.initedRewardAd=!1,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e)},enumerable:!1,configurable:!0}),e.prototype.init=function(){this.platform=window.qg,this.lifeEvent()},e.prototype.lifeEvent=function(){cc.sys.platform==cc.sys.OPPO_GAME&&(this.platform.onShow(function(){console.log("\u5c0f\u6e38\u620f\u56de\u5230\u524d\u53f0")}),this.platform.onHide(function(){console.log("\u5c0f\u6e38\u620f\u8fdb\u5165\u540e\u53f0")}))},e.prototype.onAuthDialogShow=function(){this.platform.onAuthDialogShow(function(t){console.log("\u767b\u5f55\u6216\u5b9e\u540d\u5f39\u7a97\u5c55\u793a",t)})},e.prototype.onAuthDialogClose=function(){this.platform.onAuthDialogClose(function(t){console.log("\u767b\u5f55\u6216\u5b9e\u540d\u5f39\u7a97\u5173\u95ed",t)})},e.prototype.openAd=function(t,e,i){var a=this;void 0===e&&(e=null),void 0===i&&(i=null);var n=this.rewardStr[this.rewardNum];this.rewardAd||(this.rewardAd=this.platform.createRewardedVideoAd({adUnitId:n}),this.rewardAd.onLoad(function(t){"localAdVideo"===t?console.log("\u6fc0\u52b1\u89c6\u9891 \u515c\u5e95\u5e7f\u544a-onload\u89e6\u53d1 ",t):console.log("\u6fc0\u52b1\u89c6\u9891\u5e7f\u544a\u52a0\u8f7d\u5b8c\u6210-onload\u89e6\u53d1 ",t)})),this.rewardAd.onClose(function e(n){console.log("rewardAd onClose",n),t&&(cc.game.resume(),n.isEnded?t():i&&i()),a.rewardAd.offClose(e)}),this.rewardAd.onError(function n(o){a.rewardAd.offError(n),a.rewardNum+=1,a.initedRewardAd=!1,console.log("err",o),a.rewardAd&&a.rewardAd.destroy().then(function(){if(a.rewardAd=null,a.rewardNum>a.rewardStr.length-1)return cc.game.resume(),e&&e(),void a.rewardNum;a.openAd(t,e,i)}).catch(function(){a.rewardAd=null})}),this.initedRewardAd?(console.log("\u76f4\u63a5\u663e\u793a\u6fc0\u52b1\u5e7f\u544a"),this.rewardAd.show().then(function(){a.platform.hideLoading({}),console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u6210\u529f")}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u5931\u8d25"),e&&e(t)})):this.rewardAd.load().then(function(){console.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u6210\u529f"),a.rewardAd.show().then(function(){a.platform.hideLoading({}),console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u6210\u529f"),a.initedRewardAd=!0}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u5931\u8d25"),e&&e(t)})}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u5931\u8d25"),e&&e(t)})},e.prototype.closeGame=function(){this.platform.exitApplication()},e}(a("SDKBase").default);n.default=o,cc._RF.pop()},{}],Observer:[function(t,e,i){"use strict";cc._RF.push(e,"9f6b4j0o3NDEIg3DIoKvac4","Observer");var a=i;Object.defineProperty(a,"__esModule",{value:!0}),a.EGameEvent=void 0,function(t){t.STOP_SKILL="STOP_SKILL",t.SAVE_END="SAVE_END",t.UPGRADE_EQUIP="UPGRADE_EQUIP",t.CHANGE_EQUIP_SLOT="CHANGE_EQUIP_SLOT",t.CHANGE_HERO_SLOT="CHANGE_HERO_SLOT",t.NEW_HERO="NEW_HERO"}(a.EGameEvent||(a.EGameEvent={}));var n=function(){function t(){this.event=new cc.EventTarget}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.watch=function(t,e,i){this.event.on(t,e,i)},t.prototype.notice=function(t){for(var e,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];(e=this.event).emit.apply(e,__spreadArrays([t],i))},t.prototype.remove=function(t,e,i){this.event.off(t,e,i)},t}();a.default=n,cc._RF.pop()},{}],OnlineRewardBtnScript:[function(t,e,i){"use strict";cc._RF.push(e,"ea90awaToVLaKynbfInjg1J","OnlineRewardBtnScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("DataMgr"),r=a("EventMgr"),l=a("typeEnum"),c=cc._decorator,h=c.ccclass,d=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.redDot=null,e.timeLabel=null,e.playAnimationing=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.init(),this.changeBtnSate()},e.prototype.start=function(){},e.prototype.update=function(){if(this.nextOnlineRewardInfo){var t=this.nextOnlineRewardInfo.time-o.Global.onlineRewardMgr.playerOnlineTime;if(t<=0&&!this.playAnimationing?(this.redDot.opacity=255,this.playAnimation()):t>0&&this.playAnimationing&&(this.redDot.opacity=0,this.stopAnimation()),t>=0&&this.timeLabel){var e=this.getTime(t);this.timeLabel.string=e[1]+":"+e[2]}else this.timeLabel.string="00:00"}},e.prototype.init=function(){this.nextOnlineRewardInfo=o.Global.onlineRewardMgr.getNextOnlineRewardInfo(),this.node.on("click",this.openOnlineRewardPanel,this),r.default.Instance().onOnlineRewardIconChange(this.changeBtnSate,this)},e.prototype.openOnlineRewardPanel=function(){r.default.Instance().emitShowPanel({prefab:"prefab/onlineReward/OnlineRewardPanel"})},e.prototype.changeBtnSate=function(){this.nextOnlineRewardInfo=o.Global.onlineRewardMgr.getNextOnlineRewardInfo(),this.redDot.opacity=0,this.stopAnimation();var t=s.default.Instance().getPlayerData().getGuideStep()>l.GuideStep.EvolutionaryAgeResetCoinTips;this.node.opacity=t?255:0,this.timeLabel.node.opacity=this.nextOnlineRewardInfo?255:0},e.prototype.playAnimation=function(){this.playAnimationing=!0,cc.Tween.stopAllByTag(l.TweenTag.OnlineRewardBtn),cc.tween(this.node).repeatForever(cc.tween().to(.15,{angle:10},{easing:"fade"}).to(.15,{angle:-10},{easing:"fade"}).to(.07,{angle:0}).delay(1)).tag(l.TweenTag.OnlineRewardBtn).start()},e.prototype.stopAnimation=function(){this.playAnimationing=!1,cc.Tween.stopAllByTag(l.TweenTag.OnlineRewardBtn),cc.tween(this.node).to(.15,{angle:0},{easing:"fade"}).start()},e.prototype.getTime=function(t){t=t.toString();var e=parseInt((t/60/60%24).toString());e=e<10?"0"+e:e;var i=parseInt((t/60%60).toString());i=i<10?"0"+i:i;var a=parseInt((t%60).toString());return[e,i,a=a<10?"0"+a:a]},__decorate([d(cc.Node)],e.prototype,"redDot",void 0),__decorate([d(cc.Label)],e.prototype,"timeLabel",void 0),__decorate([h],e)}(cc.Component);n.default=u,cc._RF.pop()},{}],OnlineRewardItemScript:[function(t,e,i){"use strict";cc._RF.push(e,"2d00eoAvvlPYaITEoYOPpmE","OnlineRewardItemScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("EventMgr"),r=a("typeEnum"),l=cc._decorator,c=l.ccclass,h=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onlineRewardAtlas=null,e.cfg=null,e.rewardIcon=null,e.rewardLabel=null,e.rewardNumLabel=null,e.rewardBtn=null,e.rewardBtnLabel=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.rewardIcon=cc.find("rewardIcon",this.node).getComponent(cc.Sprite),this.rewardLabel=cc.find("rewardLabel",this.node).getComponent(cc.Label),this.rewardNumLabel=cc.find("rewardNumLabel",this.node).getComponent(cc.Label),this.rewardBtn=cc.find("rewardBtn",this.node).getComponent(cc.Sprite),this.rewardBtnLabel=cc.find("rewardBtn/rewardBtnLabel",this.node).getComponent(cc.Label),this.initUI(),this.updateUI()},e.prototype.initUI=function(){this.rewardLabel.string=o.Global.languageMgr.getText(920302).replace("{0}",(this.cfg.time/60).toString()),this.rewardNumLabel.string="x"+this.cfg.item[1],this.rewardIcon.spriteFrame=this.onlineRewardAtlas.getSpriteFrame(this.cfg.icon)},e.prototype.updateUI=function(){var t=o.Global.onlineRewardMgr.playerData.getOnlineRewardIds();if(o.Global.onlineRewardMgr.playerOnlineTime>=this.cfg.time&&-1==t.indexOf(this.cfg.ID))this.rewardBtn.node.getComponent(cc.Button).enabled=!0,this.rewardBtnLabel.string=o.Global.languageMgr.getText(920303),this.rewardBtn.spriteFrame=this.onlineRewardAtlas.getSpriteFrame("btn_1"),this.rewardBtn.node.on("click",this.getReward,this);else{if(this.rewardBtn.node.getComponent(cc.Button).enabled=!1,-1!=t.indexOf(this.cfg.ID))this.rewardBtnLabel.string=o.Global.languageMgr.getText(920304);else{var e=this.cfg.time-o.Global.onlineRewardMgr.playerOnlineTime,i=this.getTime(e);this.rewardBtnLabel.string=i[1]+":"+i[2]}this.rewardBtn.node.off("click",this.getReward,this),this.rewardBtn.spriteFrame=this.onlineRewardAtlas.getSpriteFrame("btn_2")}},e.prototype.getReward=function(){if(o.Global.onlineRewardMgr.playerOnlineTime>=this.cfg.time){o.Global.onlineRewardMgr.playerData.setOnlineRewardIds(this.cfg.ID,o.Global.onlineRewardMgr.playerOnlineTime),o.Global.umSDK.send(r.EnumDefine.fieldName.online_reward,{rewardid:this.cfg.ID,onlinetime:o.Global.onlineRewardMgr.playerOnlineTime});var t=Number(this.cfg.item[0]),e=Number(this.cfg.item[1]);o.Global.common.flyProp(this.node,t,e),s.default.Instance().emitOnlineRewardIconChange(),this.updateUI()}},e.prototype.start=function(){},e.prototype.getTime=function(t){t=t.toString();var e=parseInt((t/60/60%24).toString());e=e<10?"0"+e:e;var i=parseInt((t/60%60).toString());i=i<10?"0"+i:i;var a=parseInt((t%60).toString());return[e,i,a=a<10?"0"+a:a]},__decorate([h(cc.SpriteAtlas)],e.prototype,"onlineRewardAtlas",void 0),__decorate([c],e)}(cc.Component);n.default=d,cc._RF.pop()},{}],OnlineRewardMgr:[function(t,e,i){"use strict";cc._RF.push(e,"e6b51AOvohClZoDCDUUFek7","OnlineRewardMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("typeEnum"),s=a("UtilOne"),r=a("DataMgr"),l=a("EventMgr"),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.saveIntervalTime=5,e.nowTime=0,e.endTime=0,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e)},enumerable:!1,configurable:!0}),e.prototype.init=function(){this.initData(),this.schedule(this.addPlayerOnlineTime,1),this.schedule(this.nowToday,.5)},e.prototype.initData=function(){this.cfgs=cfgTable.onlinetimeData,this.playerData=r.default.Instance().getPlayerData(),this.playerOnlineTime=this.playerData.getOnlineTime(),this.endTime=s.default.getNextDayMidnightTimestamp(1e3*s.default.getlocalTime())/1e3},e.prototype.addPlayerOnlineTime=function(){this.playerData.getGuideStep()>o.GuideStep.EvolutionaryAgeResetCoinTips&&(this.playerOnlineTime+=1,l.default.Instance().emitonOnlineTimeChange(),this.playerOnlineTime%this.saveIntervalTime==0&&this.playerData.setOnlineTime(this.playerOnlineTime))},e.prototype.getNextOnlineRewardInfo=function(){var t=this.playerData.getOnlineRewardIds();return this.cfgs[t.length+1]},e.prototype.nowToday=function(){this.nowTime=s.default.getlocalTime(),this.endTime-this.nowTime<=0&&(this.playerData.resetOnlineTime(),this.playerData.resetOnlineRewardIds(),this.initData(),l.default.Instance().emitOnlineRewardIconChange())},e}(cc.Component);n.default=c,cc._RF.pop()},{}],OnlineRewardPanel:[function(t,e,i){"use strict";cc._RF.push(e,"014953prR1PJ42L4zbcsluz","OnlineRewardPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("EventMgr"),l=a("OnlineRewardItemScript"),c=cc._decorator,h=c.ccclass,d=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onlineRewardItem=null,e.list=null,e.items=[],e.closeBtn=null,e.isFullScreen=!1,e}return __extends(e,t),e.prototype.onLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return this.list=this.findElement("content/scrollView/view/content",cc.Node),this.closeBtn=this.findElement("closeBtn",cc.Node),this.initBtn(),this.initItem(),r.default.Instance().ononOnlineTimeChange(this.updateCell,this),[2]})})},e.prototype.start=function(){},e.prototype.initBtn=function(){this.closeBtn.on("click",this.closeSelf,this)},e.prototype.initItem=function(){var t=o.Global.onlineRewardMgr.cfgs;for(var e in t){var i=t[e],a=cc.instantiate(this.onlineRewardItem);a.getComponent(l.default).cfg=i,this.list.addChild(a),this.items.push(a)}this.updateCell()},e.prototype.updateCell=function(){for(var t=0,e=this.items;t<e.length;t++)e[t].getComponent(l.default).updateUI()},e.prototype.closeSelf=function(){this.emitCloseMe()},__decorate([d(cc.Prefab)],e.prototype,"onlineRewardItem",void 0),__decorate([h],e)}(s.default);n.default=u,cc._RF.pop()},{}],PanelBase:[function(t,e,i){"use strict";cc._RF.push(e,"0b1f4R6U6hHn7kMNv4s//Bc","PanelBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("CompBase"),s=a("EventMgrBase"),r=cc._decorator,l=r.ccclass,c=(r.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!0,e.panelName="",e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.setPanelName=function(t){this.panelName=t},e.prototype.emitCloseMe=function(){s.default.Instance().emitHidePanel({prefab:this.panelName})},e.prototype.start=function(){},e.prototype.IsFullScreen=function(){return this.isFullScreen},e.prototype.showPanel=function(){},e.prototype.initWithParam=function(){},e.prototype.hidePanel=function(){this.node.destroy()},e.prototype.showEffect=function(){if(!this.isFullScreen){var t=this.node.getChildByName("Panel");t&&(t.scale=0,cc.tween(t).to(.3,{scale:1},{easing:"backOut"}).start())}},__decorate([l],e)}(o.default));n.default=c,cc._RF.pop()},{}],RedDotMgr:[function(t,e,i){"use strict";cc._RF.push(e,"b0277lfmrpMk4aPfloi0uoP","RedDotMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("typeEnum"),r=a("ConfigMgr"),l=a("DataMgr"),c=a("EventMgr"),h=function(){function t(){this.redDotArr=[]}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.init=function(){this.playerData=l.default.Instance().getPlayerData(),this.playerData.addRedDot(),this.redDotArr[s.RedDotId.DungeonsBtn]=[],this.redDotArr[s.RedDotId.UpgradeBtn]=[],this.redDotArr[s.RedDotId.UpgradeBtn][s.RedDotId.UpgradePanelUpgradeBtn]=[s.RedDotId.UpgradePanelUpgradeBtn],this.redDotArr[s.RedDotId.BattleBtn]=[],this.redDotArr[s.RedDotId.CardsPanlBtn]=[],this.redDotArr[s.RedDotId.CardsPanlBtn][s.RedDotId.CardsPanelSkillBtn]=[s.RedDotId.CardsPanelSkillBtn],this.redDotArr[s.RedDotId.CardsPanlBtn][s.RedDotId.CardsPanelTalentBtn]=[s.RedDotId.CardsPanelTalentBtn],this.redDotArr[s.RedDotId.ShopPanelBtn]=[],this.initRedDot(),this.initEvent()},t.prototype.initRedDot=function(){var t=o.Global.dataMgr.getPlayerData(),e=t.getTimeLine(),i=t.getDiamond(),a=t.getPotion(),n=t.getTalentPotion();if(l.default.Instance().getPlayerData().getPassInfo().passLevelId==cfgTable.commonData.holeopen){var r=cfgTable.dungeonsopenData;for(var c in r){var h=r[c];if(1==Number(h.open[0])&&e>=Number(h.open[1])){if(1==h.ID&&(t.getZembieKays()>0||t.getZembieADKays())){o.Global.redDotMgr.changeRedDotState(s.RedDotId.DungeonsBtn,!0);break}if(2==h.ID&&(t.getLegendADKays()>0||t.getLegendKays())){o.Global.redDotMgr.changeRedDotState(s.RedDotId.DungeonsBtn,!0);break}}}}if(t.getPassInfo().passCount>=cfgTable.commonData.cardopen){o.Global.redDotMgr.changeRedDotState(s.RedDotId.CardsPanelSkillBtn,!1),o.Global.redDotMgr.changeRedDotState(s.RedDotId.CardsPanelTalentBtn,!1),o.Global.redDotMgr.changeRedDotState(s.RedDotId.CardsPanlBtn,!1);var d=o.Global.common.allSkillIsMax();e>=cfgTable.commonData.cardsFeatureOpen[1]&&(a>=cfgTable.commonData.skillcostcard||t.getFreeGetSkill())&&!d&&o.Global.redDotMgr.changeRedDotState(s.RedDotId.CardsPanelSkillBtn,!0),e>=cfgTable.commonData.cardsFeatureOpen[2]&&n>=1&&o.Global.talentMgr.getPlayerLevelCount()<o.Global.talentMgr.getCfgLevelCount()&&o.Global.redDotMgr.changeRedDotState(s.RedDotId.CardsPanelTalentBtn,!0),(i>=cfgTable.commonData.costcard||t.getFreeGetCard())&&o.Global.redDotMgr.changeRedDotState(s.RedDotId.CardsPanlBtn,!0)}if(t.getPassInfo().passCount>=cfgTable.commonData.shopopen)for(var u=0,p=t.getAdMaxList();u<p.length;u++){var f=p[u],g=cfgTable.shopData[f.ID];g.costtype==s.CostType.Ad&&f.max<g.admax&&o.Global.redDotMgr.changeRedDotState(s.RedDotId.ShopPanelBtn,!0)}this.initUpgradeRedDot()},t.prototype.initUpgradeRedDot=function(){var t=this.playerData.getUserCoin();if(this.playerData.getPassInfo().passCount>=cfgTable.commonData.levelipen){o.Global.redDotMgr.changeRedDotState(s.RedDotId.UpgradeBtn,!1),o.Global.redDotMgr.changeRedDotState(s.RedDotId.UpgradePanelUpgradeBtn,!1);var e=this.playerData.getMaxLevel();this.satisfyFoodCost()&&o.Global.redDotMgr.changeRedDotState(s.RedDotId.UpgradeBtn,!0),this.satisfyBaseCost()&&o.Global.redDotMgr.changeRedDotState(s.RedDotId.UpgradeBtn,!0),this.satisfyRoleCardCost()&&o.Global.redDotMgr.changeRedDotState(s.RedDotId.UpgradeBtn,!0);var i=e+1,a=cfgTable.evolution=r.default.Instance().getTableValue("ID",i,cfgTable.evolutionData);a&&t>=a.evolutionmoney&&(this.satisfyFoodCost()||this.satisfyBaseCost()||this.satisfyRoleCardCost()?o.Global.redDotMgr.changeRedDotState(s.RedDotId.UpgradePanelUpgradeBtn,!0):o.Global.redDotMgr.changeRedDotState(s.RedDotId.UpgradeBtn,!0)),this.playerData.canTravel&&6==this.playerData.getMaxLevels()&&o.Global.redDotMgr.changeRedDotState(s.RedDotId.UpgradeBtn,!0)}},t.prototype.initEvent=function(){c.default.Instance().onLevelChange(this.hideRedDot,this)},t.prototype.hideRedDot=function(){o.Global.redDotMgr.changeRedDotState(s.RedDotId.UpgradePanelUpgradeBtn,!1)},t.prototype.findAllChildRedDotId=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(Array.isArray(i)&&1==this.playerData.getRedDot(t[e]).isShow)return!0}return!1},t.prototype.satisfyFoodCost=function(){var t=this.playerData.getUserCoin(),e=this.playerData.getMaxLevel(),i=e%6==0?6:e%6,a=this.playerData.getMeatLevel(),n=r.default.Instance().getTableValue("level",a,cfgTable.skillData);return t>=(n["foodcost"+i]||n.foodcost)},t.prototype.satisfyBaseCost=function(){var t=this.playerData.getUserCoin(),e=this.playerData.getMaxLevel(),i=e%6==0?6:e%6,a=this.playerData.getBuildLevel(),n=r.default.Instance().getTableValue("level",a,cfgTable.skillData);return t>=(n["basecost"+i]||n.basecost)},t.prototype.satisfyRoleCardCost=function(){var t=this.playerData.getUserCoin(),e=this.playerData.getMaxLevel(),i=this.playerData.getUnlocked(),a=r.default.Instance().getTableValue("ID",e,cfgTable.evolutionData);if(i.length<3)for(var n=0,o=0,s=a.warriorsid;o<s.length;o++){var l=s[o];if(-1==i.indexOf(l)&&t>=a.warriorsmoney[n])return!0;n++}return!1},t.prototype.changeRedDotState=function(t,e){var i;if(e)(i=this.findRedDotId(this.redDotArr,t))?this.setRedDotState(this.redDotArr,i,e):this.playerData.setRedDot(t,e);else if(this.redDotArr[t]&&this.redDotArr[t].length<=0)this.playerData.setRedDot(t,e);else if(i=this.findRedDotId(this.redDotArr,t)){i.pop();var a=this.redDotArr[i[0]];this.playerData.setRedDot(t,e),!(n=this.findAllChildRedDotId(a))&&this.playerData.setRedDot(i[0],e)}else{for(var n=!1,o=0,s=a=this.redDotArr[t];o<s.length;o++){var r=s[o];r&&this.playerData.getRedDot(r).isShow&&(n=!0)}!n&&this.playerData.setRedDot(t,e)}},t.prototype.findRedDotId=function(t,e){for(var i=0;i<t.length;i++){var a=t[i];if(Array.isArray(a)){var n=this.findRedDotId(a,e);if(null!==n)return[i].concat(n)}else if(a==e)return[]}return null},t.prototype.setRedDotState=function(t,e,i){for(var a=0,n=e;a<n.length;a++){var o=n[a],s=t[o];if(!s)return;if(this.playerData.setRedDot(o,i),Array.isArray(s)){var r=e.slice(1);this.setRedDotState(s,r,i)}}},t}();n.default=h,cc._RF.pop()},{}],RedDotScript:[function(t,e,i){"use strict";cc._RF.push(e,"61ed0W0ZYZHNKAwM0ICau5e","RedDotScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("DataMgr"),r=a("EventMgr"),l=cc._decorator,c=l.ccclass,h=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id=0,e}return __extends(e,t),e.prototype.onLoad=function(){this.playerData=s.default.Instance().getPlayerData(),this.initUI(this.id),this.initEvent()},e.prototype.initUI=function(t){t==this.id&&(this.redDotData=this.playerData.getRedDot(this.id),this.node.active=this.redDotData.isShow)},e.prototype.initEvent=function(){r.default.Instance().onRefreshRedDot(this.initUI,this),this.node.parent&&this.node.parent.on(cc.Node.EventType.TOUCH_START,this.hideRedDotState,this)},e.prototype.hideRedDotState=function(){o.Global.redDotMgr.changeRedDotState(this.id,!1)},__decorate([h()],e.prototype,"id",void 0),__decorate([c],e)}(cc.Component);n.default=d,cc._RF.pop()},{}],ResMgr:[function(t,e,i){"use strict";cc._RF.push(e,"b414aVEXeBDUIQWfFfkcp/I","ResMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.PreloadConf=n.AssetsType=void 0;var o,s=a("Global"),r=a("Singleton");(function(t){t[t.ATText=0]="ATText",t[t.ATImage=1]="ATImage",t[t.ATPrefab=2]="ATPrefab",t[t.ATAudio=3]="ATAudio",t[t.ATAtlas=4]="ATAtlas",t[t.ATSpine=5]="ATSpine"})(o=n.AssetsType||(n.AssetsType={}));var l=function(){function t(){this.BundleName="",this.displayName="",this.files={},this.prefiles={},this.filesLinshi=[]}return t.prototype.Init=function(t,e){this.BundleName=t,this.displayName=e},t.prototype.AddLoadFiles=function(t,e){if(this.files[t]&&0!=this.files[t].length)for(var i in e){var a=!1;for(var n in this.files[t])if(this.files[t][n]==e[i]){a=!0;break}a||this.files[t].push(e[i])}else this.files[t]=e},t.prototype.AddPreloadFiles=function(t,e){if(this.prefiles[t]&&0!=this.prefiles[t].length)for(var i in e){var a=!1;for(var n in this.prefiles[t])if(this.prefiles[t][n]==e[i]){a=!0;break}a||this.prefiles[t].push(e[i])}else this.prefiles[t]=e},t.prototype.Release=function(){this.bundleObj&&(console.log("\u91ca\u653e\u8d44\u6e90"+this.bundleObj.name),this.bundleObj.releaseAll())},t.prototype.getBundleName=function(){return this.BundleName},t.prototype.getDisplayName=function(){return this.displayName},t.prototype.getFileList=function(){return this.files},t.prototype.getpreFileList=function(){return this.prefiles},t.prototype.setBundle=function(t){this.bundleObj=t},t.prototype.getRes=function(t,e){return e||(e=cc.Asset),this.bundleObj.get(t,e)},t.prototype.getBundle=function(){return this.bundleObj},t.prototype.addResToLingshi=function(t){this.filesLinshi.push(t)},t.prototype.checkResInLingshi=function(t){return this.filesLinshi.indexOf(t)>=0},t.prototype.clearLingshi=function(){if(this.bundleObj){for(var t in this.filesLinshi)this.bundleObj.release(this.filesLinshi[t]);this.filesLinshi=[]}},t.prototype.clearAppointRes=function(t){if(this.bundleObj)for(var e in this.filesLinshi)this.filesLinshi[e]==t&&(this.bundleObj.release(this.filesLinshi[e]),this.filesLinshi.splice(Number(e),1))},t}();n.PreloadConf=l;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bundleCache={},e.LoadingPrefab=null,e.sideGamebundles=[],e.sideGamePrefab=[],e}return __extends(e,t),e.prototype.loadBundle=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(){return[2,new Promise(function(i){cc.assetManager.loadBundle(t,function(a,n){a?console.error("\u52a0\u8f7dbundle:"+t+" \u9519\u8bef:"+a):(e.bundleCache[t]||(e.bundleCache[t]=new l,e.bundleCache[t].Init(t,t)),e.bundleCache[t].setBundle(n),i(null))})})]})})},e.prototype.loadBundleSync=function(t,e){var i=this;cc.assetManager.loadBundle(t,function(a,n){var o;a?console.error("\u52a0\u8f7dbundle:"+t+" \u9519\u8bef:"+a):(null===(o=i.bundleCache[t])||void 0===o||o.setBundle(n),e&&e(n))})},e.prototype.loadRes=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,a,n,s,r;return __generator(this,function(l){switch(l.label){case 0:return this.bundleCache[t.getBundleName()]?[3,2]:(this.bundleCache[t.getBundleName()]=t,[4,this.loadBundle(t.getBundleName())]);case 1:l.sent(),l.label=2;case 2:for(s in i=0,a=0,n=t.getFileList())i+=n[s].length;return console.log(this.bundleCache[t.getBundleName()]),(r=this.bundleCache[t.getBundleName()].getBundle())||console.error("\u627e\u4e0d\u5230bundle\u5bf9\u8c61!",t.getBundleName()),[2,new Promise(function(s){for(var l in n){var c;switch(parseInt(l)){case o.ATText:c=cc.TextAsset;break;case o.ATPrefab:c=cc.Prefab;break;case o.ATImage:c=cc.Texture2D;break;case o.ATAudio:c=cc.AudioClip;break;case o.ATAtlas:c=cc.SpriteAtlas;break;case o.ATSpine:c=sp.SkeletonData}for(var h in n[l])(function(n){r.load(n,c,function(o){o?console.error(t.getBundleName()+">\u52a0\u8f7d\u8d44\u6e90\u9519\u8bef:"+n):console.log("loadRes\u52a0\u8f7d\u6210\u529f: "+n),a++,e&&e(a,i),a>=i&&s({})})})(n[l][h])}})]}})})},e.prototype.preloadRes=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,a,n,s,r;return __generator(this,function(l){switch(l.label){case 0:return this.bundleCache[t.getBundleName()]?[3,2]:(this.bundleCache[t.getBundleName()]=t,[4,this.loadBundle(t.getBundleName())]);case 1:l.sent(),l.label=2;case 2:for(s in i=0,a=0,n=t.getpreFileList())i+=n[s].length;return(r=this.bundleCache[t.getBundleName()].getBundle())||console.error("\u627e\u4e0d\u5230bundle\u5bf9\u8c61!",t.getBundleName()),[2,new Promise(function(s){for(var l in n){var c;switch(parseInt(l)){case o.ATText:c=cc.TextAsset;break;case o.ATPrefab:c=cc.Prefab;break;case o.ATImage:c=cc.Texture2D;break;case o.ATAudio:c=cc.AudioClip;break;case o.ATAtlas:c=cc.SpriteAtlas;break;case o.ATSpine:c=sp.SkeletonData}for(var h in n[l])(function(n){r.preload(n,c,function(o){o?console.error(t.getBundleName()+">\u52a0\u8f7d\u8d44\u6e90\u9519\u8bef:"+n):console.log("preloadRes\u52a0\u8f7d\u6210\u529f: "+n),a++,e&&e(a,i),a>=i&&s({})})})(n[l][h])}})]}})})},e.prototype.getRes=function(t,e,i){var a=this.bundleCache[t];return a?a.getRes(e,i):null},e.prototype.releaseRes=function(t){var e=this.bundleCache[t];e&&e.Release()},e.prototype.loadAndGetRes=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var a,n=this;return __generator(this,function(o){switch(o.label){case 0:return this.bundleCache[t]?[3,2]:[4,this.loadBundle(t)];case 1:o.sent(),o.label=2;case 2:return this.bundleCache[t].checkResInLingshi(e)?[2,this.getRes(t,e,i)]:(a=null,[4,new Promise(function(o){n.bundleCache[t].getBundle().load(e,null!=i?i:cc.Asset,function(i,n){i&&console.error("\u52a0\u8f7d\u8d44\u6e90\u9519\u8bef:",t,e),a=n,o(n)})})]);case 3:return o.sent(),a&&this.bundleCache[t].addResToLingshi(e),[2,a]}})})},e.prototype.loadAndGetResSync=function(t,e,i,a){return __awaiter(this,void 0,void 0,function(){var n,o=this;return __generator(this,function(s){switch(s.label){case 0:return this.bundleCache[t]?[3,2]:[4,this.loadBundle(t)];case 1:s.sent(),s.label=2;case 2:return this.bundleCache[t].checkResInLingshi(e)&&(n=this.getRes(t,e,null!=a?a:cc.Asset))?(i&&i(null,n),[2]):(this.bundleCache[t].getBundle().load(e,null!=a?a:cc.Asset,function(a,n){a&&console.error("\u52a0\u8f7d\u8d44\u6e90\u9519\u8bef! bundle:"+t+" path:"+e),o.bundleCache[t].addResToLingshi(e),i&&i(a,n)}),[2])}})})},e.prototype.loadAndGetAtlasSync=function(t,e,i){var a=this;if(!this.bundleCache[t]){var n=new l;return n.Init(t,t),this.bundleCache[t]=n,void this.loadBundleSync(t,function(t){t.load(e,cc.Asset,function(t,e){i&&i(t,e)})})}if(this.bundleCache[t].checkResInLingshi(e)){var o=this.getRes(t,e,cc.SpriteAtlas);if(o)return void(i&&i(null,o))}this.bundleCache[t].getBundle().load(e,cc.SpriteAtlas,function(n,o){n&&console.error("\u52a0\u8f7d\u8d44\u6e90\u9519\u8bef! bundle:"+t+" path:"+e),a.bundleCache[t].addResToLingshi(e),i&&i(n,o)})},e.prototype.findRes=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var a,n,o,s=this;return __generator(this,function(r){switch(r.label){case 0:return(n=this.bundleCache[t])?[3,2]:[4,this.loadBundle(t)];case 1:r.sent(),r.label=2;case 2:return a=null,this.bundleCache[t]&&(n=this.bundleCache[t])?(o=n.getBundle(),[2,(a=o.getDirWithPath(e)).find(function(t){return t.path==i})]):[4,new Promise(function(n){var o=s.bundleCache[t].getBundle();n((a=o.getDirWithPath(e)).find(function(t){return t.path==i}))})];case 3:return r.sent(),a?[2,a.find(function(t){return t.path==i})]:[2,null]}})})},e.prototype.clearLastFightRes=function(){var t=s.Global.dataMgr.getPlayerData().getMinLevel()-1,e=s.Global.common.getBdPrePath(t);if(s.Global.dataMgr.getPlayerData().getMaxLevel()!=t){var i=this.bundleCache[e];i&&(i.clearLingshi(),i.Release())}},e.prototype.clearAllLevelRes=function(){for(var t=6*(s.Global.dataMgr.getPlayerData().getTimeLine()-1),e=1;e<=6;e++){var i=s.Global.common.getBdPrePath(t+e),a=this.bundleCache[i];a&&(a.clearLingshi(),a.Release())}},e.prototype.clearSideGameRes=function(){if(this.sideGamebundles.length)for(var t in this.sideGamebundles){var e=this.sideGamebundles[t],i=this.bundleCache[e];i&&(i.clearLingshi(),i.Release())}if(this.sideGamePrefab.length){var a=this.bundleCache.res;if(!a)return;for(var t in this.sideGamePrefab)a.clearAppointRes("prefab/Dungeons/"+this.sideGamePrefab[t])}},e}(r.default);n.default=c,cc._RF.pop()},{}],RoleBase:[function(t,e,i){"use strict";cc._RF.push(e,"ffb96meNExNCIjrUXbwF0IA","RoleBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.RoleBase=void 0;var o=a("CompBase"),s=a("BattleFightMgr"),r=a("ConfigMgr"),l=a("EventMgr"),c=a("IVector2"),h=a("TweenMaterial"),d=a("UtilOne"),u=a("typeEnum"),p=a("BattleFightPanel"),f=a("DataMgr"),g=a("AudioMgr"),m=a("Global"),y=a("SkillMgr"),v=a("TalentBase"),b=cc._decorator,_=b.ccclass,T=b.property,S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bady=null,e.icon=null,e.weapon=null,e.other=null,e.bullet="",e.bulletPos=cc.v2(0,0),e.bulletRotation=0,e.bulletScale=1,e.bulletEff="",e.health=null,e.levelUrl="",e.warriorsname="",e.attack=1,e.hp=1,e.curHp=0,e.defense=1,e.attackDis=2,e.moveSpeed=1,e.sputRange=1,e.sputAttack=1,e.attakInterval=1,e.attakIngInterval=.5,e.perpetualAttack=!1,e.playReverse=!1,e.attackAim=!1,e.killRewards=1,e.needFood=1,e.damageToOurBuild=1,e.damageToOtherBuild=1,e.bulletspeed=.2,e.id=0,e.isEnemy=!1,e.target=null,e.anim=null,e.roleDate=null,e.rigidbody=null,e.bodySpeed=cc.v2(0,0),e.physics=null,e.OtherPhysics=0,e.selfPhysics=0,e.roleBaseType=u.RoleBaseType.Birth,e.OnAttackAim=!1,e.playReverseing=!1,e.NowAttackType=u.AttackType.Default,e.Birthpoint={myBirthpoint:cc.v2(-375,-25),enemyBirthpoint:cc.v2(375,-25)},e.nowBirthpoint=null,e.moveToBulidUse=0,e.canMove=!0,e.moveSpeedScale=1,e.animTimeScale=1,e.attackTimeScale=1,e.attackIndex=0,e}var i;return __extends(e,t),i=e,e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.physics=this.getComponent(cc.PhysicsCircleCollider),this.health=this.findElement("health",cc.ProgressBar),this.moveToBulidUse=d.default.rand(40,135),this.addEvent()},e.prototype.addEvent=function(){var t=this;l.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this),l.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this)},e.prototype.getCurHp=function(){return this.curHp},e.prototype.getId=function(){return this.id},e.prototype.initRole=function(t,e,i,a){return __awaiter(this,void 0,void 0,function(){var n,o,l,c,h,d,p,g,y;return __generator(this,function(){return this.canMove=!0,this.fightplan=a,this.isEnemy=t,n=this.isEnemy?s.default.Instance().enemyLevels:s.default.Instance().levels,o=n.evolution,this.levelUrl=m.Global.common.getBdPrePath(o),l=1,c=1,h=f.default.Instance().getPlayerData().getCardsTotalAddition(),this.roleDate=r.default.Instance().getTableValue("warriorsid",e,cfgTable.warriorsData),this.isEnemy?(d=cfgTable.commonData.aiidaktcorrect.find(function(t){return t[0]==e}),p=s.default.Instance().enemyLevels,c*=Number(p.aihpcorrect),l*=Number(p.aiaktcorrect),d&&(l*=Number(d[1]))):(g=h.find(function(t){return t.type==u.CardAddType.RoleAtk}),(y=h.find(function(t){return t.type==u.CardAddType.RoleHP}))&&(c+=y.addition),g&&(l+=g.addition)),h.find(function(t){return t.type==u.CardAddType.coinAdd}),this.id=i,this.attack=this.roleDate.attack*l,this.defense=this.roleDate.armor,this.hp=Number(this.roleDate.hp)*c,this.curHp=this.hp,this.warriorsname=m.Global.languageMgr.getText(Number(this.roleDate.nameid)),this.damageToOtherBuild=Number(this.roleDate.enemybasedamage),this.damageToOurBuild=this.roleDate.ourbasedamage,this.attackDis=this.roleDate.attackdistance,this.attakInterval=Number(this.roleDate.attackspeed),this.attakIngInterval=this.roleDate.attakIngInterval,this.perpetualAttack=!!this.roleDate.perpetualAttack,this.playReverse=!!this.roleDate.playReverse,this.moveSpeed=this.roleDate.movespeed,this.sputAttack=this.roleDate.splashdamage,this.sputRange=this.roleDate.splashrange,this.needFood=this.roleDate.Needfood,this.killRewards=Math.round(1*this.roleDate.Killrewards),this.bulletspeed=this.roleDate.bulletspeed?Number(this.roleDate.bulletspeed):.2,this.OtherPhysics=0,this.NowAttackType=u.AttackType.Default,this.OnAttackAim=!1,this.playReverseing=!1,this.roleBaseType=u.RoleBaseType.Birth,this.onShow(),this.isEnemy||(m.Global.talentSkillMgr.run(v.ETalentType.armyHp,this,!1),m.Global.talentSkillMgr.run(v.ETalentType.armyAtk,this,!1)),[2]})})},e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2]})})},e.prototype.attackOver=function(){var t=this;this.isDeath()||this.NowAttackType==u.AttackType.Over||(this.NowAttackType=u.AttackType.Over,this.OnAttackAim=!1,this.roleBaseType=u.RoleBaseType.Interval,this.scheduleOnce(function(){t.roleBaseType=u.RoleBaseType.Move},this.attakInterval*this.attackTimeScale))},e.prototype.attackEnd=function(){this.isDeath()||this.NowAttackType==u.AttackType.End||(this.NowAttackType=u.AttackType.End,this.playReverseing||(this.perpetualAttack?this.playReverse?(this.anim.on(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.playReverseAttack(u.AttackType.AinmIng)):this.prepareAtk():this.playAttack(u.AttackType.AinmOver)))},e.prototype.playAtkAuio=function(){this.roleDate.audioId&&g.default.Instance().playEffect(Number(this.roleDate.audioId))},e.prototype.onplayReverse=function(){this.playReverseing=!1,this.anim.off(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.prepareAtk()},e.prototype.onGoAtk=function(){if(this.NowAttackType!=u.AttackType.OnGo&&(this.NowAttackType=u.AttackType.OnGo,!this.playReverseing)){this.playAtkAuio();for(var t=this.isEnemy?p.default.roleList:p.default.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"otherBase"==n.name||"selfBase"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}if(e.minDts<=this.attackDis)this.onGoAtkTo(e);else{if(!(i.minDts<=this.attackDis))return void this.attackEnd();this.onGoAtkTo(i)}if(2==this.roleDate.warriortype){var s={root:this.weapon,target:this.target,father:this};l.default.Instance().emitFireBullet(s)}else{var r=[this.attack,this.damageToOurBuild,this.damageToOtherBuild],c=this.killRewards;l.default.Instance().emitAttacked({id:this.target.getId(),attack:r,killRewards:c,sputAttack:this.sputAttack,sputRange:this.sputRange})}}},e.prototype.prepareAtk=function(){if(!this.isDeath()&&this.NowAttackType!=u.AttackType.Prepare){this.NowAttackType=u.AttackType.Prepare;for(var t=this.isEnemy?p.default.roleList:p.default.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"otherBase"==n.name||"selfBase"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}e.minDts<=this.attackDis?this.prepareAtkTo(e):i.minDts<=this.attackDis?this.prepareAtkTo(i):this.playAttack(u.AttackType.AinmOver)}},e.prototype.attackedFunc=function(t,e,i,a){var n=i;if(t&&(n=t[0],this.isEnemy)){var o=m.Global.common.isCrit(!1);n=m.Global.common.getCritAtk(o,n,!1),o&&m.Global.talentSkillMgr.playEft(this,v.ETalentEft.crit)}if(this.isEnemy||!m.Global.common.isMiss(!1)){if(!this.isDeath()){this.hp-=n,g.default.Instance().playEffect(4);var r=this.bady.getComponent(cc.Sprite),c=new h.TweenMaterial(r,"time",0);cc.tween(c).to(.1,{mainAny:1}).to(.1,{mainAny:0}).start(),this.health.node.active=!0,this.health.progress=this.hp/this.curHp;var d=this.health.node.getChildByName("white");if(d.active=!0,d.width=(this.hp+n)/this.curHp*52,cc.tween(d).to(.2,{width:this.hp/this.curHp*52}).call(function(){d.active=!1}).start(),this.hp<=0){if(this.roleBaseType=u.RoleBaseType.Dide,this.isEnemy){var y=1;m.Global.talentSkillMgr.run(v.ETalentType.coinDouble,null,!1)&&(y=2,m.Global.talentSkillMgr.playEft(this,v.ETalentEft.doubleCoin)),m.Global.common.isDropMeat()&&m.Global.talentSkillMgr.dropMeat(this,this.fightplan);for(var b=function(){var t=_.killRewards,e=_.fightplan.gold.convertToWorldSpaceAR(cc.v3(0,0)),i=_.node.convertToWorldSpaceAR(cc.v3(0,0));s.default.Instance().coinChange=!0,l.default.Instance().emitCoinEffect(i,e,function(){g.default.Instance().playEffect(21),s.default.Instance().addCoinNum(t),s.default.Instance().coinChange=!1}),f.default.Instance().getPlayerData().addCurTaskCount(1,2)},_=this,T=0;T<y;T++)b()}var S=this.node.getContentSize().height;l.default.Instance().emitRoleDie(this.node.convertToWorldSpaceAR(cc.v2(0,S/2)),S/56.6);var D=(k=this.isEnemy?p.default.enemyList:p.default.roleList).indexOf(this);D>-1&&k.splice(D,1),this.node.destroy()}if(a){var k=this.isEnemy?p.default.enemyList:p.default.roleList,C=[];for(T=0;T<k.length;++T)if(!k[T].isDeath()){var I=k[T].node;this.node!=I&&this.getDistance(this.node,I)<=a&&C.push(k[T])}C.forEach(function(t){t.attackedFunc(null,e,i,null)})}}}else m.Global.talentSkillMgr.playEft(this,v.ETalentEft.defence)},e.prototype.prepareAtkTo=function(t){!t.base||t.base.isDeath()?this.playAttack(u.AttackType.AinmOver):(this.target=t.base,this.startAtk())},e.prototype.onGoAtkTo=function(t){t.base&&!t.base.isDeath()?this.target=t.base:this.attackEnd()},e.prototype.startAtk=function(){var t=this;this.isDeath()||(this.attackAim&&(this.OnAttackAim=!0),this.scheduleOnce(function(){t.target&&!t.target.isDeath()?t.playAttack(u.AttackType.AinmIng):t.playAttack(u.AttackType.AinmOver)},this.attakIngInterval*this.attackTimeScale))},e.prototype.playAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(){return this.isDeath()||s.default.Instance().isEnd?[2]:(e=this.anim.getClips(),(i=this.anim.play(e[t].name)).speed=1*this.animTimeScale,i.wrapMode=cc.WrapMode.Normal,[2])})})},e.prototype.playReverseAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(){return this.isDeath()?[2]:(e=this.anim.getClips(),(i=this.anim.play(e[t].name)).wrapMode=cc.WrapMode.Reverse,i.speed=1*this.animTimeScale,this.playReverseing=!0,[2])})})},e.prototype.detectionDis=function(){for(var t=this.isEnemy?p.default.roleList:p.default.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node,o=this.getDistance(this.node,n);"otherBase"==n.name||"selfBase"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}this.roleBaseType==u.RoleBaseType.Attack&&this.attackAim&&this.OnAttackAim&&(e.minDts<=this.attackDis?this.setAimTo(e):i.minDts<=this.attackDis&&this.setAimTo(i)),this.roleBaseType==u.RoleBaseType.Move&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.setAtkTo(e):i.minDts<=this.attackDis&&this.setAtkTo(i)),2==this.roleDate.warriortype&&(this.roleBaseType==u.RoleBaseType.Attack?("enemy_3"!=this.node.group&&"my_3"!=this.node.group||(this.node.group=this.isEnemy?"enemy_2":"my_2"),this.bodySpeed=cc.v2(c.Vector2.ZERO)):("enemy_2"!=this.node.group&&"my_2"!=this.node.group||(this.node.group=this.isEnemy?"enemy_3":"my_3"),this.bodySpeed=this.bodySpeed)),this.OtherPhysics>0&&50!=this.physics.density?(this.physics.density=50,this.physics.apply()):10!=this.physics.density&&(this.physics.density=10,this.physics.apply()),this.roleBaseType==u.RoleBaseType.Interval&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.bodySpeed=cc.v2(c.Vector2.ZERO):i.minDts<=this.attackDis&&(this.bodySpeed=cc.v2(c.Vector2.ZERO))),s.default.Instance().isEnd||(this.bodySpeed.x*=this.moveSpeedScale,this.bodySpeed.y*=this.moveSpeedScale,this.rigidbody.linearVelocity=this.bodySpeed)},e.prototype.setMoveTo=function(t){var e=t.base.node.getPosition(),i=this.node.getPosition();if("otherBase"==t.base.node.name||"selfBase"==t.base.node.name){var a=t.base.node.getPosition();e={x:a.x,y:a.y+this.moveToBulidUse}}var n={x:0,y:0};c.Vector2.sub(n,e,i);var o=c.Vector2.len(n),s=new c.Vector2(n.x/o,n.y/o);this.bodySpeed.x=s.x*this.moveSpeed,this.bodySpeed.y=s.y*this.moveSpeed},e.prototype.setAtkTo=function(t){t.base&&!t.base.isDeath()&&(this.target=t.base,this.bodySpeed=cc.v2(c.Vector2.ZERO),this.playAttack(u.AttackType.AinmStart),this.roleBaseType=u.RoleBaseType.Attack)},e.prototype.setAimTo=function(t){if(t.base&&!t.base.isDeath()){this.target=t.base;var e=new c.Vector2(this.node.position),i=new c.Vector2(this.target.node.position),a=c.Vector2.angle360(e,i);this.weapon.angle=a}},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},e.prototype.move=function(){!s.default.Instance().isEnd&&this.canMove?y.default.ins.isFrozen(this)?this.rigidbody.linearVelocity=cc.v2(c.Vector2.ZERO):this.isDeath()||(this.roleBaseType==u.RoleBaseType.Birth?this.moveOn():this.detectionDis()):this.rigidbody.linearVelocity=cc.v2(c.Vector2.ZERO)},e.prototype.moveOn=function(){this.roleBaseType=u.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBirth=function(){this.roleBaseType=u.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBeginContact=function(t,e,a){if(a.node){var n=a.node.getComponent(i);n&&this.isEnemy!=n.isEnemy?this.OtherPhysics+=1:this.selfPhysics+=1}},e.prototype.onEndContact=function(t,e,a){if(a.node){var n=a.node.getComponent(i);n&&this.isEnemy!=n.isEnemy?this.OtherPhysics-=1:this.selfPhysics-=1}},e.prototype.isDeath=function(){return this.roleBaseType==u.RoleBaseType.Dide},e.prototype.setHp=function(t){this.hp=t,this.health.progress=this.hp/this.curHp},e.prototype.getHp=function(){return this.hp},e.prototype.setCurHp=function(t){this.curHp=t,this.health.progress=this.hp/this.curHp},e.prototype.getAtk=function(){return this.attack},e.prototype.setAtk=function(t){this.attack=t},__decorate([T(cc.Sprite)],e.prototype,"bady",void 0),__decorate([T(cc.Sprite)],e.prototype,"icon",void 0),__decorate([T(cc.Node)],e.prototype,"weapon",void 0),__decorate([T(cc.Sprite)],e.prototype,"other",void 0),__decorate([T()],e.prototype,"bullet",void 0),__decorate([T(cc.Vec2)],e.prototype,"bulletPos",void 0),__decorate([T()],e.prototype,"bulletRotation",void 0),__decorate([T()],e.prototype,"bulletScale",void 0),__decorate([T()],e.prototype,"bulletEff",void 0),i=__decorate([_],e)}(o.default);n.RoleBase=S,cc._RF.pop()},{}],Role:[function(t,e,i){"use strict";cc._RF.push(e,"dc168saj3pNDqJw+YHD9jxc","Role");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("BattleFightMgr"),s=a("ResMgr"),r=a("UtilOne"),l=a("typeEnum"),c=a("RoleBase"),h=cc._decorator,d=h.ccclass,u=(h.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,c,h,d,u,p;return __generator(this,function(f){switch(f.label){case 0:return[4,s.default.Instance().loadAndGetRes(this.levelUrl,"level",cc.SpriteAtlas)];case 1:return t=f.sent(),1==this.roleDate.warriortype?this.node.group=this.isEnemy?"enemy":"my":this.node.group=this.isEnemy?"enemy_3":"my_3",e="",i="",a="",this.bady.spriteFrame&&(e=this.bady.spriteFrame.name),this.icon.spriteFrame&&(i=this.icon.spriteFrame.name),this.other.spriteFrame&&(a=this.other.spriteFrame.name),this.isEnemy&&(e=e.replace("e1","e2"),i=i.replace("e1","e2"),a=a.replace("e1","e2"),t.getSpriteFrame(i)||(i=i.replace("e2","e1")),t.getSpriteFrame(e)||(e=e.replace("e2","e1")),t.getSpriteFrame(a)||(a=a.replace("e2","e1"))),n=o.default.Instance().enemyLevels.leveltype,c=o.default.Instance().levels.leveltype,n!=c&&1==n&&(h=e+"_L",t.getSpriteFrame(h)&&(e=h)),this.bady.spriteFrame=t.getSpriteFrame(e),this.other.spriteFrame?(this.other.node.active=!0,this.other.spriteFrame=t.getSpriteFrame(a)):this.other.node.active=!1,this.icon.spriteFrame?this.icon.spriteFrame=t.getSpriteFrame(i):this.icon.spriteFrame=null,this.health.node.setPosition(0,this.bady.spriteFrame.getRect().height+10),this.health.node.active=!1,d=this.bady.spriteFrame.getRect().height,this.physics.offset=cc.v2(0,d/4),this.physics.radius=d/4,this.physics.apply(),this.node.setContentSize(this.bady.spriteFrame.getRect().width,this.bady.spriteFrame.getRect().height),u=r.default.randInt(-1,1),p=r.default.randInt(-1,1),this.isEnemy?(this.nowBirthpoint=cc.v2(this.Birthpoint.enemyBirthpoint.x+u,this.Birthpoint.enemyBirthpoint.y+p),this.node.setPosition(this.nowBirthpoint)):(this.nowBirthpoint=cc.v2(this.Birthpoint.myBirthpoint.x+u,this.Birthpoint.myBirthpoint.y+p),this.node.setPosition(this.nowBirthpoint)),this.roleBaseType=l.RoleBaseType.Birth,[2]}})})},__decorate([d],e)}(c.RoleBase));n.default=u,cc._RF.pop()},{}],RoundRectMask:[function(t,e,i){"use strict";cc._RF.push(e,"8a50crrt0JLlb9zavpWjBmy","RoundRectMask");var a=i;Object.defineProperty(a,"__esModule",{value:!0}),a.RoundRectMask=void 0;var n=cc._decorator.property,o=cc._decorator.ccclass,s=cc._decorator.executeInEditMode,r=cc._decorator.disallowMultiple,l=cc._decorator.requireComponent,c=cc._decorator.menu;cc.macro.ENABLE_WEBGL_ANTIALIAS=!0;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._radius=50,e.mask=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this.updateMask(t)},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){this.mask=this.getComponent(cc.Mask),this.updateMask(this.radius)},e.prototype.updateMask=function(t){var e=t>=0?t:0;e<1&&(e=Math.min(this.node.width,this.node.height)*e),this.mask.radius=e,this.mask.onDraw=this.onDraw.bind(this.mask),this.mask._updateGraphics=this._updateGraphics.bind(this.mask),this.mask.type=cc.Mask.Type.RECT},e.prototype._updateGraphics=function(){var t=this._graphics;t&&this.onDraw(t)},e.prototype.onDraw=function(t){t.clear(!1);var e=this.node,i=e.width,a=e.height,n=-i*e.anchorX,o=-a*e.anchorY;t.roundRect(n,o,i,a,this.radius||0),cc.game.renderType===cc.game.RENDER_TYPE_CANVAS?t.stroke():t.fill()},__decorate([n()],e.prototype,"_radius",void 0),__decorate([n({tooltip:"\u5706\u89d2\u534a\u5f84:\n0-1\u4e4b\u95f4\u4e3a\u6700\u5c0f\u8fb9\u957f\u6bd4\u4f8b\u503c, \n>1\u4e3a\u5177\u4f53\u50cf\u7d20\u503c"})],e.prototype,"radius",null),__decorate([o(),s(!0),r(!0),l(cc.Mask),c("\u6e32\u67d3\u7ec4\u4ef6/\u5706\u89d2\u906e\u7f69")],e)}(cc.Component);a.RoundRectMask=h,cc._RF.pop()},{}],SDKBase:[function(t,e,i){"use strict";cc._RF.push(e,"67afe4Q+8NAepUb1TriM6jH","SDKBase");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function t(){this.option={}}return t.prototype.init=function(){},t.prototype.login=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.recordGame=function(){console.log("\u5f55\u5236\u5f00\u59cbsdkbase")},t.prototype.recordEnd=function(){console.log("\u5f55\u5236\u7ed3\u675fsdkbase")},t.prototype.openAd=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.shareGame=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.videoShare=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.showBanner=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.hideBanner=function(){},t.prototype.destroyBanner=function(){},t.prototype.interstitialAd=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.send=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.openMultitonAd=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.navigateToScene=function(){},t.prototype.vibrateShort=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},t.prototype.subscribe=function(t){t&&t(!0)},t}();a.default=n,cc._RF.pop()},{}],SDKMgr:[function(t,e,i){"use strict";cc._RF.push(e,"219bbvZ66RH24St0n8djKnk","SDKMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("DebugSDK"),s=a("TTSDK"),r=a("WXSDK"),l=a("UtilOne"),c=a("EventMgr"),h=a("Global"),d=a("AudioMgr"),u=a("VIVOSDK"),p=a("OPPOSDK"),f=function(){function t(){this.testAD=!1,this.inOpenAd=!1}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.init=function(){var t;this.allOptions=h.initOption,cc.sys.platform==cc.sys.WECHAT_GAME?this.curSdk=r.default.ins:cc.sys.platform==cc.sys.BYTEDANCE_GAME?this.curSdk=s.default.ins:cc.sys.platform==cc.sys.VIVO_GAME?this.curSdk=u.default.ins:cc.sys.platform==cc.sys.OPPO_GAME?this.curSdk=p.default.ins:this.curSdk=o.default.ins,this.curSdk.scene="0",null===(t=this.curSdk)||void 0===t||t.init(),this.allOptions.hideData.hide_ONOFF_area?(this.curSdk.option.view=this.allOptions.view.unHide,this.curSdk.option.inter=this.allOptions.inter.unHide,this.curSdk.option.costom=this.allOptions.costom.unHide):(this.curSdk.option.view=this.allOptions.view.hide,this.curSdk.option.inter=this.allOptions.inter.hide,this.curSdk.option.costom=this.allOptions.costom.hide),this.curSdk.option.shop=this.allOptions.shop,this.curSdk.option.parameter=this.allOptions.parameter},t.prototype.getOption=function(t,e){var i=this;if(void 0===e&&(e=5),!cc.sys.isBrowser){var a=e,n="";cc.sys.platform==cc.sys.WECHAT_GAME?n=h.CDN_URL+"options/WX/eecj_options.dis":cc.sys.platform==cc.sys.BYTEDANCE_GAME&&(n=h.CDN_URL+"options/TT/eecj_options.dis");var o=new XMLHttpRequest;o.timeout=1e4,o.onreadystatechange=function(){4==o.readyState&&(200==o.status?t(o):404==o.status?console.error("http request not found url:["+n+"]"):a>0?(a-=1,setTimeout(i.getOption.bind(i),1e3,t,a)):console.error("tryTime Out"))},o.open("GET",n,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send()}},t.prototype.isHide=function(){var t=this;return 0==this.allOptions.hideData.hide_ONOFF_area||!!this.allOptions.hideData.hide_scene.find(function(e){return e==t.curSdk.scene})||(console.log("\u573a\u666f\u503c\u6ca1\u6709\u5c4f\u853d",this.curSdk.scene),!1)},t.prototype.openAd=function(t,e){var i,a=this;if(void 0===e&&(e=null),h.Global.isDebug)return h.Global.dataMgr.getPlayerData().addCurTaskCount(1,5),t&&t(),void(this.inOpenAd=!1);if(!this.inOpenAd){if(this.inOpenAd=!0,cc.game.pause(),this.testAD)return cc.game.resume(),h.Global.dataMgr.getPlayerData().addCurTaskCount(1,5),this.inOpenAd=!1,void(t&&t());if(!this.curSdk)return cc.game.resume(),h.Global.dataMgr.getPlayerData().addCurTaskCount(1,5),this.inOpenAd=!1,void(t&&t());null===(i=this.curSdk)||void 0===i||i.openAd(function(){cc.game.resume(),h.Global.dataMgr.getPlayerData().addCurTaskCount(1,5),a.inOpenAd=!1,t&&t()},function(){cc.game.resume(),e&&e(),h.Global.eventMgr.emitTips("\u5e7f\u544a\u62c9\u53d6\u5931\u8d25"),a.inOpenAd=!1},function(){cc.game.resume(),a.inOpenAd=!1,h.Global.eventMgr.emitTips("\u770b\u5b8c\u89c6\u9891\u624d\u80fd\u83b7\u53d6\u5956\u52b1\u54e6~")}),setTimeout(function(){a.inOpenAd=!1},3e3)}},t.prototype.openMultitonAd=function(t,e,i,a){var n,o=this;void 0===i&&(i=null),this.inOpenAd||(this.inOpenAd=!0,this.testAD?t&&t():a&&cc.sys.platform!=cc.sys.BYTEDANCE_GAME?t&&t():(null===(n=this.curSdk)||void 0===n||n.openMultitonAd(function(e){t&&t(e)},e,function(){cc.game.resume(),i&&i(),h.Global.eventMgr.emitTips("\u5e7f\u544a\u62c9\u53d6\u5931\u8d25"),o.inOpenAd=!1},function(){cc.game.resume(),o.inOpenAd=!1,h.Global.eventMgr.emitTips("\u770b\u5b8c\u89c6\u9891\u624d\u80fd\u83b7\u53d6\u5956\u52b1\u54e6~")}),setTimeout(function(){o.inOpenAd=!1},3e3)))},t.prototype.showBanner=function(t){void 0===t&&(t=""),this.testAD||this.curSdk&&this.curSdk.showBanner(t)},t.prototype.hideBanner=function(){this.testAD||this.curSdk&&this.curSdk.hideBanner()},t.prototype.destroyBanner=function(){this.testAD||this.curSdk&&this.curSdk.destroyBanner()},t.prototype.interstitialAd=function(t,e){return this.testAD?(t&&t(),void(e&&e())):this.curSdk?void this.curSdk.interstitialAd(t,e):(t&&t(),void(e&&e()))},t.prototype.shareGame=function(t,e){var i;void 0===t&&(t=null),void 0===e&&(e=function(){var t=["\u7f51\u7edc\u5ef6\u8fdf,\u5206\u4eab\u5931\u8d25","\u8bf7\u5206\u4eab\u5230\u7fa4","\u5206\u4eab\u5931\u8d25"],e=l.default.randInt(0,t.length-1);c.default.Instance().emitTips(t[e])}),this.curSdk?null===(i=this.curSdk)||void 0===i||i.shareGame(t,e):t&&t()},t.prototype.recordGame=function(){var t;console.log("\u5f55\u5236\u5f00\u59cbsdkmgr"),null===(t=this.curSdk)||void 0===t||t.recordGame()},t.prototype.recordEnd=function(){var t;console.log("\u5f55\u5236\u7ed3\u675fsdkmgr"),null===(t=this.curSdk)||void 0===t||t.recordEnd()},t.prototype.recordShare=function(){var t;console.log("\u5f55\u5236\u5206\u4eabsdkmgr"),null===(t=this.curSdk)||void 0===t||t.videoShare()},t.prototype.playInterstitialAdOnOption=function(t){var e=this;if(1==h.Global.sdkMgr.curSdk.option.inter.inter_ONOFF_loginGame){var i=this.delayTime;console.log("delayTime>>>>>"+i),t.scheduleOnce(function(){console.log("scheduleOnceIn>>>>>"),e.delayTime=h.Global.sdkMgr.curSdk.option.inter.inter_delay_loginGame,h.Global.sdkMgr.interstitialAd(function(){},function(){})},i),t.schedule(function(){e.delayTime-=.1,e.delayTime=e.delayTime<=0?0:e.delayTime},.1)}},t.prototype.send=function(t,e){var i;null===(i=this.curSdk)||void 0===i||i.send(t,e)},t.prototype.navigateToScene=function(){var t;null===(t=this.curSdk)||void 0===t||t.navigateToScene()},t.prototype.vibrateShort=function(t,e){var i;void 0===e&&(e=null),d.default.Instance().getVibrateEnabled()&&(null===(i=this.curSdk)||void 0===i||i.vibrateShort(t,e))},t.prototype.subscribe=function(t){var e;null===(e=this.curSdk)||void 0===e||e.subscribe(t)},t.prototype.getIdList=function(){},t}();n.default=f,cc._RF.pop()},{}],SettingPanel:[function(t,e,i){"use strict";cc._RF.push(e,"f4fe1CUAntCOoKUEJsPUGT7","SettingPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("AudioMgr"),l=a("EventMgr"),c=a("Observer"),h=a("TTCloudMgr"),d=cc._decorator,u=d.ccclass,p=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.btn_1=null,e.btn_2=null,e.btn_3=null,e.closeBtn=null,e.saveBtn=null,e}return __extends(e,t),e.prototype.start=function(){var t=this;this.btn_1.on("click",function(e){t.clickEffect(e)}),this.btn_2.on("click",function(e){t.clickEffect(e)}),this.btn_3.on("click",function(e){t.clickEffect(e)}),this.closeBtn.on("click",this.emitCloseMe,this);var e=this.btn_1.getChildByName("lvse"),i=this.btn_1.getChildByName("hongse"),a=this.btn_1.getChildByName("kaiguan");r.default.Instance().getVibrateEnabled()?(e.active=!0,i.active=!1,a.x=-23):(e.active=!1,i.active=!0,a.x=23);var n=this.btn_2.getChildByName("lvse"),s=this.btn_2.getChildByName("hongse"),l=this.btn_2.getChildByName("kaiguan");r.default.Instance().getMusicEnable()?(n.active=!0,s.active=!1,l.x=-23):(n.active=!1,s.active=!0,l.x=23);var c=this.btn_3.getChildByName("lvse"),h=this.btn_3.getChildByName("hongse"),d=this.btn_3.getChildByName("kaiguan");r.default.Instance().getEffectEnable()?(c.active=!0,h.active=!1,d.x=-23):(c.active=!1,h.active=!0,d.x=23),this.updateBtn(),this.idTxt=this.node.getChildByName("idTxt").getComponent(cc.Label),o.Global.common.getUniqueId(),this.idTxt.string=""},e.prototype.clickEffect=function(t){console.log("",t);var e=t.node,i=e.getChildByName("lvse"),a=e.getChildByName("hongse"),n=e.getChildByName("kaiguan");switch(e.name){case"0":if(i.active)return i.active=!1,a.active=!0,r.default.Instance().setVibrateEnabled(!1),void cc.tween(n).to(.1,{position:cc.v3(n.x+=50,0)}).start();a.active&&(i.active=!0,a.active=!1,r.default.Instance().setVibrateEnabled(!0),cc.tween(n).to(.1,{position:cc.v3(n.x-=50,0)}).start());break;case"1":if(i.active)return i.active=!1,a.active=!0,r.default.Instance().setMusicEnabled(!1),void cc.tween(n).to(.1,{position:cc.v3(n.x+=50,0)}).start();a.active&&(i.active=!0,a.active=!1,r.default.Instance().setMusicEnabled(!0),cc.tween(n).to(.1,{position:cc.v3(n.x-=50,0)}).start());break;case"2":if(i.active)return i.active=!1,a.active=!0,r.default.Instance().setEffectEnabled(!1),void cc.tween(n).to(.1,{position:cc.v3(n.x+=50,0)}).start();a.active&&(i.active=!0,a.active=!1,r.default.Instance().setEffectEnabled(!0),cc.tween(n).to(.1,{position:cc.v3(n.x-=50,0)}).start())}},e.prototype.updateBtn=function(){var t=(new Date).getTime();o.Global.common.saveTime||(o.Global.common.saveTime=0);var e=t-o.Global.common.saveTime;this.saveBtn.interactable=e>=6e4},e.prototype.saveData=function(){o.Global.common.saveTime=(new Date).getTime(),this.updateBtn(),c.default.ins.watch(c.EGameEvent.SAVE_END,this.saveEnd,this),h.default.ins.forceSave()},e.prototype.saveEnd=function(t,e){void 0===e&&(e=!1),c.default.ins.remove(c.EGameEvent.SAVE_END,this.saveEnd,this),e?l.default.Instance().emitTips("\u5b58\u6863\u4e0a\u4f20\u6210\u529f!"):t?l.default.Instance().emitTips("\u5b58\u6863\u4e0a\u4f20\u6210\u529f!"):l.default.Instance().emitTips("\u5b58\u6863\u4e0a\u4f20\u5931\u8d25!,\u8bf71\u5206\u949f\u540e\u7a0d\u540e\u91cd\u8bd5")},e.prototype.onDestroy=function(){c.default.ins.remove(c.EGameEvent.SAVE_END,this.saveEnd,this)},e.prototype.copyStr=function(){var t=this.idTxt.string;o.Global.common.copyStr(t)},__decorate([p({type:cc.Node,displayName:"\u6309\u94ae1"})],e.prototype,"btn_1",void 0),__decorate([p({type:cc.Node,displayName:"\u6309\u94ae2"})],e.prototype,"btn_2",void 0),__decorate([p({type:cc.Node,displayName:"\u6309\u94ae3"})],e.prototype,"btn_3",void 0),__decorate([p({type:cc.Node,displayName:"\u5173\u95ed\u6309\u94ae"})],e.prototype,"closeBtn",void 0),__decorate([p({type:cc.Button,displayName:"\u4fdd\u5b58\u6309\u94ae"})],e.prototype,"saveBtn",void 0),__decorate([u],e)}(s.default);n.default=f,cc._RF.pop()},{}],Set:[function(t,e,i){"use strict";cc._RF.push(e,"9b0a5lNO0VOhZUQ33PgBd/m","Set");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.Sets=void 0;var o=a("Maths"),s=function(){function t(t){void 0===t&&(t=!0);for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.values=[],this.isRepeat=!0,this.isRepeat=t,this.add.apply(this,e)}return t.forEach=function(t,e,i){if(void 0===i&&(i=!1),i)for(var a=t.length-1;a>=0&&!e(t[a],a);a--);else for(a=0;a<t.length&&!e(t[a],a);a++);},t.updateItemCount=function(t,e,i){if(!(t<0||e<0)&&t!=e){var a=t-e;if(a>0)for(var n=0;n<a;n++)i(!0);else{n=0;for(var o=Math.abs(a);n<o;n++)i(!1)}}},t.pop=function(t,e){return void 0===e&&(e=!1),e?t.pop():t[t.length-1]},t.delete=function(t,e){if(null==e||null==e)return!1;if(0==t.length)return!1;var i=t.indexOf(e);return-1!=i&&(t.splice(i,1),!0)},t.bubblingSort=function(t,e){for(var i=t.length,a=0;a<i-1;a++)for(var n=0;n<i-1-a;n++)if(e(t[n],t[n+1])){var o=t[n];t[n]=t[n+1],t[n+1]=o}},t.reverse=function(t){for(var e=0;e<t.length/2;e++){var i=t[e];t[e]=t[t.length-1-e],t[t.length-1-e]=i}return t},t.map=function(t,e){for(var i=[],a=0;a<t.length;a++){var n=e(t[a],a,t);i.push(n)}return i},t.has=function(t,e,i){return void 0===i&&(i=!1),!!t&&0!=t.length&&-1!=(i?this.map(t,function(t){return t.toString()}).indexOf(e.toString()):t.indexOf(e))},t.add=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var a=0;a<e.length;a++){var n=e[a];this.has(t,n)||t.push(n)}},t.random=function(t,e){if(0==t.length)return null;if(e){for(var i=[],a=0,n=t.length;a<n;a++)e(t[a],a)||i.push(t[a]);return this.random(i)}return t[o.Maths.zeroToMax(t.length)]},t.randomOf=function(t,e){if(0==t.length)return null;if(e){for(var i=[],a=0,n=t.length;a<n;a++)e(t[a],a)||i.push(t[a]);return this.randomOf(i)}return o.Maths.zeroToMax(t.length)},t.getAt=function(t,e){return t[e=o.Maths.clampf(e,0,t.length-1)]},t.filterValue=function(t,e,i){void 0===i&&(i=!1);var a=this.filterOf(t,e,i);return-1==a?null:t[a]},t.insert=function(t,e,i){var a=t.splice(i);return t.push(e),t.push.apply(t,a),t},t.filterOf=function(t,e,i){if(void 0===i&&(i=!1),i){for(var a=t.length-1;a>=0;a--)if(t[a]&&e(t[a],a))return a}else for(a=0;a<t.length;a++)if(t[a]&&e(t[a],a))return a;return-1},t.filter=function(t,e,i){i||(i=[]);for(var a=0;a<t.length;a++)t[a]&&e(t[a],a)&&i.push(t[a]);return i},t.push=function(t,e){if(Array.isArray(e))for(var i=0,a=e;i<a.length;i++){var n=a[i];t.push(n)}else t.push(e);return t},t.sort=function(t,e){return t.sort(e)},t.shuffle=function(t,e){if(void 0===e&&(e=!0),e)return t.sort(function(){return Math.random()>.5?1:-1}),t;var i=t.concat();return i.sort(function(){return Math.random()>.5?1:-1}),i},t.randomArray=function(t,e){void 0===e&&(e=1);for(var i=this.shuffle(t,!1),a=[],n=0;n<e;n++)i[n]&&a.push(i[n]);return a},Object.defineProperty(t.prototype,"size",{get:function(){return this.values.length},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.values.indexOf(t)},t.prototype.clear=function(){this.values.length=0},t.prototype.shift=function(t){return void 0===t&&(t=!0),t?this.values.shift():this.values.concat()[0]},t.prototype.toString=function(){return this.values.toString()},t.prototype.forEach=function(e,i){return void 0===i&&(i=!1),t.forEach(this.values,e,i),this},t.prototype.add=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.add.apply(t,__spreadArrays([this.values],e)),this},t.prototype.delete=function(e){return t.delete(this.values,e)},t.prototype.has=function(e,i){return void 0===i&&(i=!1),t.has(this.values,e,i)},t.prototype.map=function(e){return t.map(this.values,e)},t.prototype.sort=function(e){return t.sort(this.values,e),this},t.prototype.filterOf=function(e){return t.filterOf(this.values,e)},t.prototype.filterValue=function(e){return t.filterValue(this.values,e)},t.prototype.filter=function(e){return t.filter(this.values,e,[])},t}();n.Sets=s,cc._RF.pop()},{}],ShopItem:[function(t,e,i){"use strict";cc._RF.push(e,"5b983JnAOVEf75fXx5Umqjm","ShopItem");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("ConfigMgr"),r=a("DataMgr"),l=a("EventMgr"),c=a("ResMgr"),h=a("typeEnum"),d=a("SuperListItem"),u=a("UtilOne"),p=cc._decorator,f=p.ccclass,g=p.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.condition=null,e.adClick=null,e.timesLabel=null,e.count=null,e.diamondClick=null,e.icons=[],e.sprs=[],e.costAdLabel=null,e.titleIcon=null,e.rewardIcon=null,e.data=null,e.conditionNum=0,e.accTime=1,e.setTime=1,e.run=!1,e.leftTime=0,e.adMax=0,e}return __extends(e,t),e.prototype.setData=function(t){this.data=t,this.conditionNum=this.data.condition;var e=o.Global.sdkMgr.curSdk.option.shop;if(e&&e[String(this.data.ID)]&&e[String(this.data.ID)].condition&&-1!=e[String(this.data.ID)].condition&&(this.conditionNum=e[String(this.data.ID)].condition),this.data.rewardType==h.CurrencyType.Coin){var i=r.default.Instance().getPlayerData().getUnlocked()[0],a=s.default.Instance().getTableValue("warriorsid",i,cfgTable.warriorsData).Killrewards;this.condition.string=u.default.ChangeNumberUnit(this.conditionNum*a)}else this.condition.string=""+this.conditionNum;this.titleIcon=this.node.getChildByName("titleIcon").getComponent(cc.Sprite),this.rewardIcon=this.node.getChildByName("rewardIcon").getComponent(cc.Sprite),this.initUI(),this.initEvent(),this.accTime=1,this.updateSelf(),this.run=!0},e.prototype.updateSelf=function(){if(this.data.costtype==h.CostType.Ad){var t=r.default.Instance().getPlayerData();this.leftTime=0,this.check(this.data.ID);var e=this.leftTime>0;if(this.adClick.active=!e,this.timesLabel.node.active=e,e)this.timesLabel.string=""+u.default.getTimeStr(this.leftTime);else{var i=t.getAdMax(this.data.ID);this.data.costAd?this.count.string=Math.floor(i.max/this.data.costAd)+"/"+this.adMax/this.data.costAd:this.count.string=this.adMax-i.max+"/"+this.adMax}}},e.prototype.reset=function(t,e){var i=r.default.Instance().getPlayerData(),a=u.default.getNextDayMidnightTimestamp(e);i.resetAdMax(t,a)},e.prototype.check=function(t){for(var e=r.default.Instance().getPlayerData().getAdMaxList(),i=1e3*u.default.getlocalTime(),a=0;a<e.length;++a)if(e[a].ID==t){var n=e[a],l=s.default.Instance().getTableValue("ID",t,cfgTable.shopData).admax,c=o.Global.sdkMgr.curSdk.option.shop;c&&c[String(t)]&&c[String(t)].admax&&-1!=c[String(t)].admax&&(l=c[String(t)].admax),this.adMax=l,i>=n.endTime?this.reset(n.ID,i):n.max<l||(this.leftTime=Math.floor((n.endTime-i)/1e3)+1,this.leftTime>86401&&(this.leftTime=0,this.reset(n.ID,i)))}},e.prototype.onLoad=function(){},e.prototype.update=function(t){this.data.costtype==h.CostType.Ad&&this.run&&(this.leftTime<=0||(this.accTime+=t,this.accTime>=this.setTime&&(this.accTime=0,this.leftTime--,this.timesLabel.string=""+u.default.getTimeStr(this.leftTime),this.leftTime<=0&&this.updateSelf())))},e.prototype.initUI=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o;return __generator(this,function(s){switch(s.label){case 0:return t=r.default.Instance().getPlayerData(),this.data.costtype==h.CostType.Ad?(this.adClick.active=!0,this.data.admax>=9999?this.count.node.active=!1:this.count.node.active=!0,this.data.costAd&&(this.costAdLabel.node.active=!0,e=t.getAdMax(this.data.ID),this.costAdLabel.string=e.max%this.data.costAd+"/"+this.data.costAd)):this.data.costtype==h.CostType.Diamond&&(this.diamondClick.active=!0,i=this.diamondClick.getChildByName("layout"),a=i.getChildByName("icon").getComponent(cc.Sprite),n=i.getChildByName("costLabel").getComponent(cc.Label),a.spriteFrame=this.icons[h.CurrencyType.Diamond-1],n.string=this.data.costmoney.toString(),t.getDiamond()<this.data.costmoney?(n.node.color=cc.color().fromHEX("#FF0000"),this.diamondClick.getComponent(cc.Sprite).setMaterial(0,this.sprs[0])):(n.node.color=cc.color().fromHEX("#FFFFFF"),this.diamondClick.getComponent(cc.Sprite).setMaterial(0,this.sprs[1]))),this.data.rewardType==h.CurrencyType.Potion&&(this.titleIcon.node.scale=.6,this.rewardIcon.node.scale=.8),this.titleIcon.spriteFrame=this.icons[this.data.rewardType-1],o=this.rewardIcon,[4,c.default.Instance().loadAndGetRes("res","image/common/"+this.data.ICON,cc.SpriteFrame)];case 1:return o.spriteFrame=s.sent(),[2]}})})},e.prototype.initEvent=function(){this.data.costtype==h.CostType.Ad?this.adClick.on("click",this.adClickCall,this):this.data.costtype==h.CostType.Diamond&&this.diamondClick.on("click",this.diamondClickCall,this),l.default.Instance().onDiamondChange(this.initUI,this),l.default.Instance().onDiamondChange(this.updateSelf,this)},e.prototype.adClickCall=function(){var t=this;r.default.Instance().getPlayerData().canAdClick(this.data.ID)?(o.Global.umSDK.send(h.EnumDefine.fieldName.play_AD,{type:h.EnumDefine.fieldDes.shopStat}),o.Global.sdkMgr.openAd(function(){o.Global.umSDK.send(h.EnumDefine.fieldName.play_AD,{type:h.EnumDefine.fieldDes.shopEnd}),r.default.Instance().getPlayerData().addAdClick(t.data.ID),t.data.costAd?(r.default.Instance().getPlayerData().getAdMax(t.data.ID).max%t.data.costAd==0&&t.getReward(),t.initUI(),t.updateSelf()):t.getReward()},null)):l.default.Instance().emitTips(o.Global.languageMgr.getText(940002))},e.prototype.diamondClickCall=function(){var t=r.default.Instance().getPlayerData(),e=this.data.costmoney;t.getDiamond()<e?l.default.Instance().emitTips(o.Global.languageMgr.getText(933106)):(t.setDiamond(-e),this.getReward())},e.prototype.getReward=function(){var t=this.conditionNum,e=this.data.rewardType;o.Global.common.flyProp(this.node,e,t),this.initUI(),this.updateSelf(),this.accTime=1},__decorate([g(cc.Label)],e.prototype,"condition",void 0),__decorate([g(cc.Node)],e.prototype,"adClick",void 0),__decorate([g(cc.Label)],e.prototype,"timesLabel",void 0),__decorate([g(cc.Label)],e.prototype,"count",void 0),__decorate([g(cc.Node)],e.prototype,"diamondClick",void 0),__decorate([g(cc.SpriteFrame)],e.prototype,"icons",void 0),__decorate([g({type:cc.Material,displayName:"\u6309\u94ae\u66f4\u6362\u56fe\u7247"})],e.prototype,"sprs",void 0),__decorate([g({type:cc.Label,displayName:"\u9700\u8981\u89c2\u770b\u5e7f\u544a\u7684\u6b21\u6570"})],e.prototype,"costAdLabel",void 0),__decorate([f],e)}(d.default);n.default=m,cc._RF.pop()},{}],ShopPanel:[function(t,e,i){"use strict";cc._RF.push(e,"2554fcnT5lMxLRzcdbqEjNv","ShopPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("DataMgr"),r=a("ShopItem"),l=cc._decorator,c=l.ccclass,h=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemRoot=null,e.itemPrefab=null,e}return __extends(e,t),e.prototype.onEnable=function(){for(var t=cfgTable.shopData,e=[],i=0,a=s.default.Instance().getPlayerData().getAdMaxList();i<a.length;i++){var n=a[i];if(t[n.ID]){var r=o.Global.sdkMgr.curSdk.option.shop;if(r&&r[String(n.ID)]){var l=r[String(n.ID)].admax,c=r[String(n.ID)].condition;if(0==l||0==c)continue}e.push(t[n.ID])}}this.initItems(e)},e.prototype.initItems=function(t){var e=this.itemRoot.children;e.forEach(function(t){t.active=!1});for(var i=0;i<t.length;i++){var a=t[i],n=e[i];n||((n=cc.instantiate(this.itemPrefab)).parent=this.itemRoot),n.active=!0,n.getComponent(r.default).setData(a)}},__decorate([h(cc.Node)],e.prototype,"itemRoot",void 0),__decorate([h(cc.Prefab)],e.prototype,"itemPrefab",void 0),__decorate([c],e)}(cc.Component);n.default=d,cc._RF.pop()},{}],Singleton:[function(t,e,i){"use strict";cc._RF.push(e,"b0708FJLllGSosAuvc/teto","Singleton");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function t(){}return t.Instance=function(){return this.instance||(this.instance=new this),this.instance},t}();a.default=n,cc._RF.pop()},{}],SkillBase:[function(t,e,i){"use strict";cc._RF.push(e,"9178fVdnxNEdbK47bFbKFm3","SkillBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.ESkillType=void 0;var o=a("DataMgr");(function(t){t[t.ice=1]="ice",t[t.wave=2]="wave",t[t.bait=3]="bait",t[t.morale=4]="morale",t[t.buff=5]="buff",t[t.meteor=6]="meteor",t[t.push=7]="push",t[t.recover=8]="recover"})(n.ESkillType||(n.ESkillType={}));var s=function(){function t(){}return t.prototype.init=function(t,e){this.uid=e;var i=cfgTable.cardskillData[t];this.skillCfg=i,this.id=t,this.type=i.type,this.getSkillLv()},t.prototype.setTarget=function(t){this.target=t},t.prototype.getSkillLv=function(){var t=this,e=(o.default.Instance().getPlayerData().getSkillIdList()||[]).find(function(e){return e.ID==t.id});e?this.lv=e.level:(console.error("\u672a\u83b7\u53d6\u5230\u6280\u80fd"+this.id+"\u7b49\u7ea7lv"),this.lv=0)},t.prototype.getProp=function(){var t=this.skillCfg.typenumber;if(this.lv>0)for(var e=0;e<this.lv;e++)t+=this.skillCfg.level[e][1];return t},t.prototype.runSkill=function(){},t.prototype.update=function(){},t}();n.default=s,cc._RF.pop()},{}],SkillBtnItem:[function(t,e,i){"use strict";cc._RF.push(e,"89359WAHxNDRJA1ONKkG9XC","SkillBtnItem");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o,s=a("CompBase"),r=a("SkillBase"),l=a("Observer"),c=a("ResMgr"),h=a("SkillMgr"),d=cc._decorator,u=d.ccclass;d.property,function(t){t[t.normal=1]="normal",t[t.pressed=2]="pressed",t[t.cd=3]="cd",t[t.used=4]="used"}(o||(o={}));var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeScale=1,e.state=o.normal,e.startPos=new cc.Vec2,e.run=!1,e}return __extends(e,t),e.prototype.init=function(t){this.normal=this.findElement("normal"),this.pressed=this.findElement("pressed"),this.icon=this.findElement("icon",cc.Sprite),this.progress=this.findElement("progress",cc.Sprite),this.used=this.findElement("used"),this.addTouchEvt(),this.id=t,0==this.id?(this.state=o.used,this.icon.spriteFrame=null,this.closeTouchEvt()):this.setIcon(),this.updateState(),l.default.ins.remove(l.EGameEvent.STOP_SKILL,this.stopSkill,this),l.default.ins.watch(l.EGameEvent.STOP_SKILL,this.stopSkill,this)},e.prototype.setIcon=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,c.default.Instance().loadAndGetRes("res","image/skillCards/icon"+this.id,cc.SpriteFrame)];case 1:return t=e.sent(),this.icon.spriteFrame=t,[2]}})})},e.prototype.updateState=function(){this.state==o.normal?(this.normal.active=!0,this.pressed.active=!1,this.progress.node.active=!1,this.used.active=!1):this.state==o.pressed?(this.normal.active=!1,this.pressed.active=!0,this.progress.node.active=!1,this.used.active=!1):this.state==o.cd?(this.normal.active=!1,this.pressed.active=!0,this.progress.node.active=!0,this.used.active=!1):this.state==o.used&&(this.normal.active=!1,this.pressed.active=!1,this.progress.node.active=!1,this.used.active=!0)},e.prototype.addTouchEvt=function(){this.node.on(h.touch_start,this.onCtrl,this),this.node.on(h.touch_move,this.onCtrl,this),this.node.on(h.touch_cancel,this.onCtrl,this),this.node.on(h.touch_end,this.onCtrl,this)},e.prototype.closeTouchEvt=function(){this.node.off(h.touch_start,this.onCtrl,this),this.node.off(h.touch_move,this.onCtrl,this),this.node.off(h.touch_cancel,this.onCtrl,this),this.node.off(h.touch_end,this.onCtrl,this)},e.prototype.onCtrl=function(t){var e=t,i=t;e.type==h.touch_start?(this.startPos.x=i.getLocationX(),this.startPos.y=i.getLocationY(),this.state=o.pressed,this.updateState()):e.type==h.touch_move||(this.startPos.x-=i.getLocationX(),this.startPos.y-=i.getLocationY(),this.startPos.lengthSqr()<=25?this.runSkill():(this.state=o.normal,this.updateState()))},e.prototype.runSkill=function(){switch(this.closeTouchEvt(),h.default.ins.runSkill(this.id),this.id){case r.ESkillType.ice:this.state=o.cd,this.accTime=0;var t=h.default.ins.findSkillByType(this.id);this.setTime=t&&t.getProp()||0,this.run=!0;break;case r.ESkillType.wave:case r.ESkillType.bait:case r.ESkillType.morale:case r.ESkillType.meteor:case r.ESkillType.push:case r.ESkillType.recover:this.state=o.used;break;case r.ESkillType.buff:this.state=o.cd}this.updateState()},e.prototype.update=function(t){this.run&&(this.accTime+=t*this.timeScale,this.accTime>=this.setTime?(this.progress.fillRange=0,this.run=!1,this.state=o.used,this.updateState()):this.progress.fillRange=1-this.accTime/this.setTime)},e.prototype.stopSkill=function(t){this.id==t&&t==r.ESkillType.buff&&(this.state=o.used,this.updateState())},__decorate([u],e)}(s.default);n.default=p,cc._RF.pop()},{}],SkillGetPanel:[function(t,e,i){"use strict";cc._RF.push(e,"3a5434zvVhO9IE9IzEaoKs+","SkillGetPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("AudioMgr"),l=a("DataMgr"),c=a("EventMgr"),h=a("typeEnum"),d=a("SkillItemForGet"),u=cc._decorator,p=u.ccclass,f=u.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.more=null,e.one=null,e.item=null,e.arr=null,e}return __extends(e,t),e.prototype.initWithParam=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a,n=this;return __generator(this,function(o){switch(o.label){case 0:if(this.more.removeAllChildren(),this.one.removeAllChildren(),!t)return[3,6];if(this.arr=t,!(t.length>1))return[3,5];e=function(e){var i;return __generator(this,function(a){switch(a.label){case 0:return i=cfgTable.cardskillData[t[e]],[4,new Promise(function(a){n.scheduleOnce(function(){n.createItem(t[e],i),e==t.length-1&&n.scheduleOnce(n.emitCloseMe,2.5),a(1)},.2)})];case 1:return a.sent(),[2]}})},i=0,o.label=1;case 1:return i<t.length?[5,e(i)]:[3,4];case 2:o.sent(),o.label=3;case 3:return++i,[3,1];case 4:return[3,6];case 5:for(i=0;i<t.length;++i)a=cfgTable.cardskillData[t[i]],this.createItem1(t[i],a),i==t.length-1&&this.scheduleOnce(this.emitCloseMe,2.5);o.label=6;case 6:return[2]}})})},e.prototype.createItem=function(t,e){var i=cc.instantiate(this.item);i.getComponent(d.default).setData(t),this.more.addChild(i),r.default.Instance().playEffect(9),this.findSame(e.ID)||cc.tween(i).to(.15,{scale:1.3}).to(.2,{scale:1}).start()},e.prototype.createItem1=function(t,e){var i=cc.instantiate(this.item);i.getComponent(d.default).setData(t),this.one.addChild(i),r.default.Instance().playEffect(9),this.findSame(e.ID)||cc.tween(i).to(.15,{scale:1.3}).to(.2,{scale:1}).start()},e.prototype.onDestroy=function(){c.default.Instance().emitRefreshSkillUI(),l.default.Instance().getPlayerData().getGuideStep()==h.GuideStep.SkillClickNewSkill&&o.Global.guideMgr.showGuidePanel()},e.prototype.start=function(){},e.prototype.findSame=function(t){for(var e=!1,i=l.default.Instance().getPlayerData().getSkillIdList(),a=0;a<i.length;++a)i[a].ID==t&&(e=!0);return e},__decorate([f(cc.Node)],e.prototype,"more",void 0),__decorate([f(cc.Node)],e.prototype,"one",void 0),__decorate([f(cc.Prefab)],e.prototype,"item",void 0),__decorate([p],e)}(s.default);n.default=g,cc._RF.pop()},{}],SkillInfoPanel:[function(t,e,i){"use strict";cc._RF.push(e,"d80f2mvLBlEOK3/P1QKk/nB","SkillInfoPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("DataMgr"),l=a("EventMgr"),c=a("typeEnum"),h=a("SkillItemScript"),d=cc._decorator,u=d.ccclass,p=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprs=[],e.isFullScreen=!1,e}return __extends(e,t),e.prototype.initWithParam=function(t){this.showEffect(),this.init(t)},e.prototype.init=function(t){this.id=t.ID,this.level=t.level,this.count=t.count,this.cfg=cfgTable.cardskillData[this.id],this.param=t,this.playerData=r.default.Instance().getPlayerData(),this.initUI(),this.initBtn(),this.initEvent(),this.initGuide()},e.prototype.initUI=function(){var t=this.node.getChildByName("Panel");this.upgradeBtn=t.getChildByName("upgradeBtn"),this.equipBtn=t.getChildByName("equipBtn"),this.removeBtn=t.getChildByName("removeBtn"),this.closeBtn=t.getChildByName("close"),this.skillItem=t.getChildByName("skillItem").getComponent(h.default),this.skillName=t.getChildByName("skillName").getComponent(cc.Label),this.skillInfo=t.getChildByName("skillInfo").getComponent(cc.RichText),this.param.showEquipText=!1,this.skillItem.setData(this.param),this.skillName.string=this.cfg.name;var e=0;if(this.param.level<=0)e=this.cfg.typenumber;else{for(var i=0,a=0;a<this.level;++a)i+=this.cfg.level[a][1];e=this.cfg.typenumber+i}var n=o.Global.languageMgr.getText(Number(this.cfg.typetext));1!=this.id&&(e=Number((100*e).toFixed(0))),n=n.replace("{0}",e.toString()),n=this.cfg.level[this.level]&&this.count>=this.cfg.level[this.level][0]&&1!=this.id?n.replace("{1}","<color=#00ff00>(+"+(100*this.cfg.level[this.level][1]).toFixed(0)+"%)</c>"):this.cfg.level[this.level]&&this.count>=this.cfg.level[this.level][0]&&1==this.id?n.replace("{1}","<color=#00ff00>(+"+this.cfg.level[this.level][1]+"\u79d2)</c>"):n.replace("{1}",""),this.skillInfo.string=n},e.prototype.initBtn=function(){var t=this.upgradeBtn.getComponent(cc.Sprite),e=this.upgradeBtn.getComponent(cc.Button);t.spriteFrame=this.sprs[0],this.level>=this.cfg.level.length&&(this.upgradeBtn.getChildByName("upgradeBtnLabel").getComponent(cc.Label).string="max",t.spriteFrame=this.sprs[1],e.enabled=!1),this.cfg.level[this.level]&&this.count<this.cfg.level[this.level][0]&&(t.spriteFrame=this.sprs[1],e.enabled=!1),this.equipBtn.active=!1,this.removeBtn.active=!1,-1==this.playerData.getSkillSlot().indexOf(this.id)?this.equipBtn.active=!0:this.removeBtn.active=!0},e.prototype.initEvent=function(){this.closeBtn.off("click",this.emitCloseMe,this),this.upgradeBtn.off("click",this.onUpgradesBtnClick,this),this.equipBtn.off("click",this.onEquipBtnClick,this),this.removeBtn.off("click",this.onRemoveBtnClick,this),this.closeBtn.on("click",this.emitCloseMe,this),this.upgradeBtn.on("click",this.onUpgradesBtnClick,this),this.equipBtn.on("click",this.onEquipBtnClick,this),this.removeBtn.on("click",this.onRemoveBtnClick,this)},e.prototype.start=function(){},e.prototype.onUpgradesBtnClick=function(){var t=this.playerData.setSkillLevelUp(this.id),e={ID:t.ID,level:t.level,count:t.count,cfg:cfgTable.cardskillData[t.ID]};this.init(e),l.default.Instance().emitRefreshSkillUI()},e.prototype.onEquipBtnClick=function(){for(var t=this.playerData.getSkillSlot(),e=cfgTable.commonData.skill_slot,i=!1,a=0;a<t.length;a++){var n=!0;if(this.playerData.getTimeLine()>e[a]-1&&(n=!1),!n&&0==t[a]){this.playerData.setSkillSlot(this.id,a),i=!0;break}}!i&&this.playerData.setSkillSlot(this.id,0),this.playerData.getGuideStep()==c.GuideStep.SkillClickEquipSkill&&o.Global.guideMgr.changeGuideStep(c.GuideStep.SkillClickEquipSkill,c.GuideStep.SkillCheckSkillSlot),this.closeSelf()},e.prototype.onRemoveBtnClick=function(){for(var t=this.playerData.getSkillSlot(),e=0;e<t.length;e++)t[e]==this.id&&this.playerData.setSkillSlot(0,e);this.closeSelf()},e.prototype.closeSelf=function(){l.default.Instance().emitRefreshSkillUI(),this.playerData.getGuideStep()==c.GuideStep.SkillCheckSkillSlot&&o.Global.guideMgr.showGuidePanel(),this.emitCloseMe()},e.prototype.initGuide=function(){var t=this;this.scheduleOnce(function(){t.playerData.getGuideStep()==c.GuideStep.SkillClickEquipSkill&&o.Global.guideMgr.showGuidePanel(t.node)})},__decorate([p({type:cc.SpriteFrame,name:"\u8d44\u6e90"})],e.prototype,"sprs",void 0),__decorate([u],e)}(s.default);n.default=f,cc._RF.pop()},{}],SkillItemForGet:[function(t,e,i){"use strict";cc._RF.push(e,"e0285it5r9Feo5oJa1CzUS5","SkillItemForGet");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("ConfigMgr"),s=a("DataMgr"),r=a("ResMgr"),l=cc._decorator,c=l.ccclass,h=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.logo=null,e.isNewLogo=null,e.content=null,e}return __extends(e,t),e.prototype.setData=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a,n,l=this;return __generator(this,function(c){switch(c.label){case 0:return e=s.default.Instance().getPlayerData(),i=o.default.Instance().getTableValue("ID",t,cfgTable.cardskillData),a=!1,n=this.logo,[4,r.default.Instance().loadAndGetRes("res","image/skillCards/"+i.picture,cc.SpriteFrame)];case 1:return n.spriteFrame=c.sent(),[4,new Promise(function(i){for(var n=e.getSkillIdList(),o=0;o<n.length;++o)n[o].ID==t&&(a=!0);l.isNewLogo.active=!a,i(1)})];case 2:return c.sent(),e.setSkillIdList(t),this.showEffect(),[2]}})})},e.prototype.showEffect=function(){cc.tween(this.node).to(.5,{opacity:255}).start()},__decorate([h({type:cc.Sprite,displayName:"\u4eba\u7269"})],e.prototype,"logo",void 0),__decorate([h({type:cc.Node,displayName:"\u65b0\u5361\u6807\u5fd7"})],e.prototype,"isNewLogo",void 0),__decorate([h({type:cc.Node,displayName:"\u5185\u5bb9"})],e.prototype,"content",void 0),__decorate([c],e)}(cc.Component);n.default=d,cc._RF.pop()},{}],SkillItemScript:[function(t,e,i){"use strict";cc._RF.push(e,"39914hMmC5LhLi4eL4O0n6s","SkillItemScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("DataMgr"),r=a("EventMgr"),l=a("ResMgr"),c=a("typeEnum"),h=a("SuperListItem"),d=cc._decorator,u=d.ccclass,p=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprs=[],e}return __extends(e,t),e.prototype.setData=function(t){this.id=t.ID,this.level=t.level,this.count=t.count,this.showEquipText=t.showEquipText,this.cfg=cfgTable.cardskillData[this.id],this.playerData=s.default.Instance().getPlayerData(),this.init(),this.initEvent()},e.prototype.onLoad=function(){this.content=this.node.getChildByName("content"),this.progressBar=this.content.getChildByName("progressBar"),this.bar=this.progressBar.getChildByName("bar").getComponent(cc.Sprite),this.progressLabel=this.content.getChildByName("progressLabel").getComponent(cc.Label),this.levelLabel=this.content.getChildByName("levelLabel").getComponent(cc.Label),this.iconBg=this.content.getChildByName("iconBg"),this.icon=this.iconBg.getChildByName("icon").getComponent(cc.Sprite),this.upgrade=this.node.getChildByName("upgrade"),this.equippedLabel=this.node.getChildByName("equippedLabel")},e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.level>=this.cfg.level.length?(this.bar.fillRange=1,this.progressLabel.string="max",this.bar.spriteFrame=this.sprs[0]):this.cfg.level[this.level]&&(this.bar.fillRange=this.count/this.cfg.level[this.level][0],this.bar.spriteFrame=this.count>=this.cfg.level[this.level][0]?this.sprs[1]:this.sprs[0],this.progressLabel.string=this.count+"/"+this.cfg.level[this.level][0]),this.levelLabel.string="level"+(this.level+1),this.cfg.level[this.level]?this.upgrade.active=this.count>=this.cfg.level[this.level][0]:this.upgrade.active=!1,t=this.icon,[4,l.default.Instance().loadAndGetRes("res","image/skillCards/"+this.cfg.picture,cc.SpriteFrame)];case 1:return t.spriteFrame=e.sent(),-1!=this.playerData.getSkillSlot().indexOf(this.id)&&this.showEquipText?(this.content.opacity=160,this.equippedLabel.opacity=255):(this.content.opacity=255,this.equippedLabel.opacity=0),[2]}})})},e.prototype.initEvent=function(){this.node.on("click",this.openSkillInfoPanel,this)},e.prototype.openSkillInfoPanel=function(){this.playerData.getGuideStep()==c.GuideStep.SkillClickNewSkill&&o.Global.guideMgr.changeGuideStep(c.GuideStep.SkillClickNewSkill,c.GuideStep.SkillClickEquipSkill);var t={ID:this.id,level:this.level,count:this.count,cfg:this.cfg};r.default.Instance().emitShowPanel({data:t,prefab:"prefab/skill/SkillInfoPanel"})},__decorate([p({type:cc.SpriteFrame,name:"\u8d44\u6e90"})],e.prototype,"sprs",void 0),__decorate([u],e)}(h.default);n.default=f,cc._RF.pop()},{}],SkillMgr:[function(t,e,i){"use strict";cc._RF.push(e,"f4ac9tydhVNUpgMm6C2u5JR","SkillMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.EFightPanel=n.touch_cancel=n.touch_end=n.touch_move=n.touch_start=void 0;var o,s=a("Global"),r=a("SkillBase"),l=a("Skill_Bait"),c=a("Skill_Buff"),h=a("Skill_Ice"),d=a("Skill_Meteor"),u=a("Skill_Morale"),p=a("Skill_Push"),f=a("Skill_Recover"),g=a("Skill_Wave"),m=a("TalentBase"),y=a("typeEnum"),v=a("BossEnemy"),b=a("BossRole"),_=a("LegendRoleBase"),T=a("ZembieRoleBase"),S=a("BattleFightPanel"),D=a("RoleBase"),k=a("SkillBtnItem"),C=a("AudioMgr"),I=a("ConfigMgr"),B=a("DataMgr"),w=a("Observer");n.touch_start=cc.Node.EventType.TOUCH_START,n.touch_move=cc.Node.EventType.TOUCH_MOVE,n.touch_end=cc.Node.EventType.TOUCH_END,n.touch_cancel=cc.Node.EventType.TOUCH_CANCEL,function(t){t[t.battle=1]="battle",t[t.Zembie=2]="Zembie",t[t.Legend=3]="Legend",t[t.boss=4]="boss"}(o=n.EFightPanel||(n.EFightPanel={}));var P=function(){function t(){this.id=0,this.allList=[],this.updateList=[],this.skillBtnItemArr=[],this.timeScale=1,w.default.ins.watch(w.EGameEvent.STOP_SKILL,this.stopSkill,this)}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.init=function(t,e){this.allList=[],this.updateList=[],this.panelType=t,this.panel=e,this.initSkill()},t.prototype.initSkill=function(){var t=B.default.Instance().getPlayerData(),e=t.getSkillSlot()||[0,0,0],i=cfgTable.commonData.skill_slot,a=t.getTimeLine(),n=a>=i[0],o=cc.find("uiPanel/buttonRoot/skill",this.panel.node);if(n)for(var s=cc.find("layout",o),r=cc.find("layout/skill",o),l=-1,c=0;c<i.length;c++){var h=void 0;if(a>=i[c]){if(0==++l)h=r.getComponent(k.default);else{var d=cc.instantiate(r);d.parent=s,h=d.getComponent(k.default)}h.init(e[c]),this.skillBtnItemArr.push(h)}}else o.active=!1},t.prototype.getEnemyList=function(){var t=[];return this.panelType==o.battle?S.default.enemyList.forEach(function(e){t.push(e)}):this.panelType==o.Zembie?this.panel.enemyList.forEach(function(e){t.push(e)}):this.panelType==o.Legend?this.panel.enemyList.forEach(function(e){t.push(e)}):this.panelType==o.boss&&this.panel.enemyList.forEach(function(e){t.push(e)}),t},t.prototype.getRoleList=function(){var t=[];return this.panelType==o.battle?S.default.roleList.forEach(function(e){t.push(e)}):this.panelType==o.Zembie?this.panel.roleList.forEach(function(e){t.push(e)}):this.panelType==o.Legend?this.panel.roleList.forEach(function(e){t.push(e)}):this.panelType==o.boss&&this.panel.roleList.forEach(function(e){t.push(e)}),t},t.prototype.runSkill=function(e){var i,a=this,n=cfgTable.cardskillData[e].type,o=this.getEnemyList(),s=this.getRoleList(),m=cfgTable.cardskillData[e].audio;switch(n){case r.ESkillType.ice:C.default.Instance().playEffect(m),o.forEach(function(e){if(t.ins.isEnemy(e)){a.id++;var i=new h.default;i.init(r.ESkillType.ice,a.id),i.setTarget(e),i.runSkill(),a.allList.push(i),a.updateList.push(i)}});break;case r.ESkillType.wave:C.default.Instance().playEffect(m),s.forEach(function(e){if(t.ins.isRole(e)){a.id++;var i=new g.default;i.init(r.ESkillType.wave,a.id),i.setTarget(e),i.runSkill(),a.allList.push(i)}});break;case r.ESkillType.bait:C.default.Instance().playEffect(m),this.id++,(i=new l.default).init(r.ESkillType.bait,this.id),i.setTarget(null),i.runSkill(),this.allList.push(i),this.updateList.push(i);break;case r.ESkillType.morale:C.default.Instance().playEffect(m),s.forEach(function(e){if(t.ins.isRole(e)){a.id++;var i=new u.default;i.init(r.ESkillType.morale,a.id),i.setTarget(e),i.runSkill(),a.allList.push(i)}});break;case r.ESkillType.buff:C.default.Instance().playEffect(m),this.id++,(i=new c.default).init(r.ESkillType.buff,this.id),i.setTarget(null),this.allList.push(i);break;case r.ESkillType.meteor:C.default.Instance().playEffect(36),this.id++,(i=new d.default).init(r.ESkillType.meteor,this.id),i.setTarget(null),i.runSkill(),this.allList.push(i),this.updateList.push(i);break;case r.ESkillType.push:C.default.Instance().playEffect(m),o.forEach(function(e){if(t.ins.isEnemy(e)){a.id++;var i=new p.default;i.init(r.ESkillType.push,a.id),i.setTarget(e),i.runSkill(),a.allList.push(i)}});break;case r.ESkillType.recover:C.default.Instance().playEffect(m),s.forEach(function(e){if(t.ins.isRole(e)){a.id++;var i=new f.default;i.init(r.ESkillType.recover,a.id),i.setTarget(e),i.runSkill(),a.allList.push(i)}})}},t.prototype.stopSkill=function(t,e,i){for(var a=0;a<this.updateList.length;a++)if(this.updateList[a].uid==i){this.updateList.splice(a,1);break}},t.prototype.update=function(t){if(this.updateList)for(var e=0;e<this.updateList.length;e++)this.updateList[e].update(t)},t.prototype.isFrozen=function(t){for(var e=0;e<this.updateList.length;e++){var i=this.updateList[e];if(i.type==r.ESkillType.ice&&i.target===t)return!0}},t.prototype.findSkillByType=function(t){if(this.allList)for(var e=0;e<this.allList.length;e++){var i=this.allList[e];if(i.type==t)return i}},t.prototype.findSkillByUid=function(t){if(this.allList)for(var e=0;e<this.allList.length;e++){var i=this.allList[e];if(i.uid==t)return i}},t.prototype.getFirstBaseAtk=function(){var t=this.getFirstWarriorId(),e=this.getCfgData();return I.default.Instance().getTableValue("warriorsid",t,e).attack},t.prototype.getFirstAtk=function(){var t=this.getFirstBaseAtk(),e=s.Global.common.getCardAtkRate();return t*(1+s.Global.common.getTalentVal(m.ETalentType.armyAtk)[0]+e+s.Global.equipMgr.getProp(m.ETalentType.armyAtk,y.EquipGlobalType.global))},t.prototype.getFirstBaseHp=function(){var t=this.getFirstWarriorId(),e=this.getCfgData(),i=I.default.Instance().getTableValue("warriorsid",t,e);return Number(i.hp)},t.prototype.getFirstHp=function(){var t=this.getFirstBaseHp(),e=s.Global.common.getCardHpRate();return t*(1+s.Global.common.getTalentVal(m.ETalentType.armyHp)[0]+e+s.Global.equipMgr.getProp(m.ETalentType.armyHp,y.EquipGlobalType.global))},t.prototype.getFirstMeat=function(){var t=this.getFirstWarriorId(),e=this.getCfgData(),i=I.default.Instance().getTableValue("warriorsid",t,e);return Number(i.Needfood)},t.prototype.getFirstWarriorId=function(){return this.panel.getWarriorsInof()[0].warriorsid},t.prototype.getCfgData=function(){return this.panelType==o.battle?cfgTable.warriorsData:this.panelType==o.Zembie?cfgTable.zoombiewarriorsData:this.panelType==o.Legend?cfgTable.legendswarriorsData:this.panelType==o.boss?cfgTable.bosswarriorsData:void 0},t.prototype.buffSkillWork=function(t){var e=this.findSkillByType(r.ESkillType.buff);e&&(e.used||(e.setTarget(t),e.runSkill()))},t.prototype.isEnemy=function(t){var e=t instanceof D.RoleBase,i=t instanceof T.ZembieRoleBase,a=t instanceof _.LegendRoleBase,n=t instanceof v.BossEnemy;return e||i||a||n},t.prototype.isRole=function(t){var e=t instanceof D.RoleBase,i=t instanceof T.ZembieRoleBase,a=t instanceof _.LegendRoleBase,n=t instanceof v.BossEnemy||t instanceof b.BossRole;return e||i||a||n},t}();n.default=P,cc._RF.pop()},{}],SkillSlotItemScript:[function(t,e,i){"use strict";cc._RF.push(e,"33aa9vJJPJIM4ttJzNJft5Y","SkillSlotItemScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("DataMgr"),r=a("EventMgr"),l=a("ResMgr"),c=a("SuperListItem"),h=cc._decorator,d=h.ccclass,u=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lockNode=null,e.lockNodeLabel=null,e.unlockNode=null,e.unlockNodeIcon=null,e.id=0,e.isLock=!0,e}return __extends(e,t),e.prototype.setData=function(t){this.id=t.id,this.isLock=t.lock,this.timeLineLimit=t.timeLineLimit,this.initUI()},e.prototype.onLoad=function(){this.lockNode=this.node.getChildByName("lockNode"),this.lockNodeLabel=this.lockNode.getChildByName("lockLabel").getComponent(cc.Label),this.unlockNode=this.node.getChildByName("unlockNode"),this.unlockNodeIcon=this.unlockNode.getChildByName("icon").getComponent(cc.Sprite)},e.prototype.start=function(){},e.prototype.initUI=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.lockNode.active=this.isLock,this.unlockNode.active=!this.isLock,this.id?(t=this.unlockNodeIcon,[4,l.default.Instance().loadAndGetRes("res","image/skillCards/icon"+this.id,cc.SpriteFrame)]):[3,2];case 1:return t.spriteFrame=e.sent(),this.unlockNode.on(cc.Node.EventType.TOUCH_START,this.clickSkill,this),[3,3];case 2:this.unlockNodeIcon.spriteFrame=null,this.unlockNode.off(cc.Node.EventType.TOUCH_START,this.clickSkill,this),e.label=3;case 3:return this.isLock&&(this.lockNodeLabel.string=o.Global.languageMgr.getText(913001)+this.timeLineLimit),[2]}})})},e.prototype.clickSkill=function(){for(var t=0,e=s.default.Instance().getPlayerData().getSkillIdList();t<e.length;t++){var i=e[t];if(i.ID==this.id){var a={ID:this.id,level:i.level,count:i.count,cfg:cfgTable.cardskillData[this.id]};r.default.Instance().emitShowPanel({data:a,prefab:"prefab/skill/SkillInfoPanel"});break}}},__decorate([d],e)}(c.default));n.default=u,cc._RF.pop()},{}],SkillUIScript:[function(t,e,i){"use strict";cc._RF.push(e,"6e109I+kfZIArKek/HZ99ui","SkillUIScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("DataMgr"),r=a("EventMgr"),l=a("typeEnum"),c=a("SuperScrollView"),h=a("UtilOne"),d=cc._decorator,u=d.ccclass,p=d.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprs=[],e.skillSlotBG=null,e.skillSlotScrollView=null,e.skillScrollView=null,e.singleDrawBtn=null,e.tenDrawBtn=null,e.maxNode=null,e.playerData=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.playerData=s.default.Instance().getPlayerData(),this.singleDrawBtn=this.node.getChildByName("singleDrawBtn"),this.tenDrawBtn=this.node.getChildByName("tenDrawBtn"),this.skillSlotBG=this.node.getChildByName("skillSlotBG").getComponent(cc.Sprite),this.skillSlotScrollView=this.skillSlotBG.node.getChildByName("skillSlotScrollView").getComponent(c.default),this.skillScrollView=this.node.getChildByName("skillScrollView").getComponent(c.default),this.maxNode=this.node.getChildByName("maxNode");var t=this.node.getChildByName("potionBottleBg");this.potionBottleNum=t.getChildByName("potionBottleNum").getComponent(cc.Label),this.initSkillList(),this.initBtn(),this.initUI(),this.initCoinText(),this.initEvent(),this.initGuide()},e.prototype.onEnable=function(){this.initSkillSlot(),this.initCoinText()},e.prototype.start=function(){},e.prototype.initSkillSlot=function(){for(var t=[],e=this.playerData.getSkillSlot(),i=cfgTable.commonData.skill_slot,a=0;a<e.length;a++){var n=!0;this.playerData.getTimeLine()>i[a]-1&&(n=!1),t.push({id:e[a],lock:n,timeLineLimit:i[a]})}this.skillSlotScrollView.setData(t)},e.prototype.initSkillList=function(){var t=new Array;(t=this.playerData.getSkillIdList()).sort(function(t,e){return Number(t.ID)-Number(e.ID)});for(var e=[],i=0;i<t.length;i++)e.push({ID:t[i].ID,level:t[i].level,count:t[i].count,showEquipText:!0});this.skillScrollView.setData(e)},e.prototype.initBtn=function(){this.singleDrawBtn.on("click",this.singleDraw,this),this.tenDrawBtn.on("click",this.tenDraw,this)},e.prototype.initUI=function(){var t=cfgTable.cardskillData,e=[];for(var i in t)e.push({ID:t[i].ID,maxCount:t[i].maxnumber});this.playerData.setSkillTotalCount(e);var a=o.Global.common.allSkillIsMax();this.maxNode.active=a,this.singleDrawBtn.active=!a,this.tenDrawBtn.active=!a;var n=this.singleDrawBtn.getChildByName("lettleGreen"),s=this.singleDrawBtn.getChildByName("needCoin"),c=this.singleDrawBtn.getChildByName("free");this.playerData.getFreeGetSkill()?(n.active=!1,s.active=!1,c.active=!0):(n.active=!0,s.active=!0,c.active=!1);var h=[];h[0]=o.Global.languageMgr.getText(933112);var d=this.playerData.getSkillIdList().length+"/"+Object.getOwnPropertyNames(cfgTable.cardskillData).length;h.push(d),r.default.Instance().emitUpdateMainPanelTitle(h,l.MainPanelTitleType.ShowTextAndNum)},e.prototype.initCoinText=function(t){void 0===t&&(t=0),this.potionBottleNum.string=t?""+h.default.ChangeNumberUnit(t):this.playerData.getPotionStr();var e=cfgTable.commonData.skillcostcard,i=cfgTable.commonData.skilltencostcard,a=this.singleDrawBtn.getChildByName("needCoin").getComponent(cc.Label),n=this.tenDrawBtn.getChildByName("needCoin").getComponent(cc.Label);this.playerData.getPotion()<i?(this.tenDrawBtn.getComponent(cc.Sprite).setMaterial(0,this.sprs[0]),n.node.color=cc.color().fromHEX("#FF0000")):(this.tenDrawBtn.getComponent(cc.Sprite).setMaterial(0,this.sprs[1]),n.node.color=cc.color().fromHEX("#FFFFFF")),this.playerData.getPotion()<e&&!this.playerData.getFreeGetSkill()?(this.singleDrawBtn.getComponent(cc.Sprite).setMaterial(0,this.sprs[0]),a.node.color=cc.color().fromHEX("#FF0000")):(this.singleDrawBtn.getComponent(cc.Sprite).setMaterial(0,this.sprs[1]),a.node.color=cc.color().fromHEX("#FFFFFF")),a.string=""+e,n.string=""+i},e.prototype.initEvent=function(){r.default.Instance().onRefreshSkillUI(this.initSkillSlot,this),r.default.Instance().onRefreshSkillUI(this.initSkillList,this),r.default.Instance().onRefreshSkillUI(this.initUI,this),r.default.Instance().onRefreshSkillUI(this.initCoinText,this),r.default.Instance().onRefreshSkillUI(this.initBtn,this),r.default.Instance().onPotionChange(this.initCoinText,this)},e.prototype.singleDraw=function(){if(this.playerData.getFreeGetSkill())this.playerData.setFreeGetSkill(!1);else{var t=cfgTable.commonData.skillcostcard;if(this.playerData.getPotion()<t)return void r.default.Instance().emitTips(o.Global.languageMgr.getText(933116));this.playerData.setPotion(-t)}this.drawSkills(1),this.playerData.getGuideStep()==l.GuideStep.SKillClickDrawSkill&&o.Global.guideMgr.changeGuideStep(l.GuideStep.SKillClickDrawSkill,l.GuideStep.SkillClickNewSkill)},e.prototype.tenDraw=function(){var t=cfgTable.commonData.skilltencostcard;this.playerData.getPotion()<t?r.default.Instance().emitTips(o.Global.languageMgr.getText(933116)):(this.playerData.setPotion(-t),this.drawSkills(10))},e.prototype.drawSkills=function(t){var e=this,i=[];this.singleDrawBtn.targetOff(this),this.tenDrawBtn.targetOff(this);for(var a=function t(){var a=cfgTable.cardskilllevelData[e.playerData.getTakeSkillLevel()+""],n=a.probability,o=h.default.get_weight_random(n,"1"),s=a.probability[o][0],r=[];for(var l in cfgTable.cardskillData)Number(cfgTable.cardskillData[l].cardid)==s&&r.push(cfgTable.cardskillData[l]);var c=r[Math.floor(Math.random()*r.length)];if(e.playerData.subSkillTotalCount(c.ID))i.push(c.ID),e.playerData.setTakeSkillCount();else for(var d=0,u=e.playerData.getSkillTotalCount();d<u.length;d++)if(u[d].maxCount>0){t();break}},n=!0,o=0;o<t;o++)0==this.playerData.getSkillIdList().length&&n?(i.push(1),this.playerData.subSkillTotalCount(1),this.playerData.setTakeSkillCount(),n=!1):a();i.length<=0||r.default.Instance().emitShowPanel({data:i,prefab:"prefab/skill/SkillGetPanel"})},e.prototype.initGuide=function(){var t=this,e=s.default.Instance().getPlayerData().getGuideStep();e!=l.GuideStep.SKillClickDrawSkill&&e!=l.GuideStep.SkillClickNewSkill&&e!=l.GuideStep.SkillCheckSkillSlot||this.scheduleOnce(function(){o.Global.guideMgr.showGuidePanel(t.node)})},__decorate([p({type:cc.Material,displayName:"\u6309\u94ae\u66f4\u6362\u56fe\u7247"})],e.prototype,"sprs",void 0),__decorate([u],e)}(cc.Component);n.default=f,cc._RF.pop()},{}],Skill_Bait:[function(t,e,i){"use strict";cc._RF.push(e,"f1c337WvAJAML3XYhRalZq7","Skill_Bait");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("DataMgr"),s=a("Observer"),r=a("ResMgr"),l=a("SkillMgr"),c=a("BattleFightPanel"),h=a("BaitRole"),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.setTime=.8,e.accTime=0,e}return __extends(e,t),e.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.hpRate=this.getProp(),this.baitNum=cfgTable.commonData.skill_3,this.curNum=0},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.runSkill=function(){this.accTime=this.setTime},e.prototype.createBait=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,s,d;return __generator(this,function(u){switch(u.label){case 0:return t=l.default.ins.panel,e=1e4,[4,r.default.Instance().loadAndGetRes("bait","Role_"+e,cc.Prefab)];case 1:return i=u.sent(),a=cc.instantiate(i),t.id++,a.name=t.id+"",a.x=0,n=a.getComponent(h.default),t.gameFactory.addChild(a),a.opacity=0,a.scaleX=1,a.setPosition(t.Birthpoint.myBirthpoint),s=n,1==o.default.Instance().getPlayerData().getTimeScaleData().isOpen&&(n.moveSpeedScale=2,n.animTimeScale=2,n.attackTimeScale=.5),l.default.ins.panelType==l.EFightPanel.battle?c.default.roleList.push(s):l.default.ins.panelType==l.EFightPanel.Zembie?l.default.ins.panel.roleList.push(s):l.default.ins.panelType==l.EFightPanel.Legend?l.default.ins.panel.roleList.push(s):l.default.ins.panelType==l.EFightPanel.boss&&l.default.ins.panel.roleList.push(s),n.initRole(!1,e,t.id,l.default.ins.panel),d=l.default.ins.getFirstHp()*this.hpRate,n.setHp(d),n.setCurHp(d),[2]}})})},e.prototype.update=function(t){this.accTime+=t,this.accTime>=this.setTime&&(this.createBait(),this.accTime=0,this.curNum++,this.curNum>=this.baitNum&&s.default.ins.notice(s.EGameEvent.STOP_SKILL,this.type,this.target,this.uid))},e}(a("SkillBase").default);n.default=d,cc._RF.pop()},{}],Skill_Buff:[function(t,e,i){"use strict";cc._RF.push(e,"aabcdqDZDFOB4X6nsLk7/6u","Skill_Buff");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Observer"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.used=!1,e.scaleNum=1,e}return __extends(e,t),e.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.hpAndAtkRate=this.getProp(),this.scaleNum=cfgTable.commonData.skill_5},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.runSkill=function(){this.used=!0,this.addHpAndAtk(),o.default.ins.notice(o.EGameEvent.STOP_SKILL,this.type,this.target,this.uid)},e.prototype.addHpAndAtk=function(){var t=this.target,e=t.getAtk();e*=1+this.hpAndAtkRate,t.setAtk(e);var i=t.getHp();t.getCurHp(),i*=1+this.hpAndAtkRate,this.hpAndAtkRate,t.setHp(i),t.setCurHp(i),t.node.scale=this.scaleNum;var a=t.bady.spriteFrame.getRect().height;a*=this.scaleNum,t.physics.offset=cc.v2(0,a/4),t.physics.radius=a/4,t.physics.apply()},e}(a("SkillBase").default);n.default=s,cc._RF.pop()},{}],Skill_Ice:[function(t,e,i){"use strict";cc._RF.push(e,"969a12abcpNmrW3wwf/0Xyz","Skill_Ice");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Observer"),s=a("ResMgr"),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.frozenTime=this.getProp(),this.accTime=0},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.runSkill=function(){this.createIce()},e.prototype.createIce=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o;return __generator(this,function(r){switch(r.label){case 0:return(t=this.target)&&t.isValid&&t.bady.node?((e=new cc.Node("iceNode")).parent=t.node,i=e.addComponent(cc.Sprite),[4,s.default.Instance().loadAndGetRes("res","skill/bingdong",cc.SpriteFrame)]):[2];case 1:return a=r.sent(),i.spriteFrame=a,this.iceSprite=i,n={w:96,h:86},o=Math.max(t.bady.node.width/n.w,t.bady.node.height/n.h),e.width=o*n.w,e.height=o*n.h,e.x=0,e.y=t.bady.node.height/2,t.physics.sensor=!0,t.physics.apply(),t.anim.pause(),[2]}})})},e.prototype.destroyIce=function(){var t=this.target;this.iceSprite&&this.iceSprite.node&&this.iceSprite.node.isValid&&(this.iceSprite.node.destroy(),this.iceSprite=null),t&&t.isValid&&(t.physics.sensor=!1,t.physics.apply(),t.anim.resume())},e.prototype.update=function(t){this.accTime+=t,this.accTime>=this.frozenTime&&(this.accTime=0,o.default.ins.notice(o.EGameEvent.STOP_SKILL,this.type,this.target,this.uid),this.destroyIce())},e}(a("SkillBase").default);n.default=r,cc._RF.pop()},{}],Skill_Meteor:[function(t,e,i){"use strict";cc._RF.push(e,"36454y0V55EhLAnm+RAOE99","Skill_Meteor");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("AudioMgr"),r=a("EventMgr"),l=a("Observer"),c=a("ResMgr"),h=a("SkillMgr"),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.battleRect={x:0,y:10,w:600,h:190},e.zembieRect={x:42,y:79,w:640,h:190},e.legendRect={x:42,y:79,w:640,h:190},e.bossRect={x:42,y:79,w:640,h:190},e.fallenTimeSet=3,e.fallenTime=0,e.shadowMaxScale=1.5,e.run=!1,e}return __extends(e,t),e.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.atkRate=this.getProp(),this.meteorNum=cfgTable.commonData.skill_6_1,this.meteorCurNum=0,this.radius=cfgTable.commonData.skill_6_3,this.fallenTimeSet=cfgTable.commonData.skill_6_4/1e3,this.interv=cfgTable.commonData.skill_6_2},e.prototype.setTime=function(){this.timeAcc=0;var t=this.interv[0]+(this.interv[1]-this.interv[0])*Math.random();t=Math.floor(t)/1e3,this.timeSet=t/(1/h.default.ins.timeScale)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.runSkill=function(){var t=this;this.stoneList=[],this.eftList=[],this.setTime(),this.timeAcc=this.timeSet,this.createPrefabs().then(function(){t.run=!0})},e.prototype.update=function(t){this.run&&(this.timeAcc+=t,this.timeAcc>=this.timeSet&&(this.timeAcc=0,this.setTime(),this.createMeteor(),this.meteorCurNum++,this.meteorCurNum>=this.meteorNum&&l.default.ins.notice(l.EGameEvent.STOP_SKILL,this.type,this.target,this.uid)))},e.prototype.createPrefabs=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t=this,[4,c.default.Instance().loadAndGetRes("res","prefab/skill/Skill_Stone",cc.Prefab)];case 1:return t.prefabStone=i.sent(),e=this,[4,c.default.Instance().loadAndGetRes("res","prefab/skill/Skill_Shadow",cc.Prefab)];case 2:return e.prefabShadow=i.sent(),[2]}})})},e.prototype.getStone=function(){var t,e=h.default.ins.panel;if(this.stoneList.length>0)(t=this.stoneList.pop()).active=!0;else{var i=this.prefabStone;(t=cc.instantiate(i)).parent=e.node.children[0]}return t},e.prototype.getShadow=function(){var t,e=h.default.ins.panel;if(this.eftList.length>0)(t=this.eftList.pop()).active=!0;else{var i=this.prefabShadow;(t=cc.instantiate(i)).parent=e.node.children[0]}return t},e.prototype.createMeteor=function(){var t,e=this,i=(h.default.ins.panel,this.getShadow()),a=this.getStone();h.default.ins.panelType==h.EFightPanel.battle?t=this.battleRect:h.default.ins.panelType==h.EFightPanel.Zembie?t=this.zembieRect:h.default.ins.panelType==h.EFightPanel.Legend?t=this.legendRect:h.default.ins.panelType==h.EFightPanel.boss&&(t=this.bossRect);var n,o,r,l=t.x-t.w/2+t.w*Math.random(),c=t.y-t.h/2+t.h*Math.random();r=cc.winSize.height/2+36,o=l-(n=r/2-c);var d=Math.pow(r-c,2)+Math.pow(n,2),u=Math.floor(Math.pow(d,.5))/1e3;this.fallenTime=this.fallenTimeSet*u*(1/h.default.ins.timeScale),a.x=o,a.y=r,i.x=l,i.y=c;var p=a.getChildByName("icon");p.angle=0,cc.tween(p).by(4,{angle:-80}).start(),cc.tween(a).to(this.fallenTime,{x:l,y:c+36}).call(function(){a.active=!1,e.stoneList.push(a)}).start();var f=i.getChildByName("yinying");f.scale=0,f.active=!0;var g=i.getChildByName("eft1"),m=i.getChildByName("eft2");g.active=m.active=!1,cc.tween(f).to(this.fallenTime,{scale:this.shadowMaxScale}).call(function(){f.active=!1,e.playEft(i,g,m),e.doDamage(l,c);var t=cfgTable.cardskillData[e.id].audio;s.default.Instance().playEffect(t)}).start()},e.prototype.playEft=function(t,e,i){var a=this;e.width=2*this.radius,e.height=2*this.radius,i.width=2*this.radius,i.height=2*this.radius,e.active=!0,e.opacity=255;var n=e.children[0];n.scale=1,cc.tween(e).to(.2,{opacity:0},{easing:cc.easing.sineOut}).start(),cc.tween(n).to(.14,{scale:2}).start(),i.active=!0,i.scale=0,i.opacity=255,cc.tween(i).delay(.05).call(function(){i.scale=1}).to(.3,{opacity:0,scale:1.4},{easing:cc.easing.sineOut}).call(function(){t.active=!1,a.eftList.push(t)}).start()},e.prototype.doDamage=function(t,e){this.target;var i=this.radius,a=this.atkRate,n=h.default.ins.getFirstAtk()*a,s=o.Global.common.getEnemyList(h.default.ins.panel,h.default.ins.panelType),l=cc.v2(t,e),c=[];s.forEach(function(t){if(h.default.ins.isEnemy(t)){var e;e=t.bady.node?t.node.height/2:t.bady.height/2;var a=cc.v2(t.node.x,t.node.y+e),n=cc.v2(a.x-l.x,a.y-l.y),o=i+t.node.height/2;n.lengthSqr()<=o*o&&c.push(t)}}),c.forEach(function(t){r.default.Instance().emitAttacked({id:t.getId(),attack:[n,0,0],killRewards:0,sputAttack:0,sputRange:0})})},e}(a("SkillBase").default);n.default=d,cc._RF.pop()},{}],Skill_Morale:[function(t,e,i){"use strict";cc._RF.push(e,"3062dcHw3pIvoIXZze/qd14","Skill_Morale");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.hpAndAtkRate=this.getProp()},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.runSkill=function(){this.colorChange(),this.addHpAndAtk()},e.prototype.colorChange=function(){this.target.bady.node.color=cc.color(241,119,119,255)},e.prototype.addHpAndAtk=function(){var t=this.target,e=t.getAtk();e*=1+this.hpAndAtkRate,t.setAtk(e);var i=t.getHp();t.getCurHp(),i*=1+this.hpAndAtkRate,this.hpAndAtkRate,t.setHp(i),t.setCurHp(i)},e}(a("SkillBase").default);n.default=o,cc._RF.pop()},{}],Skill_Push:[function(t,e,i){"use strict";cc._RF.push(e,"ebdb9QtR2RJobBDBn6iOFAY","Skill_Push");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("EventMgr"),s=a("SkillMgr"),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.atkRate=this.getProp(),this.pushDis=cfgTable.commonData.skill_7},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.runSkill=function(){this.doPush(),this.doDamage()},e.prototype.doDamage=function(){var t=this.target,e=this.atkRate,i=s.default.ins.getFirstAtk()*e;o.default.Instance().emitAttacked({id:t.getId(),attack:[i,0,0],killRewards:0,sputAttack:0,sputRange:0})},e.prototype.doPush=function(){var t=this.target;if(t.bady.node){var e=t.Birthpoint.enemyBirthpoint,i=t.Birthpoint.myBirthpoint,a=i.x-e.x,n=(t.node.x-e.x)/a*this.pushDis,o=e.x-i.x>0?1:-1;cc.tween(t.node).by(.15,{x:o*n},{easing:cc.easing.sineOut}).start()}},e}(a("SkillBase").default);n.default=r,cc._RF.pop()},{}],Skill_Recover:[function(t,e,i){"use strict";cc._RF.push(e,"17d8dPh2i9CxbZN62zo7hZx","Skill_Recover");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("EventMgr"),r=a("ResMgr"),l=a("SkillMgr"),c=a("typeEnum"),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.meatRate=this.getProp()},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.runSkill=function(){var t=this;this.createPrefab().then(function(){var e=t.target;t.getMeatNum=e.roleDate.Needfood,t.addMeat(),t.playMeatAni(),t.playerDie()})},e.prototype.createPrefab=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=this,[4,r.default.Instance().loadAndGetRes("res","prefab/skill/Skill_Meat",cc.Prefab)];case 1:return t.prefabMeat=e.sent(),[2]}})})},e.prototype.addMeat=function(){var t=l.default.ins.panel,e=Math.floor(this.getMeatNum*this.meatRate);e<=0&&(e=1),this.allMeadNum=e,t.addMeat(e)},e.prototype.playMeatAni=function(){var t=l.default.ins.panel,e=this.target,i=cc.instantiate(this.prefabMeat);i.parent=t.node,i.x=e.node.x,i.y=e.node.y+12,cc.find("icon/txt",i).getComponent(cc.Label).string="+"+this.allMeadNum;var a=cc.find("icon",i);a.scale=1,a.opacity=255,cc.tween(a).delay(.1).to(.2,{scale:1.2}).to(.2,{scale:1}).delay(.3).to(.3,{opacity:0}).start()},e.prototype.playerDie=function(){var t=this.target;t.roleBaseType=c.RoleBaseType.Dide;var e=t.node.getContentSize().height;s.default.Instance().emitRoleDie(t.node.convertToWorldSpaceAR(cc.v2(0,e/2)),e/56.6);var i=o.Global.common.getRoleList(l.default.ins.panel,l.default.ins.panelType),a=i.indexOf(t);a>-1&&i.splice(a,1),t.node.destroy()},e}(a("SkillBase").default);n.default=h,cc._RF.pop()},{}],Skill_Wave:[function(t,e,i){"use strict";cc._RF.push(e,"f06afmpi8hMp5h8+kE/SRWa","Skill_Wave");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("EventMgr"),r=a("ResMgr"),l=a("SkillMgr"),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.atkRate=this.getProp(),this.range=cfgTable.commonData.skill_2},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.runSkill=function(){this.createWave()},e.prototype.createWave=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o,s=this;return __generator(this,function(l){switch(l.label){case 0:return t=this.target,(e=new cc.Node("waveNode")).parent=t.node,(i=e.addComponent(cc.Sprite)).type=cc.Sprite.Type.SIMPLE,i.sizeMode=cc.Sprite.SizeMode.CUSTOM,[4,r.default.Instance().loadAndGetRes("res","skill/wave",cc.SpriteFrame)];case 1:return a=l.sent(),[4,r.default.Instance().loadAndGetRes("res","skill/wave2",cc.SpriteFrame)];case 2:return n=l.sent(),[4,r.default.Instance().loadAndGetRes("res","skill/wave3",cc.SpriteFrame)];case 3:return o=l.sent(),i.spriteFrame=a,this.waveSprite=i,e.width=2*this.range,e.height=2*this.range,e.x=0,e.y=t.bady.node.height/2,cc.tween(e).delay(.02).to(.02,{scale:1.08,opacity:230}).call(function(){i.spriteFrame=n,i.node.opacity=255,s.doDamage()}).delay(.02).call(function(){i.spriteFrame=o}).to(.5,{opacity:50}).to(.3,{opacity:0}).call(function(){s.destroyWave()}).start(),[2]}})})},e.prototype.doDamage=function(){var t=this.target,e=this.range,i=this.atkRate,a=l.default.ins.getFirstAtk()*i,n=o.Global.common.getEnemyList(l.default.ins.panel,l.default.ins.panelType),r=cc.v2(t.node.x,t.node.y+t.bady.node.height/2),c=[];n.forEach(function(t){if(l.default.ins.isEnemy(t)){var i;i=t.bady.node?t.bady.node.height/2:t.node.height/2;var a=cc.v2(t.node.x,t.node.y+i),n=cc.v2(a.x-r.x,a.y-r.y),o=e+t.node.height/2;n.lengthSqr()<=o*o&&c.push(t)}}),c.forEach(function(t){s.default.Instance().emitAttacked({id:t.getId(),attack:[a,0,0],killRewards:0,sputAttack:0,sputRange:0})})},e.prototype.destroyWave=function(){this.waveSprite.node.destroy(),this.waveSprite=null},e}(a("SkillBase").default);n.default=c,cc._RF.pop()},{}],SkipGuidePanel:[function(t,e,i){"use strict";cc._RF.push(e,"d66b1ycaX5DFqhKZsvdhmVq","SkipGuidePanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("EventMgr"),l=a("typeEnum"),c=cc._decorator,h=c.ccclass,d=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.skipBtn=this.findElement("skip_btn",cc.Node),this.cancelBtn=this.findElement("cancel_btn",cc.Node),this.initBtn()},e.prototype.start=function(){},e.prototype.initBtn=function(){this.skipBtn.on("click",this.skipGuide,this),this.cancelBtn.on("click",this.emitCloseMe,this)},e.prototype.skipGuide=function(){o.Global.guideMgr.skipGuide(),r.default.Instance().emitGuideChange(l.GuideStep.Complete),this.emitCloseMe()},__decorate([h],e)}(s.default));n.default=d,cc._RF.pop()},{}],SuperListItem:[function(t,e,i){"use strict";cc._RF.push(e,"345bbW8DZBBzKQ7CPQvkPwM","SuperListItem");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,s=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.updateData=function(){},e.prototype.defaultForm=function(){},e.prototype.changedForm=function(){},__decorate([o],e)}(cc.Component));a.default=s,cc._RF.pop()},{}],SuperScrollView:[function(t,e,i){"use strict";cc._RF.push(e,"ea4d6tpGTZASLwndi/LNUcv","SuperScrollView");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("SuperListItem"),s=cc._decorator,r=s.ccclass,l=s.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ItemPrefab=null,e.ltemCom=[],e.lastTime=0,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.on("scroll-ended",this.onScrollEnded,this),this.node.on("scrolling",this.onScrolling,this)},e.prototype.onDestroy=function(){this.node.off("scroll-ended",this.onScrollEnded,this),this.node.off("scrolling",this.onScrolling,this)},e.prototype.setData=function(t,e){var i,a=this;void 0===e&&(e=null),this.ltemCom=[];for(var n=0;n<t.length;n++)this.content.children[n]?i=this.content.children[n]:((i=cc.instantiate(this.ItemPrefab)).opacity=0,this.content.addChild(i)),this.ltemCom.push(i.getComponent(o.default)),this.ltemCom[n].setData(t[n],e);if(this.content.childrenCount>t.length)for(n=t.length;n<this.content.childrenCount;n++)this.content.children[n].destroy();this.scheduleOnce(function(){a.improveDC()},.1)},e.prototype.updateData=function(t){void 0===t&&(t=null);for(var e=0;e<this.ltemCom.length;e++)this.ltemCom[e].updateData(t)},e.prototype.onScrollEnded=function(){this.improveDC()},e.prototype.onScrolling=function(){var t=Date.now();t-this.lastTime<100||(this.lastTime=t,this.improveDC())},e.prototype.improveDC=function(){if(0!=this.content.childrenCount){var t=this.node.parent.convertToWorldSpaceAR(cc.v2(this.node.x-this.node.anchorX*this.node.width,this.node.y-this.node.anchorY*this.node.height)),e=cc.rect(t.x,t.y,this.node.width,this.node.height);this.content.children.forEach(function(t){t.getBoundingBoxToWorld().intersects(e)?0===t.opacity&&(t.opacity=255):0!==t.opacity&&(t.opacity=0)})}},__decorate([l({type:cc.Prefab,displayName:"\u6761\u76ee\u9884\u5236\u4f53"})],e.prototype,"ItemPrefab",void 0),__decorate([r],e)}(cc.ScrollView);n.default=c,cc._RF.pop()},{}],TTCloudMgr:[function(t,e,i){"use strict";cc._RF.push(e,"8abbcdqSbZMMK5lkpDqfh5H","TTCloudMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o,s,r=a("Global"),l=a("typeEnum"),c=a("CacheMgr"),h=a("DataMgr"),d=a("Observer");(function(t){t.dev="env-UFL4Zq9tMe",t.prod="env-a5wgNLnvxy"})(o||(o={})),function(t){t[t.none=0]="none",t[t.waiting=1]="waiting",t[t.saving=2]="saving"}(s||(s={}));var u=function(){function t(){this.dbName="game_warriors",this.curId=o.dev,this.useCloud=!1,this.severData="{}",this.severTemp={},this.saveState=s.none,this.accTime=0,this.saveTime=30,this.tryTimes=3,this.curTry=0,this.uuid="",this.localTime={}}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.init=function(t){this.finishCb=t,r.Global.isDebug?this.curId=o.dev:this.curId=o.prod,this.sdk=window.tt,this.canUseServeData()?this.ttLogin():t&&t()},t.prototype.ttLogin=function(){var t=this;this.sdk.login({success:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(){return window.my_tt_login_data=e,this.curTry=0,r.Global.isDebug&&console.log("\u767b\u5f55\u6210\u529f!",e),this.initData(),[2]})})},fail:function(e){r.Global.isDebug&&console.log("\u767b\u5f55\u5931\u8d25!",e),t.curTry++,t.curTry>=t.tryTimes+1?(t.finishCb&&t.finishCb(),r.Global.umSDK.send(l.EnumDefine.fieldName.tt_login_fail,{type:JSON.stringify(e)})):t.ttLogin()}})},t.prototype.initData=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,this.sdk.createCloud({envID:this.curId}).database()];case 1:return[4,(t=a.sent()).collection(this.dbName).get()];case 2:return e=a.sent(),this.db=t,this.rawData=e,this.getuuId(),this.finishCb&&this.finishCb(),this.finishCb=null,r.Global.isDebug&&console.log("\u670d\u52a1\u5668\u767b\u5f55\u6210\u529f",e),[3,4];case 3:return i=a.sent(),r.Global.isDebug&&console.log("\u5f00\u59cb\u91cd\u8bd5",i),this.curTry++,this.curTry>=this.tryTimes+1?(this.finishCb&&this.finishCb(),this.finishCb=null,r.Global.umSDK.send(l.EnumDefine.fieldName.tt_cloud_read_fail,{type:JSON.stringify(i)})):this.initData(),[3,4];case 4:return[2]}})})},t.prototype.canUseServeData=function(){if(this.sdk&&this.sdk.canIUse("createCloud"))return!0;r.Global.isDebug&&console.log("TT_cloud\u4e0d\u652f\u6301\u6296\u97f3\u4e91!")},t.prototype.combineServerData=function(t){for(var e=t[0],i=1;i<t.length;i++){var a=t[i];for(var n in a)e[n]=a[n]}var o={};for(var n in e){var s=e[n];if("_id"!=n&&"_openid"!=n)try{var l=JSON.parse(s);o[n]=l}catch(c){r.Global.isDebug&&console.log("paseTT_Cloud\u9519\u8bef",n,e[n])}}return o},t.prototype.getuuId=function(){if(this.rawData&&this.rawData.data&&this.rawData.data.length>0){var t=this.rawData.data.length-1;this.uuid=this.rawData.data[t]._id}},t.prototype.LoadServer=function(){var t={};return this.useCloud=this.rawData&&this.rawData.data,this.useCloud&&this.rawData.data.length>0&&(t=this.combineServerData(this.rawData.data)),this.severData=JSON.stringify(t),t},t.prototype.uploadData=function(t){if(void 0===t&&(t=!1),this.canUseServeData()&&this.saveState!=s.saving)return t?(this.setNode(),this.saveState=s.saving,void this.save()):void(this.saveState!=s.waiting&&(this.setNode(),this.saveState=s.waiting,this.accTime=0,this.countDown()))},t.prototype.countDown=function(){var t=this;this.saveNode.runAction(cc.repeatForever(cc.sequence(cc.delayTime(1),cc.callFunc(function(){t.accTime++,r.Global.isDebug&&console.log("TTCloud++++++++++++++++",t.accTime),t.accTime>=t.saveTime&&(t.saveState=s.saving,t.saveNode.stopAllActions(),t.save())}))))},t.prototype.setNode=function(){this.saveNode||(this.saveNode=new cc.Node("my_saving_node"),this.saveNode.parent=cc.find("Canvas")),this.saveNode.stopAllActions()},t.prototype.save=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o,u,p,f;return __generator(this,function(g){switch(g.label){case 0:if(!this.db||!this.uuid)return this.saveState=s.none,[2];for(n in t={},e=!1,this.severTemp=JSON.parse(this.severData),i=JSON.parse(JSON.stringify(h.default.Instance().getPlayerData())),r.Global.isDebug&&console.log("TTCloud\u672c\u5730\u6570\u636e",i),r.Global.isDebug&&console.log("TTCloud\u670d\u52a1\u5668\u7f13\u5b58\u6570\u636e",this.severTemp),a=JSON.stringify((new Date).getTime()),i)o=i[n],u=JSON.stringify(o),void 0===this.severTemp[n]?(t[n]=u,t[c.default.timeKey+n]=a,e=!0):JSON.stringify(this.severTemp[n])!=u&&(t[n]=u,t[c.default.timeKey+n]=a,e=!0);if(r.Global.isDebug&&console.log("TTCloud\u9700\u8981\u66f4\u65b0\u7684",t),!e)return[3,5];g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.db.collection(this.dbName).doc(this.uuid).update(t)];case 2:return p=g.sent(),this.severData=JSON.stringify(i),d.default.ins.notice(d.EGameEvent.SAVE_END,!0),r.Global.isDebug&&console.log("TTCloud\u66f4\u65b0\u6210\u529f",p),[3,4];case 3:return f=g.sent(),d.default.ins.notice(d.EGameEvent.SAVE_END,!1),r.Global.isDebug&&console.log("TTCloud\u66f4\u65b0\u5931\u8d25",f),r.Global.umSDK.send(l.EnumDefine.fieldName.tt_cloud_update_fail,{type:JSON.stringify(f)}),[3,4];case 4:return[3,6];case 5:d.default.ins.notice(d.EGameEvent.SAVE_END,!1,!0),g.label=6;case 6:return this.saveState=s.none,[2]}})})},t.prototype.forceSave=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(a){switch(a.label){case 0:if(!this.canUseServeData())return[2];if(!this.db)return[2];this.setNode(),this.saveState=s.saving,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.db.collection(this.dbName).get()];case 2:return t=a.sent(),this.rawData=t,e=void 0,this.rawData&&this.rawData.data&&this.rawData.data.length>0&&(e=this.combineServerData(this.rawData.data)),e&&(this.severData=JSON.stringify(e)),this.save(),[3,4];case 3:return i=a.sent(),this.saveState=s.none,d.default.ins.notice(d.EGameEvent.SAVE_END,!1),r.Global.umSDK.send(l.EnumDefine.fieldName.tt_cloud_force_save_fail,{type:JSON.stringify(i)}),[3,4];case 4:return[2]}})})},t.prototype.checkData=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:if(!this.db)return[2];this.LoadServer(),e=JSON.stringify(t),this.curTry=0,i.label=1;case 1:return[4,this.checkAdd(e,this.severData)];case 2:return"retry"!=i.sent()?[3,3]:[3,1];case 3:this.curTry=0,i.label=4;case 4:return[4,this.checkUpdate(e,this.severData)];case 5:return"retry"!=i.sent()?[3,6]:[3,4];case 6:return[2]}})})},t.prototype.checkAdd=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,a,n,o,s,c,h,d,u,p;return __generator(this,function(f){switch(f.label){case 0:if(!this.db)return[2];for(s in i=JSON.parse(t),a=JSON.parse(e),n={},o=!1,i)c=i[s],h=JSON.stringify(c),void 0===a[s]&&(n[s]=h,o=!0);if(!o)return[2];f.label=1;case 1:return f.trys.push([1,6,,7]),this.uuid?[4,this.db.collection(this.dbName).doc(this.uuid).update(n)]:[3,3];case 2:return d=f.sent(),r.Global.isDebug&&console.log("\u8001\u7528\u6237\u65b0\u589e\u5b57\u6bb5\u6210\u529f",d,n),[3,5];case 3:return[4,this.db.collection(this.dbName).add(n)];case 4:u=f.sent(),this.uuid=u.id,r.Global.isDebug&&console.log("\u65b0\u7528\u6237\u6dfb\u52a0\u6210\u529f",u),f.label=5;case 5:return this.severData=JSON.stringify(i),[3,7];case 6:return p=f.sent(),r.Global.isDebug&&console.log("checkAdd\u5931\u8d25~\u5f00\u59cb\u91cd\u8bd5",p),this.curTry++,this.curTry>=this.tryTimes+1?(this.uuid?r.Global.umSDK.send(l.EnumDefine.fieldName.tt_cloud_new2_fail,{type:JSON.stringify(p)}):r.Global.umSDK.send(l.EnumDefine.fieldName.tt_cloud_new1_fail,{type:JSON.stringify(p)}),[3,7]):[2,"retry"];case 7:return[2]}})})},t.prototype.getLocalTime=function(t){for(var e in t){var i=cc.sys.localStorage.getItem(c.default.timeKey+c.default.preKey+e);this.localTime[e]=i}},t.prototype.checkUpdate=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,a,n,o,s,d,u,p,f,g,m,y,v,b;return __generator(this,function(_){switch(_.label){case 0:if(!this.db)return[2];if(!this.uuid)return[2];for(y in i=JSON.parse(t),a=JSON.parse(e),Object.keys(this.localTime).length<=0&&this.getLocalTime(i),n={},o=!1,i)void 0!==a[y]&&(u=i[y],p=JSON.stringify(u),f=JSON.stringify(a[y]),p!==f&&(o=!0,s=this.localTime[y],d=a[c.default.timeKey+y],s&&d?(s=JSON.parse(s),n[y]=d>=s?f:p):n[y]=s&&!d?p:f));if(!o)return[2];for(y in g=h.default.Instance().getPlayerData(),m={},n)m[y]=JSON.parse(n[y]);g.resetData(m),_.label=1;case 1:return _.trys.push([1,3,,4]),[4,this.db.collection(this.dbName).doc(this.uuid).update(n)];case 2:return v=_.sent(),this.severData=JSON.stringify(g.getData()),r.Global.isDebug&&console.log("\u8fdb\u5165\u6e38\u620f\u66f4\u65b0\u5b57\u6bb5",v,m),[3,4];case 3:return b=_.sent(),r.Global.isDebug&&console.log("checkUpdate\u5931\u8d25\u5f00\u59cb\u91cd\u8bd5",b),this.curTry++,this.curTry>=this.tryTimes+1?(r.Global.umSDK.send(l.EnumDefine.fieldName.tt_cloud_enter_fail,{type:JSON.stringify(b)}),[3,4]):[2,"retry"];case 4:return[2]}})})},t}();n.default=u,cc._RF.pop()},{}],TTSDK:[function(t,e,i){"use strict";cc._RF.push(e,"45b9aeCdaBPOJ7QSwUuqi2y","TTSDK");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.videoShareWordArr=["\u57ce\u5821\u5b88\u536b\u6218"],e.normalShareWordArr=["\u57ce\u5821\u5b88\u536b\u6218"],e.localShareImg=["share/share1.png"],e.appName="\u57ce\u5821\u5b88\u536b\u6218",e.isLogin=!1,e.isCheckScene=!1,e.rewardStr=["2kcc3otn0k271qefab"],e.rewardNum=0,e.rewardMoerStr="2o1nl47hqbq14841ck",e.subscribeId="",e.bannerStr="95cie3e82b5h277du7",e.rewardAd=null,e.initedRewardAd=!1,e.MultitonAd=null,e.initedMultitonAd=!1,e._bannerAD=null,e._interstitialIndex=0,e.enterShare=!1,e.oherShare=!1,e.shareTime=0,e.shareNeedTime=3e3,e.shareNum=0,e.isMakeVideo=!1,e.minTime=3,e.maxTime=60,e.indexTime=0,e.tempVideoPath=null,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e)},enumerable:!1,configurable:!0}),e.prototype.init=function(){this.initLtSdk(),this.platform=window.tt,this.myTimeNode=cc.find("Canvas/makeVideoNode"),this.myTimeNode||(this.myTimeNode=new cc.Node,this.myTimeNode.name="makeVideoNode",this.myTimeNode.parent=cc.find("Canvas")),this.lifeEvent(),this.scene="TTScene",this.checkScene()},e.prototype.initLtSdk=function(){},e.prototype.lifeEvent=function(){var t=this;cc.sys.platform==cc.sys.BYTEDANCE_GAME&&(this.platform.onShow(function(){console.log("tt\u524d\u53f0");var e=(new Date).getTime();if(t.oherShare){t.oherShare=!1,console.log("\u5206\u4eab\u65f6\u5dee\uff1a",e-t.shareTime);var i=e-t.shareTime>=t.shareNeedTime,a=Math.random()<.5;t.shareNum>=2&&(a=!0),i&&a?(t.shareNum=0,t.shareSuccessCb&&t.shareSuccessCb()):(t.shareNum+=1,t.shareFailCb&&t.shareFailCb())}}),this.platform.onHide(function(){console.log("tt\u540e\u53f0"),t.enterShare&&(t.oherShare=!0,t.enterShare=!1)}))},e.prototype.login=function(t){var e=this;cc.sys.platform==cc.sys.BYTEDANCE_GAME?this.isLogin?t&&t(!0):this.platform.login(function(i){i&&(e.isLogin=!0),t&&t(i)}):t&&t(!0)},e.prototype.recordGame=function(){console.log("\u5f55\u5236\u5f00\u59cbttsdk",this.isMakeVideo),this.makeVideo()},e.prototype.recordEnd=function(){console.log("\u5f55\u5236\u7ed3\u675fttsdk"),this.makeVideo()},e.prototype.makeVideo=function(){cc.sys.platform==cc.sys.BYTEDANCE_GAME&&(this.isMakeVideo?this.stopGameRecord():(this.startGameRecord(),o.Global.eventMgr.notice(o.Global.event.TT_VIDEO_BEGIN)))},e.prototype.loopTime=function(){this.indexTime++,this.indexTime>=this.maxTime&&(this.stopGameRecord(),o.Global.eventMgr.notice(o.Global.event.TT_MAX_VIDEO_TIME))},e.prototype.judgeInMinTime=function(){return!!(this.isMakeVideo&&this.indexTime<=this.minTime)},e.prototype.startGameRecord=function(){console.log("\u5f00\u59cb\u5f55\u5236");var t=this;this.isMakeVideo=!0,this.indexTime=0,this.myTimeNode.stopAllActions(),this.myTimeNode.runAction(cc.repeatForever(cc.sequence(cc.delayTime(1),cc.callFunc(function(){t.loopTime()})))),this.platform.getGameRecorderManager().start({duration:this.maxTime})},e.prototype.stopGameRecord=function(){console.log("\u5f55\u5236\u7ed3\u675f"),console.log("stopGameRecord  \u5f55\u5236\u65f6\u957f\uff1a",this.indexTime),this.isMakeVideo&&(this.isMakeVideo=!1,this.myTimeNode.stopAllActions(),this.platform.getGameRecorderManager().stop())},e.prototype.initGameRecordListener=function(){var t=this,e=this,i=this.platform.getGameRecorderManager();i.onStart(function(){i.recordClip({timeRange:[3,3]})}),i.onStop(function(a){t.indexTime<=t.minTime?t.tempVideoPath=null:i.clipVideo({path:a.videoPath,timeRange:[30,0],success:function(t){e.tempVideoPath=t.videoPath,o.Global.eventMgr.notice(o.Global.event.TT_VIDEO_END)},fail:function(t){console.error("\u89c6\u9891\u526a\u8f91\u51fa\u9519",t)}})}),i.onPause(function(){}),i.onInterruptionBegin(function(){i.pause()}),i.onInterruptionEnd(function(){i.resume()}),i.onResume(function(){})},e.prototype.shake=function(t,e){void 0===e&&(e=400),this.platform.vibrateLong(),setTimeout(function(){t&&t()},e)},e.prototype.openAd=function(t,e,i){var a=this;void 0===e&&(e=null),void 0===i&&(i=null);var n=this.rewardStr[this.rewardNum];this.platform.createRewardedVideoAd?(console.log("id ->",n),this.rewardAd||(this.rewardAd=this.platform.createRewardedVideoAd({adUnitId:n}),this.rewardAd.onLoad(function(t){console.log("rewardAd onLoad",t)})),this.rewardAd.onClose(function e(n){console.log("rewardAd onClose",n),t&&(cc.game.resume(),console.log(n),n.isEnded?t():i&&i()),a.rewardAd.offClose(e)}),this.rewardAd.onError(function n(o){a.rewardAd.offError(n),a.rewardNum+=1,a.initedRewardAd=!1,console.log("err",o),a.rewardAd&&a.rewardAd.destroy().then(function(){if(a.rewardAd=null,a.rewardNum>a.rewardStr.length-1)return cc.game.resume(),e&&e(),void a.rewardNum;a.openAd(t,e,i)}).catch(function(){a.rewardAd=null})}),this.initedRewardAd?(console.log("\u76f4\u63a5\u663e\u793a\u6fc0\u52b1\u5e7f\u544a"),this.rewardAd.show().then(function(){a.platform.hideLoading({}),console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u6210\u529f")}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u5931\u8d25"),e&&e(t)})):this.rewardAd.load().then(function(){console.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u6210\u529f"),a.rewardAd.show().then(function(){a.platform.hideLoading({}),console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u6210\u529f"),a.initedRewardAd=!0}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u5931\u8d25"),e&&e(t)})}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u5931\u8d25"),e&&e(t)})):this.platform.showModal({title:"\u63d0\u793a",content:"\u5f53\u524d\u5ba2\u6237\u7aef\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u8be5\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u5ba2\u6237\u7aef\u6216\u5173\u95ed\u540e\u91cd\u542f\u66f4\u65b0\u3002"})},e.prototype.openMultitonAd=function(t,e,i){var a=this;void 0===i&&(i=null);var n=this.rewardMoerStr;if(this.platform.createRewardedVideoAd){console.log("id ->",n),console.log("options ->",e);var s=function e(n){t&&(n.isEnded?t(n.count):(o.Global.eventMgr.emitTips("\u770b\u5b8c\u89c6\u9891\u624d\u80fd\u83b7\u53d6\u5956\u52b1\u54e6~"),i&&i(n))),a.MultitonAd.offClose(e)},r=function(t){console.log("MultitonAd onError",t),a.MultitonAd.offError(s)};this.MultitonAd?this.MultitonAd.destroy().then(function(){a.MultitonAd=a.platform.createRewardedVideoAd({adUnitId:n,multiton:e.multiton,multitonRewardMsg:e.multitonRewardMsg,multitonRewardTimes:e.multitonRewardTimes,progressTip:e.progressTip}),a.MultitonAd.onLoad(function(t){console.log("MultitonAd onLoad",t)}),a.MultitonAd.load().then(function(){a.MultitonAd.show().then(function(){a.platform.hideLoading({}),a.initedMultitonAd=!0}).catch(function(t){i&&i(t)})}).catch(function(t){i&&i(t)}),a.MultitonAd.onClose(s),a.MultitonAd.onError(r)}).catch(function(t){console.log("\u5e7f\u544a\u7ec4\u4ef6\u51fa\u73b0\u95ee\u9898",t)}):(this.MultitonAd=this.platform.createRewardedVideoAd({adUnitId:n,multiton:e.multiton,multitonRewardMsg:e.multitonRewardMsg,multitonRewardTimes:e.multitonRewardTimes,progressTip:e.progressTip}),this.MultitonAd.onLoad(function(){}),this.MultitonAd.load().then(function(){a.MultitonAd.show().then(function(){a.platform.hideLoading({}),a.initedMultitonAd=!0}).catch(function(t){i&&i(t)})}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u5931\u8d25"),i&&i(t)}),this.MultitonAd.onClose(s),this.MultitonAd.onError(r))}else this.platform.showModal({title:"\u63d0\u793a",content:"\u5f53\u524d\u5ba2\u6237\u7aef\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u8be5\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u5ba2\u6237\u7aef\u6216\u5173\u95ed\u540e\u91cd\u542f\u66f4\u65b0\u3002"})},e.prototype.shareGame=function(t,i){this.shareSuccessCb=t,this.shareFailCb=i,this.enterShare=!0,this.shareTime=(new Date).getTime();var a=Math.floor(Math.random()*this.normalShareWordArr.length);a=this.normalShareWordArr[a];var n=this.localShareImg[Math.floor(Math.random()*this.localShareImg.length)];this.platform.shareAppMessage({templateId:"",title:this.appName,desc:a,imageUrl:n,query:"",success:function(){console.log("\u5206\u4eab\u6210\u529f--"),setTimeout(function(){console.log("\u5206\u4eab\u6210\u529f--2",e.ins.oherShare),e.ins.enterShare&&e.ins.shareSuccessCb&&e.ins.shareSuccessCb()},500)},fail:function(){e.ins.shareFailCb&&e.ins.shareFailCb()}})},e.prototype.videoShare=function(t,e){if(cc.sys.platform==cc.sys.BYTEDANCE_GAME){var i=Math.floor(Math.random()*this.videoShareWordArr.length);if(i=this.videoShareWordArr[i],this.tempVideoPath&&0!=this.tempVideoPath.length){console.log("\u5206\u4eab\u6e38\u620f\u89c6\u9891--");var a={};a.title=this.appName,a.extra={videoPath:this.tempVideoPath,videoTopics:[this.appName],hashtag_list:[this.appName],video_title:i},a.success=function(){o.Global.eventMgr.emitTips("\u89c6\u9891\u5206\u4eab\u6210\u529f\uff01"),t&&t()},a.fail=function(){e&&e(),o.Global.eventMgr.emitTips("\u89c6\u9891\u5206\u4eab\u5931\u8d25\uff01")},a.channel="video",a.desc=i,a.imageUrl="",a.templateId="",this.platform.shareAppMessage(a)}else o.Global.eventMgr.emitTips("\u6682\u672a\u5f55\u5236\u89c6\u9891\u54e6")}else t&&t()},e.prototype.getMenuButtonBoundingClientRect=function(){var t=this.platform.getMenuButtonBoundingClientRect(),e=this.platform.getSystemInfo();return cc.winSize.height*(t.height+t.top)/e.screenHeight},e.prototype.uploadMsg=function(t,e){cc.sys.platform==cc.sys.BYTEDANCE_GAME&&this.platform.uploadMsg(t,e)},e.prototype.createMoreGameBtn=function(t){this.platform.createMoreGameBtn(t)},e.prototype.showMoreGamesModal=function(){cc.sys.platform==cc.sys.BYTEDANCE_GAME&&this.platform.showMoreGamesModal()},e.prototype.noticeDY=function(){cc.sys.platform==cc.sys.BYTEDANCE_GAME&&this.platform.noticeDY()},e.prototype.setCloudData=function(t,e){cc.sys.platform==cc.sys.BYTEDANCE_GAME&&this.platform.setUserCloudStorage({KVDataList:[{key:"finish",value:t.toString()},{key:"time",value:e.toString()}],success:function(t){console.log(t)},fail:function(t){console.log(t)}})},e.prototype.saveImageToPhotosAlbum=function(t,e,i){this.platform.saveImageToPhotosAlbum(t,e,i)},e.prototype.addToDesk=function(t){this.platform.addToDesk(t)},e.prototype.checkAddToDesk=function(t){this.platform.checkAddToDesk(t)},e.prototype.navigateToVideoView=function(t){window.tt.navigateToVideoView({videoId:t,fail:function(t){console.log("tt\u89c6\u9891\u8df3\u8f6c\u5931\u8d25",t)}})},e.prototype.showBanner=function(t){var e=this;void 0===t&&(t="");var i=this.bannerStr;if(this.platform.createBannerAd){var a=this.platform.getSystemInfoSync().windowWidth,n=this.platform.getSystemInfoSync().windowHeight,o=Math.min(a,450),s=Math.min(n,300);this._bannerAD?this._bannerAD.show().then(function(){e.isShowBanner=!0,e.ishideBanner&&e.hideBanner()}).catch(function(){e.destroyBanner()}):(this._bannerAD=this.platform.createBannerAd({adUnitId:i,adIntervals:30,style:{left:0,top:n-o,width:o,height:s}}),this._bannerAD.onResize(function(t){e._bannerAD.style.top=n-t.height,e._bannerAD.style.left=(a-t.width)/2,e._bannerAD.show().then(function(){e.isShowBanner=!0,e.ishideBanner&&e.hideBanner()}).catch(function(){e.isShowBanner=!1,e.destroyBanner(),e.hideBanner()})}),this._bannerAD.onError(function(){e.isShowBanner=!1,e.destroyBanner(),e.showBanner(t)}),this._bannerAD.onLoad(function(){}))}else this.platform.showModal({title:"\u63d0\u793a",content:"\u5f53\u524d\u5ba2\u6237\u7aef\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u8be5\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u5ba2\u6237\u7aef\u6216\u5173\u95ed\u540e\u91cd\u542f\u66f4\u65b0\u3002"})},e.prototype.hideBanner=function(){this._bannerAD&&this.isShowBanner?(console.log("hide"),this._bannerAD.hide(),this.ishideBanner=!1):(console.log("not hide"),this.ishideBanner=!0)},e.prototype.destroyBanner=function(){this._bannerAD&&(this._bannerAD.destroy(),this._bannerAD=null)},e.prototype.interstitialAd=function(t,i){var a=this;if(this.platform.createInterstitialAd){var n=5;(function o(){var s=a.platform.createInterstitialAd({adUnitId:e.AD_INTERSTITIAL[a._interstitialIndex]});s.onError(function(i){console.error("interstitialAd err",i),console.log("\u63d2\u5c4f\u9519\u8bef\uff01\u5f53\u524d\u91cd\u8bd5\u6b21\u6570:",n,a._interstitialIndex),a._interstitialIndex==e.AD_INTERSTITIAL.length-1?a._interstitialIndex=0:a._interstitialIndex+=1,n<=0?t&&t():(n-=1,o())}),s.onLoad(function i(){s.offLoad(i),console.log("interstitialAd has loaded"),s.show().then(function(){a._interstitialIndex==e.AD_INTERSTITIAL.length-1?a._interstitialIndex=0:a._interstitialIndex+=1,t&&t()}).catch(function(i){s.destroy(),a._interstitialIndex==e.AD_INTERSTITIAL.length-1?a._interstitialIndex=0:a._interstitialIndex+=1,n<=0?t&&t():(n-=1,o()),console.error("interstitialAd show error ",i),console.log("\u63d2\u5c4f\u9519\u8bef\uff01\u5f53\u524d\u91cd\u8bd5\u6b21\u6570:",n,a._interstitialIndex)})}),s.onClose(function t(){s.offClose(t),a._interstitialIndex==e.AD_INTERSTITIAL.length-1?a._interstitialIndex=0:a._interstitialIndex+=1,i&&i(),s=null,console.log("interstitialAd has closed")}),s.load()})()}else this.platform.showModal({title:"\u63d0\u793a",content:"\u5f53\u524d\u5ba2\u6237\u7aef\u7248\u672c\u8fc7\u4f4e\uff0c\u65e0\u6cd5\u4f7f\u7528\u8be5\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u5ba2\u6237\u7aef\u6216\u5173\u95ed\u540e\u91cd\u542f\u66f4\u65b0\u3002"})},e.prototype.checkScene=function(){this.platform.getSystemInfo({success:function(t){console.log("douying\u57fa\u7840\u5e93\u7248\u672c",t.SDKVersion),-1!=e.ins.compareVersion(t.SDKVersion,"2.92.0.0")?e.ins.platform.checkScene({scene:"sidebar",success:function(t){e.ins.isCheckScene=t.isExist,console.log("check scene success:",t)},fail:function(t){console.log("--------------check scene fail:",t)}}):e.ins.isCheckScene=!1},fail:function(t){console.error(t),console.log("getSystemInfo to scene fail: ",t)}})},e.prototype.navigateToScene=function(){tt.navigateToScene({scene:"sidebar",success:function(){console.log("navigate to scene success")},fail:function(t){console.log("navigate to scene fail: ",t)}})},e.prototype.compareVersion=function(t,e){for(var i=t.split(".").map(function(t){return 1*t}),a=e.split(".").map(function(t){return 1*t}),n=Math.max(i.length,a.length),o=0;o<n;o++){if((i[o]||0)>(a[o]||0))return 1;if((i[o]||0)<(a[o]||0))return-1}return 0},e.prototype.vibrateShort=function(t,e){void 0===e&&(e=null),this.platform.vibrateShort()},e.prototype.send=function(t,e){this.platform.uma&&this.platform.uma.trackEvent(t,e)},e.prototype.subscribe=function(t){var e=this,i=[this.subscribeId];this.platform.requestSubscribeMessage({tmplIds:i,complete:function(i){console.log("\u8ba2\u9605complete"),console.log(i);var a=i&&i.errMsg&&i.errMsg.indexOf("ok")>-1,n=i&&"accept"==i[e.subscribeId];t&&t(a&&n)}})},e.AD_INTERSTITIAL=["3h372dhhcm5h21k14d"],e}(a("SDKBase").default);n.default=s,cc._RF.pop()},{}],TalentAddition:[function(t,e,i){"use strict";cc._RF.push(e,"5fafbLjna5MO4TBcQvxtRUK","TalentAddition");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("TalentBase"),l=cc._decorator,c=l.ccclass,h=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.closeBtn=null,e.item=null,e.content=null,e}return __extends(e,t),e.prototype.start=function(){this.closeBtn.on("click",this.emitCloseMe,this)},e.prototype.onLoad=function(){for(var t=1;r.ETalentType[t];t++){var e=o.Global.common.getTalentVal(t);if(0!=e[0]&&1==e[1]){var i=cc.instantiate(this.item).getComponent(cc.Label);this.content.addChild(i.node);var a=o.Global.talentMgr.getCurrentTalentText(t),n=Math.round(1e4*e[0])/100;Math.floor(n/1e3)>1&&(n/=1e3,n=Math.round(10*n)/10,n+="k"),i.string=a.replace("{0}",n.toString())}}},__decorate([h(cc.Node)],e.prototype,"closeBtn",void 0),__decorate([h(cc.Prefab)],e.prototype,"item",void 0),__decorate([h(cc.Node)],e.prototype,"content",void 0),__decorate([c],e)}(s.default);n.default=d,cc._RF.pop()},{}],TalentBase:[function(t,e,i){"use strict";cc._RF.push(e,"4e835x4HbBATKawnNU65NvH","TalentBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.ETalentEft=n.ETalentType=void 0;var o=a("Global"),s=a("typeEnum");(function(t){t[t.armyHp=1]="armyHp",t[t.armyAtk=2]="armyAtk",t[t.baseHp=3]="baseHp",t[t.meatProduce=4]="meatProduce",t[t.coinGet=5]="coinGet",t[t.coinAd=6]="coinAd",t[t.coinDouble=7]="coinDouble",t[t.critRate=8]="critRate",t[t.critAtk=9]="critAtk",t[t.missRate=10]="missRate",t[t.dropRate=11]="dropRate",t[t.speedRate=12]="speedRate",t[t.moveRate=13]="moveRate",t[t.keepProgress=20]="keepProgress",t[t.sweepZombie=21]="sweepZombie",t[t.sweepBoss=22]="sweepBoss"})(n.ETalentType||(n.ETalentType={})),function(t){t[t.crit=1]="crit",t[t.defence=2]="defence",t[t.doubleCoin=3]="doubleCoin"}(n.ETalentEft||(n.ETalentEft={}));var r=function(){function t(){}return t.prototype.init=function(t){this.type=t,this.setProp()},t.prototype.updateSelf=function(){this.setProp()},t.prototype.setTarget=function(t){this.target=t},t.prototype.setHero=function(t){this.isHero=t},t.prototype.setProp=function(){var t=o.Global.common.getTalentVal(this.type);this.rate=t[0],this.active=t[1];var e=o.Global.equipMgr.getProp(this.type,s.EquipGlobalType.equip);if(this.rate+=e,this.isHero){var i=o.Global.equipMgr.getProp(this.type,s.EquipGlobalType.global);this.rate+=i}},t.prototype.run=function(){return this.setProp(),null},t.prototype.update=function(){},t}();n.default=r,cc._RF.pop()},{}],TalentFly:[function(t,e,i){"use strict";cc._RF.push(e,"9a1f0kocsdI5rCCbmyffVa8","TalentFly");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("ResMgr"),s=cc._decorator,r=s.ccclass,l=s.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon=null,e}return __extends(e,t),e.prototype.run=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return[4,o.default.Instance().loadAndGetRes("res","image/talent/fly"+t,cc.SpriteFrame)];case 1:return e=i.sent(),this.icon.spriteFrame=e,[2]}})})},__decorate([l(cc.Sprite)],e.prototype,"icon",void 0),__decorate([r],e)}(cc.Component);n.default=c,cc._RF.pop()},{}],TalentInfoPanel:[function(t,e,i){"use strict";cc._RF.push(e,"06ba497rnNMDKJwu1Suf2ey","TalentInfoPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("DataMgr"),l=a("EventMgr"),c=a("TalentItemScript"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.talentItemPrefab=null,e}return __extends(e,t),e.prototype.initWithParam=function(t){this.showEffect(),this.cfg=t,this.playerData=r.default.Instance().getPlayerData(),this.init(),this.initUI(),this.initEvent()},e.prototype.init=function(){var t=this.node.getChildByName("Panel");this.close=t.getChildByName("close"),this.item=t.getChildByName("item"),this.talentName=t.getChildByName("name").getComponent(cc.Label),this.talentInfo=t.getChildByName("info").getComponent(cc.RichText),this.upgradeBtn=t.getChildByName("upgradeBtn"),this.maxBtn=t.getChildByName("maxBtn"),this.costLabel=this.upgradeBtn.getChildByName("costLabel").getComponent(cc.Label),this.talentData=this.playerData.getTalentData(this.cfg.id)},e.prototype.initUI=function(){if(this.maxBtn.active=!1,this.upgradeBtn.active=!1,this.talentData){var t=0;if(this.cfg.val[this.talentData.level-1]&&(t=this.cfg.val[this.talentData.level-1],t=Math.round(1e4*t)/100),this.talentInfo.string=o.Global.languageMgr.getText(Number(this.cfg.text)).replace("{0}",t.toString()),this.cfg.cost[this.talentData.level]){var e=this.playerData.getTalentPotion();this.costLabel.string=this.cfg.cost[this.talentData.level].toString();var i=void 0;e>=this.cfg.cost[this.talentData.level]?(this.costLabel.node.color=cc.color().fromHEX("#FFFFFF"),i=cc.Material.getBuiltinMaterial("2d-sprite")):(this.costLabel.node.color=cc.color().fromHEX("#FF0000"),i=cc.Material.getBuiltinMaterial("2d-gray-sprite")),this.upgradeBtn.getComponent(cc.Sprite).setMaterial(0,i)}this.talentData.level>=this.cfg.maxlevel?this.maxBtn.active=!0:this.upgradeBtn.active=!0}else this.talentInfo.string=o.Global.languageMgr.getText(Number(this.cfg.text)).replace("{0}","0");this.talentName.string=o.Global.languageMgr.getText(Number(this.cfg.name));var a=cc.instantiate(this.talentItemPrefab);a.getComponent(c.default).setData(this.cfg,!1),this.item.addChild(a)},e.prototype.initEvent=function(){this.close.on("click",this.emitCloseMe,this),this.upgradeBtn.on("click",this.upgradeTalent,this),l.default.Instance().onTalentLevelChange(this.init,this),l.default.Instance().onTalentLevelChange(this.initUI,this)},e.prototype.upgradeTalent=function(){this.playerData.getTalentPotion()>=this.cfg.cost[this.talentData.level]?(this.playerData.setTalentPotion(-this.cfg.cost[this.talentData.level]),this.playerData.setTalentData(this.talentData.id)):l.default.Instance().emitTips(o.Global.languageMgr.getText(933121))},__decorate([u({type:cc.Prefab})],e.prototype,"talentItemPrefab",void 0),__decorate([d],e)}(s.default);n.default=p,cc._RF.pop()},{}],TalentItemScript:[function(t,e,i){"use strict";cc._RF.push(e,"7b8b9XB/nlGm7XlxFIykD4B","TalentItemScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("DataMgr"),s=a("EventMgr"),r=cc._decorator,l=r.ccclass,c=r.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.btnSpriteFrames=[],e.spriteAtlas=null,e.canClick=!0,e}return __extends(e,t),e.prototype.setData=function(t,e){void 0===e&&(e=!0),this.cfg=t,this.playerData=o.default.Instance().getPlayerData(),this.material=cc.Material.getBuiltinMaterial("2d-sprite"),this.materialGray=cc.Material.getBuiltinMaterial("2d-gray-sprite"),this.canClick=e,this.init(),this.initUI(),this.initEvent()},e.prototype.init=function(){this.idLabel=this.node.getChildByName("idLabel").getComponent(cc.Label),this.bg=this.node.getChildByName("bg").getComponent(cc.Sprite),this.icon=this.bg.node.getChildByName("icon").getComponent(cc.Sprite),this.levelLabel=this.node.getChildByName("levelLabel").getComponent(cc.Label),this.idLabel.string=this.cfg.id.toString(),this.idLabel.node.active=!1},e.prototype.initUI=function(){this.talentData=this.playerData.getTalentData(this.cfg.id),this.icon.spriteFrame=this.spriteAtlas.getSpriteFrame(this.cfg.icon),this.talentData?(this.levelLabel.node.active=!0,this.levelLabel.string=this.talentData.level+"/"+this.cfg.maxlevel,this.talentData.level>=this.cfg.maxlevel?this.bg.spriteFrame=this.btnSpriteFrames[1]:this.bg.spriteFrame=this.btnSpriteFrames[0],this.icon.setMaterial(0,this.material)):(this.levelLabel.node.active=!1,this.bg.spriteFrame=this.btnSpriteFrames[2],this.icon.setMaterial(0,this.materialGray)),this.bg.getComponent(cc.Button).enabled=!0},e.prototype.initEvent=function(){this.canClick&&this.bg.node.on("click",this.clickTalent,this),s.default.Instance().onTalentLevelChange(this.initUI,this)},e.prototype.clickTalent=function(){var t=this.cfg;s.default.Instance().emitShowPanel({data:t,prefab:"prefab/talent/TalentInfoPanel"})},__decorate([c({type:cc.SpriteFrame})],e.prototype,"btnSpriteFrames",void 0),__decorate([c({type:cc.SpriteAtlas})],e.prototype,"spriteAtlas",void 0),__decorate([l],e)}(cc.Component);n.default=h,cc._RF.pop()},{}],TalentLayoutItemScript:[function(t,e,i){"use strict";cc._RF.push(e,"fc49fiCghdKS4xzoPoel2aw","TalentLayoutItemScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("SuperListItem"),r=a("TalentItemScript"),l=cc._decorator,c=l.ccclass,h=l.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.talentItemPrefab=null,e.items=[],e.pos=[200,6,-206],e}return __extends(e,t),e.prototype.setData=function(t){var e=this.node.getChildByName("layerLabel").getComponent(cc.Label);e.string=t,e.node.active=!1,this.layer=t,this.talents=o.Global.talentMgr.getCurrentLayerTalent(this.layer),this.init()},e.prototype.init=function(){for(var t=this.node.getChildByName("talentLayout"),e=0,i=this.talents;e<i.length;e++){var a=i[e],n=cc.instantiate(this.talentItemPrefab).getComponent(r.default);t.addChild(n.node),n.setData(a),this.items.push(n)}switch(this.items.length){case 1:this.items[0].node.x=this.pos[1];break;case 2:this.items[0].node.x=this.pos[2],this.items[1].node.x=this.pos[0];break;case 3:this.items[0].node.x=this.pos[2],this.items[1].node.x=this.pos[1],this.items[2].node.x=this.pos[0]}},__decorate([h({type:cc.Prefab})],e.prototype,"talentItemPrefab",void 0),__decorate([c],e)}(s.default);n.default=d,cc._RF.pop()},{}],TalentMgr:[function(t,e,i){"use strict";cc._RF.push(e,"e310bt/SftILK0htus+Guja","TalentMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(){function t(){}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.init=function(){this.cfg=cfgTable.talentData},t.prototype.getCurrentTalentText=function(t){if(!t)return"";var e="";for(var i in this.cfg){var a=this.cfg[i];if(a.type==t){e=o.Global.languageMgr.getText(Number(a.text));break}}return e},t.prototype.getCurrentLayerTalent=function(t){if(!t)return[];var e=[];for(var i in this.cfg){var a=this.cfg[i];a.layer==t&&e.push(a)}return e},t.prototype.getMaxLayer=function(){var t=0;for(var e in this.cfg){var i=this.cfg[e];i.layer>t&&(t=i.layer)}return t},t.prototype.getCfgLevelCount=function(){var t=this.cfg,e=0;for(var i in t)e+=t[i].maxlevel;return e},t.prototype.getPlayerLevelCount=function(){for(var t=0,e=0,i=o.Global.dataMgr.getPlayerData().getAllTalentData();e<i.length;e++)t+=i[e].level;return t},t}();n.default=s,cc._RF.pop()},{}],TalentResetPanel:[function(t,e,i){"use strict";cc._RF.push(e,"c8bec65a6RB3IXBIlMBntbN","TalentResetPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("DataMgr"),l=a("EventMgr"),c=cc._decorator,h=c.ccclass,d=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e}return __extends(e,t),e.prototype.initWithParam=function(t){this.showEffect(),this.talentScrollView=t.talentScrollView,this.init()},e.prototype.init=function(){var t=r.default.Instance().getPlayerData(),e=this.node.getChildByName("Panel");this.resetBtn=e.getChildByName("resetBtn");var i,a=this.resetBtn.getChildByName("costLabel").getComponent(cc.Label);this.resetBtn.on("click",this.resetTalent,this),e.getChildByName("close").on("click",this.emitCloseMe,this),t.getDiamond()>cfgTable.commonData.talentreset?(a.node.color=cc.color().fromHEX("#FFFFFF"),i=cc.Material.getBuiltinMaterial("2d-sprite")):(a.node.color=cc.color().fromHEX("#FF0000"),i=cc.Material.getBuiltinMaterial("2d-gray-sprite")),this.resetBtn.getComponent(cc.Sprite).setMaterial(0,i)},e.prototype.resetTalent=function(){var t=r.default.Instance().getPlayerData();t.getDiamond()>cfgTable.commonData.talentreset?(t.resetTalentData(),t.setDiamond(-cfgTable.commonData.talentreset),this.talentScrollView.scrollToBottom(.5)):l.default.Instance().emitTips(o.Global.languageMgr.getText(933106))},__decorate([h],e)}(s.default));n.default=d,cc._RF.pop()},{}],TalentSkillMgr:[function(t,e,i){"use strict";cc._RF.push(e,"ac0989lJOpJ1YdETHmss7gk","TalentSkillMgr");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("TalentBase"),s=a("Talent_ArmyAtk"),r=a("Talent_ArmyHp"),l=a("Talent_BaseHp"),c=a("Talent_CoinAd"),h=a("Talent_CoinGet"),d=a("Talent_CoinDouble"),u=a("Talent_KeepProgress"),p=a("Talent_MeatProduce"),f=a("Talent_CritRate"),g=a("Talent_CritAtk"),m=a("ResMgr"),y=a("TalentFly"),v=a("Talent_MissRate"),b=a("Talent_DropRate"),_=a("Talent_SweepZombie"),T=a("Talent_SpeedRate"),S=a("Talent_MoveRate"),D=function(){function t(){this.eftList=[]}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.init=function(){for(var t in this.talentObj={},o.ETalentType){var e=o.ETalentType[t],i=o.ETalentType[e],a=void 0;switch(i){case o.ETalentType.armyHp:a=new r.default;break;case o.ETalentType.armyAtk:a=new s.default;break;case o.ETalentType.baseHp:a=new l.default;break;case o.ETalentType.meatProduce:a=new p.default;break;case o.ETalentType.coinGet:a=new h.default;break;case o.ETalentType.coinAd:a=new c.default;break;case o.ETalentType.coinDouble:a=new d.default;break;case o.ETalentType.critRate:a=new f.default;break;case o.ETalentType.critAtk:a=new g.default;break;case o.ETalentType.missRate:a=new v.default;break;case o.ETalentType.dropRate:a=new b.default;break;case o.ETalentType.speedRate:a=new T.default;break;case o.ETalentType.moveRate:a=new S.default;break;case o.ETalentType.keepProgress:a=new u.default;break;case o.ETalentType.sweepZombie:a=new _.default}a&&(a.init(i),this.talentObj[i]=a)}},t.prototype.run=function(t,e,i){var a=this.talentObj[t];return a?(a.setTarget(e),a.setHero(i),a.run()):e||0},t.prototype.playEft=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,a,n,o,s,r,l,c=this;return __generator(this,function(h){switch(h.label){case 0:return t&&t.isValid?(i=t.fightplan.critNode,a=cc.v2(),n=cc.v2(),a.x=t.node.x,a.y=t.node.y,n.x=t.node.width,n.y=t.node.height,[4,m.default.Instance().loadAndGetRes("res","prefab/talent/TalentFly",cc.Prefab)]):[2];case 1:if(o=h.sent(),!i||!i.isValid)return[2];for(r=0;r<this.eftList.length;r++)this.eftList[r].isValid||(this.eftList.splice(r,1),r--);return this.eftList.length>0?(s=this.eftList.pop()).node.active=!0:((l=cc.instantiate(o)).parent=i,s=l.getComponent(y.default)),s.node.setSiblingIndex(-1),s.run(e),s.node.x=a.x,s.node.y=a.y+n.y/2,s.node.opacity=255,s.node.scale=1,cc.tween(s.node).to(.18,{scale:1.1}).to(.18,{scale:1}).to(.2,{opacity:0}).call(function(){s.node.active=!1,c.eftList.push(s)}).start(),[2]}})})},t.prototype.dropMeat=function(t,e){var i=this.talentObj[o.ETalentType.dropRate];i&&i.dropMeat(t,e)},t}();n.default=D,cc._RF.pop()},{}],TalentUIScript:[function(t,e,i){"use strict";cc._RF.push(e,"2f27334uV9OWYs7R4wpiiqk","TalentUIScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("DataMgr"),r=a("EventMgr"),l=a("SuperScrollView"),c=a("IVector2"),h=a("UtilOne"),d=a("TalentItemScript"),u=a("TalentLayoutItemScript"),p=cc._decorator,f=p.ccclass,g=p.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.line=null,e.talentScrollView=null,e.talentPotionNum=null,e.resetBtn=null,e.pointBtn=null,e.talentLayoutItems=[],e.talentItems=[],e.scrollPos=new cc.Vec2(0,0),e}return __extends(e,t),e.prototype.onLoad=function(){this.talentScrollView=this.node.getChildByName("talentScrollView").getComponent(l.default);var t=this.node.getChildByName("talentPotionBg");this.talentPotionNum=t.getChildByName("talentPotionNum").getComponent(cc.Label),this.resetBtn=this.node.getChildByName("resetBtn"),this.pointBtn=this.node.getChildByName("pointBtn"),this.init(),this.initList(),this.initLine(),this.initTalentPotion(),this.initEvent()},e.prototype.onEnable=function(){var t=this;this.initTalentPotion(),this.scheduleOnce(function(){for(var e=0,i=0,a=s.default.Instance().getPlayerData().getAllTalentData();i<a.length;i++){var n=a[i];cfgTable.talentData[n.id].layer>e&&(e=cfgTable.talentData[n.id].layer)}if(e>2){var o=t.talentScrollView.content.height,r=o-185*e;r+185>=o&&(r-=185),t.scrollPos.set(new cc.Vec2(0,r)),t.talentScrollView.setContentPosition(t.scrollPos)}else t.talentScrollView.scrollToBottom();t.talentScrollView.improveDC()})},e.prototype.onDisable=function(){},e.prototype.init=function(){},e.prototype.initList=function(){for(var t=[],e=1;e<=o.Global.talentMgr.getMaxLayer()+2;e++)t.push(e);this.talentScrollView.setData(t);for(var i=0,a=this.talentScrollView.node.getChildByName("view").getChildByName("content").children;i<a.length;i++){var n=a[i];if("talentLayoutItem"==n.name){this.talentLayoutItems.push(n.getComponent(u.default));for(var s=0,r=n.getChildByName("talentLayout").children;s<r.length;s++){var l=r[s];this.talentItems.push(l.getComponent(d.default))}}}},e.prototype.initLine=function(){var t=this;this.scheduleOnce(function(){for(var e=0,i=t.talentItems;e<i.length;e++)for(var a=i[e],n=0,o=t.getNextLayerItem(a.cfg.active);n<o.length;n++){var s=o[n],r=cc.instantiate(t.line);r.zIndex=-1;var l=a.node.parent.parent.convertToWorldSpaceAR(a.node.position),h=s.parent.parent.convertToWorldSpaceAR(s.position),d=l.sub(h).mag();r.height=d;var u=new c.Vector2(l),p=new c.Vector2(h),f=c.Vector2.angle360(u,p);r.angle=f-90,a.node.addChild(r)}})},e.prototype.initTalentPotion=function(t){void 0===t&&(t=0),this.talentPotionNum.string=t?""+h.default.ChangeNumberUnit(t):s.default.Instance().getPlayerData().getTalentPotion().toString()},e.prototype.initEvent=function(){this.resetBtn.on("click",this.showResetPanel,this),this.pointBtn.on("click",this.showTalentAddition,this),r.default.Instance().onTalentPotionChange(this.initTalentPotion,this)},e.prototype.showResetPanel=function(){r.default.Instance().emitShowPanel({data:{talentScrollView:this.talentScrollView},prefab:"prefab/talent/TalentResetPanel"})},e.prototype.showTalentAddition=function(){r.default.Instance().emitShowPanel({prefab:"prefab/talent/TalentAddition"})},e.prototype.getNextLayerItem=function(t){for(var e=[],i=0,a=t;i<a.length;i++)for(var n=a[i],o=0,s=this.talentItems;o<s.length;o++){var r=s[o];n[0]==r.cfg.id&&e.push(r.node)}return e},__decorate([g({type:cc.Prefab})],e.prototype,"line",void 0),__decorate([f],e)}(cc.Component);n.default=m,cc._RF.pop()},{}],Talent_ArmyAtk:[function(t,e,i){"use strict";cc._RF.push(e,"b00462YHQxHJYVUnqLsjMag","Talent_ArmyAtk");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("SkillMgr"),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=this.target,i=Number(e.roleDate.attack),a=(e.heroId?s.default.ins.getFirstBaseAtk()*(1+i):i)*(1+o.Global.common.getCardAtkRate()+this.rate);o.Global.isDebug&&console.log("\u5929\u8d4b\u5175\u79cd\u653b\u51fb\u529b",a),e.setAtk(a)},e}(a("TalentBase").default);n.default=r,cc._RF.pop()},{}],Talent_ArmyHp:[function(t,e,i){"use strict";cc._RF.push(e,"26898St+LdOk513aoIttswq","Talent_ArmyHp");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("SkillMgr"),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=this.target,i=Number(e.roleDate.hp),a=(e.heroId?s.default.ins.getFirstBaseHp()*(1+i):i)*(1+o.Global.common.getCardHpRate()+this.rate);o.Global.isDebug&&console.log("\u5929\u8d4b\u5175\u79cd\u751f\u547d",a),e.setHp(a),e.setCurHp(a)},e}(a("TalentBase").default);n.default=r,cc._RF.pop()},{}],Talent_BaseHp:[function(t,e,i){"use strict";cc._RF.push(e,"88121izXnVPyrM78UOeldWx","Talent_BaseHp");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=this.target*(1+o.Global.common.getCardBaseHpRate()+this.rate);return o.Global.isDebug&&console.log("\u5929\u8d4b\u57fa\u5730\u751f\u547d",e),e},e}(a("TalentBase").default);n.default=s,cc._RF.pop()},{}],Talent_CoinAd:[function(t,e,i){"use strict";cc._RF.push(e,"ac5f0yU6yhCJZ8O65sNOe3e","Talent_CoinAd");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=this.target,i=Math.floor(e*(2+this.rate));return o.Global.isDebug&&console.log("\u5929\u8d4b\u5e7f\u544a\u91d1\u5e01",i),i},e}(a("TalentBase").default);n.default=s,cc._RF.pop()},{}],Talent_CoinDouble:[function(t,e,i){"use strict";cc._RF.push(e,"3ed78A+NPRCmJIJfRqTA/Mi","Talent_CoinDouble");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=Math.random()<=this.rate;return o.Global.isDebug&&console.log("\u5929\u8d4b\u989d\u5916\u6389\u843d\u91d1\u5e01\u51e0\u7387",e),e},e}(a("TalentBase").default);n.default=s,cc._RF.pop()},{}],Talent_CoinGet:[function(t,e,i){"use strict";cc._RF.push(e,"0df87LHCt5LhaMrJs3eBt86","Talent_CoinGet");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=this.target,i=Math.floor(e*(1+this.rate));return o.Global.isDebug&&console.log("\u5929\u8d4b\u91d1\u5e01\u63d0\u5347",i),i},e}(a("TalentBase").default);n.default=s,cc._RF.pop()},{}],Talent_CritAtk:[function(t,e,i){"use strict";cc._RF.push(e,"c8614+o4CRPuazNo9+TXVeD","Talent_CritAtk");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=this.target*(1+this.rate);return o.Global.isDebug&&console.log("\u5929\u8d4b\u66b4\u51fb\u4f24\u5bb3",e),e},e}(a("TalentBase").default);n.default=s,cc._RF.pop()},{}],Talent_CritRate:[function(t,e,i){"use strict";cc._RF.push(e,"43f00zMRbtJR4dm+bA+Wr6b","Talent_CritRate");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=Math.random()<=this.rate;return o.Global.isDebug&&console.log("\u5929\u8d4b\u66b4\u51fb\u51e0\u7387",e),e},e}(a("TalentBase").default);n.default=s,cc._RF.pop()},{}],Talent_DropRate:[function(t,e,i){"use strict";cc._RF.push(e,"ce0a9HUUghOOoxuvc8i3e5l","Talent_DropRate");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("ResMgr"),r=a("SkillMgr"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pos=new cc.Vec2,e.list=[],e}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=Math.random()<=this.rate;return o.Global.isDebug&&console.log("\u5929\u8d4b\u6389\u843d\u98df\u7269\u51e0\u7387",e),e},e.prototype.dropMeat=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(a){switch(a.label){case 0:return t&&t.isValid&&e&&e.isValid?(this.pos.x=t.node.x,this.pos.y=t.node.y,i=this,[4,s.default.Instance().loadAndGetRes("res","prefab/skill/Skill_Meat",cc.Prefab)]):[2];case 1:return i.prefab=a.sent(),this.meatNum=this.getMeatNum(),this.addMeat(e),this.playMeatAni(e),[2]}})})},e.prototype.getMeatNum=function(){return Math.floor(r.default.ins.getFirstMeat()/3)||1},e.prototype.addMeat=function(t){t.addMeat(this.meatNum)},e.prototype.getNode=function(t){for(var e=0;e<this.list.length;e++){var i=this.list[e];i&&i.isValid||(this.list.splice(e,1),e--)}var a;return this.list.length>0?(a=this.list.pop()).active=!0:(a=cc.instantiate(this.prefab)).parent=t.critNode,a.setSiblingIndex(-1),a},e.prototype.playMeatAni=function(t){var e=this,i=t,a=this.getNode(i);a.x=this.pos.x,a.y=this.pos.y+12,cc.find("icon/txt",a).getComponent(cc.Label).string="+"+this.meatNum;var n=cc.find("icon",a);n.scale=1,n.opacity=255,cc.tween(n).delay(.1).to(.2,{scale:1.2}).to(.2,{scale:1}).delay(.3).to(.3,{opacity:0}).call(function(){a.active=!1,e.list.push(a)}).start()},e}(a("TalentBase").default);n.default=l,cc._RF.pop()},{}],Talent_KeepProgress:[function(t,e,i){"use strict";cc._RF.push(e,"f0ce6v7q/pC6r90A5SkV6la","Talent_KeepProgress");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){return t.prototype.run.call(this),this.active},e}(a("TalentBase").default);n.default=o,cc._RF.pop()},{}],Talent_MeatProduce:[function(t,e,i){"use strict";cc._RF.push(e,"cd32cDZmrtPv4gS78ngpmOo","Talent_MeatProduce");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=this.target*(1+o.Global.common.getCardMeatRate()+this.rate);return o.Global.isDebug&&console.log("\u5929\u8d4b\u7cae\u98df\u901f\u5ea6\u63d0\u5347",e),e},e}(a("TalentBase").default);n.default=s,cc._RF.pop()},{}],Talent_MissRate:[function(t,e,i){"use strict";cc._RF.push(e,"d66ef51jIdPaKW7mEwhQt/M","Talent_MissRate");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=Math.random()<=this.rate;return o.Global.isDebug&&console.log("\u5929\u8d4b\u9632\u5fa1\u51e0\u7387",e),e},e}(a("TalentBase").default);n.default=s,cc._RF.pop()},{}],Talent_MoveRate:[function(t,e,i){"use strict";cc._RF.push(e,"5e15dPylfZHxoBJrfp7wbIg","Talent_MoveRate");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=this.target*(1+this.rate);return o.Global.isDebug&&console.log("\u79fb\u901f\u63d0\u5347",e),e},e}(a("TalentBase").default);n.default=s,cc._RF.pop()},{}],Talent_SpeedRate:[function(t,e,i){"use strict";cc._RF.push(e,"ac376d6rJ1DLYSA3AGze49n","Talent_SpeedRate");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){t.prototype.run.call(this);var e=this.target*(1+this.rate);return o.Global.isDebug&&console.log("\u653b\u901f\u63d0\u5347",e),e},e}(a("TalentBase").default);n.default=s,cc._RF.pop()},{}],Talent_SweepZombie:[function(t,e,i){"use strict";cc._RF.push(e,"c5990tIifhBOZW8wmbYwvjF","Talent_SweepZombie");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(e){t.prototype.init.call(this,e)},e.prototype.setTarget=function(e){t.prototype.setTarget.call(this,e)},e.prototype.run=function(){return t.prototype.run.call(this),this.active},e}(a("TalentBase").default);n.default=o,cc._RF.pop()},{}],TaskMgrBase:[function(t,e,i){"use strict";cc._RF.push(e,"6f4b6aVYHlDP792NI3ErLxf","TaskMgrBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.TaskType=n.TaskRequireType=void 0;var o=a("Singleton");(function(t){t[t.TaskRequireKill=0]="TaskRequireKill",t[t.TaskRequireLevel=1]="TaskRequireLevel",t[t.TaskRequireKillMonster=2]="TaskRequireKillMonster"})(n.TaskRequireType||(n.TaskRequireType={})),function(t){t[t.TaskTypeNormal=0]="TaskTypeNormal",t[t.TaskTypeDaily=1]="TaskTypeDaily"}(n.TaskType||(n.TaskType={}));var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mTaskList=[],e}return __extends(e,t),e}(o.default);n.default=s,cc._RF.pop()},{}],Task:[function(t,e,i){"use strict";cc._RF.push(e,"bf52b1kbURDMJYZbYYh9Eto","Task");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("ConfigMgr"),r=a("DataMgr"),l=a("EventMgr"),c=a("typeEnum"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.title=null,e.info=null,e.reward=null,e.sprs=[],e.tex=0,e.gameDate=null,e.canTouch=!1,e.curTask=null,e.count=0,e}return __extends(e,t),e.prototype.onLoad=function(){this.gameDate=r.default.Instance().getPlayerData(),l.default.Instance().onTaskStart(this.taskStart,this),l.default.Instance().onTaskHide(this.hideTsak,this),this.node.on("click",this.onchick,this),this.taskStart()},e.prototype.onchick=function(){if(this.canTouch){this.canTouch=!1;var t=this.curTask.task.gemnumber;o.Global.common.flyProp(this.node,c.CurrencyType.Diamond,t),cc.Tween.stopAllByTag(c.TweenTag.task),cc.tween(this.node).to(.3,{scale:1.1,opacity:0}).tag(c.TweenTag.taskEnd).start(),this.gameDate.finishCurTask();var e=this.gameDate.getCurTaskData();e&&e.task||l.default.Instance().emitTaskHide()}},e.prototype.taskStart=function(){var t=this.gameDate.getCurTaskData();this.gameDate.getPassInfo().passCount<cfgTable.commonData.dailytaskopen||!t||!t.task?this.node.opacity=0:this.show()},e.prototype.show=function(){var t=this.gameDate.getCurTaskData();t&&t.task?(l.default.Instance().onRefreshTask(this.refreshPanel,this),this.node.scale=.8,this.node.opacity=0,this.initPlanel(),cc.Tween.stopAllByTag(c.TweenTag.task),cc.Tween.stopAllByTag(c.TweenTag.taskEnd),cc.tween(this.node).to(.3,{scale:1,opacity:255}).tag(c.TweenTag.taskStart).start()):this.node.opacity=0},e.prototype.initPlanel=function(){this.title.string=o.Global.languageMgr.getText(920201)+" "+(this.gameDate.getCurTaskData().curIndex+1)+"/"+cfgTable.commonData.dailytasknumber,this.curTask=this.gameDate.getCurTaskData();var t=this.curTask.task.number;1==this.curTask.task.type?t*=this.curTask.meatLevel:2==this.curTask.task.type&&(t*=s.default.Instance().getTableValue("level",this.curTask.meatLevel,cfgTable.skillData).foodnumber),t=Math.round(t),this.count=t;for(var e=o.Global.languageMgr.getText(Number(this.curTask.task.dailytasktextid)),i=s.default.Instance().getTableValue("ID",this.curTask.maxleves,cfgTable.evolutionData),a=[],n=0;n<i.warriorsid.length;++n){var r=s.default.Instance().getTableValue("warriorsid",i.warriorsid[n],cfgTable.warriorsData);a.push(r)}var l=e.replace("{0}",this.count+"").replace("{1}",o.Global.languageMgr.getText(Number(a[0].nameid))).replace("{2}",o.Global.languageMgr.getText(Number(a[1].nameid))).replace("{3}",o.Global.languageMgr.getText(Number(a[2].nameid)));this.info.string=l+"  "+this.curTask.finishCount+"/"+this.count,this.reward.string=""+this.curTask.task.gemnumber,this.curTask.finishCount>=this.count?(this.node.getComponent(cc.Sprite).spriteFrame=this.sprs[0],this.canTouch=!0,cc.tween(this.node).repeatForever(cc.tween().to(.5,{scale:1.2}).to(.5,{scale:.9})).tag(c.TweenTag.task).start()):(this.node.getComponent(cc.Sprite).spriteFrame=this.sprs[1],this.canTouch=!1,cc.Tween.stopAllByTag(c.TweenTag.task))},e.prototype.refreshPanel=function(){if(this.curTask=this.gameDate.getCurTaskData(),this.curTask&&this.curTask.task){for(var t=o.Global.languageMgr.getText(Number(this.curTask.task.dailytasktextid)),e=s.default.Instance().getTableValue("ID",this.curTask.maxleves,cfgTable.evolutionData),i=[],a=0;a<e.warriorsid.length;++a){var n=s.default.Instance().getTableValue("warriorsid",e.warriorsid[a],cfgTable.warriorsData);i.push(n)}var r=t.replace("{0}",this.count+"").replace("{1}",o.Global.languageMgr.getText(Number(i[0].nameid))).replace("{2}",o.Global.languageMgr.getText(Number(i[1].nameid))).replace("{3}",o.Global.languageMgr.getText(Number(i[2].nameid)));this.info.string=r+"  "+this.curTask.finishCount+"/"+this.count,this.reward.string=""+this.curTask.task.gemnumber,this.curTask.finishCount>=this.count?(this.node.getComponent(cc.Sprite).spriteFrame=this.sprs[0],this.canTouch=!0,cc.tween(this.node).repeatForever(cc.tween().to(.5,{scale:1.2}).to(.5,{scale:.9})).tag(c.TweenTag.task).start()):(this.node.getComponent(cc.Sprite).spriteFrame=this.sprs[1],this.canTouch=!1,cc.Tween.stopAllByTag(c.TweenTag.task))}else this.node.opacity=0},e.prototype.hideTsak=function(){this.node.opacity=0},__decorate([u(cc.Label)],e.prototype,"title",void 0),__decorate([u(cc.Label)],e.prototype,"info",void 0),__decorate([u(cc.Label)],e.prototype,"reward",void 0),__decorate([u(cc.SpriteFrame)],e.prototype,"sprs",void 0),__decorate([u],e.prototype,"tex",void 0),__decorate([d],e)}(cc.Component);n.default=p,cc._RF.pop()},{}],TimeScaleScript:[function(t,e,i){"use strict";cc._RF.push(e,"a694c1UU6FNr5b5heAIBQ/I","TimeScaleScript");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("DataMgr"),r=a("EventMgr"),l=a("ResMgr"),c=a("typeEnum"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isCountdown=!1,e.time=0,e.imgs=[],e.isGameOver=!1,e}return __extends(e,t),e.prototype.onLoad=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a;return __generator(this,function(n){switch(n.label){case 0:return this.playerData=s.default.Instance().getPlayerData(),this.timeScaleData=this.playerData.getTimeScaleData(),o.Global.sdkMgr.curSdk.option.costom.TimeScaleScript?(e=(t=this.imgs).push,[4,l.default.Instance().loadAndGetRes("res","image/timeScale/play",cc.SpriteFrame)]):(this.playerData.setTimeScaleData(!this.timeScaleData.isOpen,0),[2]);case 1:return e.apply(t,[n.sent()]),a=(i=this.imgs).push,[4,l.default.Instance().loadAndGetRes("res","image/timeScale/play1",cc.SpriteFrame)];case 2:return a.apply(i,[n.sent()]),this.initUI(),this.initEvent(),[2]}})})},e.prototype.update=function(t){!this.isCountdown||this.timeScaleData.timeLeft<=0||(this.timeScaleData.timeLeft>0?(this.countdownLabel.node.active=!0,this.time+=t,this.time>=1&&(this.time=0,this.playerData.setTimeScaleData(this.timeScaleData.isOpen,this.timeScaleData.timeLeft-1))):this.countdownLabel.node.active=!1)},e.prototype.initUI=function(){this.adBtn=this.node.getChildByName("adBtn"),this.adLabel=this.adBtn.getChildByName("adLabel").getComponent(cc.Label),this.changeStateBtn=this.node.getChildByName("changeStateBtn"),this.changeStateLabel=this.changeStateBtn.getChildByName("changeStateLabel").getComponent(cc.Label),this.changeStatePlay=this.changeStateBtn.getChildByName("changeStatePlay").getComponent(cc.Sprite),this.countdownLabel=this.changeStateBtn.getChildByName("countdownLabel").getComponent(cc.Label),this.adBtn.off("click",this.openAd,this),this.adBtn.on("click",this.openAd,this),this.changeStateBtn.off("click",this.changeTimeScaleState,this),this.changeStateBtn.on("click",this.changeTimeScaleState,this);var t=this.getTime(this.timeScaleData.timeLeft);this.countdownLabel.string=t[1]+":"+t[2],this.adBtn.active=!1,this.changeStateBtn.active=!1,this.countdownLabel.node.active=!1,this.adLabel.string="x"+(cfgTable.commonData.timeScaleNum[1]-1),this.timeScaleData.isOpen?(this.changeStateLabel.string="x"+(cfgTable.commonData.timeScaleNum[1]-1),this.changeStatePlay.spriteFrame=this.imgs[0]):(this.changeStateLabel.string="x"+(cfgTable.commonData.timeScaleNum[0]-1),this.changeStatePlay.spriteFrame=this.imgs[1]),this.timeScaleData.timeLeft>0?(this.changeStateBtn.active=!0,this.countdownLabel.node.active=!0):this.adBtn.active=!0},e.prototype.initEvent=function(){var t=this;r.default.Instance().onTimeScaleTimeChange(this.initUI,this),r.default.Instance().onGameOver(function(){t.isCountdown=!1},this)},e.prototype.changeTimeScaleState=function(){this.playerData.setTimeScaleData(!this.timeScaleData.isOpen,this.timeScaleData.timeLeft),r.default.Instance().emitTimeScaleChange(),this.initUI()},e.prototype.openAd=function(){var t=this;o.Global.sdkMgr.openAd(function(){o.Global.umSDK.send(c.EnumDefine.fieldName.play_AD,{type:c.EnumDefine.fieldDes.timeScale,lv:s.default.Instance().getPlayerData().getMaxLevel()});var e=cfgTable.commonData.timeScaleTime,i=o.Global.sdkMgr.curSdk.option.parameter;i&&i.timeScaleTime&&-1!=i.timeScaleTime&&(e=i.timeScaleTime),t.playerData.setTimeScaleData(!0,e),t.initUI(),r.default.Instance().emitTimeScaleChange()})},e.prototype.getTime=function(t){t=t.toString();var e=parseInt((t/60/60%24).toString());e=e<10?"0"+e:e;var i=parseInt((t/60%60).toString());i=i<10?"0"+i:i;var a=parseInt((t%60).toString());return[e,i,a=a<10?"0"+a:a]},__decorate([u()],e.prototype,"isCountdown",void 0),__decorate([d],e)}(cc.Component);n.default=p,cc._RF.pop()},{}],TimerMgr:[function(t,e,i){"use strict";cc._RF.push(e,"7e515rnd2tMkbwb7Zpbzcex","TimerMgr");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,s=(n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mTimer=[],e}return __extends(e,t),e.prototype.start=function(){},e.prototype.update=function(t){for(var e in this.mTimer)this.mTimer[e]._uptime-=t,this.mTimer[e]._uptime<0&&(this.mTimer[e]._callback.apply(this),this.mTimer[e]._uptime=this.mTimer[e]._maxTime)},__decorate([o],e)}(cc.Component));a.default=s,cc._RF.pop()},{}],Tips:[function(t,e,i){"use strict";cc._RF.push(e,"afbf7PQIFlMurQORveoiMug","Tips");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,s=n.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.TipsLabel=null,e.Time=1,e.Timer=0,e}return __extends(e,t),e.prototype.start=function(){var t=this;cc.tween(this.node).to(.2,{scale:1.2}).to(.1,{scale:1}).start(),this.node.on("click",function(){t.node.removeFromParent()},this)},e.prototype.setTipsInfo=function(t,e){this.TipsLabel.string=t,this.Timer=0,this.Time=e,this.node.scale=0},e.prototype.update=function(t){var e=this;this.Timer+=t,this.Timer>=this.Time&&cc.tween(this.node).to(.5,{opacity:0}).call(function(){e.node.removeFromParent()}).start()},__decorate([s({type:cc.Label,displayName:"\u63d0\u793a\u6587\u672c"})],e.prototype,"TipsLabel",void 0),__decorate([o],e)}(cc.Component);a.default=r,cc._RF.pop()},{}],TweenMaterial:[function(t,e,i){"use strict";cc._RF.push(e,"cc197G8HrRGE7KeDgSgkpid","TweenMaterial");var a=i;Object.defineProperty(a,"__esModule",{value:!0}),a.TweenMaterial=void 0;var n=function(){function t(t,e,i){this.Spr=null,this._mainAny=null,this.Name="",this.Spr=t,this.material=t.getMaterial(0),this.Name=e,null!==i||null!=i?(this._mainAny=i,this.material.setProperty(this.Name,this._mainAny)):this._mainAny=null}return Object.defineProperty(t.prototype,"mainAny",{get:function(){if(null!==this.Spr)return this._mainAny},set:function(t){this._mainAny=t,this.material.setProperty(this.Name,this._mainAny)},enumerable:!1,configurable:!0}),t}();a.TweenMaterial=n,cc._RF.pop()},{}],UIBroadside:[function(t,e,i){"use strict";cc._RF.push(e,"480d7kwskRNeoIn6DQFVX/X","UIBroadside");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("EventMgr"),l=cc._decorator,c=l.ccclass,h=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.content=this.findElement("content"),this.btnGo=this.findElement("content/btnGo"),this.btnGet=this.findElement("content/btnGet"),this.btn_close=this.findElement("content/btn_close"),this.addEvent(),this.addCustomEvent(),this.init()},e.prototype.addEvent=function(){this.addClick(this.btnGo),this.addClick(this.btnGet),this.addClick(this.btn_close)},e.prototype.addCustomEvent=function(){},e.prototype.init=function(){this.updateState()},e.prototype.updateState=function(){this.updateUI()},e.prototype.updateUI=function(){var t=window.tt_is_sidebar;this.btnGo.active=!t,this.btnGet.active=t},e.prototype.initWithParam=function(){this.updateState()},e.prototype.emitCloseMe=function(){t.prototype.emitCloseMe.call(this)},e.prototype.onClick=function(t){switch(t.target){case this.btn_close:this.emitCloseMe();break;case this.btnGo:this.getBroadside(),this.emitCloseMe();break;case this.btnGet:this.getAward(),this.emitCloseMe()}},e.prototype.getAward=function(){r.default.Instance().emitGetBroadsideAward()},e.prototype.getBroadside=function(){o.Global.sdkMgr.navigateToScene()},__decorate([c],e)}(s.default));n.default=h,cc._RF.pop()},{}],UIComp:[function(t,e,i){"use strict";cc._RF.push(e,"9c443MRcVJCi4TIhzaVAd2O","UIComp");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("EventMgrBase"),s=a("PanelBase"),r=a("ResMgr"),l=a("typeEnum"),c=cc._decorator,h=c.ccclass,d=c.property,u=function(){function t(t,e){this.node=null,this.name=null,this.panelBase=null,this.weight=0,this.node=t,this.name=e,this.panelBase=t.getComponent(s.default),this.panelBase.setPanelName(e)}return t.prototype.initWithParam=function(t){var e=this.getPanelBase();e&&e.initWithParam(t)},t.prototype.getPanelBase=function(){return this.panelBase},t.prototype.show=function(t,e){this.node.opacity=255,this.node.zIndex=this.weight;var i=this.getPanelBase();i&&e&&i.showPanel(t)},t.prototype.hide=function(){this.node.opacity=0,this.node.zIndex=0},t.prototype.close=function(){var t=this.getPanelBase();t?t.hidePanel():this.node.destroy()},t.prototype.setWeight=function(t){this.weight=t},t.prototype.getWeight=function(){return this.weight},t.prototype.getName=function(){return this.name},t}(),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Container=null,e.TipsParent=null,e.interludeMask=null,e.YesPanelPrefab=null,e.TipsPrefab=null,e.PrevPanelList=[],e.panelQueue=[],e.waitingPanelQUeue={},e.abName="ui",e.interludeOver=!0,e}return __extends(e,t),e.prototype.onLoad=function(){this.panelQueue=[]},e.prototype.getPanel=function(t){for(var e in this.panelQueue)if(this.panelQueue[e].getName()==t)return this.panelQueue[e];return null},e.prototype.appendPanel=function(t,e,i){e.setWeight(i),this.panelQueue.push(e),i>=2e3?e.show(!1,!1):(this.updatePanelSort(),this.doOtherPanels(!1))},e.prototype.removePanel=function(t){var e=[];for(var i in this.panelQueue)this.panelQueue[i]&&this.panelQueue[i].getName()!=t&&e.push(this.panelQueue[i]);this.panelQueue=[],this.panelQueue=e},e.prototype.getPanelMaxWeight=function(){var t,e=1e3;for(var i in this.panelQueue){var a=null===(t=this.panelQueue[i])||void 0===t?void 0:t.getWeight();a<1e3||a>2e3||a>e&&(e=a)}return e},e.prototype.getTopMaxWeight=function(){var t,e=2e3;for(var i in this.panelQueue){var a=null===(t=this.panelQueue[i])||void 0===t?void 0:t.getWeight();a<2e3||a>e&&(e=a)}return e},e.prototype.getDeepMaxWeight=function(){var t,e=0;for(var i in this.panelQueue){var a=null===(t=this.panelQueue[i])||void 0===t?void 0:t.getWeight();a>=1e3||a>e&&(e=a)}return e},e.prototype.start=function(){o.default.Instance().onShowPanel(this.showPanel,this),o.default.Instance().onHidePanel(this.hidePanel,this)},e.prototype.updatePanelSort=function(){this.panelQueue.sort(function(t,e){return t.getWeight()-e.getWeight()})},e.prototype.doOtherPanels=function(t){if(this.panelQueue.length<=0)o.default.Instance().emitShowOrHideMainPanel(!0);else{var e=[],i=!1;for(var a in this.panelQueue)if((r=this.panelQueue[a])&&!(r.getWeight()>=2e3)){this.panelQueue[a].hide();var n=this.panelQueue[a].getPanelBase();n&&n.IsFullScreen()&&(i=!0)}for(var s=this.panelQueue.length-1;s>=0;s--){var r;if((r=this.panelQueue[s])&&!(r.getWeight()>=2e3)){r.show(t,this.PrevPanelList.indexOf(r)<0),e.push(r);var l=r.getPanelBase();if(l&&l.IsFullScreen())break}}this.PrevPanelList=e,o.default.Instance().emitShowOrHideMainPanel(!i)}},e.prototype.showPanel=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,a,n,o;return __generator(this,function(s){switch(s.label){case 0:if(""==(e=t.prefab))return[2];switch(t.abName&&0!=t.abName.length||(t.abName=this.abName),i=0,t.panelType){case l.PanelType.BattleTip:i=this.getDeepMaxWeight()+1;break;case l.PanelType.NormalPanel:i=this.getPanelMaxWeight()+1;break;case l.PanelType.HighPanel:i=this.getTopMaxWeight()+1}return this.waitingPanelQUeue[e]?[2]:(this.waitingPanelQUeue[e]=1,(a=this.getPanel(e))&&!t.createNew?[3,2]:[4,r.default.Instance().loadAndGetRes(t.abName,e)]);case 1:if(!(n=s.sent()))return console.error("\u663e\u793a\u9762\u677f: "+e+"\u9519\u8bef!"),this.waitingPanelQUeue[e]=null,delete this.waitingPanelQUeue[e],[2];o=cc.instantiate(n),this.Container.addChild(o),a=new u(o,e),s.label=2;case 2:return null!=t.data&&a.initWithParam(t.data),this.appendPanel(e,a,i),this.waitingPanelQUeue[e]=null,delete this.waitingPanelQUeue[e],[2]}})})},e.prototype.hidePanel=function(t){var e=null;if(t&&t.prefab)e=this.getPanel(t.prefab);else for(var i=this.panelQueue.length-1;i>=0;i++){var a=this.panelQueue[i];if(a&&!(a.getWeight()>=2e3)){e=a;break}}e&&(e.close(),this.removePanel(e.getName()),this.doOtherPanels(!0))},__decorate([d({displayName:"\u9762\u677f\u5bb9\u5668\u8282\u70b9",type:cc.Node})],e.prototype,"Container",void 0),__decorate([d({type:cc.Node,displayName:"\u63d0\u793a\u5bb9\u5668"})],e.prototype,"TipsParent",void 0),__decorate([d({type:cc.Node,displayName:"\u8fc7\u573a\u52a8\u753b\u906e\u7f69"})],e.prototype,"interludeMask",void 0),__decorate([h],e)}(cc.Component);n.default=p,cc._RF.pop()},{}],UIGMPlan:[function(t,e,i){"use strict";cc._RF.push(e,"fc845dpiq9DK5nbiy+Loerd","UIGMPlan");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("DataMgr"),l=a("EventMgr"),c=a("typeEnum"),h=a("UtilOne"),d=cc._decorator,u=d.ccclass,p=(d.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.closeBtn=null,e.content=null,e.btnAddMeat=null,e.btnAddKey=null,e.btnAddPotion=null,e.btnTimeLine=null,e.btnSkillMaxLevel=null,e.btnAddTalentPotion=null,e.btnTalentMax=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.btnAddCoin=this.findElement("content/btns/btnAddCoin"),this.btnAddDiamond=this.findElement("content/btns/btnAddDiamond"),this.btnAddPotion=this.findElement("content/btns/btnAddPotion"),this.btnAddTalentPotion=this.findElement("content/btns/btnAddTalentPotion"),this.btnAddMeat=this.findElement("content/btns/btnAddMeat"),this.btnAddKey=this.findElement("content/btns/btnAddKey"),this.btnTimeLine=this.findElement("content/btns/btnTimeLine"),this.btnSkillMaxLevel=this.findElement("content/btns/btnSkillMaxLevel"),this.btnTalentMax=this.findElement("content/btns/btnTalentMax"),this.content=this.findElement("content/languageSelect/view/content"),this.closeBtn=this.findElement("content/close"),this.btnAddCoin.on("click",this.addCoin,this),this.btnAddDiamond.on("click",this.addDiamond,this),this.closeBtn.on("click",this.emitCloseMe,this),this.btnAddMeat.on("click",this.addmeat,this),this.btnAddKey.on("click",this.addKey,this),this.btnAddPotion.on("click",this.addPotion,this),this.btnAddTalentPotion.on("click",this.addTalentPotion,this),this.btnTimeLine.on("click",this.setTimeLine,this),this.btnSkillMaxLevel.on("click",this.setAllSkillMaxLevel,this),this.btnTalentMax.on("click",this.talentMax,this),this.initLanguageSelect()},e.prototype.initLanguageSelect=function(){var t=this,e=function(e){var a=new cc.Node;a.addComponent(cc.Label).string=e,i.content.addChild(a),r.default.Instance().getPlayerData().getLanguage()==e&&(a.color=cc.Color.BLACK),a.on(cc.Node.EventType.TOUCH_START,function(){for(var i=0,n=t.content.children;i<n.length;i++)n[i].color=cc.Color.WHITE;a.color=cc.Color.BLACK,o.Global.languageMgr.changeLanguage(e)},i)},i=this;for(var a in c.LanguageType)e(a)},e.prototype.closeSelf=function(){this.emitCloseMe()},e.prototype.addCoin=function(){r.default.Instance().getPlayerData().setUserCoin(1e21)},e.prototype.addDiamond=function(){r.default.Instance().getPlayerData().setDiamond(1e4)},e.prototype.addPotion=function(){r.default.Instance().getPlayerData().setPotion(1e4)},e.prototype.addmeat=function(){r.default.Instance().getPlayerData().setMeatLevel(1e3)},e.prototype.addKey=function(){r.default.Instance().getPlayerData().setZembieKays(2),l.default.Instance().emitZembieLevelChange(),r.default.Instance().getPlayerData().setLegendKays(2),l.default.Instance().emitLegendLevelChange(),r.default.Instance().getPlayerData().setBossKays(2),l.default.Instance().emitBossLevelChange()},e.prototype.setTimeLine=function(){r.default.Instance().getPlayerData().setTimeLine(),l.default.Instance().emitShowPanel({prefab:"prefab/MainPanel/EvoPassPanel"})},e.prototype.setAllSkillMaxLevel=function(){for(var t=r.default.Instance().getPlayerData(),e=[],i=function i(){var a=cfgTable.cardskilllevelData[t.getTakeSkillLevel()+""],n=a.probability,o=h.default.get_weight_random(n,"1"),s=a.probability[o][0],r=[];for(var l in cfgTable.cardskillData)Number(cfgTable.cardskillData[l].cardid)==s&&r.push(cfgTable.cardskillData[l]);var c=r[Math.floor(Math.random()*r.length)];if(t.subSkillTotalCount(c.ID))e.push(c.ID),t.setTakeSkillCount(),t.setSkillIdList(c.ID);else for(var d=0,u=t.getSkillTotalCount();d<u.length;d++)if(u[d].maxCount>0){i();break}},a=!0,n=0;n<808;n++)0==t.getSkillIdList().length&&a?(e.push(1),t.subSkillTotalCount(1),t.setTakeSkillCount(),a=!1):i()},e.prototype.addTalentPotion=function(){r.default.Instance().getPlayerData().setTalentPotion(1e4)},e.prototype.talentMax=function(){var t=o.Global.dataMgr.getPlayerData();for(var e in cfgTable.talentData)for(var i=cfgTable.talentData[e],a=0;a<i.maxlevel;a++)t.setTalentData(i.id)},__decorate([u],e)}(s.default));n.default=p,cc._RF.pop()},{}],UpgradesPanel:[function(t,e,i){"use strict";cc._RF.push(e,"518e015vEFP7JByPN/FiMO7","UpgradesPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("AudioMgr"),r=a("ConfigMgr"),l=a("DataMgr"),c=a("EventMgr"),h=a("ResMgr"),d=a("UtilOne"),u=a("typeEnum"),p=cc._decorator,f=p.ccclass,g=p.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.card=[],e.addMeatBtn=null,e.addBaseHpBtn=null,e.switchBtn=null,e.evolus=[],e.cardBgs=[],e.addMeat=null,e.addBaseHp=null,e.addMeatCost=null,e.addBaseCost=null,e.btnStatuSpr=[],e.curEvolutionLogo=null,e.nextEvolutionLogo=null,e.curEvolutionLogoName=null,e.nextEvolutionLogoName=null,e.evoBtn=null,e.redPoint=null,e.upgradesEvoRoot=null,e.upgradesTimeLineRoot=null,e.upgradesTimeLineBtn=null,e.jiantou=null,e.timeLineLabel=null,e.imgs=[],e.normal=null,e.gray=null,e.evolutionBtn=null,e.upgraesBtn=null,e.data=null,e.curEvolution=null,e}return __extends(e,t),e.prototype.onLoad=function(){c.default.Instance().onRefreshUpgrad(this.ininPanel,this),c.default.Instance().onCoinChange(this.randerUpgradesUI,this),c.default.Instance().onCoinChange(this.upEvoBtnShow,this),this.initGuide()},e.prototype.onEnable=function(){this.data=l.default.Instance().getPlayerData(),this.ininPanel(),this.touchHander();var t=this.data.getMaxLevel()+1,e=cfgTable.evolution=r.default.Instance().getTableValue("ID",t,cfgTable.evolutionData);l.default.Instance().getPlayerData().canTravel?this.switchLeft():e&&this.data.getUserCoin()>=e.evolutionmoney&&0!=e.evolutionmoney?this.switchLeft():(this.switchRight(),o.Global.redDotMgr.changeRedDotState(u.RedDotId.UpgradePanelUpgradeBtn,!1))},e.prototype.onDisable=function(){this.evoBtn.off("click",this.onEvoBtnClick,this),this.redPoint.off("click",this.redPointClick,this),this.evoBtn.on("click",this.onEvoBtnClick,this),this.redPoint.on("click",this.redPointClick,this),this.upgradesTimeLineBtn.off("click",this.onUpgradesTimeLineBtnClick,this),this.addBaseHpBtn.off(cc.Node.EventType.TOUCH_START,this.touchBaseStart,this),this.addBaseHpBtn.off(cc.Node.EventType.TOUCH_END,this.touchBaseEnd,this),this.addBaseHpBtn.off(cc.Node.EventType.TOUCH_CANCEL,this.touchBaseEnd,this),this.addMeatBtn.off(cc.Node.EventType.TOUCH_START,this.touchMeatStart,this),this.addMeatBtn.off(cc.Node.EventType.TOUCH_END,this.touchMeatEnd,this),this.addMeatBtn.off(cc.Node.EventType.TOUCH_CANCEL,this.touchMeatEnd,this)},e.prototype.onTaskMgr=function(){c.default.Instance().onCoinChange(this.upEvoBtnShow,this)},e.prototype.upEvoBtnShow=function(){var t=this.data.getMaxLevel()+1,e=cfgTable.evolution=r.default.Instance().getTableValue("ID",t,cfgTable.evolutionData);e&&(this.evoBtn.getChildByName("layout").getChildByName("coin").getComponent(cc.Label).string=""+d.default.ChangeNumberUnit(e.evolutionmoney),this.data.getUserCoin()>=e.evolutionmoney?this.evoBtn.getChildByName("layout").getChildByName("coin").color=cc.color().fromHEX("#FFFFFF"):this.evoBtn.getChildByName("layout").getChildByName("coin").color=cc.color().fromHEX("#FF0000"))},e.prototype.redPointClick=function(){c.default.Instance().emitShowPanel({data:{data:1},prefab:"prefab/MainPanel/EvolutionProcessPanel"})},e.prototype.onEvoBtnClick=function(){var t=this.data.getMaxLevel()+1,e=cfgTable.evolution=r.default.Instance().getTableValue("ID",t,cfgTable.evolutionData);e?this.data.getUserCoin()>=e.evolutionmoney?(this.data.setUserCoin(-e.evolutionmoney),console.log("\u8981\u82b1\u7684\u94b1",e.evolutionmoney),this.addReward(),c.default.Instance().emitShowPanel({data:{data:2,maxLevel:this.data.getMaxLevel()},prefab:"prefab/MainPanel/EvolutionProcessPanel"}),this.evolutionComplete(),this.initReward(),o.Global.common.preLoadLv(),this.evoBtn.targetOff(this)):c.default.Instance().emitTips(o.Global.languageMgr.getText(911003)):c.default.Instance().emitTips(o.Global.languageMgr.getText(911004))},e.prototype.switchLeft=function(){this.evolutionBtn.getComponent(cc.Sprite).spriteFrame=this.imgs[0],this.upgraesBtn.getComponent(cc.Sprite).spriteFrame=this.imgs[1],this.evolutionBtn.getChildByName("label").scale=1.2,this.upgraesBtn.getChildByName("label").scale=.9,this.evolutionBtn.zIndex=1,this.upgraesBtn.zIndex=0,this.updataPlane(1);var t=l.default.Instance().getPlayerData().getGuideStep();t!=u.GuideStep.EvolutionaryAgeUnlockArmyTips&&t!=u.GuideStep.EvolutionaryAgeResetCoinTips||this.scheduleOnce(function(){o.Global.guideMgr.showGuidePanel()}),o.Global.guideMgr.changeGuideStep(u.GuideStep.ClickEvolve,u.GuideStep.EvolutionaryAgeUnlockArmyTips,!1)},e.prototype.switchRight=function(){this.evolutionBtn.getComponent(cc.Sprite).spriteFrame=this.imgs[1],this.upgraesBtn.getComponent(cc.Sprite).spriteFrame=this.imgs[0],this.evolutionBtn.getChildByName("label").scale=.9,this.upgraesBtn.getChildByName("label").scale=1.2,this.upgraesBtn.zIndex=1,this.evolutionBtn.zIndex=0,this.updataPlane(0)},e.prototype.updataPlane=function(t){for(var e=0;e<this.evolus.length;++e)this.evolus[e].active=!1;this.evolus[t].active=!0,this.ininPanel()},e.prototype.ininPanel=function(){this.evolutionBtn=this.switchBtn.getChildByName("evolutionBtn"),this.upgraesBtn=this.switchBtn.getChildByName("upgraesBtn"),this.addOncardBtn(),this.randerUpgradesUI(),this.randerEvolutionUI(),this.initReward(),this.initEvent(),this.updateTravelBtn()},e.prototype.updateTravelBtn=function(){var t=this.upgradesTimeLineBtn.getComponent(cc.Sprite);o.Global.dataMgr.getPlayerData().getTimeLine()>=this.getMaxTimeLine()?t.setMaterial(0,this.gray):t.setMaterial(0,this.normal)},e.prototype.randerEvolutionUI=function(){var t=this.data.getMaxLevel(),e=r.default.Instance().getTableValue("ID",t,cfgTable.evolutionData);this.upgradesEvoRoot.active=!Boolean(e.Timelinelevel),this.upgradesTimeLineRoot.active=Boolean(e.Timelinelevel),this.timeLineLabel.string=o.Global.languageMgr.getText(913001)+" - "+this.data.getTimeLine(),this.upgradesEvoRoot.active&&this.upgradesEvoShow(),this.upgradesTimeLineRoot.active&&this.upgradesTimeLineShow()},e.prototype.upgradesTimeLineShow=function(){var t=o.Global.dataMgr.getPlayerData(),e=t.canTravel,i=this.upgradesTimeLineRoot.getChildByName("travelTip"),a=this.upgradesTimeLineRoot.getChildByName("travelText"),n=o.Global.languageMgr.getText(911008).replace("{0}",t.getTimeLine()+1+"");a.getComponent(cc.Label).string=n,this.upgradesTimeLineBtn.getComponent(cc.Button).interactable=e,e?(i.active=!1,this.upgradesTimeLineBtn.color=cc.color().fromHEX("#FFFFFF"),this.upgradesTimeLineBtn.getChildByName("lable").color=cc.color().fromHEX("#FFFFFF")):(i.active=!0,i.getComponent(cc.Label).string=o.Global.languageMgr.getText(911009),this.upgradesTimeLineBtn.color=cc.color().fromHEX("#2D2D2D"),this.upgradesTimeLineBtn.getChildByName("lable").color=cc.color().fromHEX("#AB0000"))},e.prototype.upgradesEvoShow=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,s;return __generator(this,function(l){switch(l.label){case 0:return t=this.data.getMaxLevel(),e=t+1,i=r.default.Instance().getTableValue("ID",t,cfgTable.evolutionData),a=cfgTable.evolution=r.default.Instance().getTableValue("ID",e,cfgTable.evolutionData),n=this.curEvolutionLogo,[4,h.default.Instance().loadAndGetRes("res","image/evolutionIcon/"+i.evolutionPic,cc.SpriteFrame)];case 1:return n.spriteFrame=l.sent(),s=this.nextEvolutionLogo,[4,h.default.Instance().loadAndGetRes("res","image/evolutionIcon/"+a.evolutionPic,cc.SpriteFrame)];case 2:return s.spriteFrame=l.sent(),this.curEvolutionLogoName.string=" "+o.Global.languageMgr.getText(Number(i.evolutionnameid)),this.nextEvolutionLogoName.string=" "+o.Global.languageMgr.getText(Number(a.evolutionnameid)),this.evoBtn.getChildByName("layout").getChildByName("coin").getComponent(cc.Label).string=""+d.default.ChangeNumberUnit(a.evolutionmoney),this.data.getUserCoin()>=a.evolutionmoney?this.evoBtn.getChildByName("layout").getChildByName("coin").color=cc.color().fromHEX("#FFFFFF"):this.evoBtn.getChildByName("layout").getChildByName("coin").color=cc.color().fromHEX("#FF0000"),[2]}})})},e.prototype.randerUpgradesUI=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,s,l,c,u,p,f,g,m,y,v;return __generator(this,function(b){switch(b.label){case 0:t=this.data.getMaxLevel(),this.curEvolution=r.default.Instance().getTableValue("ID",t,cfgTable.evolutionData),e=o.Global.common.getBdPrePath(t),i=this.curEvolution.warriorsid.length,a=0,b.label=1;case 1:return a<i?(n=this.curEvolution.warriorsid[a],s=r.default.Instance().getTableValue("warriorsid",n,cfgTable.warriorsData),[4,h.default.Instance().loadAndGetRes(e,"roleIcon",cc.SpriteAtlas)]):[3,4];case 2:l=b.sent(),this.card[a].getChildByName("logo").getChildByName("icon").getComponent(cc.Sprite).spriteFrame=l.getSpriteFrame(String(s.warriorsid)),c=this.card[a].getChildByName("btn"),u=this.card[a].getComponent(cc.Sprite),p=c.getChildByName("layout").getChildByName("coin"),f=this.card[a].getChildByName("m_name"),-1!=this.data.getUnlocked().indexOf(s.warriorsid)?(c.active=!1,u.spriteFrame=this.cardBgs[0]):(u.spriteFrame=this.cardBgs[1],c.active=!0,this.data.getUserCoin()>=this.curEvolution.warriorsmoney[a]?(p.color=cc.color().fromHEX("#FFFFFF"),c.getComponent(cc.Sprite).spriteFrame=this.btnStatuSpr[0]):(p.color=cc.color().fromHEX("#FF0000"),c.getComponent(cc.Sprite).spriteFrame=this.btnStatuSpr[1])),f.getComponent(cc.Label).string=""+o.Global.languageMgr.getText(Number(s.nameid)),p.getComponent(cc.Label).string=""+d.default.ChangeNumberUnit(this.curEvolution.warriorsmoney[a]),b.label=3;case 3:return++a,[3,1];case 4:return g=t%6==0?6:t%6,m=r.default.Instance().getTableValue("level",this.data.getBuildLevel(),cfgTable.skillData),y=m["basenumber"+g]||m.basenumber,this.addBaseHp.string=Math.round(100*y)/100+"",v=r.default.Instance().getTableValue("level",this.data.getMeatLevel(),cfgTable.skillData),y=v["foodnumber"+g]||v.foodnumber,this.addMeat.string=Math.round(100*y)/100+"/s",this.renderCoinText(),[2]}})})},e.prototype.renderCoinText=function(){var t=this.data.getMaxLevel(),e=t%6==0?6:t%6,i=this.data.getBuildLevel(),a=r.default.Instance().getTableValue("level",i,cfgTable.skillData);if(a){var n=a["basecost"+e]||a.basecost;this.data.getUserCoin()>=n?(this.addBaseCost.node.color=cc.color().fromHEX("#FFFFFF"),this.addBaseHpBtn.getComponent(cc.Sprite).spriteFrame=this.btnStatuSpr[0]):(this.addBaseCost.node.color=cc.color().fromHEX("#FF0000"),this.addBaseHpBtn.getComponent(cc.Sprite).spriteFrame=this.btnStatuSpr[1]),this.addBaseCost.string=""+d.default.ChangeNumberUnit(n)}else n=(c=r.default.Instance().getTableValue("level",this.data.getBuildLevel(),cfgTable.skillData))["basecost"+e]||c.basecost,this.addBaseCost.string=""+d.default.ChangeNumberUnit(n);var o=this.data.getMeatLevel(),s=r.default.Instance().getTableValue("level",o,cfgTable.skillData),l=s["foodcost"+e]||s.foodcost;if(s)this.data.getUserCoin()>=l?(this.addMeatCost.node.color=cc.color().fromHEX("#FFFFFF"),this.addMeatBtn.getComponent(cc.Sprite).spriteFrame=this.btnStatuSpr[0]):(this.addMeatCost.node.color=cc.color().fromHEX("#FF0000"),this.addMeatBtn.getComponent(cc.Sprite).spriteFrame=this.btnStatuSpr[1]),this.addMeatCost.string=""+d.default.ChangeNumberUnit(l);else{var c,h=(c=r.default.Instance().getTableValue("level",this.data.getMeatLevel(),cfgTable.skillData))["foodcost"+e]||c.foodcost;this.addMeatCost.string=""+d.default.ChangeNumberUnit(h)}},e.prototype.touchHander=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return this.addBaseHpBtn.on(cc.Node.EventType.TOUCH_START,this.touchBaseStart,this),this.addBaseHpBtn.on(cc.Node.EventType.TOUCH_END,this.touchBaseEnd,this),this.addBaseHpBtn.on(cc.Node.EventType.TOUCH_CANCEL,this.touchBaseEnd,this),this.addMeatBtn.on(cc.Node.EventType.TOUCH_START,this.touchMeatStart,this),this.addMeatBtn.on(cc.Node.EventType.TOUCH_END,this.touchMeatEnd,this),this.addMeatBtn.on(cc.Node.EventType.TOUCH_CANCEL,this.touchMeatEnd,this),this.upgradesTimeLineBtn.on("click",this.onUpgradesTimeLineBtnClick,this),[2]})})},e.prototype.addOncardBtn=function(){this.data=l.default.Instance().getPlayerData();var t=this.data.getMaxLevel();this.curEvolution=r.default.Instance().getTableValue("ID",t,cfgTable.evolutionData);for(var e=this.curEvolution.warriorsid.length,i=0;i<e;++i){var a=this.curEvolution.warriorsid[i],n=r.default.Instance().getTableValue("warriorsid",a,cfgTable.warriorsData),o=this.card[i].getChildByName("btn");-1!=this.data.getUnlocked().indexOf(n.warriorsid)?o.active=!1:(o.active=!0,o.off("click",this.cardBtnChick,this),o.on("click",this.cardBtnChick,this))}},e.prototype.cardBtnChick=function(t){for(var e=this.curEvolution.warriorsid.length,i=0,a=0;a<e;++a)t.node.parent==this.card[a]&&(i=a);var n=this.curEvolution.warriorsid[i],s=r.default.Instance().getTableValue("warriorsid",n,cfgTable.warriorsData);if(this.data.getUserCoin()>=this.curEvolution.warriorsmoney[i]){this.data.setUnlocked(s.warriorsid),this.data.setUserCoin(-this.curEvolution.warriorsmoney[i]);var h=r.default.Instance().getTableValue("warriorsid",s.warriorsid,cfgTable.warriorsData);o.Global.umSDK.send(u.EnumDefine.fieldName.unlock_arm,{name:h.warriorsname,lv:l.default.Instance().getPlayerData().getMaxLevel()}),this.randerUpgradesUI()}else c.default.Instance().emitTips(o.Global.languageMgr.getText(911003))},e.prototype.touchBaseStart=function(){this.onAddBaseHpBtnClick(),this.scheduleOnce(this.openTouchBaseHp,.3)},e.prototype.openTouchBaseHp=function(){this.schedule(this.onSustainBaseHpBtnClick,.1)},e.prototype.touchBaseEnd=function(){this.unschedule(this.openTouchBaseHp),this.unschedule(this.onSustainBaseHpBtnClick)},e.prototype.touchMeatStart=function(){o.Global.guideMgr.changeGuideStep(u.GuideStep.UpgradeOutputFoodSpeed,u.GuideStep.SendArmySpeedTips,!1),this.scheduleOnce(this.openTouchAddMeat,.3),this.onAddMeatBtnClick()},e.prototype.openTouchAddMeat=function(){this.schedule(this.onSustainMeatBtnClick,.1)},e.prototype.touchMeatEnd=function(){this.unschedule(this.openTouchAddMeat),this.unschedule(this.onSustainMeatBtnClick)},e.prototype.onUpgradesTimeLineBtnClick=function(){var t=this.getMaxTimeLine();console.log("\u6253\u5370\u6700\u5927\u5173\u5361\u7b49\u7ea7=",t),o.Global.dataMgr.getPlayerData().getTimeLine()>=this.getMaxTimeLine()?c.default.Instance().emitTips(o.Global.languageMgr.getText(911010)):(this.upgradesTimeLineBtn.targetOff(this),this.upgradesTimeLineBtn.getComponent(cc.Button).interactable=!1,this.addReward(function(){c.default.Instance().emitShowPanel({prefab:"prefab/MainPanel/EvoPassPanel"})}),l.default.Instance().getPlayerData().setTimeLine(),o.Global.common.preLoadLv())},e.prototype.onSustainBaseHpBtnClick=function(){s.default.Instance().playEffect(16),this.onAddBaseHpBtnClick()},e.prototype.onAddBaseHpBtnClick=function(){var t=this.data.getBuildLevel(),e=r.default.Instance().getTableValue("level",t,cfgTable.skillData);if(r.default.Instance().getTableValue("level",t+1,cfgTable.skillData)){var i=l.default.Instance().getPlayerData().getMaxLevel();o.Global.umSDK.send(u.EnumDefine.fieldName.basic_skills_click,{type:u.EnumDefine.fieldDes.addBuild,lv:i});var a=e["basecost"+(i%6==0?6:i%6)]||e.basecost;this.data.getUserCoin()>=a?(this.data.setBuildLevel(),this.data.setUserCoin(-a),this.randerUpgradesUI()):c.default.Instance().emitTips(o.Global.languageMgr.getText(911003))}else c.default.Instance().emitTips(o.Global.languageMgr.getText(911006))},e.prototype.onSustainMeatBtnClick=function(){s.default.Instance().playEffect(16),this.onAddMeatBtnClick()},e.prototype.onAddMeatBtnClick=function(){var t=this.data.getMeatLevel(),e=r.default.Instance().getTableValue("level",t,cfgTable.skillData);if(r.default.Instance().getTableValue("level",t+1,cfgTable.skillData)){var i=l.default.Instance().getPlayerData().getMaxLevel();o.Global.umSDK.send(u.EnumDefine.fieldName.basic_skills_click,{type:u.EnumDefine.fieldDes.addMeat,lv:i});var a=e["foodcost"+(i%6==0?6:i%6)]||e.foodcost;this.data.getUserCoin()>=a?(this.data.setMeatLevel(),this.data.setUserCoin(-a),this.randerUpgradesUI()):c.default.Instance().emitTips(o.Global.languageMgr.getText(911003))}else c.default.Instance().emitTips(o.Global.languageMgr.getText(911006))},e.prototype.initGuide=function(){var t=l.default.Instance().getPlayerData().getGuideStep();t!=u.GuideStep.UpgradeOutputFoodSpeed&&t!=u.GuideStep.SendArmySpeedTips&&t!=u.GuideStep.BaseBloodVolumeTips&&t!=u.GuideStep.UnlockArmyTips&&t!=u.GuideStep.ClickEvolve||this.scheduleOnce(function(){o.Global.guideMgr.showGuidePanel()})},e.prototype.evolutionComplete=function(){var t=l.default.Instance().getPlayerData();o.Global.umSDK.send(u.EnumDefine.fieldName.Level_up_basic_skills,{type:u.EnumDefine.fieldDes.meat,typelv:t.getMeatLevel(),lv:t.getMaxLevel()}),o.Global.umSDK.send(u.EnumDefine.fieldName.Level_up_basic_skills,{type:u.EnumDefine.fieldDes.build,typelv:t.getBuildLevel(),lv:t.getMaxLevel()}),this.data.setMaxLeves(!1),o.Global.umSDK.send(u.EnumDefine.fieldName.level_num,{lv:t.getMaxLevel()});var e=r.default.Instance().getTableValue("ID",this.data.getMaxLevel(),cfgTable.evolutionData).warriorsid[0],i=r.default.Instance().getTableValue("warriorsid",e,cfgTable.warriorsData);o.Global.umSDK.send(u.EnumDefine.fieldName.unlock_arm,{name:i.warriorsname}),this.randerEvolutionUI()},e.prototype.initReward=function(){var t=cc.find("evolution/awardRoot",this.node),e=l.default.Instance().getPlayerData().getMaxLevel(),i=cfgTable.evolutionData[e].reward;t.children.forEach(function(t){t.active=!1});for(var a=0;a<i.length;a++){var n=i[a],s=n[0],r=n[1],c=t.children[s-1];c.active=!0;var h=c.getChildByName("txt").getComponent(cc.Label),d=c.getChildByName("num").getComponent(cc.Label);h.string=o.Global.languageMgr.getText(913006),d.string=r+""}},e.prototype.addReward=function(t){void 0===t&&(t=null);var e=l.default.Instance().getPlayerData().getMaxLevel(),i=cfgTable.evolutionData[e],a=i.reward,n=cc.find("evolution/awardRoot",this.node);if(!i||!i.reward||i.reward.length<=0)t&&t();else for(var s=0;s<a.length;s++){var r=a[s],c=r[0],h=r[1],d=n.children[c-1];0==s?o.Global.common.flyProp(d,c,h,t):o.Global.common.flyProp(d,c,h)}},e.prototype.initEvent=function(){this.evolutionBtn.on("click",this.switchLeft,this),this.upgraesBtn.on("click",this.switchRight,this),this.evoBtn.on("click",this.onEvoBtnClick,this),this.redPoint.on("click",this.redPointClick,this)},e.prototype.getMaxTimeLine=function(){return 2},__decorate([g({type:cc.Node,displayName:"\u724c"})],e.prototype,"card",void 0),__decorate([g({type:cc.Node,displayName:"\u589e\u52a0\u4ea7\u8089\u901f\u5ea6"})],e.prototype,"addMeatBtn",void 0),__decorate([g({type:cc.Node,displayName:"\u589e\u52a0\u57fa\u5730\u8840\u91cf"})],e.prototype,"addBaseHpBtn",void 0),__decorate([g({type:cc.Node,displayName:"\u5207\u6362\u6309\u94ae"})],e.prototype,"switchBtn",void 0),__decorate([g({type:cc.Node,displayName:"\u5347\u7ea7&\u8fdb\u9636\u754c\u9762"})],e.prototype,"evolus",void 0),__decorate([g({type:cc.SpriteFrame,displayName:"\u724c\u80cc\u666f"})],e.prototype,"cardBgs",void 0),__decorate([g({type:cc.Label,displayName:"\u8089\u589e\u52a0\u7684\u901f\u5ea6"})],e.prototype,"addMeat",void 0),__decorate([g({type:cc.Label,displayName:"\u589e\u52a0\u57fa\u5730\u8840\u91cf"})],e.prototype,"addBaseHp",void 0),__decorate([g({type:cc.Label,displayName:"\u82b1\u8d39\u91d1\u5e01\u5347\u7ea7\u98df\u7269\u4ea7\u751f\u901f\u5ea6"})],e.prototype,"addMeatCost",void 0),__decorate([g({type:cc.Label,displayName:"\u82b1\u8d39\u91d1\u5e01\u5347\u7ea7\u57fa\u5730\u8840\u91cf"})],e.prototype,"addBaseCost",void 0),__decorate([g({type:cc.SpriteFrame,displayName:"\u6309\u94ae\u72b6\u6001\u56fe\u7247"})],e.prototype,"btnStatuSpr",void 0),__decorate([g({type:cc.Sprite,displayName:"\u5f53\u524d\u65f6\u4ee3"})],e.prototype,"curEvolutionLogo",void 0),__decorate([g({type:cc.Sprite,displayName:"\u4e0b\u4e00\u65f6\u4ee3"})],e.prototype,"nextEvolutionLogo",void 0),__decorate([g({type:cc.Label,displayName:"\u5f53\u524d\u65f6\u4ee3\u540d\u79f0"})],e.prototype,"curEvolutionLogoName",void 0),__decorate([g({type:cc.Label,displayName:"\u4e0b\u4e00\u65f6\u4ee3\u540d\u79f0"})],e.prototype,"nextEvolutionLogoName",void 0),__decorate([g({type:cc.Node,displayName:"\u8fdb\u9636\u6309\u94ae"})],e.prototype,"evoBtn",void 0),__decorate([g({type:cc.Node,displayName:"\u8fdb\u9636\u5de6\u4e0a\u89d2\u7ea2\u70b9"})],e.prototype,"redPoint",void 0),__decorate([g({type:cc.Node,displayName:"\u5347\u7ea7\u65f6\u4ee3\u6839\u8282\u70b9"})],e.prototype,"upgradesEvoRoot",void 0),__decorate([g({type:cc.Node,displayName:"\u5347\u7ea7\u65f6\u95f4\u7ebf\u6839\u8282\u70b9"})],e.prototype,"upgradesTimeLineRoot",void 0),__decorate([g({type:cc.Node,displayName:"\u5347\u7ea7\u65f6\u95f4\u7ebf\u6309\u94ae"})],e.prototype,"upgradesTimeLineBtn",void 0),__decorate([g(cc.Node)],e.prototype,"jiantou",void 0),__decorate([g({type:cc.Label,displayName:"\u65f6\u95f4\u7ebf\u6587\u672c"})],e.prototype,"timeLineLabel",void 0),__decorate([g({type:cc.SpriteFrame,displayName:"\u6309\u94ae\u56fe\u7247"})],e.prototype,"imgs",void 0),__decorate([g(cc.Material)],e.prototype,"normal",void 0),__decorate([g(cc.Material)],e.prototype,"gray",void 0),__decorate([f],e)}(cc.Component);n.default=m,cc._RF.pop()},{}],UtilOne:[function(t,e,i){"use strict";cc._RF.push(e,"535814+fKVJzoTbsoAB6rnb","UtilOne");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=!1,r=function(){function t(){}return t.Lerp=function(t,e,i){return t+(e-t)*((i=i<0?0:i)>1?1:i)},t.getTimestamp=function(){return Math.floor((new Date).getTime()/1e3)+this.mServerTimeOffset},t.getTimestampTB=function(e){var i=new XMLHttpRequest,a=function(t){s||(s=!0,e(t))};setTimeout(function(){a(t.getTimestamp())},1200),i.onreadystatechange=function(){if(4===i.readyState&&i.status>=200&&i.status<300){var t=decodeURIComponent(i.responseText),n=JSON.parse(t);e&&(o.Global.isDebug&&console.log("\u670d\u52a1\u5668\u65f6\u95f4",n.data.t),o.Global.isDebug&&console.log("\u672c\u5730\u65f6\u95f4",(new Date).getTime()),a(Math.floor(n.data.t/1e3)))}},i.open("POST","https://api.m.taobao.com/rest/api3.do?api=mtop.common.getTimestamp",!0),i.timeout=1e3,i.setRequestHeader("Content-type","application/json;charset=utf-8"),i.send()},t.getTimestampMS=function(){return(new Date).getTime()+1e3*this.mServerTimeOffset},t.setServerTime=function(e){this.mServerTimeOffset=e-t.getTimestamp()},t.getlocalTime=function(){return o.Global.TbTime+(t.getTimestamp()-o.Global.localTime)},t.isToday=function(e){var i=new Date(1e3*e),a=new Date(1e3*t.getlocalTime());return i.getDate()===a.getDate()&&i.getMonth()===a.getMonth()&&i.getFullYear()===a.getFullYear()},t.getTimeStr=function(t,e,i,a){e||(e=":"),i||(i=":"),a||(a=""),t=Math.floor(t);var n=Math.floor(t/3600),o=Math.floor(t%3600/60),s=t%60,r="";return r+=n>=10?n+e:"0"+n+e,(r+=o>=10?o+i:"0"+o+i)+(s>=10?s+a:"0"+s+a)},t.getMinSecStr=function(t){t=Math.floor(t);var e=Math.floor(t/60),i=t%60,a="";return(a+=e>=10?e+":":"0"+e+":")+(i>=10?i:"0"+i)},t.sortArr=function(t,e,i){void 0===e&&(e="id"),void 0===i&&(i=!0);for(var a=0;a<t.length-1;a++)for(var n=a+1;n<t.length;n++)if(t[a][e]>t[n][e]&&1==i){var o=t[a][e];t[a][e]=t[n][e],t[n][e]=o}else t[a][e]<t[n][e]&&0==i&&(o=t[a][e],t[a][e]=t[n][e],t[n][e]=o);return t},t.sortArrToo=function(t,e,i){void 0===e&&(e="id"),void 0===i&&(i=!0);for(var a=0;a<t.length-1;a++)for(var n=a+1;n<t.length;n++)if(t[a][e]>t[n][e]&&1==i){var o=t[a][e];t[a][e]=t[n][e],t[n][e]=o}else t[a][e]<t[n][e]&&0==i&&(o=t[a][e],t[a][e]=t[n][e],t[n][e]=o);return t},t.rand=function(t,e){return Math.random()*(e-t)+t},t.randInt=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},t.GenNonce=function(e,i){i||(i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz");for(var a="",n=0;n<e;n++)a+=i[Math.floor(t.rand(0,i.length))];return a},t.GetPlatId=function(){switch(cc.sys.platform){case cc.sys.WECHAT_GAME:return 1;case cc.sys.BYTEDANCE_GAME:return 2}return 0},t.ChangeNumberUnit=function(t,e){void 0===e&&(e=2);var i=!1,a=t;if(a<0&&(a=Math.abs(t),i=!0),a<1e3){var n=Number("1E0"),o=Math.floor(a*n)/n+"";return i?"-"+o:o}for(var s="\u221e",r=0,l=["K","M","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],c=0,h=3;c<l.length;c++,h+=3){var d=Number("1E"+h),u=Number("1E"+(h+3));if(a>=d&&a<u){r=a/d,s=l[c];break}}var p="";if(r<0)p=s;else{var f=Math.floor(r)+"",g=Number("1E"+(3-f.length));f&&(p=Math.floor(r*g)/g+s)}return i?"-"+p:p},t.get_weight_random=function(t,e){for(var i=0,a=0;a<t.length;a++)i+=Number(t[a][e]);for(var n=Math.random()*i,o=Math.floor(n),s=0;s<t.length;s++)if((o-=Number(t[s][e]))<=0)return s;return 0},t.setPositionByNode=function(t,e){var i=t.parent.convertToWorldSpaceAR(t.position);return e.parent.convertToNodeSpaceAR(i)},t.convertNodeSpaceAR=function(t,e){if(e.parent)return t.parent.convertToNodeSpaceAR(e.parent.convertToWorldSpaceAR(e.position));t.destroy()},t.getnodePoolNode=function(t,e){return null===e||null===t?null:t.size()>0?t.get():cc.instantiate(e)},t.setNodeScale=function(t,e){var i=e.getComponent(cc.Sprite).spriteFrame.getRect(),a=t.width/i.width,n=t.height/i.height,o=a-n>0?n:a;e.scale=o},t.getNeedNodeScale=function(t,e){var i=t.width/e.width,a=t.height/e.height;return i-a>0?a:i},t.compare_version=function(t,e){for(var i=t.split("."),a=e.split("."),n=Math.max(i.length,a.length),o=0;o<n;++o){var s=i.length>o?parseInt(i[o]):0,r=a.length>o?parseInt(a[o]):0;if(s>r)return 1;if(s<r)return-1}return 0},t.getIPAndcname=function(t){void 0===t&&(t=null);var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===e.readyState&&e.status>=200&&e.status<300){var i=decodeURIComponent(e.responseText);console.log("getIpAndname::",i);var a=JSON.parse(i);t&&t(a)}},e.open("POST","https://whois.pconline.com.cn/ipJson.jsp?json=true",!0),e.timeout=5e3,e.setRequestHeader("Content-type","application/json;charset=utf-8"),e.send()},t.getNextDayMidnightTimestamp=function(t){var e=new Date(t);return e.setHours(0,0,0,0),e.setDate(e.getDate()+1),e.getTime()},t.getRandWeight=function(t){for(var e=t.reduce(function(t,e){return t+e.weight},0),i=Math.random()*e,a=0,n=0;n<t.length;n++){var o=t[n];if(i<(a+=o.weight))return o}return t[0]},t.mServerTimeOffset=0,t}();n.default=r,cc._RF.pop()},{}],VIVOSDK:[function(t,e,i){"use strict";cc._RF.push(e,"f4933Z8LiRJkrDEk8C8x0Ij","VIVOSDK");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rewardStr=["e24fe0b655e644efae207919bd9d220e"],e.rewardNum=0,e.rewardAd=null,e.initedRewardAd=!1,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e)},enumerable:!1,configurable:!0}),e.prototype.init=function(){this.platform=window.qg,this.lifeEvent()},e.prototype.lifeEvent=function(){cc.sys.platform==cc.sys.VIVO_GAME&&(this.platform.onShow(function(){console.log("\u5c0f\u6e38\u620f\u56de\u5230\u524d\u53f0")}),this.platform.onHide(function(){console.log("\u5c0f\u6e38\u620f\u8fdb\u5165\u540e\u53f0")}))},e.prototype.onAuthDialogShow=function(){this.platform.onAuthDialogShow(function(t){console.log("\u767b\u5f55\u6216\u5b9e\u540d\u5f39\u7a97\u5c55\u793a",t)})},e.prototype.onAuthDialogClose=function(){this.platform.onAuthDialogClose(function(t){console.log("\u767b\u5f55\u6216\u5b9e\u540d\u5f39\u7a97\u5173\u95ed",t)})},e.prototype.openAd=function(t,e,i){var a=this;void 0===e&&(e=null),void 0===i&&(i=null);var n=this.rewardStr[this.rewardNum];this.rewardAd||(this.rewardAd=this.platform.createRewardedVideoAd({posId:n}),this.rewardAd.onLoad(function(t){"localAdVideo"===t?console.log("\u6fc0\u52b1\u89c6\u9891 \u515c\u5e95\u5e7f\u544a-onload\u89e6\u53d1 ",t):console.log("\u6fc0\u52b1\u89c6\u9891\u5e7f\u544a\u52a0\u8f7d\u5b8c\u6210-onload\u89e6\u53d1 ",t)})),this.rewardAd.onClose(function e(n){console.log("rewardAd onClose",n),t&&(cc.game.resume(),n.isEnded?t():i&&i()),a.rewardAd.offClose(e)}),this.rewardAd.onError(function n(o){a.rewardAd.offError(n),a.rewardNum+=1,a.initedRewardAd=!1,console.log("err",o),a.rewardAd&&a.rewardAd.destroy().then(function(){if(a.rewardAd=null,a.rewardNum>a.rewardStr.length-1)return cc.game.resume(),e&&e(),void a.rewardNum;a.openAd(t,e,i)}).catch(function(){a.rewardAd=null})}),this.initedRewardAd?(console.log("\u76f4\u63a5\u663e\u793a\u6fc0\u52b1\u5e7f\u544a"),this.rewardAd.show().then(function(){a.platform.hideLoading({}),console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u6210\u529f")}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u5931\u8d25"),e&&e(t)})):this.rewardAd.load().then(function(){console.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u6210\u529f"),a.rewardAd.show().then(function(){a.platform.hideLoading({}),console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u6210\u529f"),a.initedRewardAd=!0}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u5931\u8d25"),e&&e(t)})}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891\u52a0\u8f7d\u5931\u8d25"),e&&e(t)})},e}(a("SDKBase").default);n.default=o,cc._RF.pop()},{}],WXSDK:[function(t,e,i){"use strict";cc._RF.push(e,"8a6b56w9RZPo5XwUqM3B5KA","WXSDK");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("UtilOne"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.appName="\u51fa\u51fb",e.shareDes=["\u51fa\u51fb"],e.shareImgList=[],e.platform=window.wx,e.rewardStr=["adunit-e14941c549659202"],e.rewardNum=0,e.insertStr="adunit-5e96276329f2ff78",e.bannerStr="adunit-6d28ec2b716644c4",e.enterShare=!1,e.shareTime=0,e.shareNeedTime=3e3,e.shareNum=0,e._bannerAD=null,e._interstitialIndex=0,e.rewardLoadNum=0,e.rewardonShow=!1,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e)},enumerable:!1,configurable:!0}),e.prototype.init=function(){var t=this;this.lifeEvent(),cc.resources.loadDir("share",cc.Asset,function(e,i){console.log("res:",i),i.forEach(function(e){""!=e.url&&t.shareImgList.push(e.url)},t),console.log("\u5206\u4eab\u56fe\u7247\u52a0\u8f7d\u6210\u529f",t.shareImgList)}),this.scene=this.platform.getLaunchOptionsSync().scene},e.prototype.lifeEvent=function(){var t=this;cc.sys.platform==cc.sys.WECHAT_GAME&&(this.platform.onShow(function(){var e=(new Date).getTime();if(console.log("\u5c0f\u6e38\u620f\u56de\u5230\u524d\u53f0\uff1a",e),t.enterShare){t.enterShare=!1,console.log("\u5206\u4eab\u65f6\u5dee\uff1a",e-t.shareTime);var i=e-t.shareTime>=t.shareNeedTime,a=Math.random()<.5;t.shareNum>=2&&(a=!0),i&&a?(t.shareNum=0,t.shareSuccessCb&&t.shareSuccessCb()):(t.shareNum+=1,t.shareFailCb&&t.shareFailCb())}}),this.platform.onHide(function(){}))},e.prototype.openAd=function(t,e,i){var a=this;void 0===e&&(e=null),void 0===i&&(i=null),this.rewardLoadNum+=1;var n=this.rewardStr[this.rewardNum];console.log("id ->",n);var o=function e(n){a.rewardonShow=!1,t&&(cc.game.resume(),n.isEnded?t():i&&i()),a.rewardAd.offClose(e)},s=function n(){a.rewardAd.offLoad(function(){}),a.rewardAd.offError(function(){return n()}),a.rewardAd.offClose(o),a.rewardAd.destroy(),a.rewardAd=null,a.rewardNum+=1,a.rewardNum>=a.rewardStr.length&&(a.rewardNum=0),a.rewardLoadNum>5?(cc.game.resume(),e&&e(),a.rewardLoadNum=0):a.openAd(t,e,i)};this.rewardAd||(this.rewardAd=this.platform.createRewardedVideoAd({adUnitId:n,multiton:!0}),this.rewardAd.iss,this.rewardAd.onLoad(function(){}),this.rewardAd.onError(function(){return s()})),this.rewardAd.onClose(o),1==this.rewardonShow?(this.rewardonShow=!1,s()):this.rewardAd.load().then(function(){a.rewardAd.show().then(function(t){console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u6210\u529f",t),a.rewardLoadNum=0,a.rewardonShow=!0}).catch(function(t){console.log("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u5931\u8d25",t)})})},e.prototype.shareGame=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.shareSuccessCb=t,this.shareFailCb=e,this.enterShare=!0,this.shareTime=(new Date).getTime();var i=this.shareImgList[o.default.randInt(0,this.shareImgList.length-1)],a=this.shareDes[o.default.randInt(0,this.shareDes.length-1)];this.platform.shareAppMessage({title:a,imageUrl:i})},e.prototype.showBanner=function(t){var e=this;void 0===t&&(t="");var i=this.bannerStr,a=this.platform.getSystemInfoSync();if(o.default.compare_version(a.SDKVersion,"2.0.4")<0)console.error("wx sdkVersion less 2.0.4");else{var n=this.platform.getSystemInfoSync().windowWidth,s=this.platform.getSystemInfoSync().windowHeight,r=Math.min(n,450),l=Math.min(s,300);this._bannerAD?this._bannerAD.show().then(function(){console.log("_bannerAD:onshowtow"),e.isShowBanner=!0,e.ishideBanner&&e.hideBanner()}).catch(function(){console.log("_bannerAD:onshowtowErr"),e.isShowBanner=!1,e.destroyBanner()}):(this._bannerAD=this.platform.createBannerAd({adUnitId:i,adIntervals:30,style:{left:0,top:s-r,width:r,height:l}}),this._bannerAD.onResize(function(t){e._bannerAD.style.top=s-t.height,e._bannerAD.style.left=(n-t.width)/2,e._bannerAD.show().then(function(){console.log("_bannerAD:onshow"),e.isShowBanner=!0,e.ishideBanner&&e.hideBanner()}).catch(function(){console.log("_bannerAD:onshowErr"),e.isShowBanner=!1,e.destroyBanner(),e.hideBanner()})}),this._bannerAD.onError(function(i){console.log("_bannerAD:Err----%o",i),e.isShowBanner=!1,e.destroyBanner(),e.showBanner(t)}),this._bannerAD.onLoad(function(){console.log("_bannerAD:onLoad")}),this._bannerAD.onClose(function(){console.log("_bannerAD:onClose")}))}},e.prototype.hideBanner=function(){this._bannerAD&&this.isShowBanner?(console.log("hide"),this._bannerAD.hide(),this.ishideBanner=!1):(console.log("not hide"),this.ishideBanner=!0)},e.prototype.destroyBanner=function(){this._bannerAD&&(this._bannerAD.destroy(),this._bannerAD=null)},e.prototype.interstitialAd=function(t,i){var a=this,n=this.platform.getSystemInfoSync();if(o.default.compare_version(n.SDKVersion,"2.6.0")<0)console.error("ADVideo not be supported ",n.SDKVersion+" < 2.6.0");else{var s=5;(function r(){var l=a.platform.createInterstitialAd({adUnitId:e.AD_INTERSTITIAL[a._interstitialIndex]});l.onError(function(){console.error("interstitialAd err"),l.destroy(),console.log("\u63d2\u5c4f\u9519\u8bef\uff01\u5f53\u524d\u91cd\u8bd5\u6b21\u6570:",s,a._interstitialIndex),a._interstitialIndex==e.AD_INTERSTITIAL.length-1?a._interstitialIndex=0:a._interstitialIndex+=1,s<=0?t&&t():(s-=1,r())}),l.onLoad(function i(){l.offLoad(i),console.log("interstitialAd has loaded"),l.show().then(function(){a._interstitialIndex==e.AD_INTERSTITIAL.length-1?a._interstitialIndex=0:a._interstitialIndex+=1,t&&t()}).catch(function(i){l.destroy(),a._interstitialIndex==e.AD_INTERSTITIAL.length-1?a._interstitialIndex=0:a._interstitialIndex+=1,s<=0?t&&t():(s-=1,r()),console.error("interstitialAd show error ",i),console.log("\u63d2\u5c4f\u9519\u8bef\uff01\u5f53\u524d\u91cd\u8bd5\u6b21\u6570:",s,a._interstitialIndex)})}),l.onClose(function t(){l.offClose(t),a._interstitialIndex==e.AD_INTERSTITIAL.length-1?a._interstitialIndex=0:a._interstitialIndex+=1,i&&i(),console.log("interstitialAd has closed")}),o.default.compare_version(n.SDKVersion,"2.8.0")>=0?l.load():l.show().then(function(){a._interstitialIndex==e.AD_INTERSTITIAL.length-1?a._interstitialIndex=0:a._interstitialIndex+=1,t&&t()}).catch(function(i){a._interstitialIndex==e.AD_INTERSTITIAL.length-1?a._interstitialIndex=0:a._interstitialIndex+=1,l.destroy(),s<=0?t&&t():(s-=1,r()),console.log("\u63d2\u5c4f\u9519\u8bef\uff01\u5f53\u524d\u91cd\u8bd5\u6b21\u6570:",s,a._interstitialIndex),console.error("interstitialAd show error ",i)})})()}},e.prototype.send=function(t,e){this.platform.uma&&this.platform.uma.trackEvent(t,e)},e.prototype.navigateToScene=function(){},e.prototype.vibrateShort=function(t,e){void 0===e&&(e=null),this.platform.vibrateShort({type:t,complete:function(){e&&e()}})},e.AD_INTERSTITIAL=["adunit-5e96276329f2ff78"],e}(a("SDKBase").default);n.default=s,cc._RF.pop()},{}],ZembieBuildBase:[function(t,e,i){"use strict";cc._RF.push(e,"67aafmLCH1C6KuGIWsoX/5Y","ZembieBuildBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("AudioMgr"),r=a("EventMgr"),l=a("TweenMaterial"),c=a("UtilOne"),h=a("typeEnum"),d=a("DungeonFightMgr"),u=cc._decorator,p=u.ccclass,f=u.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.xueliang=null,e.xueliangNum=null,e.anim=null,e.hp=0,e.curHp=0,e.iocn_1=null,e.iocn_2=null,e.material=[],e.fightplan=null,e.id=1e8,e.killRewards=null,e.canMove=!0,e.tween=cc.tween().to(.1,{mainAny:9.99}).to(.1,{mainAny:0}).tag(h.TweenTag.white),e.tweenDie=cc.tween().to(2,{mainAny:9.99}).tag(h.TweenTag.buildDie),e}return __extends(e,t),e.prototype.onEnable=function(){this.addEvent(),this.uiSet()},e.prototype.addEvent=function(){var t=this;r.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this),r.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this)},e.prototype.uiSet=function(){this.anim.node.active=!1,this.iocn_1.setMaterial(0,this.material[0]),this.iocn_2.setMaterial(0,this.material[0])},e.prototype.attackedFunc=function(t,e,i,a){var n=this,o=i;if(t&&(o=t[1]),!(this.hp<=0)){if(o>=this.hp&&(o=this.hp),this.hp-=o,s.default.Instance().playEffect(5),this.playEff(t),this.hp<=0)return this.hp=0,s.default.Instance().playEffect(8),d.default.Instance().isEnd=!0,this.playDie(),this.xueliangNum.string="0",this.xueliang.progress=0,this.scheduleOnce(function(){r.default.Instance().emitZembieGameOver(!1),n.anim.stopSystem(),n.anim.node.active=!1},2.2),this.xueliangNum.string=""+c.default.ChangeNumberUnit(this.hp,1),void(this.xueliang.progress=this.hp/this.curHp);if(this.xueliangNum.string=""+c.default.ChangeNumberUnit(this.hp,1),this.xueliang.progress=this.hp/this.curHp,a){for(var l=this.fightplan.roleList,h=[],u=0;u<l.length;++u)if(!l[u].isDeath()){var p=l[u].node;this.node!=p&&this.getDistance(this.node,p)<=a&&h.push(l[u])}h.forEach(function(t){t.attackedFunc(null,e,i,null)})}}},e.prototype.playEff=function(t){var e=this.xueliang.node.getChildByName("white");e.active=!0,e.width=(this.hp+t)/this.curHp*62,cc.tween(e).to(.2,{width:this.hp/this.curHp*62}).call(function(){e.active=!1}).start();var i=new l.TweenMaterial(this.iocn_1,"time",0),a=new l.TweenMaterial(this.iocn_2,"time",0);if(this.tween.clone().target(i).start(),this.tween.clone().target(a).start(),s.default.Instance().getVibrateEnabled()){o.Global.sdkMgr.vibrateShort("heavy");var n=cc.v3(c.default.randInt(-3,3),c.default.randInt(-3,3));cc.tween(this.node.parent).to(.1,{position:n}).to(.1,{position:cc.v3(0,0,0)}).start()}},e.prototype.playDie=function(){cc.Tween.stopAllByTag(h.TweenTag.white),this.anim.node.active=!0,this.anim.resetSystem(),this.iocn_1.setMaterial(0,this.material[1]),this.iocn_2.setMaterial(0,this.material[1]);var t=new l.TweenMaterial(this.iocn_1,"time",0),e=new l.TweenMaterial(this.iocn_2,"time",0);this.tweenDie.clone().target(t).start(),this.tweenDie.clone().target(e).start()},e.prototype.getHp=function(){return this.hp},e.prototype.subHp=function(t){this.hp-=t},e.prototype.isDeath=function(){return this.hp<=0},e.prototype.initBase=function(t){this.hp=t.hp,this.curHp=t.hp,this.xueliangNum.string=""+c.default.ChangeNumberUnit(this.curHp,1),this.xueliang.progress=this.hp/this.curHp,this.fightplan=t.fightplan,this.id=t.id},e.prototype.move=function(){},e.prototype.getId=function(){return this.id},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},__decorate([f(cc.ProgressBar)],e.prototype,"xueliang",void 0),__decorate([f(cc.Label)],e.prototype,"xueliangNum",void 0),__decorate([f(cc.ParticleSystem)],e.prototype,"anim",void 0),__decorate([f(cc.Sprite)],e.prototype,"iocn_1",void 0),__decorate([f(cc.Sprite)],e.prototype,"iocn_2",void 0),__decorate([f(cc.Material)],e.prototype,"material",void 0),__decorate([p],e)}(cc.Component);n.default=g,cc._RF.pop()},{}],ZembieDieAnimPre:[function(t,e,i){"use strict";cc._RF.push(e,"4944abs41JK96o8Xznw76GZ","ZembieDieAnimPre");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,s=(n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pool=null,e}return __extends(e,t),e.prototype.init=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=!1),this.pool=e;var a=this.node.parent.convertToNodeSpaceAR(t);this.node.setPosition(a),this.node.opacity=255,this.node.color=i?cc.color(0,255,0):cc.color(255,255,255),this.play(),this.scheduleOnce(this.onfinished,1)},e.prototype.play=function(){this.node.getComponent(cc.Animation).play(),this.node.on(cc.Animation.EventType.FINISHED,this.onfinished,this)},e.prototype.onfinished=function(){this.putBack(),this.pool&&this.pool.put(this.node)},e.prototype.putBack=function(){this.unschedule(this.onfinished),this.node.off(cc.Animation.EventType.FINISHED,this.onfinished,this),this.node.opacity=0},__decorate([o],e)}(cc.Component));a.default=s,cc._RF.pop()},{}],ZembieEnterPanel:[function(t,e,i){"use strict";cc._RF.push(e,"673c4Uvi35N4peiyVvLQ3FK","ZembieEnterPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("Global"),s=a("PanelBase"),r=a("EventMgr"),l=a("typeEnum"),c=a("spriteFrameControl"),h=cc._decorator,d=h.ccclass,u=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.SpriteIconKey=null,e.SpriteIconReward=null,e.LabelTitle=null,e.LabelLevelTitle=null,e.LabelNowLevel=null,e.LabelReward=null,e.LabelNum=null,e.LabelKeyNum=null,e.BtnEnter=null,e.BtnRight=null,e.BtnLift=null,e.BtnClose=null,e.enterTxt=null,e.IocnIndex=0,e.nowlevel=1,e}return __extends(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.SpriteIconKey=this.findElement("content/SpriteIconKey",c.default),this.SpriteIconReward=this.findElement("content/SpriteIconReward",c.default),this.LabelTitle=this.findElement("content/LabelTitle",cc.Label),this.LabelLevelTitle=this.findElement("content/LabelLevelTitle",cc.Label),this.LabelNowLevel=this.findElement("content/LabelNowLevel",cc.Label),this.LabelReward=this.findElement("content/LabelReward",cc.Label),this.LabelNum=this.findElement("content/LabelNum",cc.Label),this.LabelKeyNum=this.findElement("content/LabelKeyNum",cc.Label),this.BtnEnter=this.findElement("content/BtnEnter"),this.BtnRight=this.findElement("content/BtnRight"),this.BtnLift=this.findElement("content/BtnLift"),this.BtnClose=this.findElement("content/BtnClose"),this.enterTxt=this.findElement("content/BtnEnter/Label",cc.Label),this.nowlevel=o.Global.dataMgr.getPlayerData().getzombieMaxLevel(),r.default.Instance().onZembieLevelChange(this.onZembieLevelChange,this)},e.prototype.onEnable=function(){this.subClicks(this.BtnEnter,this.BtnRight,this.BtnLift,this.BtnClose),this.addClicks(this.BtnEnter,this.BtnRight,this.BtnLift,this.BtnClose),this.showOherUI(),this.showKeyUI(),this.showLevelUI()},e.prototype.onDisable=function(){this.subClicks(this.BtnEnter,this.BtnRight,this.BtnLift,this.BtnClose)},e.prototype.onZembieLevelChange=function(){this.nowlevel=o.Global.dataMgr.getPlayerData().getzombieMaxLevel(),this.showKeyUI(),this.showLevelUI()},e.prototype.showOherUI=function(){this.LabelTitle.string=o.Global.languageMgr.getText(900004),this.LabelLevelTitle.string=o.Global.languageMgr.getText(900006),this.LabelReward.string=o.Global.languageMgr.getText(900007),this.BtnEnter.getChildByName("Label").getComponent(cc.Label).string=o.Global.languageMgr.getText(900005)},e.prototype.showKeyUI=function(){var t=o.Global.dataMgr.getPlayerData(),e=cfgTable.commonData.zombiekeymax,i=cfgTable.commonData.zombieadnumber,a=o.Global.sdkMgr.curSdk.option.parameter;a&&(a.zombieadnumber||0==a.zombieadnumber)&&-1!=a.zombieadnumber&&(i=a.zombieadnumber);var n=t.getZembieKays(),s=t.getZembieADKays(),r="0/"+e;this.IocnIndex=0;var l=!0;n>0?r=n+"/"+e:s>0?(this.IocnIndex=1,r=s+"/"+i):l=!1,this.SpriteIconKey.setSpriteFramebyIndex(this.IocnIndex),this.LabelKeyNum.string=r,this.BtnEnter.getComponent(cc.Button).interactable=l},e.prototype.showLevelUI=function(){var t=o.Global.configMgr.getTableValue("id",this.nowlevel,cfgTable.zoombieleveData);this.LabelNowLevel.string=t.level;var e=t.reward;this.SpriteIconReward.setSpriteFramebyIndex(Number(e[0])-1),this.LabelNum.string=e[1],this.checkAutoComplete()},e.prototype.emitCloseMe=function(){t.prototype.emitCloseMe.call(this)},e.prototype.onClick=function(t){switch(t.target){case this.BtnEnter:this.onbtnEnter();break;case this.BtnRight:this.onBtnRight();break;case this.BtnLift:this.onBtnLift();break;case this.BtnClose:this.emitCloseMe()}},e.prototype.onbtnEnter=function(){var t=this,e=o.Global.configMgr.getTableValue("id",this.nowlevel,cfgTable.zoombieleveData),i=this.checkAutoComplete();this.IocnIndex?o.Global.sdkMgr.openAd(function(){if(i)t.directGetDiamond(e.reward[1],!0);else{var a=o.Global.dataMgr.getPlayerData(),n=a.getZembieADKays();a.setZembieKays(1),n-=1,a.setZembieADKays(n),r.default.Instance().emitZembieLevelChange(),r.default.Instance().emitShowPanel({data:e.battle,prefab:"prefab/Dungeons/ZembieFightPanel"})}},null):i?this.directGetDiamond(e.reward[1],!1):r.default.Instance().emitShowPanel({data:e.battle,prefab:"prefab/Dungeons/ZembieFightPanel"})},e.prototype.directGetDiamond=function(t,e){var i=this;r.default.Instance().emitInterludeMask(!0);var a=Number(t);this.scheduleOnce(function(){o.Global.common.flyProp(i.node,l.CurrencyType.Diamond,a)},.5);var n=o.Global.dataMgr.getPlayerData();if(e){var s=n.getZembieADKays();s-=1,n.setZembieADKays(s)}else{var c=n.getZembieKays();c>0&&(c-=1,n.setZembieKays(c))}this.showKeyUI(),r.default.Instance().emitZembieLevelChange()},e.prototype.onBtnRight=function(){this.nowlevel++,this.nowlevel>o.Global.dataMgr.getPlayerData().getzombieMaxLevel()&&(this.nowlevel>l.MaxLevel.Zembie&&r.default.Instance().emitTips(o.Global.languageMgr.getText(911010)),this.nowlevel=o.Global.dataMgr.getPlayerData().getzombieMaxLevel()),this.showLevelUI()},e.prototype.onBtnLift=function(){this.nowlevel--,this.nowlevel<1&&(this.nowlevel=1),this.showLevelUI()},e.prototype.checkAutoComplete=function(){var t=o.Global.dataMgr.getPlayerData().getzombieMaxLevel(),e=this.nowlevel<t,i=o.Global.common.isSweepZembie(),a=e&&i;return this.enterTxt.string=a?o.Global.languageMgr.getText(900028):o.Global.languageMgr.getText(900005),a},__decorate([d],e)}(s.default));n.default=u,cc._RF.pop()},{}],ZembieFightPanel:[function(t,e,i){"use strict";cc._RF.push(e,"93686oSrfFCi5SjlUJP+VV9","ZembieFightPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("ConfigMgr"),r=a("DataMgr"),l=a("EventMgr"),c=a("ResMgr"),h=a("UtilOne"),d=a("typeEnum"),u=a("AudioMgr"),p=a("Global"),f=a("ZembieRole"),g=a("ZembieBuildBase"),m=a("ZembieDieAnimPre"),y=a("DungeonBullet"),v=a("SkillMgr"),b=a("DungeonFightMgr"),_=a("TimeScaleScript"),T=a("TalentBase"),S=cc._decorator,D=S.ccclass,k=S.property,C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selfBase=null,e.meatGrowth=null,e.meatCount=null,e.cards=[],e.coin=null,e.diamond=null,e.costs=[],e.btnBgs=[],e.bullet=null,e.gameFactory=null,e.dieAnimShow=null,e.dieShowP=null,e.bg=null,e.selfBase_1=null,e.selfBase_2=null,e.timeScale=null,e.timeScalePrefab=null,e.baseImgs=[],e.meatPlay=null,e.zembieHave=null,e.die=null,e.dieShow=null,e.meatNum=0,e.gameData=null,e.id=0,e.bulletNodePool=null,e.dieNodePool=null,e.dieShowPool=null,e.dieshowlist=[],e.roleList=[],e.enemyList=[],e.canUpdate=!1,e.suspendBtn=null,e.Birthpoint={myBirthpoint:cc.v2(-375,-25),enemyBirthpoint:cc.v2(400,0)},e.enemyPosyWeight=.5,e.zembieAllNum=0,e.gameTime=0,e.warriortime=0,e.createRoleIndex=[],e.meatTimeScale=1,e.skillTimeScale=1,e.sendTroopsTimeScale=1,e}return __extends(e,t),e.prototype.onLoad=function(){cc.game.on(cc.game.EVENT_SHOW,function(){console.log("\u8fdb\u5165\u524d\u53f0"),u.default.Instance().playMusic(1)},this),this.node.getComponent(cc.Widget).updateAlignment(),b.default.Instance().isEnd=!1,this.meatPlay=this.findElement("uiPanel/buttonRoot/meatPlay"),this.zembieHave=this.findElement("uiPanel/top/zembieHave/label",cc.Label),this.suspendBtn=this.findElement("uiPanel/top/suspendBtn"),this.critNode=this.findElement("fightContent/Crit"),this.addBtnevent(),this.addEvent(),c.default.Instance().sideGamePrefab.push("ZembieFightPanel"),cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().gravity=cc.v2(),cc.director.getPhysicsManager().enabledAccumulator=!0,cc.PhysicsManager.FIXED_TIME_STEP=1/60,cc.PhysicsManager.VELOCITY_ITERATIONS=8,cc.PhysicsManager.POSITION_ITERATIONS=8,cc.PhysicsManager.PTM_RATIO=32,cc.PhysicsManager.FIXED_TIME_STEP=.01,this.bulletNodePool=new cc.NodePool,this.dieNodePool=new cc.NodePool,this.dieShowPool=new cc.NodePool;var t=cc.instantiate(this.timeScalePrefab);t.getComponent(_.default).isCountdown=!0,this.timeScale.addChild(t)},e.prototype.onEnable=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return u.default.Instance().playMusic(1),l.default.Instance().onCloseZembieBattlePanel(this.onClaseSelf,this),l.default.Instance().onDieNumChange(this.onDieNumChange,this),l.default.Instance().emitRefreshTask(),l.default.Instance().onGameTimePause(this.onGameTimePause,this),u.default.Instance().playEffect(7),[2]})})},e.prototype.onClaseSelf=function(){var t=this;this.scheduleOnce(function(){t.emitCloseMe()},.5)},e.prototype.onDieNumChange=function(){var t=b.default.Instance().dieNum;this.zembieHave.string=p.Global.languageMgr.getText(Number(900008))+t+"/"+this.zembieAllNum,b.default.Instance().dieNum>=this.zembieAllNum&&(b.default.Instance().isEnd=!0,this.scheduleOnce(function(){l.default.Instance().emitZembieGameOver(!0)},.3))},e.prototype.loadRes=function(){for(var t=[],e=0,i=this.getWarriorsInof();e<i.length;e++){var a=i[e];t.push(a.warriorsid)}this.getDataAndLoad(t,"player_"),t=[];for(var n=b.default.Instance().zoombieleve,o=0;o<n.time.length;++o)t.push(n.time[o][1]);this.getDataAndLoad(t,"zoombie_")},e.prototype.getDataAndLoad=function(t,e){for(var i=this,a=new Map,n=0;n<t.length;++n){var o=Math.round(t[n]/1e3%10);a.has(o)?a.get(o).push(t[n]):a.set(o,[t[n]])}a.forEach(function(t,a){var n=t.concat();c.default.Instance().sideGamebundles.push(e+a),i.loadBundle(e+a,n)}),a.clear()},e.prototype.loadBundle=function(t,e){var i=new c.PreloadConf;i.Init(t,t),cc.assetManager.loadBundle(t,function(a,n){if(a)console.error("\u52a0\u8f7dbundle:"+t+" \u9519\u8bef:"+a);else{i.setBundle(n);for(var o=[],s=0,r=e;s<r.length;s++){var l=r[s];o.push("Zoombie_"+l)}i.AddLoadFiles(c.AssetsType.ATPrefab,o),c.default.Instance().loadRes(i,function(){}),i.AddPreloadFiles(c.AssetsType.ATPrefab,o),c.default.Instance().preloadRes(i)}})},e.prototype.update=function(t){var e=this;if(this.canUpdate&&this.gameData){var i=t*this.skillTimeScale;v.default.ins.update(i),t*=this.sendTroopsTimeScale,this.gameTime+=t,this.sortNode(),this.cardShow();for(var a=0;a<this.enemyList.length;++a)this.enemyList[a].move(t);for(a=0;a<this.roleList.length;++a)this.roleList[a].move(t);if(this.gameTime>this.warriortime&&b.default.Instance().zoombieleve){this.gameTime+=this.warriortime;for(var n=b.default.Instance().zoombieleve,o=function(t){var i=n.time[t][0];if(s.gameTime>i&&-1==s.createRoleIndex.indexOf(t)){for(var a=Number(n.time[t][2]),o=0;o<a;++o)s.scheduleOnce(function(){e.createRole(!0,Number(n.time[t][1]))},cfgTable.commonData.warriortime/1e3*o);s.createRoleIndex.push(t)}},s=this,r=0;r<n.time.length;++r)o(r)}}},e.prototype.onDisable=function(){cc.Tween.stopAllByTag(d.TweenTag.meat),this.dieShowP.destroyAllChildren(),u.default.Instance().stopMusic()},e.prototype.onDestroy=function(){cc.director.getPhysicsManager().enabled=!1,this.roleList=[],this.enemyList=[],this.dieNodePool.clear(),this.dieShowPool.clear()},e.prototype.oncome=function(){this.enemyPosyWeight=.5,this.id=0,this.canUpdate=!0,this.gameData=r.default.Instance().getPlayerData(),this.meatNum=0,this.meatCount.string=""+this.meatNum;for(var t=b.default.Instance().zoombieleve,e=0;e<t.time.length;++e)this.zembieAllNum+=t.time[e][2];this.zembieAllNum=Math.round(this.zembieAllNum),this.initPanel()},e.prototype.cardShow=function(){var t=this.getWarriorsInof(),e=0;for(var i in t){var a=t[i];this.meatNum>=a.Needfood?this.btnBgs[e].active&&(this.cards[e].getComponent(cc.Button).interactable=!0,this.btnBgs[e].active=!1):this.btnBgs[e].active||(this.cards[e].getComponent(cc.Button).interactable=!1,this.btnBgs[e].active=!0),e+=1}},e.prototype.getWarriorsInof=function(){for(var t=b.default.Instance().zoombieleve.warriorsid,e=[],i=0;i<t.length;i++){var a=t[i],n=s.default.Instance().getTableValue("warriorsid",a,cfgTable.zoombiewarriorsData);n&&e.push(n)}return e},e.prototype.addBtnevent=function(){this.suspendBtn.on("click",this.clicksuspendBtn,this)},e.prototype.addEvent=function(){var t=this;l.default.Instance().onFireBullet(function(e){var i;i=t.bulletNodePool.size()>0?t.bulletNodePool.get():cc.instantiate(t.bullet),t.gameFactory.addChild(i),i.getComponent(y.default).initBullet(e,t)},this),l.default.Instance().onDungeonRoleDie(this.onDieShow,this),l.default.Instance().onCoinChange(this.setCoinShow,this),l.default.Instance().onDiamondChange(this.setDiamondShow,this),l.default.Instance().onTimeScaleChange(this.initTimeScale,this)},e.prototype.sortNode=function(){this.gameFactory.children.sort(function(t,e){return t.y+1<e.y-1?1:t.y-1>e.y+1?-1:0})},e.prototype.meatNumUp=function(t){var e=this;void 0===t&&(t=0);var i=b.default.Instance().zoombieleve.foodspeed*(1+p.Global.common.getCardMeatRate()),a=1/i;i>=2?(cc.Tween.stopAllByTag(d.TweenTag.meat),this.meatGrowth.fillRange=0,this.meatGrowth.node.active=!1,this.meatPlay.active=!0,this.meatTween=cc.tween(this),this.meatTween.repeatForever(cc.tween().delay(a).call(function(){e.meatNum+=1,e.meatCount.string=""+e.meatNum})).tag(d.TweenTag.zembieMeatTow).start()):(this.meatGrowth.fillRange=t,this.meatGrowth.node.active=!0,this.meatPlay.active=!1,t&&(a*=1-t),cc.Tween.stopAllByTag(d.TweenTag.meatTow),this.meatTween=cc.tween(this.meatGrowth),this.meatTween.repeatForever(cc.tween().to(a,{fillRange:1}).call(function(){e.meatNum+=1,e.meatCount.string=""+e.meatNum,e.meatGrowth.fillRange=0,a=1/i})).tag(d.TweenTag.zembieMeat).start())},e.prototype.initPool=function(t){return void 0===t&&(t=20),__awaiter(this,void 0,void 0,function(){var e,i,a,n,o,s;return __generator(this,function(r){switch(r.label){case 0:for(o=0;o<t;o++)e=cc.instantiate(this.bullet),this.bulletNodePool.put(e);return this.die?[3,2]:(i=this,[4,c.default.Instance().loadAndGetRes("res","prefab/animPre/ZembieDieAnimPre")]);case 1:i.die=r.sent(),r.label=2;case 2:for(o=0;o<t;o++)a=cc.instantiate(this.die),this.dieNodePool.put(a);return this.dieShow?[3,4]:(n=this,[4,c.default.Instance().loadAndGetRes("res","prefab/MainPanel/DieShowPre")]);case 3:n.dieShow=r.sent(),r.label=4;case 4:for(o=0;o<t;o++)s=cc.instantiate(this.dieShow),this.dieShowPool.put(s);return[2]}})})},e.prototype.initBase=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o,s;return __generator(this,function(){for(this.roleList.push(this.selfBase.getComponent(g.default)),this.id++,t=b.default.Instance().zoombieleve.enemybasehp,e=p.Global.talentSkillMgr.run(T.ETalentType.baseHp,t,!1),this.selfBase.getComponent(g.default).initBase({hp:e,fightplan:this,id:this.id}),i=b.default.Instance().zoombieleve.base,a=[],n=0,o=this.baseImgs;n<o.length;n++)-1!=(s=o[n]).name.indexOf(i)&&a.push(s);return this.selfBase_1.spriteFrame=a[0],this.selfBase_2.spriteFrame=a[1],this.id++,[2]})})},e.prototype.initMeat=function(){this.meatNum=0,this.meatCount.string=""+this.meatNum,this.meatNumUp()},e.prototype.initCards=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,o=this;return __generator(this,function(){for(n in t=this.getWarriorsInof(),e=0,i=function(i){var n=t[i];a.cards[e].active=!0,a.costs[e].string=""+n.Needfood;var s=Math.round(n.warriorsid/1e3%10);a.getCardIcon(e,s,n.warriorsid),a.cards[e].on("click",function(){o.meatNum>=n.Needfood&&(p.Global.sdkMgr.vibrateShort("medium"),o.meatNum-=n.Needfood,o.meatCount.string=""+o.meatNum,o.createRole(!1,n.warriorsid),o.cardShow(),0==Number(i)?r.default.Instance().getPlayerData().addCurTaskCount(1,6):1==Number(i)?r.default.Instance().getPlayerData().addCurTaskCount(1,7):2==Number(i)&&r.default.Instance().getPlayerData().addCurTaskCount(1,8))}),e+=1},a=this,t)i(n);return[2]})})},e.prototype.getCardIcon=function(t,e,i){return __awaiter(this,void 0,void 0,function(){var a,n;return __generator(this,function(o){switch(o.label){case 0:return a="player_"+e,[4,c.default.Instance().loadAndGetRes(a,"roleIcon",cc.SpriteAtlas)];case 1:return n=o.sent(),this.cards[t].getChildByName("bg").getChildByName("bgMask").getChildByName("logo").getComponent(cc.Sprite).spriteFrame=n.getSpriteFrame(String(i)),[2]}})})},e.prototype.initGold=function(){this.setCoinShow(),this.setDiamondShow(),this.onDieNumChange()},e.prototype.setCoinShow=function(t){void 0===t&&(t=0),this.coin.string=t?""+h.default.ChangeNumberUnit(t):""+r.default.Instance().getPlayerData().getUserCoinStr()},e.prototype.setDiamondShow=function(t){void 0===t&&(t=0),this.diamond.string=t?""+h.default.ChangeNumberUnit(t):""+r.default.Instance().getPlayerData().getDiamondStr()},e.prototype.createRole=function(t,e){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,function(){var i,a,n,o,s;return __generator(this,function(r){switch(r.label){case 0:return i=Math.round(e/1e3%10),a="player_"+i,t&&(a="zoombie_"+i),[4,c.default.Instance().loadAndGetRes(a,"Zoombie_"+e)];case 1:return(n=r.sent())?(o=cc.instantiate(n),this.id++,o.name=this.id+"",o.x=0,s=o.getComponent(f.default),this.gameFactory.addChild(o),o.opacity=0,1!=this.meatTimeScale&&(s.moveSpeedScale=2,s.animTimeScale=2,s.attackTimeScale=.5),t?(o.scaleX=-1,o.setPosition(this.Birthpoint.enemyBirthpoint),this.enemyList.push(o.getComponent(f.default))):(o.scaleX=1,o.setPosition(this.Birthpoint.myBirthpoint),this.roleList.push(o.getComponent(f.default))),s.initRole(t,e,this.id,this),t||v.default.ins.buffSkillWork(s),[2]):(console.error("\u4e3bUI\u9884\u5236\u4f53\u4e22\u5931!"),[2])}})})},e.prototype.initWithParam=function(t){console.log("\u5f53\u524d\u7684\u8fdb\u5165\u7b49\u7ea7",t);var e=b.default.Instance();e.gameType=d.dungeonsGameType.Zembie,e.battle=t,e.zoombieleve=s.default.Instance().getTableValue("battle",t,cfgTable.zoombieleveData),this.showBG(),this.oncome()},e.prototype.initPanel=function(){this.gameData=r.default.Instance().getPlayerData(),this.loadRes(),this.initGold(),this.initPool(),this.initMeat(),this.initCards(),this.initBase(),v.default.ins.init(v.EFightPanel.Zembie,this),p.Global.heroMgr.init(v.EFightPanel.Zembie,this),this.initTimeScale()},e.prototype.showBG=function(){},e.prototype.destroyRole=function(){cc.director.getPhysicsManager().enabled=!1},e.prototype.onDieShow=function(t,e,i){var a=h.default.getnodePoolNode(this.dieNodePool,this.die);a.scale=e,a&&(this.dieAnimShow.addChild(a),a.getComponent(m.default).init(t,this.dieNodePool,i));var n=h.default.getnodePoolNode(this.dieShowPool,this.dieShow);n&&(this.dieShowP.addChild(n),n.setPosition(this.dieShowP.convertToNodeSpaceAR(t)))},e.prototype.onGameTimePause=function(t){t?this.pauseTime():this.recoverTime()},e.prototype.pauseTime=function(){var t=this;this.scheduleOnce(function(){t.canUpdate=!1}),cc.Tween.stopAllByTag(d.TweenTag.meat),cc.Tween.stopAllByTag(d.TweenTag.meatTow);for(var e=0;e<this.enemyList.length;++e)this.enemyList[e].canMove=!1;for(e=0;e<this.roleList.length;++e)this.roleList[e].canMove=!1},e.prototype.recoverTime=function(){this.canUpdate=!0,this.meatNumUp(this.meatGrowth.fillRange);for(var t=0;t<this.enemyList.length;++t)this.enemyList[t].canMove=!0;for(t=0;t<this.roleList.length;++t)this.roleList[t].canMove=!0},e.prototype.clicksuspendBtn=function(){l.default.Instance().emitShowPanel({prefab:"prefab/Dungeons/DungeonSuspendPanel"})},e.prototype.addMeat=function(t){this.meatNum+=t,this.meatCount.string=""+this.meatNum},e.prototype.initTimeScale=function(){if(this.meatTween){var t=p.Global.common.getTimeScale();this.meatTimeScale=t[0],this.sendTroopsTimeScale=t[5],this.meatTween._finalAction._speedMethod=!0,this.meatTween._finalAction._speed=this.meatTimeScale;for(var e=0,i=this.roleList;e<i.length;e++)(o=i[e]).moveSpeedScale=t[1],o.animTimeScale=t[2],o.attackTimeScale=t[3];for(var a=0,n=this.enemyList;a<n.length;a++){var o;(o=n[a]).moveSpeedScale=t[1],o.animTimeScale=t[2],o.attackTimeScale=t[3]}v.default.ins.timeScale=t[4],this.skillTimeScale=t[4];for(var s=0,r=v.default.ins.skillBtnItemArr;s<r.length;s++)r[s].timeScale=t[4]}},__decorate([k({type:cc.Node,displayName:"\u6211\u65b9\u57fa\u5730"})],e.prototype,"selfBase",void 0),__decorate([k({type:cc.Sprite,displayName:"\u8089\u7684\u589e\u957f"})],e.prototype,"meatGrowth",void 0),__decorate([k({type:cc.Label,displayName:"\u8089\u7684\u6570\u91cf"})],e.prototype,"meatCount",void 0),__decorate([k({type:cc.Node,displayName:"\u5361\u724c"})],e.prototype,"cards",void 0),__decorate([k({type:cc.Label,displayName:"\u91d1\u5e01"})],e.prototype,"coin",void 0),__decorate([k({type:cc.Label,displayName:"\u94bb\u77f3"})],e.prototype,"diamond",void 0),__decorate([k(cc.Label)],e.prototype,"costs",void 0),__decorate([k(cc.Node)],e.prototype,"btnBgs",void 0),__decorate([k(cc.Prefab)],e.prototype,"bullet",void 0),__decorate([k(cc.Node)],e.prototype,"gameFactory",void 0),__decorate([k(cc.Node)],e.prototype,"dieAnimShow",void 0),__decorate([k(cc.Node)],e.prototype,"dieShowP",void 0),__decorate([k(cc.Sprite)],e.prototype,"bg",void 0),__decorate([k(cc.Sprite)],e.prototype,"selfBase_1",void 0),__decorate([k(cc.Sprite)],e.prototype,"selfBase_2",void 0),__decorate([k(cc.Node)],e.prototype,"timeScale",void 0),__decorate([k(cc.Prefab)],e.prototype,"timeScalePrefab",void 0),__decorate([k(cc.SpriteFrame)],e.prototype,"baseImgs",void 0),__decorate([D],e)}(o.default);n.default=C,cc._RF.pop()},{}],ZembieItem:[function(t,e,i){"use strict";cc._RF.push(e,"abf1eGZjnFDKa+wWZWEQfWi","ZembieItem");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("CompBase"),s=a("Global"),r=a("EventMgr"),l=a("spriteFrameControl"),c=cc._decorator,h=c.ccclass,d=(c.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.btnEnter=null,e.LabelTitle=null,e.LabelKeyNum=null,e.SpriteIconKey=null,e.ClickON=!1,e}return __extends(e,t),e.prototype.onLoad=function(){this.init(),r.default.Instance().onZembieLevelChange(this.showUI,this),r.default.Instance().onDungeonKeyChange(this.showUI,this)},e.prototype.onEnable=function(){this.btnEnter&&this.onClick()},e.prototype.onDisable=function(){this.offClick()},e.prototype.init=function(){this.btnEnter=this.findElement("btnEnter"),this.LabelTitle=this.findElement("LabelTitle",cc.Label),this.LabelKeyNum=this.findElement("LabelKeyNum",cc.Label),this.SpriteIconKey=this.findElement("SpriteIconKey",l.default),this.onClick(),this.showUI()},e.prototype.onClick=function(){this.ClickON||(this.ClickON=!0,this.btnEnter.on("click",this.onBtnEnter,this))},e.prototype.offClick=function(){this.ClickON&&(this.ClickON=!1,this.btnEnter.off("click",this.onBtnEnter,this))},e.prototype.showUI=function(){var t=s.Global.dataMgr.getPlayerData(),e=cfgTable.commonData.zombiekeymax;this.LabelTitle.string=s.Global.languageMgr.getText(900004);var i=t.getZembieKays(),a=t.getZembieADKays(),n="0/"+e,o=0,r=cfgTable.commonData.zombieadnumber,l=s.Global.sdkMgr.curSdk.option.parameter;l&&(l.zombieadnumber||0==l.zombieadnumber)&&-1!=l.zombieadnumber&&(r=l.zombieadnumber);var c=cc.assetManager.builtins.getBuiltin("material","builtin-2d-sprite");i>0?n=i+"/"+e:a>0?(o=1,n=a+"/"+r):c=cc.assetManager.builtins.getBuiltin("material","builtin-2d-gray-sprite"),this.btnEnter.getComponent(cc.Sprite).setMaterial(0,c),this.btnEnter.getChildByName("Label").getComponent(cc.Label).string=s.Global.languageMgr.getText(900005),this.SpriteIconKey.setSpriteFramebyIndex(o),this.LabelKeyNum.string=n},e.prototype.onBtnEnter=function(){r.default.Instance().emitShowPanel({prefab:"prefab/Dungeons/ZembieEnterPanel"})},__decorate([h],e)}(o.default));n.default=d,cc._RF.pop()},{}],ZembieRoleBase:[function(t,e,i){"use strict";cc._RF.push(e,"c9fc4fFIDtHcrmZuOkbROYq","ZembieRoleBase");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),n.ZembieRoleBase=void 0;var o=a("CompBase"),s=a("ConfigMgr"),r=a("EventMgr"),l=a("IVector2"),c=a("TweenMaterial"),h=a("UtilOne"),d=a("typeEnum"),u=a("DataMgr"),p=a("AudioMgr"),f=a("Global"),g=a("DungeonFightMgr"),m=a("SkillMgr"),y=a("TalentBase"),v=cc._decorator,b=v.ccclass,_=v.property,T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bady=null,e.icon=null,e.weapon=null,e.other=null,e.bullet="",e.bulletPos=cc.v2(0,0),e.bulletRotation=0,e.bulletScale=1,e.bulletEff=null,e.Atlas=null,e.health=null,e.warriorsname="",e.attack=1,e.hp=1,e.curHp=0,e.defense=1,e.attackDis=2,e.moveSpeed=1,e.sputRange=1,e.sputAttack=1,e.attakInterval=1,e.attakIngInterval=.5,e.perpetualAttack=!1,e.playReverse=!1,e.attackAim=!1,e.killRewards=1,e.needFood=1,e.damageToOurBuild=1,e.damageToOtherBuild=1,e.bulletspeed=.2,e.id=0,e.isEnemy=!1,e.target=null,e.anim=null,e.roleDate=null,e.rigidbody=null,e.bodySpeed=cc.v2(0,0),e.physics=null,e.OtherPhysics=0,e.selfPhysics=0,e.roleBaseType=d.RoleBaseType.Birth,e.OnAttackAim=!1,e.playReverseing=!1,e.NowAttackType=d.AttackType.Default,e.Birthpoint={myBirthpoint:cc.v2(-375,-25),enemyBirthpoint:cc.v2(400,0)},e.nowBirthpoint=null,e.moveToBulidUse=0,e.canMove=!0,e.moveSpeedScale=1,e.animTimeScale=1,e.attackTimeScale=1,e}var i;return __extends(e,t),i=e,e.prototype.onLoad=function(){this.anim=this.getComponent(cc.Animation),this.rigidbody=this.getComponent(cc.RigidBody),this.physics=this.getComponent(cc.PhysicsCircleCollider),this.health=this.findElement("health",cc.ProgressBar),this.moveToBulidUse=h.default.rand(40,135),this.addEvent()},e.prototype.addEvent=function(){var t=this;r.default.Instance().onBulletHuit(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this),r.default.Instance().onAttacked(function(e){t.getId()==e.id&&t.attackedFunc(e.attack,e.killRewards,e.sputAttack,e.sputRange)},this)},e.prototype.getCurHp=function(){return this.curHp},e.prototype.getId=function(){return this.id},e.prototype.initRole=function(t,e,i,a){return __awaiter(this,void 0,void 0,function(){var n,o,r,l,c,h,p;return __generator(this,function(){return this.canMove=!0,this.fightplan=a,this.isEnemy=t,n=1,o=1,r=u.default.Instance().getPlayerData().getCardsTotalAddition(),this.roleDate=s.default.Instance().getTableValue("warriorsid",e,cfgTable.zoombiewarriorsData),this.isEnemy?(l=g.default.Instance().zoombieleve,o*=Number(l.aihpcorrect),n*=Number(l.aiaktcorrect)):(c=r.find(function(t){return t.type==d.CardAddType.RoleAtk}),(h=r.find(function(t){return t.type==d.CardAddType.RoleHP}))&&(o+=h.addition),c&&(n+=c.addition)),(p=r.find(function(t){return t.type==d.CardAddType.coinAdd}))&&p.addition,this.id=i,this.attack=this.roleDate.attack*n,this.defense=this.roleDate.armor,this.hp=Number(this.roleDate.hp)*o,this.curHp=this.hp,this.warriorsname=f.Global.languageMgr.getText(Number(this.roleDate.nameid)),this.damageToOtherBuild=Number(this.roleDate.enemybasedamage),this.damageToOurBuild=this.roleDate.ourbasedamage,this.attackDis=this.roleDate.attackdistance,this.attakInterval=Number(this.roleDate.attackspeed),this.attakIngInterval=this.roleDate.attakIngInterval,this.perpetualAttack=!!this.roleDate.perpetualAttack,this.playReverse=!!this.roleDate.playReverse,this.moveSpeed=this.roleDate.movespeed,this.sputAttack=this.roleDate.splashdamage,this.sputRange=this.roleDate.splashrange,this.needFood=this.roleDate.Needfood,this.killRewards=1*this.roleDate.Killrewards,this.bulletspeed=this.roleDate.bulletspeed?Number(this.roleDate.bulletspeed):.2,this.OtherPhysics=0,this.NowAttackType=d.AttackType.Default,this.OnAttackAim=!1,this.playReverseing=!1,this.roleBaseType=d.RoleBaseType.Birth,this.onShow(),this.isEnemy||(f.Global.talentSkillMgr.run(y.ETalentType.armyHp,this,!1),f.Global.talentSkillMgr.run(y.ETalentType.armyAtk,this,!1)),[2]})})},e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return[2]})})},e.prototype.attackOver=function(){var t=this;this.isDeath()||this.NowAttackType==d.AttackType.Over||(this.NowAttackType=d.AttackType.Over,this.OnAttackAim=!1,this.roleBaseType=d.RoleBaseType.Interval,this.scheduleOnce(function(){t.roleBaseType=d.RoleBaseType.Move},this.attakInterval*this.attackTimeScale))},e.prototype.attackEnd=function(){this.isDeath()||this.NowAttackType==d.AttackType.End||(this.NowAttackType=d.AttackType.End,this.playReverseing||(this.perpetualAttack?this.playReverse?(this.anim.on(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.playReverseAttack(d.AttackType.AinmIng)):this.prepareAtk():this.playAttack(d.AttackType.AinmOver)))},e.prototype.playAtkAuio=function(){this.roleDate.audioId&&p.default.Instance().playEffect(Number(this.roleDate.audioId))},e.prototype.onplayReverse=function(){this.playReverseing=!1,this.anim.off(cc.Animation.EventType.FINISHED,this.onplayReverse,this),this.prepareAtk()},e.prototype.onGoAtk=function(){if(this.NowAttackType!=d.AttackType.OnGo&&(this.NowAttackType=d.AttackType.OnGo,!this.playReverseing)){this.playAtkAuio();for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}if(e.minDts<=this.attackDis)this.onGoAtkTo(e);else{if(!(i.minDts<=this.attackDis))return void this.attackEnd();this.onGoAtkTo(i)}if(2==this.roleDate.warriortype){var s={root:this.weapon,target:this.target,father:this};r.default.Instance().emitFireBullet(s)}else{var l=[this.attack,this.damageToOurBuild,this.damageToOtherBuild],c=this.killRewards;r.default.Instance().emitAttacked({id:this.target.getId(),attack:l,killRewards:c,sputAttack:this.sputAttack,sputRange:this.sputRange})}}},e.prototype.prepareAtk=function(){if(!this.isDeath()&&this.NowAttackType!=d.AttackType.Prepare&&this.isValid){this.NowAttackType=d.AttackType.Prepare;for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node;if(n&&n.isValid){var o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}}e.minDts<=this.attackDis?this.prepareAtkTo(e):i.minDts<=this.attackDis?this.prepareAtkTo(i):this.playAttack(d.AttackType.AinmOver)}},e.prototype.attackedFunc=function(t,e,i,a){var n=i;if(t&&(n=t[0],this.isEnemy)){var o=f.Global.common.isCrit(!1);n=f.Global.common.getCritAtk(o,n,!1),o&&f.Global.talentSkillMgr.playEft(this,y.ETalentEft.crit)}if(this.isEnemy||!f.Global.common.isMiss(!1)){if(!this.isDeath()){this.hp-=n,p.default.Instance().playEffect(4);var s=this.bady.getComponent(cc.Sprite),l=new c.TweenMaterial(s,"time",0);cc.tween(l).to(.1,{mainAny:1}).to(.1,{mainAny:0}).start(),this.health.node.active=!0,this.health.progress=this.hp/this.curHp;var h=this.health.node.getChildByName("white");if(h.active=!0,h.width=(this.hp+n)/this.curHp*52,cc.tween(h).to(.2,{width:this.hp/this.curHp*52}).call(function(){h.active=!1}).start(),this.hp<=0){this.roleBaseType=d.RoleBaseType.Dide,f.Global.common.isDropMeat();var u=this.node.getContentSize().height;r.default.Instance().emitDungeonRoleDie(this.node.convertToWorldSpaceAR(cc.v2(0,u/2)),u/56.6,this.isEnemy);var m=(v=this.isEnemy?this.fightplan.enemyList:this.fightplan.roleList).indexOf(this);m>-1&&v.splice(m,1),this.isEnemy&&g.default.Instance().addDieNum(1),this.node.destroy()}if(a){for(var v=this.isEnemy?this.fightplan.enemyList:this.fightplan.roleList,b=[],_=0;_<v.length;++_)if(!v[_].isDeath()){var T=v[_].node;this.node!=T&&this.getDistance(this.node,T)<=a&&b.push(v[_])}b.forEach(function(t){t.attackedFunc(null,e,i,null)})}}}else f.Global.talentSkillMgr.playEft(this,y.ETalentEft.defence)},e.prototype.prepareAtkTo=function(t){!t.base||t.base.isDeath()?this.playAttack(d.AttackType.AinmOver):(this.target=t.base,this.startAtk())},e.prototype.onGoAtkTo=function(t){t.base&&!t.base.isDeath()?this.target=t.base:this.attackEnd()},e.prototype.startAtk=function(){var t=this;this.isDeath()||(this.attackAim&&(this.OnAttackAim=!0),this.scheduleOnce(function(){t.target&&!t.target.isDeath()?t.playAttack(d.AttackType.AinmIng):t.playAttack(d.AttackType.AinmOver)},this.attakIngInterval*this.attackTimeScale))},e.prototype.playAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(){return this.isDeath()?[2]:(e=this.anim.getClips(),(i=this.anim.play(e[t].name)).speed=1*this.animTimeScale,i.wrapMode=cc.WrapMode.Normal,[2])})})},e.prototype.playReverseAttack=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(){return this.isDeath()?[2]:(e=this.anim.getClips(),(i=this.anim.play(e[t].name)).wrapMode=cc.WrapMode.Reverse,i.speed=1*this.animTimeScale,this.playReverseing=!0,[2])})})},e.prototype.detectionDis=function(){for(var t=this.isEnemy?this.fightplan.roleList:this.fightplan.enemyList,e={minDts:1e5,base:null},i={minDts:1e5,base:null},a=0;a<t.length;++a)if(!t[a].isDeath()){var n=t[a].node,o=this.getDistance(this.node,n);"selfBuild"==n.name?(i.minDts=o,i.base=t[a]):o<e.minDts&&(e.minDts=o,e.base=t[a])}this.roleBaseType==d.RoleBaseType.Attack&&this.attackAim&&this.OnAttackAim&&(e.minDts<=this.attackDis?this.setAimTo(e):i.minDts<=this.attackDis&&this.setAimTo(i)),this.roleBaseType==d.RoleBaseType.Move&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.setAtkTo(e):i.minDts<=this.attackDis&&this.setAtkTo(i)),2==this.roleDate.warriortype&&(this.roleBaseType==d.RoleBaseType.Attack?("enemy_3"!=this.node.group&&"my_3"!=this.node.group||(this.node.group=this.isEnemy?"enemy_2":"my_2"),this.bodySpeed=cc.v2(l.Vector2.ZERO)):("enemy_2"!=this.node.group&&"my_2"!=this.node.group||(this.node.group=this.isEnemy?"enemy_3":"my_3"),this.bodySpeed=this.bodySpeed)),this.OtherPhysics>0&&50!=this.physics.density?(this.physics.density=50,this.physics.apply()):10!=this.physics.density&&(this.physics.density=10,this.physics.apply()),this.roleBaseType==d.RoleBaseType.Interval&&(e.base&&!e.base.isDeath()?this.setMoveTo(e):i.base&&!i.base.isDeath()&&this.setMoveTo(i),e.minDts<=this.attackDis?this.bodySpeed=cc.v2(l.Vector2.ZERO):i.minDts<=this.attackDis&&(this.bodySpeed=cc.v2(l.Vector2.ZERO))),g.default.Instance().isEnd||(this.bodySpeed.x*=this.moveSpeedScale,this.bodySpeed.y*=this.moveSpeedScale,this.rigidbody.linearVelocity=this.bodySpeed)},e.prototype.setMoveTo=function(t){var e=t.base.node.getPosition(),i=this.node.getPosition();if("selfBuild"==t.base.node.name){var a=t.base.node.getPosition();e={x:a.x,y:a.y+this.moveToBulidUse}}var n={x:0,y:0};l.Vector2.sub(n,e,i);var o=l.Vector2.len(n),s=new l.Vector2(n.x/o,n.y/o);this.bodySpeed.x=s.x*this.moveSpeed,this.bodySpeed.y=s.y*this.moveSpeed},e.prototype.setAtkTo=function(t){t.base&&!t.base.isDeath()&&(this.target=t.base,this.bodySpeed=cc.v2(l.Vector2.ZERO),this.playAttack(d.AttackType.AinmStart),this.roleBaseType=d.RoleBaseType.Attack)},e.prototype.setAimTo=function(t){if(t.base&&!t.base.isDeath()){this.target=t.base;var e=new l.Vector2(this.node.position),i=new l.Vector2(this.target.node.position),a=l.Vector2.angle360(e,i);this.weapon.angle=a}},e.prototype.getDistance=function(t,e){var i=Math.abs(t.x-e.x)-(t.width/2+e.width/2),a=t.y-e.y>0?e.height/2:t.height/2,n=Math.abs(t.y-e.y)-a,o=Math.hypot(i,n);return i<0&&n<0&&(o*=-1),o},e.prototype.move=function(){!g.default.Instance().isEnd&&this.canMove?m.default.ins.isFrozen(this)?this.rigidbody.linearVelocity=cc.v2(l.Vector2.ZERO):this.isDeath()||(this.roleBaseType==d.RoleBaseType.Birth?this.moveOn():this.detectionDis()):this.rigidbody.linearVelocity=cc.v2(l.Vector2.ZERO)},e.prototype.moveOn=function(){this.roleBaseType=d.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBirth=function(){this.roleBaseType=d.RoleBaseType.Move,this.node.opacity=255},e.prototype.onBeginContact=function(t,e,a){if(a.node){var n=a.node.getComponent(i);n&&this.isEnemy!=n.isEnemy?this.OtherPhysics+=1:this.selfPhysics+=1}},e.prototype.onEndContact=function(t,e,a){if(a.node){var n=a.node.getComponent(i);n&&this.isEnemy!=n.isEnemy?this.OtherPhysics-=1:this.selfPhysics-=1}},e.prototype.isDeath=function(){return this.roleBaseType==d.RoleBaseType.Dide},e.prototype.setHp=function(t){this.hp=t,this.health.progress=this.hp/this.curHp},e.prototype.getHp=function(){return this.hp},e.prototype.setCurHp=function(t){this.curHp=t,this.health.progress=this.hp/this.curHp},e.prototype.getAtk=function(){return this.attack},e.prototype.setAtk=function(t){this.attack=t},__decorate([_(cc.Sprite)],e.prototype,"bady",void 0),__decorate([_(cc.Sprite)],e.prototype,"icon",void 0),__decorate([_(cc.Node)],e.prototype,"weapon",void 0),__decorate([_(cc.Sprite)],e.prototype,"other",void 0),__decorate([_()],e.prototype,"bullet",void 0),__decorate([_(cc.Vec2)],e.prototype,"bulletPos",void 0),__decorate([_()],e.prototype,"bulletRotation",void 0),__decorate([_()],e.prototype,"bulletScale",void 0),__decorate([_(cc.Prefab)],e.prototype,"bulletEff",void 0),__decorate([_(cc.SpriteAtlas)],e.prototype,"Atlas",void 0),i=__decorate([b],e)}(o.default);n.ZembieRoleBase=T,cc._RF.pop()},{}],ZembieRole:[function(t,e,i){"use strict";cc._RF.push(e,"594e4GPLqZMPI94Q/q2sL7P","ZembieRole");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("UtilOne"),s=a("typeEnum"),r=a("ZembieRoleBase"),l=cc._decorator,c=l.ccclass,h=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,a,n,r,l,c,h;return __generator(this,function(){return 1==this.roleDate.warriortype?this.node.group=this.isEnemy?"enemy":"my":this.node.group=this.isEnemy?"enemy_3":"my_3",t="",e="",i="",this.bady.spriteFrame&&(t=this.bady.spriteFrame.name),this.icon.spriteFrame&&(e=this.icon.spriteFrame.name),this.other.spriteFrame&&(i=this.other.spriteFrame.name),this.isEnemy&&(t=t.replace("e1","e2"),e=e.replace("e1","e2"),i=i.replace("e1","e2"),this.Atlas.getSpriteFrame(e)||(e=e.replace("e2","e1")),this.Atlas.getSpriteFrame(t)||(t=t.replace("e2","e1")),this.Atlas.getSpriteFrame(i)||(i=i.replace("e2","e1"))),this.bady.spriteFrame=this.Atlas.getSpriteFrame(t),this.other.spriteFrame?(this.other.node.active=!0,this.other.spriteFrame=this.Atlas.getSpriteFrame(i)):this.other.node.active=!1,this.icon.spriteFrame?this.icon.spriteFrame=this.Atlas.getSpriteFrame(e):this.icon.spriteFrame=null,this.health.node.setPosition(0,this.bady.spriteFrame.getRect().height+10),this.health.node.active=!1,a=this.bady.spriteFrame.getRect().height,this.physics.offset=cc.v2(0,a/4),this.physics.radius=a/4,this.physics.apply(),this.node.setContentSize(this.bady.spriteFrame.getRect().width,this.bady.spriteFrame.getRect().height),n=o.default.randInt(-1,1),r=o.default.randInt(-1,1),this.isEnemy?(c=this.fightplan&&this.fightplan.enemyPosyWeight||0,h=Math.random()>c,(l=h?o.default.randInt(-100,370):o.default.randInt(-350,100))>=0?c+.2>=1?c=1:c+=.2:c-.2<=0?c=0:c-=.2,this.fightplan&&this.fightplan.enemyPosyWeight&&(this.fightplan.enemyPosyWeight=c),this.nowBirthpoint=cc.v2(this.Birthpoint.enemyBirthpoint.x+n,this.Birthpoint.enemyBirthpoint.y+l),this.node.setPosition(this.nowBirthpoint)):(this.nowBirthpoint=cc.v2(this.Birthpoint.myBirthpoint.x+n,this.Birthpoint.myBirthpoint.y+r),this.node.setPosition(this.nowBirthpoint)),this.roleBaseType=s.RoleBaseType.Birth,[2]})})},__decorate([c],e)}(r.ZembieRoleBase));n.default=h,cc._RF.pop()},{}],base64:[function(t,e,i){"use strict";cc._RF.push(e,"bcfa3PwGt1G1qKWy4I+60K1","base64");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function t(){this._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}return t.Instance=function(){return this.instance||(this.instance=new this),this.instance},t.prototype.encode=function(t){var e,i,a,n,o,s,r,l="",c=0;for(t=this._utf8_encode(t);c<t.length;)n=(e=t.charCodeAt(c++))>>2,o=(3&e)<<4|(i=t.charCodeAt(c++))>>4,s=(15&i)<<2|(a=t.charCodeAt(c++))>>6,r=63&a,isNaN(i)?s=r=64:isNaN(a)&&(r=64),l=l+this._keyStr.charAt(n)+this._keyStr.charAt(o)+this._keyStr.charAt(s)+this._keyStr.charAt(r);return l},t.prototype.decode=function(t){var e,i,a,n,o,s,r="",l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)e=this._keyStr.indexOf(t.charAt(l++))<<2|(n=this._keyStr.indexOf(t.charAt(l++)))>>4,i=(15&n)<<4|(o=this._keyStr.indexOf(t.charAt(l++)))>>2,a=(3&o)<<6|(s=this._keyStr.indexOf(t.charAt(l++))),r+=String.fromCharCode(e),64!=o&&(r+=String.fromCharCode(i)),64!=s&&(r+=String.fromCharCode(a));return this._utf8_decode(r)},t.prototype._utf8_encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var a=t.charCodeAt(i);a<128?e+=String.fromCharCode(a):a>127&&a<2048?(e+=String.fromCharCode(a>>6|192),e+=String.fromCharCode(63&a|128)):(e+=String.fromCharCode(a>>12|224),e+=String.fromCharCode(a>>6&63|128),e+=String.fromCharCode(63&a|128))}return e},t.prototype._utf8_decode=function(t){for(var e="",i=0,a=0,n=0,o=0;i<t.length;)(a=t.charCodeAt(i))<128?(e+=String.fromCharCode(a),i++):a>191&&a<224?(n=t.charCodeAt(i+1),e+=String.fromCharCode((31&a)<<6|63&n),i+=2):(n=t.charCodeAt(i+1),o=t.charCodeAt(i+2),e+=String.fromCharCode((15&a)<<12|(63&n)<<6|63&o),i+=3);return e},t.prototype.str2buffer=function(t){var e,i;e=new ArrayBuffer(t.length),i=new Uint8Array(e);for(var a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return e},t.prototype.buffer2str=function(t){var e=new Uint16Array(t);return String.fromCharCode.apply(null,e)},t}();a.default=n,cc._RF.pop()},{}],curve:[function(t,e,i){"use strict";cc._RF.push(e,"8c5159viT9LsbVoreBzm+T3","curve");var a=i;Object.defineProperty(a,"__esModule",{value:!0}),a.Curve=void 0;var n=0,o=function(){function t(){}return t.Bezier=new function(){this.vec1=new(function(){function t(){}return t.prototype.gets=function(t,e){var i=t.length;n=1-e;for(var a=0,o=0;o<i;o++){var s=i-o-1;a+=t[o]*Math.pow(n,s)*Math.pow(e,o)*this.erxiangshi(i-1,o)}return a},t.prototype.erxiangshi=function(t,e){for(var i=1,a=1;e>0;)i*=t,a*=e,t--,e--;return i/a},t.prototype.getControlByCurve=function(t,e,i,a){return(n=1-a)*n*t+2*a*n*i+a*a*e},t.prototype.getCurveByControl=function(t,e,i,a){return(i-(n=1-a)*n*t-a*a*e)/(2*a*n)},t.prototype.get3ControlByCurve=function(t,e,i,a,o){return 0==t&&0==e?0:(n=1-o,Math.pow(n,3)*t+3*i*o*n*n+3*a*o*o*n+e*Math.pow(o,3))},t.prototype.get3CurveByControl=function(t,e,i,a,o){return n=1-o,(i-Math.pow(n,3)*t-3*n*o*o*a-e*Math.pow(o,3))/(3*n*n)},t.prototype.get3CurveByControl2=function(t,e,i,a,o){return n=1-o,(i-Math.pow(n,3)*t-3*n*n*a*o-e*Math.pow(o,3))/(3*Math.pow(n,3)*o*o)},t}()),this.vec2=new(function(){function e(){}return e.prototype.gets=function(e,i,a){var o=i.length;n=1-a;for(var s=0;s<o;s++){var r=o-s-1,l=Math.pow(n,r)*Math.pow(a,s)*t.Bezier.vec1.erxiangshi(o-1,s);e.x+=i[s].x*l,e.y+=i[s].y*l}return e},e.prototype.getControlByCurve=function(e,i,a,n,o){return o.x=t.Bezier.vec1.getControlByCurve(e.x,i.x,a.x,n),o.y=t.Bezier.vec1.getControlByCurve(e.y,i.y,a.y,n),o},e.prototype.getCurveByControl=function(e,i,a,n,o){return o.x=t.Bezier.vec1.getCurveByControl(e.x,i.x,a.x,n),o.y=t.Bezier.vec1.getCurveByControl(e.y,i.y,a.y,n),o},e}()),this.vec3=new(function(){function e(){}return e.prototype.gets=function(e,i,a){var o=i.length;n=1-a;for(var s=0;s<o;s++){var r=o-s-1,l=Math.pow(n,r)*Math.pow(a,s)*t.Bezier.vec1.erxiangshi(o-1,s);e.x+=i[s].x*l,e.y+=i[s].y*l,e.z+=i[s].z*l}return e},e.prototype.getControlByCurve=function(e,i,a,n,o){return o.x=t.Bezier.vec1.getControlByCurve(e.x,i.x,a.x,n),o.y=t.Bezier.vec1.getControlByCurve(e.y,i.y,a.y,n),o.z=t.Bezier.vec1.getControlByCurve(e.z,i.z,a.z,n),o},e.prototype.getCurveByControl=function(e,i,a,n,o){return o.x=t.Bezier.vec1.getCurveByControl(e.x,i.x,a.x,n),o.y=t.Bezier.vec1.getCurveByControl(e.y,i.y,a.y,n),o.z=t.Bezier.vec1.getCurveByControl(e.z,i.z,a.z,n),o},e}())},t.Spline=new function(){this.vec1=new(function(){function t(){}return t.prototype.get=function(t,e,i,a,n,o){var s=o*o,r=s*o,l=(1-n)/2;return t*l*(2*s-r-o)+e*(l*(-r+s)+(2*r-3*s)+1)+i*(l*(r-2*s+o)+-2*r+3*s)+a*l*(r-s)},t}()),this.vec2=new(function(){function t(){}return t.prototype.get=function(t,e,i,a,n,o,s){var r=o*o,l=r*o,c=(1-n)/2,h=c*(2*r-l-o),d=c*(-l+r)+(2*l-3*r)+1,u=c*(l-2*r+o)+-2*l+3*r,p=c*(l-r);return s.x=t.x*h+e.x*d+i.x*u+a.x*p,s.y=t.y*h+e.y*d+i.y*u+a.y*p,s},t}()),this.vec3=new(function(){function t(){}return t.prototype.get=function(t,e,i,a,n,o,s){var r=o*o,l=r*o,c=(1-n)/2,h=c*(2*r-l-o),d=c*(-l+r)+(2*l-3*r)+1,u=c*(l-2*r+o)+-2*l+3*r,p=c*(l-r);return s.x=t.x*h+e.x*d+i.x*u+a.x*p,s.y=t.y*h+e.y*d+i.y*u+a.y*p,s.z=t.z*h+e.z*d+i.z*u+a.z*p,s},t}())},t}();a.Curve=o,cc._RF.pop()},{}],dataList:[function(t,e,i){"use strict";cc._RF.push(e,"d9e9blv06dJHaW8XUBAFkbU","dataList");var a=i;Object.defineProperty(a,"__esModule",{value:!0}),a.dataList=void 0;var n=function(){function t(e,i,a,n,o){this.showItemMap=new Map,this.pool=[],this.lastPos=-1,o=o||0,this.listSize=n?e.node.width:e.node.height,this.maxShowItemNum=Math.ceil(this.listSize/(a+o)+2*t.ADD_SHOW_NUM),this.itemNum=0,this.list=e,this.itemPrefab=i,this.itemSize=a,this.isVorizontal=n,this.space=o||0,e.node.on("scrolling",this.OnScrollHandler,this)}return t.prototype.Refresh=function(t){t&&(this.lastPos=-1),this.OnScrollHandler()},t.prototype.SetItemNum=function(t){this.itemNum=t,this.RefreshMaxSizeValue(),this.Refresh(!0)},t.prototype.GetItemByItemIndex=function(t){return this.showItemMap.has(t)?this.showItemMap.get(t):null},t.prototype.IsRenderItem=function(t){return t>=this.lastRenderStartIndex&&t<=this.lastRenderEndIndex},t.prototype.OnScrollHandler=function(){var e=this.list;if(e){var i=e.getScrollOffset(),a=0,n=this.isVorizontal?i.x:i.y;n>0&&(a=Math.floor(n/(this.itemSize+this.space))-t.ADD_SHOW_NUM),a<0&&(a=0),-1==this.lastPos&&(a=0),this.lastPos=a;var o=this.maxShowItemNum+a;o>=this.itemNum&&(o=this.itemNum-1);var s=this.lastRenderStartIndex,r=this.lastRenderEndIndex;if(this.lastRenderStartIndex=a,this.lastRenderEndIndex=o,-1!=s&&r-s>=0){for(var l=s;l<a;l++)this.BackToPool(l);for(l=o+1;l<=r;l++)this.BackToPool(l)}for(l=a;l<=o;l++)this.CreateFromPool(l),this.RenderItem(l)}},t.prototype.BackToPool=function(t){var e=this.GetItemByItemIndex(t);null!=e&&(e.removeFromParent(),this.pool.push(e)),this.showItemMap.has(t)&&this.showItemMap.delete(t)},t.prototype.CreateFromPool=function(t){if(null==this.itemPrefab)return console.log("jiaka err: \u865a\u62df\u5217\u8868\u6ca1\u6709\u6307\u5b9aitem\u7684\u9884\u5236\u4f53"),null;var e=this.GetItemByItemIndex(t);return e||(e=this.pool.length>0?this.pool.pop():this.CreateItem(),this.list.content.addChild(e),e.setPosition(this.GetPos(t)),this.showItemMap.set(t,e),e)},t.prototype.CreateItem=function(){return cc.instantiate(this.itemPrefab)},t.prototype.RenderItem=function(t){if(null!=this.itemRenderer){var e=this.GetItemByItemIndex(t);e&&this.itemRenderer(t,e)}},t.prototype.GetPos=function(t){var e=t*(this.itemSize+this.space);return this.isVorizontal?cc.v3(e,0,1):cc.v3(0,-e-this.itemSize/2,1)},t.prototype.RefreshMaxSizeValue=function(){var t=0;this.itemNum>0&&(t=(this.itemSize+this.space)*this.itemNum-this.space);var e=this.list;this.isVorizontal?e.content.setContentSize(cc.size(t,e.node.height)):e.content.setContentSize(cc.size(e.node.width,t))},t.prototype.Clear=function(t){this.lastPos=-1,this.itemNum=0,this.lastRenderStartIndex=-1,this.lastRenderEndIndex=-1,this.Refresh(),t&&(this.pool=[])},t.prototype.Dispose=function(){this.Clear(!0),this.list.node.off("scrolling",this.OnScrollHandler,this),this.list=null,this.itemPrefab=null,this.itemRenderer=null,this.showItemMap=null},t.ADD_SHOW_NUM=1,t}();a.dataList=n,cc._RF.pop()},{}],gameConfig:[function(t,e){"use strict";cc._RF.push(e,"39a39C66KxPO7uy3ZdGQW/k","gameConfig");var i=function(){};i.videoRecordingState=0,i.video_recorder=null,i.videoStartTime=null,i.videoPath=null,i.videoIsExist=0,i.recorderTime=100,i.videoAd=null,i.chaPingErr=!1,i.chaPing=null,i.isFirst=!0,i.guanqia=0,i.gameType=0,i.checkVideo=!1,i.isFirstInGame=!0,i.enterStartSceneIndex=0,i.ishowjiguang=!1,i.jiguangshowtime=10,i.feicuinowdata=[],i.daojishi=300,i.isupscore=!1,i.userInfo={hightScore:0,icon:"",openid:"",name:""},i._gameState=0,i.backGameIndex=0,i.time600=300,i.tryId=-1,i.cebianlingquState=0,i.btnshake=0,i.showDaMoTips=!0,i.showVideoIndex=0,i.autoVideo=!1,e.exports=i,cc._RF.pop()},{}],gameShareAdsVideo:[function(t,e){"use strict";cc._RF.push(e,"db6145SglNKlr0u4Bum7vto","gameShareAdsVideo");var i=t("gameConfig"),a={isdebug:!1,endTime:0,tt_info:{videoTopics:["\u57ce\u5821\u5b88\u536b\u6218","\u9e45\u9e45"]},recording_Video_Start:function(){if(!this.isdebug&&(cc.sys.os===cc.sys.OS_IOS||cc.sys.os===cc.sys.OS_ANDROID)&&cc.sys.platform===cc.sys.BYTEDANCE_GAME){if(console.log("\u5f55\u5236\u89c6\u9891\u5f00\u59cb"),"devtools"==tt.getSystemInfoSync().appName)return console.log("\u5f00\u53d1\u5de5\u5177\u4e0d\u64cd\u4f5c");i.videoRecordingState=1,i.videoIsExist=0,i.video_recorder=tt.getGameRecorderManager(),i.videoStartTime=Date.parse(new Date),i.video_recorder.onStart(function(){console.log("\u5f55\u5c4f\u5f00\u59cb")}),i.video_recorder.start({duration:i.recorderTime}),i.video_recorder.onStop(function(t){console.log("\u7ed3\u675f\u56de\u8c03"),i.videoRecordingState=2,i.videoPath=t.videoPath}),i.video_recorder.onError(function(t){console.log("\u5f55\u5c4ferror",t)})}},recording_Video_End:function(){if(!this.isdebug&&(cc.sys.os===cc.sys.OS_IOS||cc.sys.os==cc.sys.OS_ANDROID)&&(console.log("\u5f55\u5236\u89c6\u9891\u7ed3\u675f"),cc.sys.platform===cc.sys.BYTEDANCE_GAME)){if("devtools"==tt.getSystemInfoSync().appName)return console.log("\u5f00\u53d1\u5de5\u5177\u4e0d\u64cd\u4f5c");console.log("\u5f55\u5c4f\u7ed3\u675f"),i.video_recorder&&(console.log("aaaaaa"),this.endTime=Date.parse(new Date),(this.endTime-i.videoStartTime)/1e3<=5?i.videoIsExist=1:i.videoIsExist=0,console.log("bbbbbb"),i.video_recorder.stop())}},recording_Video_Share:function(t,e){if(console.log("\u5f55\u5236\u89c6\u9891\u5206\u4eab"),this.isdebug)return t();if(cc.sys.platform!=cc.sys.WECHAT_GAME&&cc.sys.platform!=cc.sys.BYTEDANCE_GAME)return t();if(cc.sys.os===cc.sys.OS_IOS||cc.sys.os==cc.sys.OS_ANDROID){var a=this;if(cc.sys.platform==cc.sys.BYTEDANCE_GAME){if(1==i.videoIsExist)return void a.showToast("\u5f55\u5236\u65f6\u95f4\u8fc7\u77ed");i.videoRecordingState=3,tt.shareAppMessage({channel:"video",title:"",imageUrl:"",query:"",extra:{videoPath:i.videoPath,videoTopics:a.tt_info.videoTopics,createChallenge:!0},success:function(){a.showToast("\u5206\u4eab\u89c6\u9891\u6210\u529f"),t()},fail:function(){a.showToast("\u5206\u4eab\u89c6\u9891\u5931\u8d25"),e()}})}}}};e.exports=a,cc._RF.pop()},{gameConfig:"gameConfig"}],mainGame:[function(t,e,i){"use strict";cc._RF.push(e,"798c7N1y+5J7qspLvwUzkPW","mainGame");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("ResMgr"),s=a("LoadingPanel"),r=a("DataMgr"),l=a("TTCloudMgr"),c=cc._decorator,h=c.ccclass,d=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.LoadingPanel=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.getComponent(cc.Widget).updateAlignment(),String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,i){return void 0!==t[i]?t[i]:e})}},e.prototype.start=function(){var t=this;l.default.ins.init(function(){t.startLoading()}),this.initDebug()},e.prototype.initDebug=function(){cc.addCoin=function(){r.default.Instance().getPlayerData().setUserCoin(100)}},e.prototype.startLoading=function(){var t=this,e=cc.instantiate(this.LoadingPanel);this.node.addChild(e),e.getComponent(s.default).startLoading(function(){var e=o.default.Instance().getRes("res","prefab/MainPanel/mainUI");if(e){var i=cc.instantiate(e);t.node.addChild(i),cc.assetManager.releaseAsset(t.LoadingPanel)}else console.error("\u4e3bUI\u9884\u5236\u4f53\u4e22\u5931!")})},__decorate([d({type:cc.Prefab,displayName:"\u767b\u5f55\u754c\u9762"})],e.prototype,"LoadingPanel",void 0),__decorate([h],e)}(cc.Component);n.default=u,cc._RF.pop()},{}],mainUI:[function(t,e,i){"use strict";cc._RF.push(e,"dbd9fzvM2RIW5Arme2KVuUB","mainUI");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("EventMgr"),s=a("ResMgr"),r=a("Tips"),l=a("UIComp"),c=a("typeEnum"),h=cc._decorator,d=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MainContainer=null,e.time=0,e.open=!0,e.abName="res",e}return __extends(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.node.getComponent(cc.Widget).updateAlignment()},e.prototype.start=function(){var e=this;t.prototype.start.call(this),o.default.Instance().onTips(this.onShowTips,this),o.default.Instance().onHideTips(this.hideTips,this),o.default.Instance().onInterludeMask(this.interludeShow,this),o.default.Instance().onShowOrHideMainPanel(function(t){e.MainContainer.opacity=t.show?255:0},this);var i=s.default.Instance().getRes("res","prefab/MainPanel/MainPanel");if(i){var a=cc.instantiate(i);this.MainContainer.addChild(a)}else console.error("\u4e3b\u754c\u9762\u9884\u5236\u4f53\u4e22\u5931!")},e.prototype.onShowTips=function(t,e){return void 0===e&&(e=1.5),__awaiter(this,void 0,void 0,function(){var i,a;return __generator(this,function(n){switch(n.label){case 0:return this.TipsPrefab?[3,2]:(i=this,[4,s.default.Instance().loadAndGetRes("res","prefab/tips/Tips")]);case 1:i.TipsPrefab=n.sent(),n.label=2;case 2:return this.TipsParent.childrenCount>=3?[2]:((a=cc.instantiate(this.TipsPrefab)).getComponent(r.default).setTipsInfo(t,e),this.TipsParent.addChild(a),[2])}})})},e.prototype.hideTips=function(){this.TipsParent.destroyAllChildren()},e.prototype.interludeShow=function(){var t=this;this.open=!0,cc.Tween.stopAllByTag(c.TweenTag.interludeMaskClose),this.interludeOver=!1,this.interludeMask.active=!0,this.interludeMask.opacity=0,cc.tween(this.interludeMask).to(.5,{opacity:255}).call(function(){t.interludeOver=!0}).tag(c.TweenTag.interludeMaskOpen).start()},e.prototype.interludeColse=function(){var t=this;this.interludeOver&&(cc.Tween.stopAllByTag(c.TweenTag.interludeMaskOpen),cc.tween(this.interludeMask).to(.1,{opacity:0}).call(function(){t.interludeMask.active=!1,t.interludeMask.opacity=0}).tag(c.TweenTag.interludeMaskClose).start(),this.open=!1)},e.prototype.update=function(t){this.open&&(this.time+=t,this.time>.1&&(this.interludeColse(),this.time=0))},__decorate([u({displayName:"\u4e3b\u9762\u677f\u5bb9\u5668\u8282\u70b9",type:cc.Node})],e.prototype,"MainContainer",void 0),__decorate([d],e)}(l.default);n.default=p,cc._RF.pop()},{}],poolOnce:[function(t,e,i){"use strict";cc._RF.push(e,"add599WfApOILomfLegUs5w","poolOnce");var a=i;Object.defineProperty(a,"__esModule",{value:!0}),a.PoolArray=a.Pool=a.PoolOnce=void 0;var n=function(){function t(t,e,i,a){this.maxCount=10,this.onObj=null,this.onClear=null,this.onDestroy=null,this.data=[],this.maxCount=t,this.onObj=e,this.onClear=i,this.onDestroy=a}return t.prototype.get=function(){var t=this.data.pop();return t||(t=this.onObj()),this.onClear(t),t},t.prototype.put=function(t){this.onClear(t);var e=this.data.length;if(e>this.maxCount){var i=this.data.shift();i&&(this.onClear(i),this.onDestroy&&this.onDestroy(i)),this.put(t)}else this.data[e]=t},t.prototype.clear=function(){for(var t=0,e=this.data;t<e.length;t++){var i=e[t];this.onClear(i),this.onDestroy&&this.onDestroy(i)}this.data.length=0},t.prototype.size=function(){return this.data.length},t}();a.PoolOnce=n;var o=function(){function t(t,e,i,a){this.maxCount=10,this.onObj=null,this.onClear=null,this.onDestroy=null,this.datas=new Map,this.maxCount=t,this.onObj=e,this.onClear=i,this.onDestroy=a}return t.prototype.get=function(t){return this.pool(t).get()},t.prototype.put=function(t){return this.pool(t.poolLoadUrl).put(t)},t.prototype.clear=function(){this.datas.forEach(function(t){return t.clear()}),this.datas.clear()},t.prototype.size=function(){var t=0;return this.datas.forEach(function(e){t+=e.size()}),t},t.prototype.pool=function(t){var e=this,i=this.datas.get(t);return i||(i=new n(this.maxCount,function(){var i=e.onObj(t);return i.poolLoadUrl=t,i},function(i){return e.onClear(i,t)},this.onDestroy?function(i){return e.onDestroy(i,t)}:null),this.datas.set(t||"pool",i)),i},t}();a.Pool=o;var s=function(){function t(t){this.data=[],this.pool=null,this.pool=t}return t.prototype.clear=function(){for(var t=0,e=this.data;t<e.length;t++){var i=e[t];this.pool.put(i)}this.data.length=0},t.prototype.add=function(){var t=this.pool.get();return this.data[this.data.length]=t,t},t.prototype.size=function(){return this.data.length},t.prototype.get=function(t){return this.data[t]},t}();a.PoolArray=s,cc._RF.pop()},{}],spriteFrameControl:[function(t,e,i){"use strict";cc._RF.push(e,"17b19LGaJhJfoFUTzerP+ov","spriteFrameControl");var a=i;Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,s=n.property,r=n.menu,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprframs=[],e.spr=null,e.index=-1,e}return __extends(e,t),e.prototype.onLoad=function(){this.spr=this.node.getComponent(cc.Sprite)},e.prototype.setSpriteFramebyIndex=function(t){this.spr||(this.spr=this.node.getComponent(cc.Sprite)),this.spr&&(this.spr.spriteFrame=this.sprframs[t],this.index=t)},e.prototype.setSpriteFramebyName=function(t){if(this.spr||(this.spr=this.node.getComponent(cc.Sprite)),this.spr){var e=-1,i=this.sprframs.find(function(i,a){return e=a,i.name==t});i&&(this.spr.spriteFrame=i,this.index=e)}},e.prototype.getSpriteFramebyIndex=function(t){if(this.spr)return this.sprframs[t]},e.prototype.getSpriteFramebyName=function(t){if(this.spr)return this.sprframs.find(function(e){return e.name==t})},__decorate([s(cc.SpriteFrame)],e.prototype,"sprframs",void 0),__decorate([o,r("Control/spriteFrameControl")],e)}(cc.Component);a.default=l,cc._RF.pop()},{}],suspendPanel:[function(t,e,i){"use strict";cc._RF.push(e,"f9dd89eU71Kh5wIedmo6i1H","suspendPanel");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0});var o=a("PanelBase"),s=a("AudioMgr"),r=a("BattleFightMgr"),l=a("EventMgr"),c=cc._decorator,h=c.ccclass,d=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFullScreen=!1,e.closeBtn=null,e.yesBtn=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.node.getComponent(cc.Widget).updateAlignment()},e.prototype.onEnable=function(){r.default.Instance().suspend=!0,this.closeBtn.on("click",this.emitCloseMe,this),this.yesBtn.on("click",this.yesBtnClick,this)},e.prototype.onDisable=function(){this.closeBtn.off("click",this.emitCloseMe,this),this.yesBtn.off("click",this.yesBtnClick,this)},e.prototype.emitCloseMe=function(){r.default.Instance().suspend=!1,t.prototype.emitCloseMe.call(this)},e.prototype.yesBtnClick=function(){s.default.Instance().playEffect(6),r.default.Instance().suspend=!1,l.default.Instance().emitGameOver(!1),t.prototype.emitCloseMe.call(this)},__decorate([d(cc.Node)],e.prototype,"closeBtn",void 0),__decorate([d(cc.Node)],e.prototype,"yesBtn",void 0),__decorate([h],e)}(o.default);n.default=u,cc._RF.pop()},{}],temp:[function(t,e){"use strict";cc._RF.push(e,"5e3a5ToFx5M75Gyu3Kaa1pl","temp"),cc._RF.pop()},{}],typeEnum:[function(t,e,i){"use strict";cc._RF.push(e,"63e09XTRC5EhZh3bArhCO+U","typeEnum");var a=i;Object.defineProperty(a,"__esModule",{value:!0}),a.EquipGlobalType=a.EquipType=a.MaxLevel=a.RedDotId=a.dungeonsGameType=a.dungeonsOpenType=a.CardsPanelInterfaceType=a.MainPanelTitleType=a.CostType=a.CurrencyType=a.LanguageType=a.EnumDefine=a.GuideStep=a.CardAddType=a.TweenTag=a.BossAttackType=a.AttackType=a.RoleBaseType=a.AnimType=a.PanelType=void 0,function(t){t[t.BattleTip=0]="BattleTip",t[t.NormalPanel=1]="NormalPanel",t[t.HighPanel=2]="HighPanel"}(a.PanelType||(a.PanelType={})),function(t){t[t.Circular=0]="Circular",t[t.Bounce=1]="Bounce"}(a.AnimType||(a.AnimType={})),function(t){t[t.Interval=0]="Interval",t[t.Move=1]="Move",t[t.Attack=2]="Attack",t[t.Dide=3]="Dide",t[t.Birth=4]="Birth",t[t.BirthOut=5]="BirthOut",t[t.MoveOut=6]="MoveOut"}(a.RoleBaseType||(a.RoleBaseType={})),function(t){t[t.AinmStart=0]="AinmStart",t[t.AinmIng=1]="AinmIng",t[t.AinmOver=2]="AinmOver",t[t.Default=3]="Default",t[t.Prepare=4]="Prepare",t[t.OnGo=5]="OnGo",t[t.End=6]="End",t[t.Over=7]="Over"}(a.AttackType||(a.AttackType={})),function(t){t[t.AinmStandby=0]="AinmStandby",t[t.AinmOver=1]="AinmOver",t[t.AinmDie=2]="AinmDie",t[t.AinmBirth=3]="AinmBirth",t[t.AinmAttack=4]="AinmAttack",t[t.Default=5]="Default",t[t.Prepare=6]="Prepare",t[t.OnGo=7]="OnGo",t[t.End=8]="End",t[t.Over=9]="Over"}(a.BossAttackType||(a.BossAttackType={})),function(t){t[t.interludeMaskOpen=0]="interludeMaskOpen",t[t.interludeMaskClose=1]="interludeMaskClose",t[t.meat=2]="meat",t[t.meatTow=3]="meatTow",t[t.task=4]="task",t[t.taskEnd=5]="taskEnd",t[t.taskStart=6]="taskStart",t[t.white=7]="white",t[t.buildDie=8]="buildDie",t[t.OnlineRewardBtn=9]="OnlineRewardBtn",t[t.zembieMeat=10]="zembieMeat",t[t.zembieMeatTow=11]="zembieMeatTow",t[t.LegendMeat=12]="LegendMeat",t[t.LegendMeatTow=13]="LegendMeatTow",t[t.LegendRoleBaseTalk=14]="LegendRoleBaseTalk",t[t.BossMeat=15]="BossMeat",t[t.BossMeatTow=16]="BossMeatTow",t[t.BossRoleBaseTalk=17]="BossRoleBaseTalk"}(a.TweenTag||(a.TweenTag={})),function(t){t[t.RoleHP=1]="RoleHP",t[t.RoleAtk=2]="RoleAtk",t[t.BuildHp=3]="BuildHp",t[t.meatUp=4]="meatUp",t[t.coinAdd=5]="coinAdd"}(a.CardAddType||(a.CardAddType={})),function(t){t[t.StartFight=1]="StartFight",t[t.ProductionSchedule=2]="ProductionSchedule",t[t.FoodUnsatisfied=3]="FoodUnsatisfied",t[t.FoodSatisfaction=4]="FoodSatisfaction",t[t.GetDoubleReward=5]="GetDoubleReward",t[t.ClickUpgradesPanel=6]="ClickUpgradesPanel",t[t.UpgradeOutputFoodSpeed=7]="UpgradeOutputFoodSpeed",t[t.SendArmySpeedTips=8]="SendArmySpeedTips",t[t.BaseBloodVolumeTips=9]="BaseBloodVolumeTips",t[t.UnlockArmyTips=10]="UnlockArmyTips",t[t.ClickEvolve=11]="ClickEvolve",t[t.EvolutionaryAgeUnlockArmyTips=12]="EvolutionaryAgeUnlockArmyTips",t[t.EvolutionaryAgeResetCoinTips=13]="EvolutionaryAgeResetCoinTips",t[t.ClickCard=14]="ClickCard",t[t.ClickDrawCard=15]="ClickDrawCard",t[t.ClickNewCard=16]="ClickNewCard",t[t.CardAttributeIntroduction=17]="CardAttributeIntroduction",t[t.CheckAllCardAttribute=18]="CheckAllCardAttribute",t[t.Complete=1e4]="Complete",t[t.SkillClickCards=10001]="SkillClickCards",t[t.SkillClickCardsSkillBtn=10002]="SkillClickCardsSkillBtn",t[t.SKillClickDrawSkill=10003]="SKillClickDrawSkill",t[t.SkillClickNewSkill=10004]="SkillClickNewSkill",t[t.SkillClickEquipSkill=10005]="SkillClickEquipSkill",t[t.SkillCheckSkillSlot=10006]="SkillCheckSkillSlot",t[t.SkillCheckSkillUse=10007]="SkillCheckSkillUse",t[t.SkillComplete=2e4]="SkillComplete"}(a.GuideStep||(a.GuideStep={})),function(t){(function(t){t.loading_start="loading_start",t.loading_end="loading_end",t.going_main="going_main",t.going_game="going_game",t.play_AD="play_AD",t.level_num="level_num",t.play_level="play_level",t.unlock_arm="unlock_arm",t.basic_skills_click="basic_skills_click",t.card_draws="card_draws",t.Card_pool_level="Card_pool_level",t.Level_up_basic_skills="Level_up_basic_skills",t.guide_step="guide_step",t.skip_guide="skip_guide",t.online_reward="online_reward",t.test_bug="test_bug",t.new_level_pass="new_level_pass",t.tt_cloud_read_fail="tt_cloud_read_fail",t.tt_login_fail="tt_login_fail",t.tt_cloud_update_fail="tt_cloud_update_fail",t.tt_cloud_new1_fail="tt_cloud_new1_fail",t.tt_cloud_new2_fail="tt_cloud_new2_fail",t.tt_cloud_enter_fail="tt_cloud_enter_fail",t.tt_cloud_force_save_fail="tt_cloud_force_save_fail"})(t.fieldName||(t.fieldName={})),function(t){t.addMeatOnPlayStat="addMeatOnPlayStat",t.addMeatOnPlayEnd="addMeatOnPlayEnd",t.addGodOnGameOverStat="addGodOnGameOverStat",t.addGodOnGameOverEnd="addGodOnGameOverEnd",t.shopStat="shopStat",t.shopEnd="shopEnd",t.addMeat="addMeat",t.addBuild="addBuild",t.cardOne="cardOne",t.cardTen="cardTen",t.meat="meat",t.build="build",t.timeScale="timeScale"}(t.fieldDes||(t.fieldDes={}))}(a.EnumDefine||(a.EnumDefine={})),function(t){t.CN="CN",t.TN="TN"}(a.LanguageType||(a.LanguageType={})),function(t){t[t.Coin=1]="Coin",t[t.Diamond=2]="Diamond",t[t.Potion=3]="Potion",t[t.Talent=4]="Talent",t[t.ZembieKey=5]="ZembieKey",t[t.LegendKey=6]="LegendKey",t[t.BossKey=7]="BossKey"}(a.CurrencyType||(a.CurrencyType={})),function(t){t[t.Ad=1]="Ad",t[t.Diamond=2]="Diamond"}(a.CostType||(a.CostType={})),function(t){t[t.ShowText=0]="ShowText",t[t.ShowTextAndNum=1]="ShowTextAndNum"}(a.MainPanelTitleType||(a.MainPanelTitleType={})),function(t){t[t.card=0]="card",t[t.skill=1]="skill",t[t.talent=2]="talent",t[t.equip=3]="equip"}(a.CardsPanelInterfaceType||(a.CardsPanelInterfaceType={})),(a.dungeonsOpenType||(a.dungeonsOpenType={})).timeline="1",function(t){t[t.Zembie=1]="Zembie",t[t.Legend=2]="Legend",t[t.Boss=3]="Boss"}(a.dungeonsGameType||(a.dungeonsGameType={})),function(t){t[t.DungeonsBtn=1]="DungeonsBtn",t[t.UpgradeBtn=2]="UpgradeBtn",t[t.BattleBtn=3]="BattleBtn",t[t.CardsPanlBtn=4]="CardsPanlBtn",t[t.CardsPanelSkillBtn=5]="CardsPanelSkillBtn",t[t.CardsPanelTalentBtn=6]="CardsPanelTalentBtn",t[t.ShopPanelBtn=7]="ShopPanelBtn",t[t.UpgradePanelUpgradeBtn=8]="UpgradePanelUpgradeBtn"}(a.RedDotId||(a.RedDotId={})),function(t){t[t.Legend=21]="Legend",t[t.Zembie=20]="Zembie",t[t.Boss=10]="Boss"}(a.MaxLevel||(a.MaxLevel={})),function(t){t[t.weapon=1]="weapon",t[t.armour=2]="armour",t[t.head=3]="head",t[t.ring=4]="ring",t[t.necklace=5]="necklace"}(a.EquipType||(a.EquipType={})),function(t){t[t.global=1]="global",t[t.equip=2]="equip"}(a.EquipGlobalType||(a.EquipGlobalType={})),cc._RF.pop()},{}],umSDK:[function(t,e,i){"use strict";cc._RF.push(e,"2660a1yYiNBAKTBtNqOJ0rJ","umSDK");var a=t,n=i;Object.defineProperty(n,"__esModule",{value:!0}),a("Global"),a("Set");var o=function(){function t(){this._sendByEventKey=[]}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!1,configurable:!0}),t.prototype.send=function(){},t}();n.default=o,cc._RF.pop()},{}]},{},["GameData","AudioMgr","BaitRole","BaitRoleBase","BattleFightMgr","BattleFightPanel","BattlePanel","BossBuild","BossDropItem","BossDropPanel","BossDropProbabilityPanel","BossEnemy","BossEnterPanel","BossFightPanel","BossItem","BossNPCBase","BossRole","BtnEffect","BuildBase","Bullet","CacheMgr","CardGetPanel","CardUIScript","CardsAddition","CardsInfo","CardsItem","CardsItemForGet","CardsPanel","CardsProbabilityPanel","Common","CompBase","ConfigMgr","ContinuousClick","DailyTaskMgr","DataMgr","DataMgrBase","DebugSDK","DieAnimPre","DungeonBullet","DungeonFightMgr","DungeonSuspendPanel","DungeonsEnd","DungeonsItem","DungeonsPanel","EquipDetailPanel","EquipMgr","EquipPanel","EquipUIScript","EventMgr","EventMgrBase","EvoPassPanel","EvolutionProcessPanel","EvolutionProcessPanelItem","FlyCoin","GameMgr","GameOverPanel","Global","Guide","GuideMgr","GuidePanel","Hero","HeroDetailPanel","HeroGetPanel","HeroItemForGet","HeroMgr","HeroPanel","HeroRole","HeroRoleBase","IVector2","IVector3","ItemEquipSlot","ItemEquipUpLv","ItemHero","ItemHeroSkill","LanguageMgr","LanguageScript","LegendBuildBase","LegendEnterPanel","LegendFightPanel","LegendItem","LegendRole","LegendRoleBase","LoadingPanel","MainPanel","Maths","OPPOSDK","Observer","OnlineRewardBtnScript","OnlineRewardItemScript","OnlineRewardMgr","OnlineRewardPanel","PanelBase","RedDotMgr","RedDotScript","ResMgr","Role","RoleBase","RoundRectMask","SDKBase","SDKMgr","Set","SettingPanel","ShopItem","ShopPanel","Singleton","SkillBase","SkillBtnItem","SkillGetPanel","SkillInfoPanel","SkillItemForGet","SkillItemScript","SkillMgr","SkillSlotItemScript","SkillUIScript","Skill_Bait","Skill_Buff","Skill_Ice","Skill_Meteor","Skill_Morale","Skill_Push","Skill_Recover","Skill_Wave","SkipGuidePanel","SuperListItem","SuperScrollView","TTCloudMgr","TTSDK","TalentAddition","TalentBase","TalentFly","TalentInfoPanel","TalentItemScript","TalentLayoutItemScript","TalentMgr","TalentResetPanel","TalentSkillMgr","TalentUIScript","Talent_ArmyAtk","Talent_ArmyHp","Talent_BaseHp","Talent_CoinAd","Talent_CoinDouble","Talent_CoinGet","Talent_CritAtk","Talent_CritRate","Talent_DropRate","Talent_KeepProgress","Talent_MeatProduce","Talent_MissRate","Talent_MoveRate","Talent_SpeedRate","Talent_SweepZombie","Task","TaskMgrBase","TimeScaleScript","TimerMgr","Tips","TweenMaterial","UIBroadside","UIComp","UIGMPlan","UpgradesPanel","UtilOne","VIVOSDK","WXSDK","ZembieBuildBase","ZembieDieAnimPre","ZembieEnterPanel","ZembieFightPanel","ZembieItem","ZembieRole","ZembieRoleBase","base64","curve","dataList","gameConfig","gameShareAdsVideo","mainGame","mainUI","poolOnce","spriteFrameControl","suspendPanel","typeEnum","umSDK","temp"]);